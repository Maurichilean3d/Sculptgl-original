/*! For license information please see sculptgl.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sculptgl=t():e.sculptgl=t()}(self,()=>(()=>{var __webpack_modules__={2(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var gl_matrix__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(827),gl_matrix__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(322),math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(693),misc_Tablet__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(142),misc_Utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(445),gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(865);function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var _TMP_NEAR=[0,0,0],_TMP_NEAR_1=[0,0,0],_TMP_FAR=[0,0,0],_TMP_INV=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt(),_TMP_INTER=[0,0,0],_TMP_INTER_1=[0,0,0],_TMP_V1=[0,0,0],_TMP_V2=[0,0,0],_TMP_V3=[0,0,0],Picking=function(){function e(t,i){_classCallCheck(this,e),this._mesh=null,this._main=t,this._pickedFace=-1,this._pickedVertices=[],this._interPoint=[0,0,0],this._rLocal2=0,this._rWorld2=0,this._eyeDir=[0,0,0],this._xSym=!!i,this._pickedNormal=[0,0,0],this._alphaOrigin=[0,0,0],this._alphaSide=0,this._alphaLookAt=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt(),this._alpha=null}return _createClass(e,[{key:"setIdAlpha",value:function(t){this._alpha=e.ALPHAS[t]}},{key:"getAlpha",value:function(e,t,i){var r=this._alpha;if(!r||!r._texture)return 1;var n=this._alphaLookAt,a=this._alphaSide,s=r._ratioY*(n[0]*e+n[4]*t+n[8]*i+n[12])/(this._xSym?-a:a);if(Math.abs(s)>1)return 0;var o=r._ratioX*(n[1]*e+n[5]*t+n[9]*i+n[13])/a;if(Math.abs(o)>1)return 0;var l=r._width;return s=(.5-.5*s)*l,o=(.5-.5*o)*r._height,r._texture[(0|s)+l*(0|o)]/255}},{key:"updateAlpha",value:function(e){var t=_TMP_V1,i=_TMP_V2,r=Math.sqrt(this._rLocal2);if(this._alphaSide=r*Math.SQRT1_2,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.jb(t,this._interPoint,this._alphaOrigin),0!==gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Il(t)){gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(t,t);var n=this._pickedNormal;gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,n,-gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Om(t,n)),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(t,t),e||gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._alphaOrigin,this._interPoint),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(i,this._alphaOrigin,n,r),gl_matrix__WEBPACK_IMPORTED_MODULE_0__.t5(this._alphaLookAt,this._alphaOrigin,i,t)}}},{key:"initAlpha",value:function(){this.computePickedNormal(),this.updateAlpha()}},{key:"getMesh",value:function(){return this._mesh}},{key:"setLocalRadius2",value:function(e){this._rLocal2=e}},{key:"getLocalRadius2",value:function(){return this._rLocal2}},{key:"getLocalRadius",value:function(){return Math.sqrt(this._rLocal2)}},{key:"getWorldRadius2",value:function(){return this._rWorld2}},{key:"getWorldRadius",value:function(){return Math.sqrt(this._rWorld2)}},{key:"setIntersectionPoint",value:function(e){this._interPoint=e}},{key:"getEyeDirection",value:function(){return this._eyeDir}},{key:"getIntersectionPoint",value:function(){return this._interPoint}},{key:"getPickedVertices",value:function(){return this._pickedVertices}},{key:"getPickedFace",value:function(){return this._pickedFace}},{key:"getPickedNormal",value:function(){return this._pickedNormal}},{key:"intersectionMouseMeshes",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMeshes(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,r=this.unproject(t,i,0),n=this.unproject(t,i,.1),a=1/0,s=null,o=-1,l=0,u=e.length;l<u;++l){var c=e[l];if(c.isVisible()&&(gl_matrix__WEBPACK_IMPORTED_MODULE_0__.B8(_TMP_INV,c.getMatrix()),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_NEAR_1,r,_TMP_INV),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_FAR,n,_TMP_INV),this.intersectionRayMesh(c,_TMP_NEAR_1,_TMP_FAR))){var h=this.getIntersectionPoint(),d=gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(_TMP_NEAR_1,h)*c.getScale();d<a&&(a=d,s=c,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_INTER_1,h),o=this.getPickedFace())}}return this._mesh=s,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._interPoint,_TMP_INTER_1),this._pickedFace=o,-1!==o&&this.updateLocalAndWorldRadius2(),!!s}},{key:"intersectionMouseMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMesh(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,r=this.unproject(t,i,0),n=this.unproject(t,i,.1),a=gl_matrix__WEBPACK_IMPORTED_MODULE_0__.vt();return gl_matrix__WEBPACK_IMPORTED_MODULE_0__.B8(a,e.getMatrix()),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(r,r,a),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(n,n,a),this.intersectionRayMesh(e,r,n)}},{key:"intersectionRayMesh",value:function(e,t,i){if(this._mesh=null,this._pickedFace=-1,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_NEAR,t),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(_TMP_FAR,i),this._xSym){var r=e.getSymmetryOrigin(),n=e.getSymmetryNormal();math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.mirrorPoint(_TMP_NEAR,r,n),math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.mirrorPoint(_TMP_FAR,r,n)}var a=e.getVertices(),s=e.getFaces(),o=this.getEyeDirection();gl_matrix__WEBPACK_IMPORTED_MODULE_1__.jb(o,_TMP_FAR,_TMP_NEAR),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(o,o);for(var l=e.intersectRay(_TMP_NEAR,o),u=1/0,c=l.length,h=0;h<c;++h){var d=4*l[h],p=3*s[d],_=3*s[d+1],f=3*s[d+2];_TMP_V1[0]=a[p],_TMP_V1[1]=a[p+1],_TMP_V1[2]=a[p+2],_TMP_V2[0]=a[_],_TMP_V2[1]=a[_+1],_TMP_V2[2]=a[_+2],_TMP_V3[0]=a[f],_TMP_V3[1]=a[f+1],_TMP_V3[2]=a[f+2];var g=math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V2,_TMP_V3,_TMP_INTER);g<0&&(_=s[d+3])!==misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX&&(_*=3,_TMP_V2[0]=a[_],_TMP_V2[1]=a[_+1],_TMP_V2[2]=a[_+2],g=math3d_Geometry__WEBPACK_IMPORTED_MODULE_2__.A.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V3,_TMP_V2,_TMP_INTER)),g>=0&&g<u&&(u=g,gl_matrix__WEBPACK_IMPORTED_MODULE_1__.C(this._interPoint,_TMP_INTER),this._pickedFace=l[h])}return-1!==this._pickedFace?(this._mesh=e,this.updateLocalAndWorldRadius2(),!0):(this._rLocal2=0,!1)}},{key:"pickVerticesInSphere",value:function(e){for(var t=this._mesh,i=t.getVertices(),r=t.getVerticesSculptFlags(),n=this.getIntersectionPoint(),a=t.intersectSphere(n,e,!0),s=t.getVerticesFromFaces(a),o=s.length,l=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.SCULPT_FLAG,u=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.getMemory(4*o),0,o),c=0,h=n[0],d=n[1],p=n[2],_=0;_<o;++_){var f=s[_],g=3*f,m=h-i[g],v=d-i[g+1],y=p-i[g+2];m*m+v*v+y*y<e&&(r[f]=l,u[c++]=f)}return this._pickedVertices=new Uint32Array(u.subarray(0,c)),this._pickedVertices}},{key:"_isInsideSphere",value:function(e,t,i){if(e===misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX)return!1;var r=3*e;return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.lo(t,this._mesh.getVertices().subarray(r,r+3))<=i}},{key:"pickVerticesInSphereTopological",value:function(e){var t=this._mesh,i=t.getNbVertices(),r=t.getVertices(),n=t.getFaces(),a=t.getVerticesRingVertStartCount(),s=t.getVerticesRingVert(),o=s instanceof Array?s:null,l=t.getVerticesSculptFlags(),u=t.getVerticesTagFlags(),c=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.SCULPT_FLAG,h=++misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TAG_FLAG,d=this.getIntersectionPoint(),p=d[0],_=d[1],f=d[2],g=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.getMemory(4*i),0,i),m=4*this.getPickedFace(),v=1;this._isInsideSphere(n[m],d,e)?g[0]=n[m]:this._isInsideSphere(n[m+1],d,e)?g[0]=n[m+1]:this._isInsideSphere(n[m+2],d,e)?g[0]=n[m+2]:this._isInsideSphere(n[m+3],d,e)?g[0]=n[m+3]:v=0,1===v&&(l[g[0]]=c,u[g[0]]=h);for(var y=0;y<v;++y){var b,A,T=g[y];o?(b=0,A=(s=o[T]).length):A=(b=a[2*T])+a[2*T+1];for(var M=b;M<A;++M){var S=s[M];if(u[S]!==h){u[S]=h;var E=3*S,R=p-r[E],k=_-r[E+1],x=f-r[E+2];R*R+k*k+x*x>e||(l[S]=c,g[v++]=S)}}}return this._pickedVertices=new Uint32Array(g.subarray(0,v)),this._pickedVertices}},{key:"computeWorldRadius2",value:function(e){gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Z0(_TMP_INTER,this.getIntersectionPoint(),this._mesh.getMatrix());var t=this._main.getSculptManager().getCurrentTool().getScreenRadius();e||(t*=misc_Tablet__WEBPACK_IMPORTED_MODULE_3__.A.getPressureRadius());var i=this.project(_TMP_INTER);return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.lo(_TMP_INTER,this.unproject(i[0]+t,i[1],i[2]))}},{key:"updateLocalAndWorldRadius2",value:function(){this._mesh&&(this._rWorld2=this.computeWorldRadius2(),this._rLocal2=this._rWorld2/this._mesh.getScale2())}},{key:"unproject",value:function(e,t,i){return this._main.getCamera().unproject(e,t,i)}},{key:"project",value:function(e){return this._main.getCamera().project(e)}},{key:"computePickedNormal",value:function(){if(this._mesh&&!(this._pickedFace<0))return this.polyLerp(this._mesh.getNormals(),this._pickedNormal),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.S8(this._pickedNormal,this._pickedNormal)}},{key:"polyLerp",value:function(e,t){var i=this._mesh.getVertices(),r=this._mesh.getFaces(),n=4*this._pickedFace,a=3*r[n],s=3*r[n+1],o=3*r[n+2],l=r[n+3],u=l!==misc_Utils__WEBPACK_IMPORTED_MODULE_4__.A.TRI_INDEX;u&&(l*=3);var c=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,i.subarray(a,a+3)),h=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,i.subarray(s,s+3)),d=1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,i.subarray(o,o+3)),p=u?1/gl_matrix__WEBPACK_IMPORTED_MODULE_1__.xg(this._interPoint,i.subarray(l,l+3)):0,_=1/(c+h+d+p);return gl_matrix__WEBPACK_IMPORTED_MODULE_1__.hZ(t,0,0,0),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(a,a+3),c*_),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(s,s+3),h*_),gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(o,o+3),d*_),u&&gl_matrix__WEBPACK_IMPORTED_MODULE_1__.Ln(t,t,e.subarray(l,l+3),p*_),t}}],[{key:"addAlpha",value:function(t,i,r,n){var a={};a._name=n,a._texture=t,a._ratioX=Math.max(1,i/r),a._ratioY=Math.max(1,r/i),a._ratioMax=Math.max(a._ratioX,a._ratioY),a._width=i,a._height=r;for(var s=1;e.ALPHAS[a._name];)a._name=n+s++;return e.ALPHAS[a._name]=a,e.ALPHAS_NAMES[a._name]=a._name,a}}]),e}();Picking.INIT_ALPHAS_NAMES=[(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaSquare"),(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaSkin")],Picking.INIT_ALPHAS_PATHS=["square.jpg","skin.jpg"];var readAlphas=function readAlphas(){if(window.module&&window.module.exports){var fs=eval("require")("fs"),path=eval("require")("path"),directoryPath=path.join(window.__filename,"../resources/alpha");fs.readdir(directoryPath,function(e,t){if(!e)for(var i=0;i<t.length;++i){var r=t[i];"square.jpg"!==r&&"skin.jpg"!==r&&(Picking.INIT_ALPHAS_NAMES.push(r),Picking.INIT_ALPHAS_PATHS.push(r))}})}};readAlphas();var none=(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_5__.A)("alphaNone");Picking.ALPHAS_NAMES={},Picking.ALPHAS_NAMES[none]=none,Picking.ALPHAS={},Picking.ALPHAS[none]=null;const __WEBPACK_DEFAULT_EXPORT__=Picking},13(e,t,i){var r;function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}!function(a,s,o,l){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],h=s.createElement("div"),d=Math.round,p=Math.abs,_=Date.now;function f(e,t,i){return setTimeout(T(e,i),t)}function g(e,t,i){return!!Array.isArray(e)&&(m(e,i[t],i),!0)}function m(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==l)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function v(e,t,i){var r="DEPRECATED METHOD: "+t+"\n"+i+" AT \n";return function(){var t=new Error("get-stack-trace"),i=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",n=a.console&&(a.console.warn||a.console.log);return n&&n.call(a.console,r,i),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function(e){if(e===l||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==l&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t}:Object.assign;var y=v(function(e,t,i){for(var r=Object.keys(t),n=0;n<r.length;)(!i||i&&e[r[n]]===l)&&(e[r[n]]=t[r[n]]),n++;return e},"extend","Use `assign`."),b=v(function(e,t){return y(e,t,!0)},"merge","Use `assign`.");function A(e,t,i){var r,n=t.prototype;(r=e.prototype=Object.create(n)).constructor=e,r._super=n,i&&u(r,i)}function T(e,t){return function(){return e.apply(t,arguments)}}function M(e,t){return"function"==n(e)?e.apply(t&&t[0]||l,t):e}function S(e,t){return e===l?t:e}function E(e,t,i){m(w(t),function(t){e.addEventListener(t,i,!1)})}function R(e,t,i){m(w(t),function(t){e.removeEventListener(t,i,!1)})}function k(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function x(e,t){return e.indexOf(t)>-1}function w(e){return e.trim().split(/\s+/g)}function C(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var r=0;r<e.length;){if(i&&e[r][i]==t||!i&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function D(e,t,i){for(var r=[],n=[],a=0;a<e.length;){var s=t?e[a][t]:e[a];C(n,s)<0&&r.push(e[a]),n[a]=s,a++}return i&&(r=t?r.sort(function(e,i){return e[t]>i[t]}):r.sort()),r}function I(e,t){for(var i,r,n=t[0].toUpperCase()+t.slice(1),a=0;a<c.length;){if((r=(i=c[a])?i+n:t)in e)return r;a++}return l}var F=1;function L(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}var O="ontouchstart"in a,V=I(a,"PointerEvent")!==l,N=O&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",U="mouse",G=["x","y"],j=["clientX","clientY"];function W(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){M(e.options.enable,[e])&&i.handler(t)},this.init()}function z(e,t,i){var r=i.pointers.length,n=i.changedPointers.length,a=1&t&&r-n===0,s=12&t&&r-n===0;i.isFirst=!!a,i.isFinal=!!s,a&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,r=t.pointers,n=r.length;i.firstInput||(i.firstInput=X(t)),n>1&&!i.firstMultiple?i.firstMultiple=X(t):1===n&&(i.firstMultiple=!1);var a=i.firstInput,s=i.firstMultiple,o=s?s.center:a.center,u=t.center=K(r);t.timeStamp=_(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=Z(o,u),t.distance=q(o,u),function(e,t){var i=t.center,r=e.offsetDelta||{},n=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(n=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=n.x+(i.x-r.x),t.deltaY=n.y+(i.y-r.y)}(i,t),t.offsetDirection=H(t.deltaX,t.deltaY);var c,h,d=Y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=p(d.x)>p(d.y)?d.x:d.y,t.scale=s?(c=s.pointers,q((h=r)[0],h[1],j)/q(c[0],c[1],j)):1,t.rotation=s?function(e,t){return Z(t[1],t[0],j)+Z(e[1],e[0],j)}(s.pointers,r):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,r,n,a,s=e.lastInterval||t,o=t.timeStamp-s.timeStamp;if(8!=t.eventType&&(o>25||s.velocity===l)){var u=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,h=Y(o,u,c);r=h.x,n=h.y,i=p(h.x)>p(h.y)?h.x:h.y,a=H(u,c),e.lastInterval=t}else i=s.velocity,r=s.velocityX,n=s.velocityY,a=s.direction;t.velocity=i,t.velocityX=r,t.velocityY=n,t.direction=a}(i,t);var f=e.element;k(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function X(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:d(e.pointers[i].clientX),clientY:d(e.pointers[i].clientY)},i++;return{timeStamp:_(),pointers:t,center:K(t),deltaX:e.deltaX,deltaY:e.deltaY}}function K(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var i=0,r=0,n=0;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:d(i/t),y:d(r/t)}}function Y(e,t,i){return{x:t/e||0,y:i/e||0}}function H(e,t){return e===t?1:p(e)>=p(t)?e<0?2:4:t<0?8:16}function q(e,t,i){i||(i=G);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return Math.sqrt(r*r+n*n)}function Z(e,t,i){i||(i=G);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return 180*Math.atan2(n,r)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&R(this.element,this.evEl,this.domHandler),this.evTarget&&R(this.target,this.evTarget,this.domHandler),this.evWin&&R(L(this.element),this.evWin,this.domHandler)}};var Q={mousedown:1,mousemove:2,mouseup:4};function J(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,W.apply(this,arguments)}A(J,W,{handler:function(e){var t=Q[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:U,srcEvent:e}))}});var $={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},ee={2:B,3:"pen",4:U,5:"kinect"},te="pointerdown",ie="pointermove pointerup pointercancel";function re(){this.evEl=te,this.evWin=ie,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}a.MSPointerEvent&&!a.PointerEvent&&(te="MSPointerDown",ie="MSPointerMove MSPointerUp MSPointerCancel"),A(re,W,{handler:function(e){var t=this.store,i=!1,r=e.type.toLowerCase().replace("ms",""),n=$[r],a=ee[e.pointerType]||e.pointerType,s=a==B,o=C(t,e.pointerId,"pointerId");1&n&&(0===e.button||s)?o<0&&(t.push(e),o=t.length-1):12&n&&(i=!0),o<0||(t[o]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),i&&t.splice(o,1))}});var ne={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ae(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,W.apply(this,arguments)}function se(e,t){var i=P(e.touches),r=P(e.changedTouches);return 12&t&&(i=D(i.concat(r),"identifier",!0)),[i,r]}A(ae,W,{handler:function(e){var t=ne[e.type];if(1===t&&(this.started=!0),this.started){var i=se.call(this,e,t);12&t&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:B,srcEvent:e})}}});var oe={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function le(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},W.apply(this,arguments)}function ue(e,t){var i=P(e.touches),r=this.targetIds;if(3&t&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,a,s=P(e.changedTouches),o=[],l=this.target;if(a=i.filter(function(e){return k(e.target,l)}),1===t)for(n=0;n<a.length;)r[a[n].identifier]=!0,n++;for(n=0;n<s.length;)r[s[n].identifier]&&o.push(s[n]),12&t&&delete r[s[n].identifier],n++;return o.length?[D(a.concat(o),"identifier",!0),o]:void 0}function ce(){W.apply(this,arguments);var e=T(this.handler,this);this.touch=new le(this.manager,e),this.mouse=new J(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function he(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,de.call(this,t)):12&e&&de.call(this,t)}function de(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var r=this.lastTouches;setTimeout(function(){var e=r.indexOf(i);e>-1&&r.splice(e,1)},2500)}}function pe(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],a=Math.abs(t-n.x),s=Math.abs(i-n.y);if(a<=25&&s<=25)return!0}return!1}A(le,W,{handler:function(e){var t=oe[e.type],i=ue.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:B,srcEvent:e})}}),A(ce,W,{handler:function(e,t,i){var r=i.pointerType==B,n=i.pointerType==U;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)he.call(this,t,i);else if(n&&pe.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var _e=I(h.style,"touchAction"),fe=_e!==l,ge="compute",me="auto",ve="manipulation",ye="none",be="pan-x",Ae="pan-y",Te=function(){if(!fe)return!1;var e={},t=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=!t||a.CSS.supports("touch-action",i)}),e}();function Me(e,t){this.manager=e,this.set(t)}Me.prototype={set:function(e){e==ge&&(e=this.compute()),fe&&this.manager.element.style&&Te[e]&&(this.manager.element.style[_e]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return m(this.manager.recognizers,function(t){M(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(x(e,ye))return ye;var t=x(e,be),i=x(e,Ae);return t&&i?ye:t||i?t?be:Ae:x(e,ve)?ve:me}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,n=x(r,ye)&&!Te[ye],a=x(r,Ae)&&!Te[Ae],s=x(r,be)&&!Te[be];if(n){var o=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(o&&l&&u)return}if(!s||!a)return n||a&&6&i||s&&24&i?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Se=32;function Ee(e){this.options=u({},this.defaults,e||{}),this.id=F++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Re(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function ke(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function xe(e,t){var i=t.manager;return i?i.get(e):e}function we(){Ee.apply(this,arguments)}function Ce(){we.apply(this,arguments),this.pX=null,this.pY=null}function Pe(){we.apply(this,arguments)}function De(){Ee.apply(this,arguments),this._timer=null,this._input=null}function Ie(){we.apply(this,arguments)}function Fe(){we.apply(this,arguments)}function Le(){Ee.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Oe(e,t){return(t=t||{}).recognizers=S(t.recognizers,Oe.defaults.preset),new Ve(e,t)}function Ve(e,t){this.options=u({},Oe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(V?re:N?le:O?ce:J))(this,z),this.touchAction=new Me(this,this.options.touchAction),Ne(this,!0),m(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Ne(e,t){var i,r=e.element;r.style&&(m(e.options.cssProps,function(n,a){i=I(r.style,a),t?(e.oldCssProps[i]=r.style[i],r.style[i]=n):r.style[i]=e.oldCssProps[i]||""}),t||(e.oldCssProps={}))}Ee.prototype={defaults:{},set:function(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=xe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)||(e=xe(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===C(t,e=xe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=xe(e,this);var t=C(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function r(i){t.manager.emit(i,e)}i<8&&r(t.options.event+Re(i)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),i>=8&&r(t.options.event+Re(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Se},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=u({},e);if(!M(this.options.enable,[this,t]))return this.reset(),void(this.state=Se);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},A(we,Ee,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,r=6&t,n=this.attrTest(e);return r&&(8&i||!n)?16|t:r||n?4&i?8|t:2&t?4|t:2:Se}}),A(Ce,we,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Ae),24&e&&t.push(be),t},directionTest:function(e){var t=this.options,i=!0,r=e.distance,n=e.direction,a=e.deltaX,s=e.deltaY;return n&t.direction||(6&t.direction?(n=0===a?1:a<0?2:4,i=a!=this.pX,r=Math.abs(e.deltaX)):(n=0===s?1:s<0?8:16,i=s!=this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&n&t.direction},attrTest:function(e){return we.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ke(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),A(Pe,we,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ye]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),A(De,Ee,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[me]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!r||!i||12&e.eventType&&!n)this.reset();else if(1&e.eventType)this.reset(),this._timer=f(function(){this.state=8,this.tryEmit()},t.time,this);else if(4&e.eventType)return 8;return Se},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=_(),this.manager.emit(this.options.event,this._input)))}}),A(Ie,we,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ye]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),A(Fe,we,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ce.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return 30&i?t=e.overallVelocity:6&i?t=e.overallVelocityX:24&i&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=ke(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),A(Le,Ee,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ve]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&n&&i){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||q(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=8,this.tryEmit()},t.interval,this),2):8}return Se},failTimeout:function(){return this._timer=f(function(){this.state=Se},this.options.interval,this),Se},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Oe.VERSION="2.0.7",Oe.defaults={domEvents:!1,touchAction:ge,enable:!0,inputTarget:null,inputClass:null,preset:[[Ie,{enable:!1}],[Pe,{enable:!1},["rotate"]],[Fe,{direction:6}],[Ce,{direction:6},["swipe"]],[Le],[Le,{event:"doubletap",taps:2},["tap"]],[De]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ve.prototype={set:function(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var r=this.recognizers,n=t.curRecognizer;(!n||n&&8&n.state)&&(n=t.curRecognizer=null);for(var a=0;a<r.length;)i=r[a],2===t.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(e),!n&&14&i.state&&(n=t.curRecognizer=i),a++}},get:function(e){if(e instanceof Ee)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=C(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==l&&t!==l){var i=this.handlers;return m(w(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this}},off:function(e,t){if(e!==l){var i=this.handlers;return m(w(e),function(e){t?i[e]&&i[e].splice(C(i[e],t),1):delete i[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=s.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&Ne(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(Oe,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Se,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ve,Input:W,TouchAction:Me,TouchInput:le,MouseInput:J,PointerEventInput:re,TouchMouseInput:ce,SingleTouchInput:ae,Recognizer:Ee,AttrRecognizer:we,Tap:Le,Pan:Ce,Swipe:Fe,Pinch:Pe,Rotate:Ie,Press:De,on:E,off:R,each:m,merge:b,extend:y,assign:u,inherit:A,bindFn:T,prefixed:I}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=Oe,(r=function(){return Oe}.call(t,i,t,e))===l||(e.exports=r)}(window,document)},61(){if(window.Map||(window.Map=function(){this.map={}},window.Map.prototype={set:function(e,t){this.map[e]=t},get:function(e){return this.map[e]}}),!Float32Array.prototype.slice){var e=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=e,Uint8Array.prototype.slice=e,Uint8ClampedArray.prototype.slice=e,Int16Array.prototype.slice=e,Uint16Array.prototype.slice=e,Int32Array.prototype.slice=e,Uint32Array.prototype.slice=e,Float32Array.prototype.slice=e,Float64Array.prototype.slice=e}String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.slice(-e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});for(var t=["moz","webkit"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"];window.requestAnimationFrame||window.alert("browser is too old. Probably no webgl there anyway")},142(e,t,i){"use strict";i.d(t,{A:()=>n});var r={radiusFactor:.75,intensityFactor:0,pressure:.5,getPressureIntensity:function(){return 1+r.intensityFactor*(2*r.pressure-1)},getPressureRadius:function(){return 1+r.radiusFactor*(2*r.pressure-1)}};const n=r},241(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}module=__webpack_require__.nmd(module),window,factory=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===_typeof(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./src/yagui.js")}({"./src/GuiMain.js":function srcGuiMainJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Sidebar */ \"./src/containers/Sidebar.js\");\n/* harmony import */ var containers_Topbar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! containers/Topbar */ \"./src/containers/Topbar.js\");\n\n\n\nclass GuiMain {\n\n  constructor(viewport, callbackResize) {\n    this.domMain = document.createElement('div');\n    this.viewport = viewport;\n\n    this.callbackResize = callbackResize;\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n    }\n    this.cbResize_ = this._onWindowResize.bind(this);\n\n    document.body.appendChild(this.domMain);\n    this.leftSidebar = undefined;\n    this.rightSidebar = undefined;\n    this.topbar = undefined;\n\n    window.addEventListener('resize', this._onWindowResize.bind(this), false);\n  }\n\n  _onWindowResize() {\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n      this.viewport.style.left = '0px';\n      this.viewport.style.top = '0px';\n      if (this.leftSidebar)\n        this.leftSidebar._updateViewportPosition(this.viewport);\n      if (this.rightSidebar)\n        this.rightSidebar._updateViewportPosition(this.viewport);\n      if (this.topbar)\n        this.topbar._updateViewportPosition(this.viewport);\n    }\n    this._updateSidebarsPosition();\n    if (this.callbackResize)\n      this.callbackResize();\n  }\n\n  _updateSidebarsPosition() {\n    if (!this.topbar) return;\n    var off = this.topbar.domTopbar.offsetHeight;\n    if (this.leftSidebar)\n      this.leftSidebar._setTop(off);\n    if (this.rightSidebar)\n      this.rightSidebar._setTop(off);\n  }\n\n  addLeftSidebar() {\n    this.leftSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.leftSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.leftSidebar.domResize);\n\n    this._updateSidebarsPosition();\n    this.leftSidebar._updateViewportPosition(this.viewport);\n    return this.leftSidebar;\n  }\n\n  addRightSidebar() {\n    this.rightSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.rightSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.rightSidebar.domResize);\n\n    this.rightSidebar._onTheRight();\n    this._updateSidebarsPosition();\n    this.rightSidebar._updateViewportPosition(this.viewport);\n    return this.rightSidebar;\n  }\n\n  addTopbar() {\n    this.topbar = new containers_Topbar__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.cbResize_);\n    this.domMain.appendChild(this.topbar.domTopbar);\n\n    this._updateSidebarsPosition();\n    this.topbar._updateViewportPosition(this.viewport);\n    return this.topbar;\n  }\n\n  setVisibility(visible) {\n    this.domMain.hidden = !visible;\n    this._onWindowResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiMain);\n\n\n//# sourceURL=webpack://yagui/./src/GuiMain.js?")},"./src/containers/BaseContainer.js":function srcContainersBaseContainerJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_Button__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/Button */ "./src/widgets/Button.js");\n/* harmony import */ var widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/Checkbox */ "./src/widgets/Checkbox.js");\n/* harmony import */ var widgets_Color__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! widgets/Color */ "./src/widgets/Color.js");\n/* harmony import */ var widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! widgets/Combobox */ "./src/widgets/Combobox.js");\n/* harmony import */ var widgets_Slider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! widgets/Slider */ "./src/widgets/Slider.js");\n/* harmony import */ var widgets_Title__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! widgets/Title */ "./src/widgets/Title.js");\n\n\n\n\n\n\n\n// label : 36%\n// slider : bar 52% + margin 2% + input 10%\n// combobox : 64%\n// color : 64%\nclass BaseContainer {\n\n  constructor() {}\n\n  _addLine(name) {\n    var domLine = document.createElement(\'li\');\n    domLine.innerHTML = name || \'\';\n    this.domUl.appendChild(domLine);\n    return domLine;\n  }\n\n  _createLabel(name) {\n    var domLabel = document.createElement(\'label\');\n    domLabel.className = \'gui-label-side\';\n    domLabel.innerHTML = name || \'\';\n    return domLabel;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  addTitle(name) {\n    var widget = new widgets_Title__WEBPACK_IMPORTED_MODULE_5__["default"](name);\n    this.domUl.appendChild(widget.domText);\n    return widget;\n  }\n\n  addCheckbox(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    domLine.className += \' gui-pointerOnHover gui-glowOnHover\';\n    var domLabel = this._createLabel(name);\n    domLabel.style.overflow = \'visible\';\n    domLabel.className += \' gui-pointerOnHover\';\n    domLine.appendChild(domLabel);\n    domLine.appendChild(widget.domCheckbox);\n    domLine.appendChild(widget.domLabelCheckbox);\n    domLine.addEventListener(\'mousedown\', widget._onMouseDown.bind(widget));\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addCombobox(name, valOrObject, callbackOrKey, options) {\n    var widget = new widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__["default"](valOrObject, callbackOrKey, options);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domSelect.style.width = \'100%\';\n    domLine.appendChild(widget.domSelect);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var widget = new widgets_Slider__WEBPACK_IMPORTED_MODULE_4__["default"](valOrObject, callbackOrKey, min, max, step);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    domLine.appendChild(widget.domInputText);\n    domLine.appendChild(widget.domSlider);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addColor(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Color__WEBPACK_IMPORTED_MODULE_2__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domColor.style.width = \'100%\';\n    domLine.appendChild(widget.domColor);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addButton(name, callbackOrObject, key) {\n    var widget = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name, callbackOrObject, key);\n    var domLine = this._addLine();\n    domLine.appendChild(widget.domButton);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addDualButton(name1, name2, callbackOrObject1, callbackOrObject2, key1, key2) {\n    var widget1 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name1, callbackOrObject1, key1);\n    var widget2 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name2, callbackOrObject2, key2);\n    var domLine = this._addLine();\n    domLine.appendChild(widget2.domButton);\n    domLine.appendChild(widget1.domButton);\n    var style1 = widget1.domButton.style;\n    var style2 = widget2.domButton.style;\n    style1.width = style2.width = \'49%\';\n    style1.marginRight = style2.marginLeft = \'1%\';\n    widget1._setDomContainer(domLine);\n    widget2._setDomContainer(domLine);\n    return [widget1, widget2];\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (BaseContainer);\n\n\n//# sourceURL=webpack://yagui/./src/containers/BaseContainer.js?')},"./src/containers/Folder.js":function srcContainersFolderJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ \"./src/containers/BaseContainer.js\");\n\n\nclass Folder extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domUl = document.createElement('ul');\n    this.domUl.setAttribute('opened', true);\n\n    var domTitle = document.createElement('label');\n    domTitle.innerHTML = name || '';\n\n    domTitle.addEventListener('mousedown', this._onMouseDown.bind(this));\n\n    this.domUl.appendChild(domTitle);\n    this.isOpen = true;\n  }\n\n  _onMouseDown() {\n    this.isOpen = !this.isOpen;\n    this.domUl.setAttribute('opened', this.isOpen);\n  }\n\n  open() {\n    this.isOpen = true;\n    this.domUl.setAttribute('opened', true);\n  }\n\n  close() {\n    this.isOpen = false;\n    this.domUl.setAttribute('opened', false);\n  }\n\n  setVisibility(visible) {\n    if (!visible) this.domUl.setAttribute('opened', false);\n    else if (this.isOpen) this.domUl.setAttribute('opened', true);\n    this.domUl.style.height = visible ? 'auto' : '0px';\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Folder);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Folder.js?")},"./src/containers/Menu.js":function srcContainersMenuJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ "./src/containers/BaseContainer.js");\n/* harmony import */ var widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/MenuButton */ "./src/widgets/MenuButton.js");\n\n\n\nclass Menu extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__["default"] {\n\n  constructor() {\n    super();\n\n    this.domUl = document.createElement(\'ul\');\n  }\n\n  addButton(name, callbackOrObject, shortcutOrKey, shortcut) {\n    var widget = new widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__["default"](callbackOrObject, shortcutOrKey, shortcut);\n    var domLine = this._addLine(name);\n    domLine.appendChild(widget.domSpan);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var wid = super.addSlider(name, valOrObject, callbackOrKey, min, max, step);\n    // label 36% + slider ?% + 2% + input 18%\n    wid.domInputText.style.width = \'18%\';\n    wid.domSlider.style.width = name ? \'44%\' : \'80%\';\n    return wid;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Menu);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Menu.js?')},"./src/containers/Sidebar.js":function srcContainersSidebarJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Folder__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Folder */ \"./src/containers/Folder.js\");\n\n\nclass Sidebar {\n\n  constructor(callbackResize) {\n    this.domSidebar = document.createElement('div');\n    this.domSidebar.className = 'gui-sidebar';\n\n    this.domResize = document.createElement('div');\n    this.domResize.className = 'gui-resize';\n\n    this.isDragging = false;\n    this.mouseX = 0;\n    this.domResize.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n\n    this.callbackResize = callbackResize;\n    this.isOnTheRight = false;\n  }\n\n  _setTop(nb) {\n    this.domSidebar.style.top = this.domResize.style.top = nb + 'px';\n  }\n\n  _onTheRight() {\n    this.isOnTheRight = true;\n    this.domSidebar.style.right = 0;\n    this.domSidebar.style.borderRight = 0;\n    this.domSidebar.style.borderLeft = 'double';\n    this.domSidebar.style.borderColor = 'rgba(255,255,255,0.3)';\n    this.domResize.style.left = 'auto';\n    this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    this.domResize.style.marginRight = '-3px';\n  }\n\n  _onMouseDown(ev) {\n    this.isDragging = true;\n    this.mouseX = ev.clientX;\n  }\n\n  _updateViewportPosition(viewport) {\n    var w = this.domSidebar.hidden ? 0 : this.domSidebar.offsetWidth;\n    if (this.isOnTheRight) {\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    } else {\n      viewport.style.left = (this.domSidebar.offsetLeft + w) + 'px';\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    }\n  }\n\n  _onMouseMove(ev) {\n    if (this.isDragging === false) return;\n    var mouseX = ev.clientX;\n    var delta = mouseX - this.mouseX;\n    if (this.isOnTheRight) delta = -delta;\n    var widthBar = Math.max(50, this.domSidebar.offsetWidth + delta);\n\n    var val = widthBar + 'px';\n    this.domSidebar.style.width = val;\n    if (this.isOnTheRight) this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    else this.domResize.style.left = val;\n\n    this.mouseX = mouseX;\n    this.callbackResize();\n  }\n\n  _onMouseUp() {\n    this.isDragging = false;\n  }\n\n  addMenu(name) {\n    var folder = new containers_Folder__WEBPACK_IMPORTED_MODULE_0__[\"default\"](name);\n    this.domSidebar.appendChild(folder.domUl);\n    return folder;\n  }\n\n  setVisibility(visible) {\n    this.domSidebar.hidden = !visible;\n    this.domResize.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Sidebar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Sidebar.js?")},"./src/containers/Topbar.js":function srcContainersTopbarJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Menu__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Menu */ "./src/containers/Menu.js");\n/* harmony import */ var utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! utils/EditStyle */ "./src/utils/EditStyle.js");\n\n\n\nclass Topbar {\n\n  constructor(callbackResize) {\n    this.domTopbar = document.createElement(\'div\');\n    this.domTopbar.className = \'gui-topbar\';\n\n    this.domUl = document.createElement(\'ul\');\n    this.domTopbar.appendChild(this.domUl);\n\n    this.callbackResize = callbackResize;\n    this.uiExtra = {};\n  }\n\n  _updateViewportPosition(viewport) {\n    var h = this.domTopbar.hidden ? 0 : this.domTopbar.offsetHeight;\n    viewport.style.top = h + \'px\';\n    viewport.style.height = (viewport.clientHeight - h) + \'px\';\n  }\n\n  _onChangeColor(callback, color) {\n    callback(color);\n    this.uiExtra.overallColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.widgetColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.backColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, true);\n    this.uiExtra.textColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, true);\n  }\n\n  addMenu(name) {\n    var menu = new containers_Menu__WEBPACK_IMPORTED_MODULE_0__["default"]();\n    var li = document.createElement(\'li\');\n    li.setAttribute(\'onclick\', \'void(0)\'); // iOS trick to trigger click on hover\n    li.innerHTML = name || \'\';\n    this.domUl.appendChild(li);\n    li.appendChild(menu.domUl);\n    menu._setDomContainer(li);\n    return menu;\n  }\n\n  addExtra() {\n    var cb = this._onChangeColor;\n    var menu = this.addMenu(\'Extra UI\');\n    var ext = this.uiExtra;\n    menu.addTitle(\'Overall\');\n    ext.overallColor = menu.addColor(\'\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeOverallColor));\n\n    menu.addTitle(\'Advanced\');\n    ext.widgetColor = menu.addColor(\'Widget\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeWidgetsColor));\n    ext.backColor = menu.addColor(\'Back\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeBackgroundColor));\n    ext.textColor = menu.addColor(\'Text\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeTextColor));\n    ext.showBorder = menu.addCheckbox(\'Border\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curShowBorder, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeDisplayBoorder);\n    return menu;\n  }\n\n  setVisibility(visible) {\n    this.domTopbar.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Topbar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Topbar.js?')},"./src/utils/EditStyle.js":function srcUtilsEditStyleJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n\n\nvar EditStyle = {};\n\nEditStyle.refRules = {};\n\nvar yaguiSheet;\nvar findSheet = function () {\n  if (yaguiSheet) return yaguiSheet;\n  var sheets = document.styleSheets;\n  for (var i = 0, nb = sheets.length; i < nb; ++i) {\n    var href = sheets[i].href;\n    if (href && href.indexOf('yagui.css') !== -1) {\n      yaguiSheet = sheets[i];\n      return yaguiSheet;\n    }\n  }\n  return;\n};\n\nvar editStyle = function (selector, key, value) {\n  var sheet = findSheet();\n  if (!sheet)\n    return;\n  var rules = sheet.cssRules || sheet.rules;\n  var rule = EditStyle.refRules[selector];\n  if (!rule) {\n    var i = 0;\n    var len = rules.length;\n    for (i = 0; i < len; ++i) {\n      if (rules[i].selectorText === selector) break;\n    }\n    if (i === len) return false;\n    rule = EditStyle.refRules[selector] = rules[i];\n  }\n  if (rule)\n    rule.style[key] = value;\n};\n\nEditStyle.changeWidgetsColor = function (color) {\n  var str = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  // button\n  editStyle('.gui-button', 'background', str);\n  // select\n  editStyle('.gui-select', 'background', str);\n  // slider\n  editStyle('.gui-slider > div', 'background', str);\n  EditStyle._curWidgetColor = color;\n};\n\nEditStyle.changeDisplayBoorder = function (bool) {\n  var str = bool ? '1px solid #000' : '0';\n  editStyle('.gui-button', 'border', str);\n  // select\n  editStyle('.gui-select', 'border', str);\n  // slider\n  editStyle('.gui-slider', 'border', str);\n  editStyle('.gui-input-number', 'border', str);\n  // folder\n  editStyle('.gui-sidebar > ul > label', 'borderTop', str);\n  editStyle('.gui-sidebar > ul > label', 'borderBottom', str);\n  // side bar\n  editStyle('.gui-sidebar', 'borderLeft', str);\n  editStyle('.gui-sidebar', 'borderRight', str);\n  // top bar\n  editStyle('.gui-topbar', 'borderBottom', str);\n  EditStyle._curShowBorder = bool;\n};\n\nEditStyle.changeBackgroundColor = function (color) {\n  // side bar\n  editStyle('.gui-sidebar', 'background', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color));\n  // top bar\n  var colTop = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5));\n  editStyle('.gui-topbar', 'background', colTop);\n  editStyle('.gui-topbar ul > li > ul', 'background', colTop);\n  EditStyle._curBackgroundColor = color;\n};\n\nEditStyle.changeTextColor = function (color) {\n  var strColor = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  editStyle('*', 'color', strColor);\n  editStyle('.gui-sidebar > ul > label', 'color', strColor);\n  EditStyle._curTextColor = color;\n};\n\nEditStyle.changeOverallColor = function (color) {\n  EditStyle.changeWidgetsColor(color);\n  var bgCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5);\n  bgCol.length = 3;\n  EditStyle.changeBackgroundColor(bgCol);\n\n  var texCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorAdd(color, 0.5);\n  for (var i = 0; i < 3; ++i) texCol[i] = Math.min(0.8, texCol[i]);\n  EditStyle.changeTextColor(texCol);\n\n  EditStyle._curWidgetColor = color;\n  EditStyle._curBackgroundColor = bgCol;\n  EditStyle._curTextColor = texCol;\n};\n\n// init value\nEditStyle._curTextColor = [0.73, 0.73, 0.73, 1.0];\nEditStyle._curWidgetColor = [0.32, 0.37, 0.39, 1.0];\nEditStyle._curBackgroundColor = [0.24, 0.24, 0.24];\nEditStyle._curShowBorder = false;\n\nEditStyle.changeOverallColor([0.3, 0.34, 0.4, 1.0]);\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (EditStyle);\n\n\n//# sourceURL=webpack://yagui/./src/utils/EditStyle.js?")},"./src/utils/GuiUtils.js":function srcUtilsGuiUtilsJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nvar GuiUtils = {};\n\nGuiUtils.rgbToHsv = function (rgb) {\n  var r = rgb[0];\n  var g = rgb[1];\n  var b = rgb[2];\n  var maxRGB = Math.max(r, g, b);\n  var minRGB = Math.min(r, g, b);\n  if (minRGB === maxRGB) return [0, 0, minRGB];\n  var d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\n  var h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\n  return [(h - d / (maxRGB - minRGB)) / 6, (maxRGB - minRGB) / maxRGB, maxRGB];\n};\n\nGuiUtils.hsvToRgb = function (hsv) {\n  var h = hsv[0] * 6;\n  var s = hsv[1];\n  var v = hsv[2];\n  var i = Math.floor(h);\n  var f = h - i;\n  var p = v * (1.0 - s);\n  var q = v * (1.0 - f * s);\n  var t = v * (1.0 - (1.0 - f) * s);\n  var mod = i % 6;\n  if (mod === 0) return [v, t, p];\n  else if (mod === 1) return [q, v, p];\n  else if (mod === 2) return [p, v, t];\n  else if (mod === 3) return [p, q, v];\n  else if (mod === 4) return [t, p, v];\n  else return [v, p, q];\n};\n\nGuiUtils.getValidColor = function (color) {\n  for (var i = 0, len = color.length; i < len; ++i) color[i] = Math.max(0.0, Math.min(1.0, color[i]));\n  return color;\n};\n\nGuiUtils.getStrColor = function (color) {\n  if (color.length === 3) return GuiUtils.rgbToHex(color);\n  return 'rgba(' + Math.round(color[0] * 255) + ',' + Math.round(color[1] * 255) + ',' + Math.round(color[2] * 255) + ',' + color[3] + ')';\n};\n\nGuiUtils.getColorMult = function (color, fac) {\n  var out = [color[0] * fac, color[1] * fac, color[2] * fac];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.getColorAdd = function (color, add) {\n  var out = [color[0] + add, color[1] + add, color[2] + add];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.rgbToHex = function (rgb) {\n  var h = '#';\n  for (var i = 0; i < 3; ++i) {\n    var c = Math.round(rgb[i] * 255).toString(16);\n    h += c.length === 1 ? '0' + c : c;\n  }\n  return h;\n};\n\nGuiUtils.hexToRgb = function (hex) {\n  var i = 0;\n  if (hex[0] === '#') hex = hex.slice(1);\n  var h = hex;\n  if (hex.length > 6) h = hex.slice(0, 6);\n  else if (hex.length < 6) {\n    h = '';\n    for (i = 0; i < 3; ++i)\n      h += hex[i] ? hex[i] + hex[i] : '00';\n  }\n  var col = [0, 0, 0];\n  for (i = 0; i < 3; ++i) {\n    var c = parseInt(h[i * 2] + h[i * 2 + 1], 16);\n    col[i] = (c !== c ? 0 : c) / 255;\n  }\n  return col;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiUtils);\n\n\n//# sourceURL=webpack://yagui/./src/utils/GuiUtils.js?")},"./src/widgets/BaseWidget.js":function srcWidgetsBaseWidgetJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nclass BaseWidget {\n\n  constructor() {}\n\n  _getInitialValue(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return valOrObject;\n    return valOrObject[callbackOrKey];\n  }\n\n  _getCheckCallback(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return callbackOrKey;\n    return function (val) {\n      valOrObject[callbackOrKey] = val;\n    };\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  setCallback(callback) {\n    this.callback = callback;\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (BaseWidget);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/BaseWidget.js?")},"./src/widgets/Button.js":function srcWidgetsButtonJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Button extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name, callbackOrObject, key) {\n    super();\n\n    var callback = key ? callbackOrObject[key].bind(callbackOrObject) : callbackOrObject;\n\n    this.domButton = document.createElement('button');\n    this.domButton.className = 'gui-button';\n    this.domButton.innerHTML = name || '';\n    this.domButton.addEventListener('click', this._onClick.bind(this));\n\n    this.setCallback(callback);\n  }\n\n  setEnable(bool) {\n    this.domButton.disabled = bool === undefined ? false : !bool;\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Button);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Button.js?")},"./src/widgets/Checkbox.js":function srcWidgetsCheckboxJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Checkbox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    this.domCheckbox = document.createElement('input');\n    this.domCheckbox.className = 'gui-input-checkbox';\n    this.domCheckbox.type = 'checkbox';\n\n    this.domLabelCheckbox = document.createElement('label');\n\n    this.setValue(value === undefined ? true : value);\n    this.setCallback(callback);\n  }\n\n  _onMouseDown() {\n    this.setValue(!this.domCheckbox.checked);\n  }\n\n  setValue(val, ignoreCB) {\n    this.domCheckbox.checked = val;\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  getValue() {\n    return this.domCheckbox.checked;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Checkbox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Checkbox.js?")},"./src/widgets/Color.js":function srcWidgetsColorJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\n\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nvar urlAlpha = 'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAChJREFUeNpiPHPmDAMMGBsbw9lMDDgA6RKM%2F%2F%2F%2Fh3POnj1LCzsAAgwAQtYIcFfEyzkAAAAASUVORK5CYII%3D\")';\n\nclass Color extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    if (value) this.color = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getValidColor(value.slice());\n    else this.color = [1.0, 0.0, 0.0];\n\n    // container\n    this.domColor = document.createElement('div');\n    this.domColor.className = 'gui-widget-color';\n\n    // input text\n    this.domInputColor = document.createElement('input');\n    this.domPopup = document.createElement('div');\n\n    // hue picker\n    this.domHue = document.createElement('div');\n    this.domHue.className = 'gui-color-hue';\n    this.domHueKnob = document.createElement('div');\n    this.domHueKnob.className = 'gui-knob-hue';\n\n    // saturation picker\n    this.domSaturation = document.createElement('div');\n    this.domSaturation.className = 'gui-color-saturation';\n    var zAlphaSat = document.createElement('div');\n    this.domSaturation.appendChild(zAlphaSat);\n    this.domSaturationKnob = document.createElement('div');\n    this.domSaturationKnob.className = 'gui-knob-saturation';\n\n    this.domHue.appendChild(this.domHueKnob);\n    this.domPopup.appendChild(this.domSaturationKnob);\n    this.domPopup.appendChild(this.domSaturation);\n    this.domPopup.appendChild(this.domHue);\n    this.domColor.appendChild(this.domInputColor);\n    this.domColor.appendChild(this.domPopup);\n\n    this._hueGradient(this.domHue);\n    this._linearGradient(zAlphaSat, 'top', 'rgba(0,0,0,0)', '#000');\n\n    this.domColor.addEventListener('keydown', this._onInputDown.bind(this));\n    this.domSaturation.addEventListener('mousedown', this._onSaturationDown.bind(this));\n    this.domHue.addEventListener('mousedown', this._onHueDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n    window.addEventListener('mouseout', this._onMouseUp.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    // alpha picker\n    this.hasAlpha = this.color.length === 4;\n    this.alpha = 1.0;\n    if (this.hasAlpha) {\n      this.domPopup.style.width = '142px';\n      this.domAlpha = document.createElement('div');\n      this.domAlpha.className = 'gui-color-alpha';\n      this.domAlphaKnob = document.createElement('div');\n      this.domAlphaKnob.className = 'gui-knob-alpha';\n\n      this._alphaGradient(this.domAlpha, 'top', 'rgba(0,0,0,1.0)', 'rgba(0,0,0,0.0)');\n\n      this.domAlpha.addEventListener('mousedown', this._onAlphaDown.bind(this));\n      this.domAlpha.appendChild(this.domAlphaKnob);\n      this.domPopup.appendChild(this.domAlpha);\n    }\n\n    this.editHue = this.editSaturation = this.editAlpha = false;\n    this.widgetHeight = this.widgetWidth = 100;\n    this.setValue(this.color);\n    this.setCallback(callback);\n  }\n\n  _onInputDown(ev) {\n    ev.stopPropagation();\n    if (ev.keyCode === 13)\n      this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hexToRgb(ev.target.value));\n  }\n\n  _onUpdateSaturation(ev) {\n    var rect = this.domSaturation.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[1] = Math.min(1.0, Math.max(0.0, (ev.clientX - rect.left) / rect.width));\n    hsv[2] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.width));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateHue(ev) {\n    var rect = this.domHue.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[0] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateAlpha(ev) {\n    var rect = this.domAlpha.getBoundingClientRect();\n    var col = this.getValue();\n    col[3] = this.alpha = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(col, false, true);\n    this._updateGui();\n  }\n\n  _updateGui() {\n    var color = this.getValue();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n\n    this.domSaturationKnob.style.marginLeft = this.widgetWidth * hsv[1] - 7 + 'px';\n    this.domSaturationKnob.style.marginTop = this.widgetHeight * (1.0 - hsv[2]) - 7 + 'px';\n\n    hsv[1] = hsv[2] = 1.0;\n    this._linearGradient(this.domSaturation, 'left', '#fff', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv)));\n\n    this.domHueKnob.style.marginTop = (1.0 - hsv[0]) * this.widgetHeight + 'px';\n\n    if (this.hasAlpha && color[3] !== undefined)\n      this.domAlphaKnob.style.marginTop = (1.0 - this.alpha) * this.widgetHeight + 'px';\n  }\n\n  _onMouseMove(ev) {\n    if (!this.editSaturation && !this.editHue && !this.editAlpha) return;\n    if (this.editSaturation) return this._onUpdateSaturation(ev);\n    if (this.editHue) return this._onUpdateHue(ev);\n    if (this.editAlpha) return this._onUpdateAlpha(ev);\n  }\n\n  _onSaturationDown(ev) {\n    this.editSaturation = true;\n    this._onMouseMove(ev);\n  }\n\n  _onHueDown(ev) {\n    this.editHue = true;\n    this._onMouseMove(ev);\n  }\n\n  _onAlphaDown(ev) {\n    this.editAlpha = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.editHue = this.editSaturation = this.editAlpha = false;\n  }\n\n  _hueGradient(dom) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  }\n\n  _alphaGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ',' + col2 + '),' + urlAlpha + ';';\n  }\n\n  _linearGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ' 0%, ' + col2 + ' 100%);';\n  }\n\n  setValue(color, ignoreCB, ignoreUI) {\n    var c = this.color;\n    for (var i = 0, nbC = color.length; i < nbC; ++i)\n      c[i] = color[i];\n\n    var hex = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHex(color);\n    this.domInputColor.value = hex;\n    if (this.hasAlpha) {\n      if (color.length >= 4) this.alpha = color[3];\n      else color.push(this.alpha);\n      var col = 'rgba(' + parseInt(color[0] * 255, 10) + ',' + parseInt(color[1] * 255, 10) + ',' + parseInt(color[2] * 255, 10) + ',' + this.alpha + ')';\n      this._alphaGradient(this.domInputColor, '0deg', col, col);\n    } else {\n      this.domInputColor.style.background = hex;\n    }\n\n    // color of text\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n    this.domSaturationKnob.style.borderColor = (hsv[2] < 0.5 || hsv[1] > 0.5) ? '#fff' : '#000';\n    this.domInputColor.style.color = (this.alpha > 0.2 && (hsv[2] < 0.5 || hsv[1] > 0.5)) ? '#fff' : '#000';\n    if (!ignoreUI) this._updateGui();\n    if (!ignoreCB && this.callback) this.callback(color);\n  }\n\n  getValue() {\n    return this.color;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Color);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Color.js?")},"./src/widgets/Combobox.js":function srcWidgetsComboboxJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Combobox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, options) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    options = options || {};\n    value = value !== undefined ? value : options[0];\n\n    this.isArray = options.length !== undefined;\n\n    this.domSelect = document.createElement('select');\n    this.domSelect.className = 'gui-select';\n    this.addOptions(options);\n\n    this.domSelect.addEventListener('change', this._onChange.bind(this));\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _parseValue(val) {\n    return this.isArray ? parseInt(val, 10) : val;\n  }\n\n  _onChange(ev) {\n    this.setValue(ev.target.value);\n  }\n\n  addOptions(options) {\n    var keys = Object.keys(options);\n    for (var i = 0; i < keys.length; ++i) {\n      var opt = document.createElement('option');\n      opt.innerHTML = options[keys[i]];\n      opt.value = keys[i];\n      this.domSelect.appendChild(opt);\n    }\n  }\n\n  setValue(val, ignoreCB) {\n    this.domSelect.value = val;\n    if (!ignoreCB && this.callback) this.callback(this._parseValue(val));\n  }\n\n  getValue() {\n    return this._parseValue(this.domSelect.value);\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Combobox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Combobox.js?")},"./src/widgets/MenuButton.js":function srcWidgetsMenuButtonJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass MenuButton extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(callbackOrObject, shortcutOrKey, shortcut) {\n    super();\n\n    var callback = callbackOrObject;\n    if (callback && typeof callback !== 'function') callback = callbackOrObject[shortcutOrKey].bind(callbackOrObject);\n    else shortcut = shortcutOrKey;\n\n    this.domSpan = document.createElement('span');\n    this.domSpan.className = 'shortcut';\n    this.domSpan.innerHTML = shortcut || '';\n\n    this.setCallback(callback);\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n    container.addEventListener('click', this._onClick.bind(this));\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (MenuButton);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/MenuButton.js?")},"./src/widgets/Slider.js":function srcWidgetsSliderJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Slider extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, min, max, step) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    value = value !== undefined ? value : 100;\n    min = min !== undefined ? min : 0;\n    max = max !== undefined ? max : 200;\n    step = step !== undefined ? step : 1;\n\n    // slider\n    this.domSlider = document.createElement('div');\n    this.domSlider.className = 'gui-slider';\n    this.domSliderFill = document.createElement('div');\n    this.domSlider.appendChild(this.domSliderFill);\n\n    // text input\n    this.domInputText = document.createElement('input');\n    this.domInputText.className = 'gui-input-number';\n    this.domInputText.type = 'number';\n    this.min = this.domInputText.min = min;\n    this.max = this.domInputText.max = max;\n    this.step = this.domInputText.step = step;\n\n    this.domInputText.addEventListener('keydown', this._onKeyDown.bind(this));\n    this.domInputText.addEventListener('change', this._onInputText.bind(this));\n    this.domInputText.addEventListener('blur', this._onInputText.bind(this));\n    this.domSlider.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this), true);\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    this.lastValue = value;\n    this.isDown = false;\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _onInputText(ev) {\n    var val = parseFloat(ev.target.value);\n    if (val !== val || val === this.lastValue) return;\n    this.setValue(val);\n  }\n\n  _onKeyDown(ev) {\n    ev.stopPropagation();\n    if (ev.which === 13) // enter\n      this.domInputText.blur();\n  }\n\n  _onMouseMove(ev) {\n    ev.preventDefault();\n    if (!this.isDown)\n      return;\n    var rect = this.domSlider.getBoundingClientRect();\n    var val = this.min + (this.max - this.min) * ((ev.clientX - rect.left) / rect.width);\n    this.setValue(val);\n  }\n\n  _onMouseDown(ev) {\n    this.isDown = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.isDown = false;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  getValue() {\n    return parseFloat(this.domInputText.value);\n  }\n\n  setValue(val, ignoreCB) {\n    this.lastValue = val;\n    val = Math.max(Math.min(val, this.max), this.min);\n    val = Math.round(val / this.step) * this.step;\n    this.domInputText.value = val;\n    var per = this.min;\n    if (this.max !== this.min) per = (val - this.min) / (this.max - this.min);\n    this.domSliderFill.style.width = 100 * per + '%';\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  setMax(max) {\n    this.domInputText.max = this.max = max;\n    return this;\n  }\n\n  setMin(min) {\n    this.min = min;\n    return this;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Slider);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Slider.js?")},"./src/widgets/Title.js":function srcWidgetsTitleJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Title extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domText = document.createElement('div');\n    this.domText.innerHTML = name || '';\n    this.domText.className = 'group-title';\n  }\n\n  setText(text) {\n    this.domText.innerHTML = text;\n  }\n\n  setVisibility(visible) {\n    this.domText.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Title);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Title.js?")},"./src/yagui.js":function srcYaguiJs(module,exports,__webpack_require__){eval('var GuiMain = __webpack_require__(/*! GuiMain */ "./src/GuiMain.js").default;\n\nvar yagui = {\n  GuiMain: GuiMain\n};\n\nmodule.exports = yagui;\n\n\n//# sourceURL=webpack://yagui/./src/yagui.js?')}})},"object"===_typeof(exports)&&"object"===_typeof(module)?module.exports=factory():(__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},263(e,t,i){"use strict";i.d(t,{A:()=>h});var r,n=i(406),a=n.A.KeyAction,s=function(e,t){return void 0===e?t:"false"!==e&&"0"!==e},o=function(e,t,i,r){var n=parseFloat(e);return n||0===n?Math.max(t,Math.min(i,n)):r},l=function(e,t,i,r){var n=parseInt(e,10);return n||0===n?Math.max(t,Math.min(i,n)):r},u=function(e,t,i){if(t){var r=e[t.toUpperCase()];if(void 0!==r)return r}return i},c=function(){if(r)return r;r={};var e=function(){for(var e=window.location.search.substr(1).split("&"),t={},i=0,r=e.length;i<r;i++){var n=e[i].split("=",2);2===n.length&&(t[n[0].toLowerCase()]=n[1])}return t}();return r.language=e.language,r.scalecenter=s(e.scalecenter,!1),r.grid=s(e.grid,!0),r.outline=s(e.outline,!1),r.outlinecolor=function(e,t){if(!e)return t;var i=e.split(",");if(i.length<3)return t;var r=t.slice();return r[0]=parseInt(i[0]||0,10)/255,r[1]=parseInt(i[1]||0,10)/255,r[2]=parseInt(i[2]||0,10)/255,void 0!==i[3]&&(r[3]=parseFloat(i[3])),r}(e.outlinecolor,[.3,0,0,1]),r.mirrorline=s(e.mirrorline,!1),r.darkenunselected=s(e.darkenunselected,!0),r.projection=u(n.A.Projection,e.projection,n.A.Projection.PERSPECTIVE),r.cameramode=u(n.A.CameraMode,e.cameramode,n.A.Projection.ORBIT),r.pivot=s(e.pivot,!0),r.fov=o(e.fov,10,90,45),r.flatshading=s(e.flatshading,!1),r.wireframe=s(e.wireframe,!1),r.curvature=o(e.curvature,0,5,0),r.exposure=o(e.exposure,0,5),r.environment=l(e.environment,0,1/0,0),r.matcap=l(e.matcap,0,1/0,3),r.shader=u(n.A.Shader,e.shader,n.A.Shader.MATCAP),r.filmic=s(e.filmic,!1),r.modelurl=e.modelurl,r.shortcuts=function(e){var t={};if(t["0".charCodeAt(0)]=a.MOVE,t["1".charCodeAt(0)]=a.BRUSH,t["2".charCodeAt(0)]=a.INFLATE,t["3".charCodeAt(0)]=a.TWIST,t["4".charCodeAt(0)]=a.SMOOTH,t["5".charCodeAt(0)]=a.FLATTEN,t["6".charCodeAt(0)]=a.PINCH,t["7".charCodeAt(0)]=a.CREASE,t["8".charCodeAt(0)]=a.DRAG,t["9".charCodeAt(0)]=a.PAINT,t["E".charCodeAt(0)]=a.TRANSFORM,t["C".charCodeAt(0)]=a.INTENSITY,t["X".charCodeAt(0)]=a.RADIUS,t["N".charCodeAt(0)]=a.NEGATIVE,t["S".charCodeAt(0)]=a.PICKER,t[46]=a.DELETE,t["F".charCodeAt(0)]=a.CAMERA_FRONT,t["T".charCodeAt(0)]=a.CAMERA_TOP,t["L".charCodeAt(0)]=a.CAMERA_LEFT,t[32]=a.CAMERA_RESET,t[37]=a.STRIFE_LEFT,t[39]=a.STRIFE_RIGHT,t[38]=a.STRIFE_UP,t[40]=a.STRIFE_DOWN,t["W".charCodeAt(0)]=a.WIREFRAME,t["R".charCodeAt(0)]=a.REMESH,!e)return t;for(var i=e.split(","),r=0,n=i.length;r<n;r++){var s=i[r].split(":",2);if(2===s.length){var o=s[1].toUpperCase(),l=parseInt(o,10);o=l==l&&l>=10?l:o.charCodeAt(0);var u=a[s[0].toUpperCase()];void 0!==u&&(t[o]=u)}}return t}(e.shortcuts),r};c(),c.getShortKey=function(e){return e>=96&&e<=105&&(e-=48),c().shortcuts[e]};const h=c},322(e,t,i){"use strict";i.d(t,{$A:()=>_,C:()=>s,Il:()=>A,Ln:()=>c,Om:()=>p,S8:()=>d,WQ:()=>l,Z0:()=>f,ei:()=>g,fA:()=>a,gL:()=>m,hZ:()=>o,hs:()=>u,jb:()=>v,lo:()=>b,uE:()=>T,vt:()=>n,xg:()=>y,ze:()=>h});var r=i(968);function n(){var e=new r.tb(3);return r.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function a(e,t,i){var n=new r.tb(3);return n[0]=e,n[1]=t,n[2]=i,n}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function l(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function u(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function c(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function h(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function d(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function p(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _(e,t,i){var r=t[0],n=t[1],a=t[2],s=i[0],o=i[1],l=i[2];return e[0]=n*l-a*o,e[1]=a*s-r*l,e[2]=r*o-n*s,e}function f(e,t,i){var r=t[0],n=t[1],a=t[2],s=i[3]*r+i[7]*n+i[11]*a+i[15];return s=s||1,e[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/s,e[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/s,e}function g(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e}function m(e,t,i){var r=i[0],n=i[1],a=i[2],s=i[3],o=t[0],l=t[1],u=t[2],c=n*u-a*l,h=a*o-r*u,d=r*l-n*o,p=n*d-a*h,_=a*c-r*d,f=r*h-n*c,g=2*s;return c*=g,h*=g,d*=g,p*=2,_*=2,f*=2,e[0]=o+c+p,e[1]=l+h+_,e[2]=u+d+f,e}var v=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},y=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.hypot(i,r,n)},b=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n},A=function(e){var t=e[0],i=e[1],r=e[2];return Math.hypot(t,i,r)},T=function(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r};n()},406(e,t,i){"use strict";i.d(t,{A:()=>s});var r=i(445),n={Action:{NOTHING:0,MASK_EDIT:1,SCULPT_EDIT:2,CAMERA_ZOOM:3,CAMERA_ROTATE:4,CAMERA_PAN:5,CAMERA_PAN_ZOOM_ALT:6},Tools:{BRUSH:0,INFLATE:1,TWIST:2,SMOOTH:3,FLATTEN:4,PINCH:5,CREASE:6,DRAG:7,PAINT:8,MOVE:9,MASKING:10,LOCALSCALE:11,TRANSFORM:12,ELEMENTSELECT:13},Shader:{PBR:0,FLAT:1,NORMAL:2,WIREFRAME:3,UV:4,MATCAP:5,SELECTION:6,BACKGROUND:7,MERGE:8,FXAA:9,CONTOUR:10,PAINTUV:11,BLUR:12},Projection:{PERSPECTIVE:0,ORTHOGRAPHIC:1},CameraMode:{ORBIT:0,SPHERICAL:1,PLANE:2},MultiState:{NONE:0,SCULPT:1,CAMERA:2,PICKING:3}},a=Object.keys(n.Tools).length;n.KeyAction=r.A.extend({INTENSITY:a++,RADIUS:a++,NEGATIVE:a++,PICKER:a++,DELETE:a++,CAMERA_FRONT:a++,CAMERA_TOP:a++,CAMERA_LEFT:a++,CAMERA_RESET:a++,STRIFE_LEFT:a++,STRIFE_RIGHT:a++,STRIFE_UP:a++,STRIFE_DOWN:a++,WIREFRAME:a++,REMESH:a++},n.Tools);const s=n},442(){!function(e){"use strict";var t,i="File format is not recognized.",r="Error while reading zip file.",n="Error while reading file data.",a=524288,s="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(){this.crc=-1}function l(){}function u(e,t){var i,r;return i=new ArrayBuffer(e),r=new Uint8Array(i),t&&r.set(t,0),{buffer:i,array:r,view:new DataView(i)}}function c(){}function h(e){var t,i=this;i.size=0,i.init=function(r,n){var a=new Blob([e],{type:s});(t=new p(a)).init(function(){i.size=t.size,r()},n)},i.readUint8Array=function(e,i,r,n){t.readUint8Array(e,i,r,n)}}function d(t){var i,r=this;r.size=0,r.init=function(e){for(var n=t.length;"="==t.charAt(n-1);)n--;i=t.indexOf(",")+1,r.size=Math.floor(.75*(n-i)),e()},r.readUint8Array=function(r,n,a){var s,o=u(n),l=4*Math.floor(r/3),c=4*Math.ceil((r+n)/3),h=e.atob(t.substring(l+i,c+i)),d=r-3*Math.floor(l/4);for(s=d;s<d+n;s++)o.array[s-d]=h.charCodeAt(s);a(o.array)}}function p(e){var t=this;t.size=0,t.init=function(i){t.size=e.size,i()},t.readUint8Array=function(t,i,r,n){var a=new FileReader;a.onload=function(e){r(new Uint8Array(e.target.result))},a.onerror=n;try{a.readAsArrayBuffer(function(e,t,i){if(t<0||i<0||t+i>e.size)throw new RangeError("offset:"+t+", length:"+i+", size:"+e.size);return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):e.mozSlice?e.mozSlice(t,t+i):e.msSlice?e.msSlice(t,t+i):void 0}(e,t,i))}catch(e){n(e)}}}function _(){}function f(e){var i,r=this;r.init=function(e){i=new Blob([],{type:s}),e()},r.writeUint8Array=function(e,r){i=new Blob([i,t?e:e.buffer],{type:s}),r()},r.getData=function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=r,n.readAsText(i,e)}}function g(t){var i=this,r="",n="";i.init=function(e){r+="data:"+(t||"")+";base64,",e()},i.writeUint8Array=function(t,i){var a,s=n.length,o=n;for(n="",a=0;a<3*Math.floor((s+t.length)/3)-s;a++)o+=String.fromCharCode(t[a]);for(;a<t.length;a++)n+=String.fromCharCode(t[a]);o.length>2?r+=e.btoa(o):n=o,i()},i.getData=function(t){t(r+e.btoa(n))}}function m(e){var i,r=this;r.init=function(t){i=new Blob([],{type:e}),t()},r.writeUint8Array=function(r,n){i=new Blob([i,t?r:r.buffer],{type:e}),n()},r.getData=function(e){e(i)}}function v(e,t,i,r,n,s,o,l,u,c){var h,d,p,_=0,f=t.sn;function g(){e.removeEventListener("message",m,!1),l(d,p)}function m(t){var i=t.data,n=i.data,a=i.error;if(a)return a.toString=function(){return"Error: "+this.message},void u(a);if(i.sn===f)switch("number"==typeof i.codecTime&&(e.codecTime+=i.codecTime),"number"==typeof i.crcTime&&(e.crcTime+=i.crcTime),i.type){case"append":n?(d+=n.length,r.writeUint8Array(n,function(){v()},c)):v();break;case"flush":p=i.crc,n?(d+=n.length,r.writeUint8Array(n,function(){g()},c)):g();break;case"progress":o&&o(h+i.loaded,s);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",i)}}function v(){(h=_*a)<s?i.readUint8Array(n+h,Math.min(a,s-h),function(i){o&&o(h,s);var r=0===h?t:{sn:f};r.type="append",r.data=i,e.postMessage(r,[i.buffer]),_++},u):e.postMessage({sn:f,type:"flush"})}d=0,e.addEventListener("message",m,!1),v()}function y(e,t,i,r,n,s,l,u,c,h){var d,p=0,_=0,f="input"===s,g="output"===s,m=new o;!function s(){var o;if((d=p*a)<n)t.readUint8Array(r+d,Math.min(a,n-d),function(t){var r;try{r=e.append(t,function(e){l&&l(d+e,n)})}catch(e){return void c(e)}r?(_+=r.length,i.writeUint8Array(r,function(){p++,setTimeout(s,1)},h),g&&m.append(r)):(p++,setTimeout(s,1)),f&&m.append(t),l&&l(d,n)},c);else{try{o=e.flush()}catch(e){return void c(e)}o?(g&&m.append(o),_+=o.length,i.writeUint8Array(o,function(){u(_,m.get())},h)):u(_,m.get())}}()}function b(t,i,r,n,a,s,o,u,c,h,d){var p="input";e.zip.useWebWorkers&&o?v(t,{sn:i,codecClass:"NOOP",crcType:p},r,n,a,s,c,u,h,d):y(new l,r,n,a,s,p,c,u,h,d)}function A(e){var t,i,r="",n=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)r+=(i=255&e.charCodeAt(t))>127?n[i-128]:String.fromCharCode(i);return r}function T(e){return decodeURIComponent(escape(e))}function M(e){var t,i="";for(t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return i}function S(e,t,i,r,n){e.version=t.view.getUint16(i,!0),e.bitFlag=t.view.getUint16(i+2,!0),e.compressionMethod=t.view.getUint16(i+4,!0),e.lastModDateRaw=t.view.getUint32(i+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,i=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&i)>>11,(2016&i)>>5,2*(31&i),0)}catch(e){}}(e.lastModDateRaw),1&~e.bitFlag?((r||8&~e.bitFlag)&&(e.crc32=t.view.getUint32(i+10,!0),e.compressedSize=t.view.getUint32(i+14,!0),e.uncompressedSize=t.view.getUint32(i+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(i+22,!0),e.extraFieldLength=t.view.getUint16(i+24,!0)):n("File is using Zip64 (4gb+ file size).")):n("File contains encrypted entry.")}function E(e){return unescape(encodeURIComponent(e))}function R(e){var t,i=[];for(t=0;t<e.length;t++)i.push(e.charCodeAt(t));return i}function k(t,i,r,a){var s={},o=[],l=0,c=0;function h(e){r(e||"Error while writing zip file.")}function d(e){r(e||n)}var p={add:function(i,n,p,_,f){var g,m,A,T=this._worker;function M(e,i){var r=u(16);l+=e||0,r.view.setUint32(0,1347094280),void 0!==i&&(g.view.setUint32(10,i,!0),r.view.setUint32(4,i,!0)),n&&(r.view.setUint32(8,e,!0),g.view.setUint32(14,e,!0),r.view.setUint32(12,n.size,!0),g.view.setUint32(18,n.size,!0)),t.writeUint8Array(r.array,function(){l+=16,p()},h)}function S(){var p;f=f||{},i=i.trim(),f.directory&&"/"!=i.charAt(i.length-1)&&(i+="/"),s.hasOwnProperty(i)?r("File already exists."):(m=R(E(i)),o.push(i),A=f.lastModDate||new Date,g=u(26),s[i]={headerArray:g.array,directory:f.directory,filename:m,offset:l,comment:R(E(f.comment||""))},g.view.setUint32(0,335546376),f.version&&g.view.setUint8(0,f.version),a||0===f.level||f.directory||g.view.setUint16(4,2048),g.view.setUint16(6,(A.getHours()<<6|A.getMinutes())<<5|A.getSeconds()/2,!0),g.view.setUint16(8,(A.getFullYear()-1980<<4|A.getMonth()+1)<<5|A.getDate(),!0),g.view.setUint16(22,m.length,!0),(p=u(30+m.length)).view.setUint32(0,1347093252),p.array.set(g.array,4),p.array.set(m,30),l+=p.array.length,t.writeUint8Array(p.array,function(){n?a||0===f.level?b(T,c++,n,t,0,n.size,!0,M,_,d,h):function(t,i,r,n,a,s,o,l,u){var c="input";e.zip.useWebWorkers?v(t,{sn:i,options:{level:a},codecClass:"Deflater",crcType:c},r,n,0,r.size,o,s,l,u):y(new e.zip.Deflater,r,n,0,r.size,c,o,s,l,u)}(T,c++,n,t,f.level,M,_,d,h):M()},h))}n?n.init(S,d):S()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var i,r,n,a=0,c=0;for(r=0;r<o.length;r++)a+=46+(n=s[o[r]]).filename.length+n.comment.length;for(i=u(a+22),r=0;r<o.length;r++)n=s[o[r]],i.view.setUint32(c,1347092738),i.view.setUint16(c+4,5120),i.array.set(n.headerArray,c+6),i.view.setUint16(c+32,n.comment.length,!0),n.directory&&i.view.setUint8(c+38,16),i.view.setUint32(c+42,n.offset,!0),i.array.set(n.filename,c+46),i.array.set(n.comment,c+46+n.filename.length),c+=46+n.filename.length+n.comment.length;i.view.setUint32(c,1347093766),i.view.setUint16(c+8,o.length,!0),i.view.setUint16(c+10,o.length,!0),i.view.setUint32(c+12,a,!0),i.view.setUint32(c+16,l,!0),t.writeUint8Array(i.array,function(){t.getData(e)},h)},_worker:null};e.zip.useWebWorkers?w("deflater",function(e){p._worker=e,i(p)},function(e){r(e)}):i(p)}o.prototype.append=function(e){for(var t=0|this.crc,i=this.table,r=0,n=0|e.length;r<n;r++)t=t>>>8^i[255&(t^e[r])];this.crc=t},o.prototype.get=function(){return~this.crc},o.prototype.table=function(){var e,t,i,r=[];for(e=0;e<256;e++){for(i=e,t=0;t<8;t++)1&i?i=i>>>1^3988292384:i>>>=1;r[e]=i}return r}(),l.prototype.append=function(e,t){return e},l.prototype.flush=function(){},h.prototype=new c,h.prototype.constructor=h,d.prototype=new c,d.prototype.constructor=d,p.prototype=new c,p.prototype.constructor=p,_.prototype.getData=function(e){e(this.data)},f.prototype=new _,f.prototype.constructor=f,g.prototype=new _,g.prototype.constructor=g,m.prototype=new _,m.prototype.constructor=m;var x={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function w(t,i,r){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var n,a,s;if(e.zip.workerScripts){if(n=e.zip.workerScripts[t],!Array.isArray(n))return void r(new Error("zip.workerScripts."+t+" is not an array!"));a=n,s=document.createElement("a"),n=a.map(function(e){return s.href=e,s.href})}else(n=x[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+n[0];var o=new Worker(n[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:n.slice(1)}),o.addEventListener("message",function e(t){var n=t.data;if(n.error)return o.terminate(),void r(n.error);"importScripts"===n.type&&(o.removeEventListener("message",e),o.removeEventListener("error",l),i(o))}),o.addEventListener("error",l)}else r(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function l(e){o.terminate(),r(e)}}function C(e){console.error(e)}e.zip={Reader:c,Writer:_,BlobReader:p,Data64URIReader:d,TextReader:h,BlobWriter:m,Data64URIWriter:g,TextWriter:f,createReader:function(t,a,s){s=s||C,t.init(function(){!function(t,a,s){var o=0;function l(){}l.prototype.getData=function(r,a,l,c){var h=this;function d(e,t){c&&!function(e){var t=u(4);return t.view.setUint32(0,e),h.crc32==t.view.getUint32(0)}(t)?s("CRC failed."):r.getData(function(e){a(e)})}function p(e){s(e||n)}function _(e){s(e||"Error while writing file data.")}t.readUint8Array(h.offset,30,function(n){var a,f=u(n.length,n);1347093252==f.view.getUint32(0)?(S(h,f,4,!1,s),a=h.offset+30+h.filenameLength+h.extraFieldLength,r.init(function(){0===h.compressionMethod?b(h._worker,o++,t,r,a,h.compressedSize,c,d,l,p,_):function(t,i,r,n,a,s,o,l,u,c,h){var d=o?"output":"none";e.zip.useWebWorkers?v(t,{sn:i,codecClass:"Inflater",crcType:d},r,n,a,s,u,l,c,h):y(new e.zip.Inflater,r,n,a,s,d,u,l,c,h)}(h._worker,o++,t,r,a,h.compressedSize,c,d,l,p,_)},_)):s(i)},p)};var c={getEntries:function(e){var n=this._worker;!function(e){function n(i,n){t.readUint8Array(t.size-i,i,function(t){for(var i=t.length-22;i>=0;i--)if(80===t[i]&&75===t[i+1]&&5===t[i+2]&&6===t[i+3])return void e(new DataView(t.buffer,i,22));n()},function(){s(r)})}t.size<22?s(i):n(22,function(){n(Math.min(65558,t.size),function(){s(i)})})}(function(a){var o,c;o=a.getUint32(16,!0),c=a.getUint16(8,!0),o<0||o>=t.size?s(i):t.readUint8Array(o,t.size-o,function(t){var r,a,o,h,d=0,p=[],_=u(t.length,t);for(r=0;r<c;r++){if((a=new l)._worker=n,1347092738!=_.view.getUint32(d))return void s(i);S(a,_,d+6,!0,s),a.commentLength=_.view.getUint16(d+32,!0),a.directory=!(16&~_.view.getUint8(d+38)),a.offset=_.view.getUint32(d+42,!0),o=M(_.array.subarray(d+46,d+46+a.filenameLength)),a.filename=2048&~a.bitFlag?A(o):T(o),a.directory||"/"!=a.filename.charAt(a.filename.length-1)||(a.directory=!0),h=M(_.array.subarray(d+46+a.filenameLength+a.extraFieldLength,d+46+a.filenameLength+a.extraFieldLength+a.commentLength)),a.comment=2048&~a.bitFlag?A(h):T(h),p.push(a),d+=46+a.filenameLength+a.extraFieldLength+a.commentLength}e(p)},function(){s(r)})})},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?w("inflater",function(e){c._worker=e,a(c)},function(e){s(e)}):a(c)}(t,a,s)},s)},createWriter:function(e,t,i,r){i=i||C,r=!!r,e.init(function(){k(e,t,i,r)},i)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this)},445(e,t,i){"use strict";i.d(t,{A:()=>l});var r=i(322),n={SCALE:100,TAG_FLAG:1,SCULPT_FLAG:1,STATE_FLAG:1,TRI_INDEX:4294967295,cursors:{}};n.cursors.dropper="url(resources/dropper.png) 5 25, auto",n.linearToSRGB1=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},n.sRGBToLinear1=function(e){return e<.04045?e*(1/12.92):Math.pow((e+.055)*(1/1.055),2.4)},n.extend=function(e,t){for(var i=Object.keys(t),r=0,n=i.length;r<n;++r){var a=i[r];void 0===e[a]&&(e[a]=t[a])}return e},n.invert=function(e){for(var t=Object.keys(e),i={},r=0,n=t.length;r<n;++r)i[e[t[r]]]=t[r];return i},n.replaceElement=function(e,t,i){for(var r=0,n=e.length;r<n;++r)if(e[r]===t)return void(e[r]=i)},n.removeElement=function(e,t){for(var i=0,r=e.length;i<r;++i)if(e[i]===t)return e[i]=e[r-1],void e.pop()},n.appendArray=function(e,t){var i=e.length,r=t.length;e.length+=r;for(var n=0;n<r;++n)e[i+n]=t[n]},n.isPowerOfTwo=function(e){return 0!==e&&!(e&e-1)},n.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1};var a,s,o=function(e,t){return e-t};n.tidy=function(e){e.sort(o);var t=e.length,i=0,r=0;for(i=1;i<t;++i)e[r]!==e[i]&&(e[++r]=e[i]);i>1&&(e.length=r+1)},n.intersectionArrays=function(e,t){for(var i=0,r=0,n=[],a=e.length,s=t.length;i<a&&r<s;)e[i]<t[r]?i++:e[i]>t[r]?r++:(n.push(e[i]),++i,++r);return n},n.littleEndian=(a=new ArrayBuffer(2),new DataView(a).setInt16(0,256,!0),256===new Int16Array(a)[0]),n.getBytes=function(e,t){return[e[t].charCodeAt(),e[t+1].charCodeAt(),e[t+2].charCodeAt(),e[t+3].charCodeAt()]},n.getUint32=function(e,t){var i=n.getBytes(e,t);return i[0]|i[1]<<8|i[2]<<16|i[3]<<24},n.getFloat32=function(e,t){var i=n.getBytes(e,t),r=1-2*(i[3]>>7),a=(i[3]<<1&255|i[2]>>7)-127,s=(127&i[2])<<16|i[1]<<8|i[0];return 128===a?0!==s?NaN:r*(1/0):-127===a?r*s*Math.pow(2,-149):r*(1+s*Math.pow(2,-23))*Math.pow(2,a)},n.ab2str=function(e){for(var t="",i=new Uint8Array(e),r=65535,n=0,a=i.length;n<a;n+=r){var s=i.subarray(n,r<a-n?r+n:a);t+=String.fromCharCode.apply(null,s)}return t},n.getMemory=(s=new ArrayBuffer(1e5),function(e){return s.byteLength>=e?s:s=new ArrayBuffer(e)}),n.now=Date.now||function(){return(new Date).getTime()},n.throttle=function(e,t){var i,r=[],a=null,s=0,o=function(){s=n.now(),a=null,i=e.apply(e,r)};return function(){for(var l=n.now(),u=t-(l-s),c=r.length=arguments.length,h=0;h<c;++h)r[h]=arguments[h];return u<=0||u>t?(window.clearTimeout(a),a=null,s=l,i=e.apply(e,r)):a||(a=window.setTimeout(o,u)),i}},n.normalizeArrayVec3=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=0,r=e.length/3;i<r;++i){var n=3*i,a=e[n],s=e[n+1],o=e[n+2],l=a*a+s*s+o*o;0!==l?(l=1/Math.sqrt(l),t[n]=a*l,t[n+1]=s*l,t[n+2]=o*l):t[n]=1}return t},n.convertArrayVec3toSRGB=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=0,r=e.length;i<r;++i)t[i]=n.linearToSRGB1(e[i]);return t},n.convertArrayVec3toLinear=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=0,r=e.length;i<r;++i)t[i]=n.sRGBToLinear1(e[i]);return t},n.computeWorldVertices=function(e,t){var i=e.getNbVertices(),n=e.getVertices().subarray(0,3*i);t||(t=new Float32Array(3*i));for(var a=e.getMatrix(),s=r.vt(),o=0;o<i;++o){var l=3*o;r.hZ(s,n[l],n[l+1],n[l+2]),r.Z0(s,s,a),t[l]=s[0],t[l+1]=s[1],t[l+2]=s[2]}return t};const l=n},464(e,t,i){var r,n;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}void 0===(n="function"==typeof(r=function(){"use strict";function t(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,i)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==("undefined"==typeof window?"undefined":a(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":a(self))&&self.self===self?self:"object"==(void 0===i.g?"undefined":a(i.g))&&i.g.global===i.g?i.g:void 0,o=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||("object"!=("undefined"==typeof window?"undefined":a(window))||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,i,a){var o=s.URL||s.webkitURL,l=document.createElement("a");i=i||e.name||"download",l.download=i,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?n(l):r(l.href)?t(e,i,a):n(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,i,s){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=a(t)&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,s),i);else if(r(e))t(e,i,s);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){n(o)})}}:function(e,i,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return t(e,i,r);var a="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&l||o)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},c.readAsDataURL(e)}else{var h=s.URL||s.webkitURL,d=h.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout(function(){h.revokeObjectURL(d)},4e4)}});s.saveAs=l.saveAs=l,e.exports=l})?r.apply(t,[]):r)||(e.exports=n)},693(e,t,i){"use strict";i.d(t,{A:()=>A});var r,n,a,s,o,l,u,c,h,d,p,_,f,g,m,v,y=i(322),b={normalizedMouse:function(e,t,i,r){return[2*e/i-1,1-2*t/r]},mouseOnUnitSphere:function(e){var t=e[0],i=e[1],r=1-t*t-i*i,n=[t,i,r>0?Math.sqrt(r):0];return y.S8(n,n)}};b.intersectionRayTriangleEdges=(r=1+1e-15,n=-1e-15,a=[0,0,0],s=[0,0,0],o=[0,0,0],function(e,t,i,l,u,c){y.$A(a,t,l);var h=y.Om(i,a);if(h>-1e-15&&h<1e-15)return-1;var d=1/h;y.jb(s,e,u);var p=y.Om(s,a)*d;if(p<n||p>r)return-1;y.$A(o,s,i);var _=y.Om(t,o)*d;if(_<n||p+_>r)return-1;var f=y.Om(l,o)*d;return f<n?-1:(c&&y.Ln(c,e,t,f),f)}),b.intersectionRayTriangle=(l=[0,0,0],u=[0,0,0],function(e,t,i,r,n,a){return y.jb(l,r,i),y.jb(u,n,i),b.intersectionRayTriangleEdges(e,t,l,u,i,a)}),b.distance2PointTriangleEdges=(c=[0,0,0],function(e,t,i,r,n,a,s,o){y.jb(c,r,e);var l,u,h,d,p,_=y.Om(c,t),f=y.Om(c,i),g=y.uE(c),m=Math.abs(n*s-a*a),v=a*f-s*_,b=a*_-n*f,A=4;if(v+b<=m)if(v<0)b<0?(A=4,_<0?(b=0,-_>=n?(v=1,l=n+2*_+g):l=_*(v=-_/n)+g):(v=0,f>=0?(b=0,l=g):-f>=s?(b=1,l=s+2*f+g):l=f*(b=-f/s)+g)):(A=3,v=0,f>=0?(b=0,l=g):-f>=s?(b=1,l=s+2*f+g):l=f*(b=-f/s)+g);else if(b<0)A=5,b=0,_>=0?(v=0,l=g):-_>=n?(v=1,l=n+2*_+g):l=_*(v=-_/n)+g;else{A=0;var T=1/m;l=(v*=T)*(n*v+a*(b*=T)+2*_)+b*(a*v+s*b+2*f)+g}else v<0?(A=2,(h=s+f)>(u=a+_)?(d=h-u)>=(p=n-2*a+s)?(v=1,b=0,l=n+2*_+g):l=(v=d/p)*(n*v+a*(b=1-v)+2*_)+b*(a*v+s*b+2*f)+g:(v=0,h<=0?(b=1,l=s+2*f+g):f>=0?(b=0,l=g):l=f*(b=-f/s)+g)):b<0?(A=6,(h=n+_)>(u=a+f)?(d=h-u)>=(p=n-2*a+s)?(b=1,v=0,l=s+2*f+g):l=(v=1-(b=d/p))*(n*v+a*b+2*_)+b*(a*v+s*b+2*f)+g:(b=0,h<=0?(v=1,l=n+2*_+g):_>=0?(v=0,l=g):l=_*(v=-_/n)+g)):(A=1,(d=s+f-a-_)<=0?(v=0,b=1,l=s+2*f+g):d>=(p=n-2*a+s)?(v=1,b=0,l=n+2*_+g):l=(v=d/p)*(n*v+a*(b=1-v)+2*_)+b*(a*v+s*b+2*f)+g);return l<0&&(l=0),o&&(o[0]=r[0]+v*t[0]+b*i[0],o[1]=r[1]+v*t[1]+b*i[1],o[2]=r[2]+v*t[2]+b*i[2],o[3]=A),l}),b.distance2PointTriangle=function(){var e=[0,0,0],t=[0,0,0];return function(i,r,n,a,s){y.jb(e,n,r),y.jb(t,a,r);var o=y.uE(e),l=y.Om(e,t),u=y.uE(t);return b.distance2PointTriangleEdges(i,e,t,r,o,l,u,s)}}(),b.pointInsideTriangle=(h=[0,0,0],d=[0,0,0],p=[0,0,0],_=[0,0,0],f=[0,0,0],function(e,t,i,r){y.jb(h,t,i),y.jb(d,t,r),y.jb(p,e,i),y.jb(_,e,r);var n=y.Il(y.$A(f,h,d)),a=y.Il(y.$A(f,h,p)),s=y.Il(y.$A(f,d,_)),o=y.Il(y.$A(f,p,_));return Math.abs(n-(a+s+o))<1e-20}),b.triangleInsideSphere=function(e,t,i,r,n){return b.distanceSqToSegment(e,i,r)<t||b.distanceSqToSegment(e,r,n)<t||b.distanceSqToSegment(e,i,n)<t},b.distanceSqToSegment=(g=[0,0,0],m=[0,0,0],function(e,t,i){y.jb(g,e,t),y.jb(m,i,t);var r=y.uE(m),n=y.Om(g,m)/r;return n<0?y.uE(g):n>1?y.uE(y.jb(g,e,i)):(g[0]=e[0]-t[0]-n*m[0],g[1]=e[1]-t[1]-n*m[1],g[2]=e[2]-t[2]-n*m[2],y.uE(g))}),b.signedAngle2d=function(e,t){var i=e[0],r=e[1],n=t[0],a=t[1];return Math.atan2(i*a-r*n,i*n+r*a)},b.pointPlaneDistance=function(){var e=[0,0,0];return function(t,i,r){return y.Om(y.jb(e,t,i),r)}}(),b.mirrorPoint=function(){var e=[0,0,0];return function(t,i,r){return y.jb(t,t,y.hs(e,r,2*b.pointPlaneDistance(t,i,r)))}}(),b.vertexOnLine=(v=[0,0,0],function(e,t,i){y.jb(v,i,t);var r=[0,0,0],n=y.Om(v,y.jb(r,e,t));return y.Ln(r,t,v,n/y.uE(v))}),b.intersectLinePlane=function(e,t,i,r,n){var a=y.Om(y.jb(n,e,i),r),s=y.Om(y.jb(n,t,i),r);if(a===s)return t;var o=-a/(s-a);return y.Ln(n,e,y.jb(n,t,e),o)},b.getPerpendicularVector=function(e){var t=[0,0,0];return 0===e[0]?t[0]=1:0===e[1]?t[1]=1:0===e[2]?t[2]=1:(t[0]=e[2],t[1]=e[2],t[2]=-e[0]-e[1],y.S8(t,t)),t};const A=b},827(e,t,i){"use strict";i.d(t,{B8:()=>o,C:()=>a,D_:()=>s,I0:()=>_,Qr:()=>p,Tl:()=>l,Z8:()=>d,e$:()=>c,eL:()=>h,fN:()=>f,hs:()=>u,lK:()=>v,t5:()=>m,v3:()=>g,vt:()=>n});var r=i(968);function n(){var e=new r.tb(16);return r.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],_=t[12],f=t[13],g=t[14],m=t[15],v=i*o-r*s,y=i*l-n*s,b=i*u-a*s,A=r*l-n*o,T=r*u-a*o,M=n*u-a*l,S=c*f-h*_,E=c*g-d*_,R=c*m-p*_,k=h*g-d*f,x=h*m-p*f,w=d*m-p*g,C=v*w-y*x+b*k+A*R-T*E+M*S;return C?(C=1/C,e[0]=(o*w-l*x+u*k)*C,e[1]=(n*x-r*w-a*k)*C,e[2]=(f*M-g*T+m*A)*C,e[3]=(d*T-h*M-p*A)*C,e[4]=(l*R-s*w-u*E)*C,e[5]=(i*w-n*R+a*E)*C,e[6]=(g*b-_*M-m*y)*C,e[7]=(c*M-d*b+p*y)*C,e[8]=(s*x-o*R+u*S)*C,e[9]=(r*R-i*x-a*S)*C,e[10]=(_*T-f*b+m*v)*C,e[11]=(h*b-c*T-p*v)*C,e[12]=(o*E-s*k-l*S)*C,e[13]=(i*k-r*E+n*S)*C,e[14]=(f*y-_*A-g*v)*C,e[15]=(c*A-h*y+d*v)*C,e):null}function l(e,t,i){var r,n,a,s,o,l,u,c,h,d,p,_,f=i[0],g=i[1],m=i[2];return t===e?(e[12]=t[0]*f+t[4]*g+t[8]*m+t[12],e[13]=t[1]*f+t[5]*g+t[9]*m+t[13],e[14]=t[2]*f+t[6]*g+t[10]*m+t[14],e[15]=t[3]*f+t[7]*g+t[11]*m+t[15]):(r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],_=t[11],e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=_,e[12]=r*f+o*g+h*m+t[12],e[13]=n*f+l*g+d*m+t[13],e[14]=a*f+u*g+p*m+t[14],e[15]=s*f+c*g+_*m+t[15]),e}function u(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function c(e,t,i,n){var a,s,o,l,u,c,h,d,p,_,f,g,m,v,y,b,A,T,M,S,E,R,k,x,w=n[0],C=n[1],P=n[2],D=Math.hypot(w,C,P);return D<r.p8?null:(w*=D=1/D,C*=D,P*=D,a=Math.sin(i),o=1-(s=Math.cos(i)),l=t[0],u=t[1],c=t[2],h=t[3],d=t[4],p=t[5],_=t[6],f=t[7],g=t[8],m=t[9],v=t[10],y=t[11],b=w*w*o+s,A=C*w*o+P*a,T=P*w*o-C*a,M=w*C*o-P*a,S=C*C*o+s,E=P*C*o+w*a,R=w*P*o+C*a,k=C*P*o-w*a,x=P*P*o+s,e[0]=l*b+d*A+g*T,e[1]=u*b+p*A+m*T,e[2]=c*b+_*A+v*T,e[3]=h*b+f*A+y*T,e[4]=l*M+d*S+g*E,e[5]=u*M+p*S+m*E,e[6]=c*M+_*S+v*E,e[7]=h*M+f*S+y*E,e[8]=l*R+d*k+g*x,e[9]=u*R+p*k+m*x,e[10]=c*R+_*k+v*x,e[11]=h*R+f*k+y*x,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function h(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],s=t[5],o=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+u*r,e[5]=s*n+c*r,e[6]=o*n+h*r,e[7]=l*n+d*r,e[8]=u*n-a*r,e[9]=c*n-s*r,e[10]=h*n-o*r,e[11]=d*n-l*r,e}function d(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-u*r,e[1]=s*n-c*r,e[2]=o*n-h*r,e[3]=l*n-d*r,e[8]=a*r+u*n,e[9]=s*r+c*n,e[10]=o*r+h*n,e[11]=l*r+d*n,e}function p(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+u*r,e[1]=s*n+c*r,e[2]=o*n+h*r,e[3]=l*n+d*r,e[4]=u*n-a*r,e[5]=c*n-s*r,e[6]=h*n-o*r,e[7]=d*n-l*r,e}function _(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,l=n+n,u=i*s,c=r*s,h=r*o,d=n*s,p=n*o,_=n*l,f=a*s,g=a*o,m=a*l;return e[0]=1-h-_,e[1]=c+m,e[2]=d-g,e[3]=0,e[4]=c-m,e[5]=1-u-_,e[6]=p+f,e[7]=0,e[8]=d+g,e[9]=p-f,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function f(e,t,i,r,n){var a,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(a=1/(r-n),e[10]=(n+r)*a,e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e}function g(e,t,i,r,n,a,s){var o=1/(t-i),l=1/(r-n),u=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*o,e[13]=(n+r)*l,e[14]=(s+a)*u,e[15]=1,e}function m(e,t,i,n){var a,o,l,u,c,h,d,p,_,f,g=t[0],m=t[1],v=t[2],y=n[0],b=n[1],A=n[2],T=i[0],M=i[1],S=i[2];return Math.abs(g-T)<r.p8&&Math.abs(m-M)<r.p8&&Math.abs(v-S)<r.p8?s(e):(d=g-T,p=m-M,_=v-S,a=b*(_*=f=1/Math.hypot(d,p,_))-A*(p*=f),o=A*(d*=f)-y*_,l=y*p-b*d,(f=Math.hypot(a,o,l))?(a*=f=1/f,o*=f,l*=f):(a=0,o=0,l=0),u=p*l-_*o,c=_*a-d*l,h=d*o-p*a,(f=Math.hypot(u,c,h))?(u*=f=1/f,c*=f,h*=f):(u=0,c=0,h=0),e[0]=a,e[1]=u,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=p,e[7]=0,e[8]=l,e[9]=h,e[10]=_,e[11]=0,e[12]=-(a*g+o*m+l*v),e[13]=-(u*g+c*m+h*v),e[14]=-(d*g+p*m+_*v),e[15]=1,e)}var v=function(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],_=t[11],f=t[12],g=t[13],m=t[14],v=t[15],y=i[0],b=i[1],A=i[2],T=i[3];return e[0]=y*r+b*o+A*h+T*f,e[1]=y*n+b*l+A*d+T*g,e[2]=y*a+b*u+A*p+T*m,e[3]=y*s+b*c+A*_+T*v,y=i[4],b=i[5],A=i[6],T=i[7],e[4]=y*r+b*o+A*h+T*f,e[5]=y*n+b*l+A*d+T*g,e[6]=y*a+b*u+A*p+T*m,e[7]=y*s+b*c+A*_+T*v,y=i[8],b=i[9],A=i[10],T=i[11],e[8]=y*r+b*o+A*h+T*f,e[9]=y*n+b*l+A*d+T*g,e[10]=y*a+b*u+A*p+T*m,e[11]=y*s+b*c+A*_+T*v,y=i[12],b=i[13],A=i[14],T=i[15],e[12]=y*r+b*o+A*h+T*f,e[13]=y*n+b*l+A*d+T*g,e[14]=y*a+b*u+A*p+T*m,e[15]=y*s+b*c+A*_+T*v,e}},863(e,t,i){var r,n,a,s;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}e=i.nmd(e),s=function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function r(e){if(!e)throw new Error("SketchfabOAuth2 config is missing.");if(e.hasOwnProperty("hostname")||(e.hostname="sketchfab.com"),!e.hasOwnProperty("client_id"))throw new Error("client_id is missing. Please check the config of SketchfabOAuth2.");if(!e.hasOwnProperty("redirect_uri"))throw new Error("redirect_uri is missing. Please check the config of SketchfabOAuth2.");this.config=e}i(5);var n=i(2),a=i(6),s=a.buildQueryString,o=a.parseQueryString;r.prototype.connect=function(e){return new n(function(t,i){if(this.config.client_id)var r={response_type:"token",state:+new Date,client_id:this.config.client_id,redirect_uri:this.config.redirect_uri},n=Object.assign({},r,e),a="https://"+this.config.hostname+"/oauth2/authorize/?"+s(n),l=window.open(a,"loginWindow","width=640,height=400"),u=setInterval(function(){try{var e=l.location.href;if(void 0===e)return clearInterval(u),void i(new Error("Access denied (User closed popup)"));if(-1!==e.indexOf("?error=access_denied"))return clearInterval(u),void i(new Error("Access denied (User canceled)"));if(-1!==e.indexOf(this.config.redirect_uri)){clearInterval(u);var r,n=l.location.hash,a=RegExp("access_token=([^&]+)");return n.match(a)?(r=o(n.substring(1)),void t(r)):void i(new Error("Access denied (missing token)"))}}catch(e){}}.bind(this),1e3);else i(new Error("client_id is missing."))}.bind(this))},e.exports=r},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(u===setTimeout)return setTimeout(e,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function a(){_&&d&&(_=!1,d.length?p=d.concat(p):f=-1,p.length&&s())}function s(){if(!_){var e=n(a);_=!0;for(var t=p.length;t;){for(d=p,p=[];++f<t;)d&&d[f].run();f=-1,t=p.length}d=null,_=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var u,c,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(e){u=i}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var d,p=[],_=!1,f=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new o(e,t)),1!==p.length||_||n(s)},o.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,i){(function(t){"use strict";function i(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function n(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void r._immediateFn(function(){var i=1===e._state?t.onFulfilled:t.onRejected;if(null!==i){var r;try{r=i(e._value)}catch(e){return void s(t.promise,e)}a(t.promise,r)}else(1===e._state?a:s)(t.promise,e._value)}))}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==o(t)||"function"==typeof t)){var i=t.then;if(t instanceof r)return e._state=3,e._value=t,void l(e);if("function"==typeof i)return void c(function(e,t){return function(){e.apply(t,arguments)}}(i,t),e)}e._state=1,e._value=t,l(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)n(e,e._deferreds[t]);e._deferreds=null}function u(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}function c(e,t){var i=!1;try{e(function(e){i||(i=!0,a(t,e))},function(e){i||(i=!0,s(t,e))})}catch(e){if(i)return;i=!0,s(t,e)}}var h=setTimeout;r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var r=new this.constructor(i);return n(this,new u(e,t,r)),r},r.prototype.finally=function(e){var t=this.constructor;return this.then(function(i){return t.resolve(e()).then(function(){return i})},function(i){return t.resolve(e()).then(function(){return t.reject(i)})})},r.all=function(e){return new r(function(t,i){function r(e,s){try{if(s&&("object"==o(s)||"function"==typeof s)){var l=s.then;if("function"==typeof l)return void l.call(s,function(t){r(e,t)},i)}n[e]=s,0===--a&&t(n)}catch(e){i(e)}}if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);for(var a=n.length,s=0;s<n.length;s++)r(s,n[s])})},r.resolve=function(e){return e&&"object"==o(e)&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,i){i(e)})},r.race=function(e){return new r(function(t,i){for(var r=0,n=e.length;r<n;r++)e[r].then(t,i)})},r._immediateFn="function"==typeof t&&function(e){t(e)}||function(e){h(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e.exports=r}).call(t,i(4).setImmediate)},function(e,t,i){(function(e,t){!function(e){"use strict";function i(e){delete s[e]}function r(e){if(o)setTimeout(r,0,e);else{var t=s[e];if(t){o=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{i(e),o=!1}}}}if(!e.setImmediate){var n,a=1,s={},o=!1,l=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){r(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?function(){var t="setImmediate$"+Math.random()+"$",i=function(i){i.source===e&&"string"==typeof i.data&&0===i.data.indexOf(t)&&r(+i.data.slice(t.length))};e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),n=function(i){e.postMessage(t+i,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){r(e.data)},n=function(t){e.port2.postMessage(t)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var e=l.documentElement;n=function(t){var i=l.createElement("script");i.onreadystatechange=function(){r(t),i.onreadystatechange=null,e.removeChild(i),i=null},e.appendChild(i)}}():n=function(e){setTimeout(r,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return s[a]=r,n(a),a++},u.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,function(){return this}(),i(1))},function(e,t,i){(function(e){function r(e,t){this._id=e,this._clearFn=t}var n=Function.prototype.apply;t.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},i(3),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,function(){return this}())},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])}return i},writable:!0,configurable:!0})},function(e,t){e.exports={parseQueryString:function(e){var t={};return e.split("&").forEach(function(e){var i=e.split("=");t[i[0]]=decodeURIComponent(i[1])}),t},buildQueryString:function(e){for(var t=Object.keys(e),i=[],r=0,n=t.length;r<n;r++)i.push(t[r]+"="+encodeURIComponent(e[t[r]]));return i.join("&")}}}])},"object"==o(t)&&"object"==o(e)?e.exports=s():(n=[],void 0===(a="function"==typeof(r=s)?r.apply(t,n):r)||(e.exports=a))},865(e,t,i){"use strict";i.d(t,{A:()=>s});var r=i(263),n=function e(t){var i=e.languages[e.select][t]||e.languages.english[t];return"string"==typeof i?i:"function"==typeof i?i.apply(this,Array.prototype.slice.call(arguments,1)):(console.error("No TR found for : "+t),t)};n.languages={english:{backgroundTitle:"Background",backgroundReset:"Reset",backgroundImport:"Import (jpg, png...)",backgroundFill:"Fill",cameraTitle:"Camera",cameraReset:"View",cameraCenter:"Reset (bar)",cameraFront:"Front (F)",cameraLeft:"Left (L)",cameraTop:"Top (T)",cameraMode:"Mode",cameraOrbit:"Orbit (Turntable)",cameraSpherical:"Spherical (Trackball)",cameraPlane:"Plane (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographic",cameraFov:"Fov",cameraPivot:"Picking pivot",fileTitle:"Files (import/export)",fileImportTitle:"Import",fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:"Scale and center",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Export Scene",fileExportAll:"Export all",fileExportSGL:"Save .sgl (SculptGL)",fileExportOBJ:"Save .obj",fileExportPLY:"Save .ply",fileExportSTL:"Save .stl",fileExportTextureTitle:"Export textures",fileExportTextureSize:"Size",fileExportColor:"Save diffuse",fileExportRoughness:"Save roughness",fileExportMetalness:"Save metalness",sceneTitle:"Scene",sceneReset:"Clear scene",sceneResetConfirm:"Confirm clear scene",sceneAddSphere:"Add sphere",sceneAddCube:"Add cube",sceneAddPlane:"Add plane",sceneAddCylinder:"Add cylinder",sceneAddTorus:"Add torus",sceneSelection:"Selection",sceneMerge:"Merge selection",sceneDuplicate:"Copy selection",sceneDelete:"Delete selection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topology",multiresTitle:"Multiresolution",multiresSubdivide:"Subdivide",multiresReverse:"Reverse",multiresResolution:"Resolution",multiresNoLower:"There is no lower resolution level.",multiresNoHigher:"There is no higher resolution level.",multiresDelHigher:"Delete higher",multiresDelLower:"Delete lower",multiresSelectLowest:"Select the lowest resolution before reversing.",multiresSelectHighest:"Select the highest resolution before subdividing.",multiresWarnBigMesh:function(e){return"The next subdivision level will reach "+e+' faces.\nIf you know what you are doing, click again on "subdivide".'},multiresNotReversible:"Sorry it is not possile to reverse this mesh.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Resolution",remeshBlock:"Block",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamic Topology",dynamicActivated:"Activated (no quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Decimation",dynamicLinear:"Linear subdivision",sculptTitle:"Sculpting & Painting",sculptBrush:"Brush",sculptInflate:"Inflate",sculptTwist:"Twist",sculptSmooth:"Smooth (-Shift)",sculptFlatten:"Flatten",sculptPinch:"Pinch",sculptCrease:"Crease",sculptDrag:"Drag",sculptPaint:"Paint",sculptMasking:"Masking (-Ctrl)",sculptMove:"Move",sculptLocalScale:"Local scale",sculptTransform:"Transform (E)",sculptElementSelect:"Element selection",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Coordinate space",sculptGlobal:"Global",sculptLocal:"Local",sculptLocalTransform:"Yaw/Pitch/Roll",sculptYaw:"Yaw",sculptPitch:"Pitch",sculptRoll:"Roll",sculptGizmoFilters:"Gizmo filters",sculptGizmoOperation:"Operation",sculptGizmoAxis:"Axis",sculptGizmoAll:"All",sculptGizmoMove:"Move",sculptGizmoRotate:"Rotate",sculptGizmoScale:"Scale",sculptGizmoAxisX:"X",sculptGizmoAxisY:"Y",sculptGizmoAxisZ:"Z",sculptElementSelectMode:"Element",sculptElementSelectVertex:"Vertex",sculptElementSelectEdge:"Edge",sculptElementSelectFace:"Face",sculptElementSelectAction:"Action",sculptElementSelectReplace:"Replace",sculptElementSelectAdd:"Add",sculptElementSelectRemove:"Remove",sculptElementSelectAll:"Select all",sculptElementSelectClear:"Clear selection",sculptElementSelectInvert:"Invert selection",sculptCommon:"Common",sculptTool:"Tool",sculptSymmetry:"Symmetry",sculptContinuous:"Continuous",sculptRadius:"Radius (-X)",sculptIntensity:"Intensity (-C)",sculptHardness:"Hardness",sculptCulling:"Thin surface (front vertex only)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Lock position",sculptAlphaTex:"Texture",sculptImportAlpha:"Import alpha tex (jpg, png...)",sculptNegative:"Negative (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Roughness",sculptMetallic:"Metallic",sculptClay:"Clay",sculptAccumulate:"Accumulate (no limit per stroke)",sculptColorGlobal:"Global",sculptPickColor:"Material / Color picker (-S)",sculptTangentialSmoothing:"Relax only",sculptTopologicalCheck:"Topological check",sculptMoveAlongNormal:"Move along normal (N or -Alt)",sculptMaskingClear:"Clear (-Ctrl + Drag)",sculptMaskingInvert:"Invert (-Ctrl + Click)",sculptMaskingBlur:"Blur",sculptMaskingSharpen:"Sharpen",sculptPBRTitle:"PBR materials",sculptPaintAll:"Paint all",sculptExtractTitle:"Extract",sculptExtractThickness:"Thickness",sculptExtractAction:"Extract !",stateTitle:"History",stateUndo:"Undo",stateRedo:"Redo",stateMaxStack:"Max Stack",pressureTitle:"Tablet pressure",pressureRadius:"Pressure radius",pressureIntensity:"Pressure intensity",renderingTitle:"Rendering",renderingGrid:"Show grid",renderingSymmetryLine:"Show mirror line",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Transparency",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Import (jpg, png...)",renderingImportMatcap:"Import (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flat shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exposure",renderingEnvironment:"Environment",renderingIsolate:"Isolate/Show (I)",renderingFilmic:"Filmic tonemapping",contour:"Contour",contourShow:"Show contour",contourColor:"Color",darkenUnselected:"Darken unselected",resolution:"Resolution",matcapPearl:"Pearl",matcapClay:"Clay",matcapSkin:"Skin",matcapGreen:"Green",matcapWhite:"White",sketchfabTitle:"Go to Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"About & Help",alphaNone:"None",alphaSquare:"Square",alphaSkin:"Skin",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"},:{backgroundTitle:"",backgroundReset:"",backgroundImport:"  (jpg, png...)",backgroundFill:null,cameraTitle:"",cameraReset:"View",cameraCenter:null,cameraFront:null,cameraLeft:null,cameraTop:null,cameraMode:"",cameraOrbit:null,cameraSpherical:" (Trackball)",cameraPlane:" (Trackball)",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:"",fileTitle:" (/)",fileImportTitle:null,fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportSceneTitle:null,fileExportAll:null,fileExportSGL:null,fileExportOBJ:null,fileExportPLY:null,fileExportSTL:null,fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:null,sceneReset:null,sceneAddSphere:null,sceneAddCube:null,sceneAddPlane:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,sceneDuplicate:null,meshTitle:"",meshNbVertices:null,meshNbFaces:null,topologyTitle:null,multiresTitle:null,multiresSubdivide:null,multiresReverse:null,multiresResolution:null,multiresNoLower:null,multiresNoHigher:null,multiresDelHigher:null,multiresDelLower:null,multiresSelectLowest:null,multiresSelectHighest:null,multiresWarnBigMesh:null,multiresNotReversible:null,remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,retopoQuadTitle:null,retopoQuadAction:null,retopoQuadResolution:null,retopoQuadRelax:null,retopoQuadIntensity:null,retopoQuadTangent:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,modelingTitle:null,modelingMode:null,modelingSidebarTitle:null,modelingSelectionTitle:null,modelingSelectVertex:null,modelingSelectEdge:null,modelingSelectFace:null,modelingSelectionAction:null,modelingActionReplace:null,modelingActionAdd:null,modelingActionRemove:null,modelingToolsTitle:null,modelingExtrude:null,modelingDelete:null,modelingFill:null,modelingBridge:null,modelingKnife:null,modelingLoopCut:null,modelingNotImplemented:null,sculptRotomoldTitle:null,sculptRotomoldEnable:null,sculptRotomoldSpeed:null,sculptRotomoldAxis:null,sculptRotomoldAxisX:null,sculptRotomoldAxisY:null,sculptRotomoldAxisZ:null,sculptRotomoldPivot:null,sculptRotomoldPivotMesh:null,sculptRotomoldPivotWorld:null,sculptGizmoTransform:null,sculptCoordSpace:null,sculptGlobal:null,sculptLocal:null,sculptLocalTransform:null,sculptYaw:null,sculptPitch:null,sculptRoll:null,sculptCommon:null,sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:" (N or -Alt)",sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:"",sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:null,pressureTitle:"",pressureRadius:"",pressureIntensity:"",renderingTitle:null,renderingGrid:null,renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"",renderingNormal:"",renderingUV:null,renderingShader:"",renderingMaterial:null,renderingImportUV:null,renderingImportMatcap:null,renderingExtra:null,renderingFlat:"",renderingWireframe:" (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:"",matcapSkin:"",matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfab",sketchfabUpload:"",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"",cameraTitle:"",cameraReset:"",cameraCenter:" ()",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:"",cameraOrbit:" ()",cameraSpherical:" ()",cameraPlane:" ()",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:"",fileTitle:" (/)",fileImportTitle:"",fileAdd:" (obj, sgl, ply, stl)",fileAutoMatrix:"",fileVertexSRGB:"sRGB ",fileExportSceneTitle:"",fileExportAll:"",fileExportSGL:" .sgl (SculptGL)",fileExportOBJ:" .obj",fileExportPLY:" .ply",fileExportSTL:" .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:"",sceneResetConfirm:"",sceneAddSphere:"",sceneAddCube:"",sceneAddPlane:"",sceneAddCylinder:"",sceneAddTorus:"",sceneSelection:"",sceneMerge:"",sceneDuplicate:"",sceneDelete:"",meshTitle:"",meshNbVertices:" : ",meshNbFaces:" : ",topologyTitle:"()",multiresTitle:"",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"",multiresNoHigher:"",multiresDelHigher:"",multiresDelLower:"",multiresSelectLowest:"",multiresSelectHighest:"",multiresWarnBigMesh:function(e){return" "+e+" \n"},multiresNotReversible:"\n (loop-catmull) ",remeshTitle:"",remeshRemesh:"",remeshResolution:"",remeshBlock:"",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"",dynamicActivated:" ()",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:"",sculptTitle:"",sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:" (-Ctrl)",sculptMove:"",sculptLocalScale:"",sculptTransform:" (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:"",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:" ()",sculptAlphaTitle:" (Alpha)",sculptLockPositon:"",sculptAlphaTex:"",sculptImportAlpha:" alpha  (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"",sculptAccumulate:" ()",sculptColorGlobal:"",sculptPickColor:" (-S)",sculptTangentialSmoothing:"",sculptTopologicalCheck:"",sculptMoveAlongNormal:" (N  -Alt)",sculptMaskingClear:" (-Ctrl + )",sculptMaskingInvert:" (-Ctrl + )",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:"",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:" !",stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:"",pressureTitle:"",pressureRadius:"",pressureIntensity:"",renderingTitle:"",renderingGrid:"",renderingSymmetryLine:"",renderingMatcap:" (Matcap)",renderingCurvature:"",renderingPBR:"(PBR)",renderingTransparency:"",renderingNormal:"",renderingUV:"UV ",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:"",renderingFlat:"",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:"/ (I)",renderingFilmic:"",contour:"",contourShow:"",contourColor:"",darkenUnselected:"",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:" Sketchfab !",sketchfabUpload:"",sketchfabUploadMessage:' sketchfab API .\n "guest" \n()',sketchfabUploadError:function(e){return"Sketchfab  :\n"+e},sketchfabUploadSuccess:" !\n :",sketchfabAbort:" ?",sketchfabUploadProcessing:"...\n",about:"",alphaNone:"",alphaSquare:"",alphaSkin:""},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"  ",cameraTitle:"",cameraReset:"",cameraCenter:" (bar)",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:"",cameraOrbit:" (Turntable)",cameraSpherical:" (Trackball)",cameraPlane:" (Trackball)",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:"",cameraPivot:" ",fileTitle:" (/)",fileImportTitle:"",fileAdd:" (obj, sgl, ply, stl)",fileAutoMatrix:"  ",fileVertexSRGB:"sRGB  ",fileExportSceneTitle:" ",fileExportAll:" ",fileExportSGL:".sgl  ",fileExportOBJ:".obj  ",fileExportPLY:".ply  ",fileExportSTL:".stl  ",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:" ",sceneResetConfirm:"  ",sceneAddSphere:" ",sceneAddCube:" ",sceneAddPlane:" ",sceneAddCylinder:" ",sceneAddTorus:" ",sceneSelection:"",sceneMerge:" ",sceneDuplicate:null,sceneDelete:"  ",meshTitle:"",meshNbVertices:"  : ",meshNbFaces:"  : ",topologyTitle:"",multiresTitle:" ",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"    .",multiresNoHigher:"    .",multiresDelHigher:"  ",multiresDelLower:"  ",multiresSelectLowest:"      .",multiresSelectHighest:"      ",multiresWarnBigMesh:function(e){return"     "+e+'   .\n      ""   .'},multiresNotReversible:"     .\n    (loop-catmull)  .",remeshTitle:" ",remeshRemesh:"",remeshResolution:"",remeshBlock:"",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:" ",dynamicActivated:" (  )",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:" ",sculptTitle:" & ",sculptBrush:"",sculptInflate:"",sculptTwist:"",sculptSmooth:" (-Shift)",sculptFlatten:"",sculptPinch:"",sculptCrease:"",sculptDrag:"",sculptPaint:"",sculptMasking:" (-Ctrl)",sculptMove:"",sculptLocalScale:" ",sculptTransform:" (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:" ",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:"  (  )",sculptAlphaTitle:"",sculptLockPositon:" ",sculptAlphaTex:"",sculptImportAlpha:"   (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"",sculptAccumulate:" (   )",sculptColorGlobal:null,sculptPickColor:" /   (-S)",sculptTangentialSmoothing:" ",sculptTopologicalCheck:" ",sculptMoveAlongNormal:"  ",sculptMaskingClear:" (-Ctrl + Drag)",sculptMaskingInvert:" (-Ctrl + Click)",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:" ",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:"!",stateTitle:"",stateUndo:" ",stateRedo:" ",stateMaxStack:"  ",pressureTitle:"",pressureRadius:"",pressureIntensity:" ",renderingTitle:"",renderingGrid:" ",renderingSymmetryLine:" ",renderingMatcap:"",renderingCurvature:" ",renderingPBR:"PBR",renderingTransparency:"",renderingNormal:" ",renderingUV:"UV ",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:" ",renderingFlat:" ",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:"/ (I)",renderingFilmic:"(filmic) ",contour:"",contourShow:" ",contourColor:"",darkenUnselected:" ",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:"Sketchfab ",sketchfabUpload:"",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:"SculptGL ",alphaNone:null,alphaSquare:null,alphaSkin:null},:{backgroundTitle:"",backgroundReset:"",backgroundImport:" (jpg, png...)",backgroundFill:"",cameraTitle:"",cameraReset:"",cameraCenter:" (bar)",cameraFront:" (F)",cameraLeft:" (L)",cameraTop:" (T)",cameraMode:" ",cameraOrbit:" ()",cameraSpherical:" ()",cameraPlane:" ()",cameraProjection:"",cameraPerspective:"",cameraOrthographic:"",cameraFov:" ",cameraPivot:" ",fileTitle:"",fileImportTitle:"",fileAdd:"(obj,sgl,ply,stl)",fileAutoMatrix:"-",fileVertexSRGB:"  sRGB",fileExportSceneTitle:" ",fileExportAll:" ",fileExportSGL:" .sgl",fileExportOBJ:" .obj",fileExportPLY:" .ply",fileExportSTL:" .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"",sceneReset:" ",sceneResetConfirm:"  ",sceneAddSphere:" ",sceneAddCube:" ",sceneAddPlane:" ",sceneAddCylinder:" ",sceneAddTorus:" ",sceneSelection:"",sceneMerge:"",sceneDuplicate:null,sceneDelete:" ",meshTitle:"",meshNbVertices:" : ",meshNbFaces:" : ",topologyTitle:"",multiresTitle:"",multiresSubdivide:"",multiresReverse:"",multiresResolution:"",multiresNoLower:"   .",multiresNoHigher:"   .",multiresDelHigher:" ",multiresDelLower:" ",multiresSelectLowest:"   .",multiresSelectHighest:"   .",multiresWarnBigMesh:function(e){return"  "+e+' faces.\n  ,    "".'},multiresNotReversible:"    ,    .\n  .",remeshTitle:" ",remeshRemesh:"",remeshResolution:"",remeshBlock:"-",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:" ",dynamicActivated:" ( )",dynamicSubdivision:"",dynamicDecimation:"",dynamicLinear:" ",sculptTitle:"  ",sculptBrush:"3D ",sculptInflate:"3D ",sculptTwist:"3D ",sculptSmooth:"3D  (-Shift)",sculptFlatten:"3D ",sculptPinch:"3D ",sculptCrease:"3D ",sculptDrag:"3D ",sculptMove:"3D ",sculptLocalScale:"3D ",sculptPaint:"2D ",sculptMasking:"2D  (-Ctrl)",sculptTransform:"",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"",sculptCoordSpace:" ",sculptGlobal:"",sculptLocal:"",sculptLocalTransform:"//",sculptYaw:"",sculptPitch:"",sculptRoll:"",sculptCommon:"",sculptTool:"",sculptSymmetry:"",sculptContinuous:"",sculptRadius:" (-X)",sculptIntensity:" (-C)",sculptHardness:"",sculptCulling:" ( )",sculptAlphaTitle:"",sculptLockPositon:"",sculptAlphaTex:"",sculptImportAlpha:"   (jpg, png...)",sculptNegative:" (N  -Alt)",sculptColor:"",sculptRoughness:"",sculptMetallic:"",sculptClay:"  ",sculptAccumulate:"  ",sculptColorGlobal:"",sculptPickColor:"  (-S)",sculptTangentialSmoothing:"  ",sculptTopologicalCheck:" ",sculptMoveAlongNormal:"  ",sculptMaskingClear:" (-Ctrl + Drag)",sculptMaskingInvert:" (-Ctrl + Click)",sculptMaskingBlur:"",sculptMaskingSharpen:"",sculptPBRTitle:"PBR ",sculptPaintAll:"",sculptExtractTitle:"",sculptExtractThickness:"",sculptExtractAction:"!",stateTitle:"",stateUndo:"",stateRedo:"",stateMaxStack:" ",pressureTitle:" pressure",pressureRadius:"-",pressureIntensity:"-",renderingTitle:"",renderingGrid:" ",renderingSymmetryLine:" ",renderingMatcap:null,renderingCurvature:"",renderingPBR:"PBR",renderingTransparency:"",renderingNormal:" ",renderingUV:"UV",renderingShader:"",renderingMaterial:"",renderingImportUV:" (jpg, png...)",renderingImportMatcap:" (jpg, png...)",renderingExtra:"",renderingFlat:"",renderingWireframe:" (W)",renderingExposure:"",renderingEnvironment:"",renderingIsolate:" /  (I)",renderingFilmic:"",contour:"",contourShow:" ",contourColor:"",darkenUnselected:" ",resolution:"",matcapPearl:"",matcapClay:"",matcapSkin:"",matcapGreen:"",matcapWhite:"",sketchfabTitle:" Sketchfab.com ",sketchfabUpload:"",sketchfabUploadMessage:" API- sketchfab.\n  guest,    .\n(       )",sketchfabUploadError:function(e){return"   Sketchfab :\n"+e},sketchfabUploadSuccess:"  !\n :",sketchfabAbort:" ?",sketchfabUploadProcessing:"...\n    :",about:" ",alphaNone:"",alphaSquare:"",alphaSkin:""},turkish:{backgroundTitle:"Arka plan",backgroundReset:"Temizle",backgroundImport:"e Aktar (jpg, png...)",backgroundFill:"Doldur",cameraTitle:"Kamera",cameraReset:"Grnm",cameraCenter:"Temizle (boluk)",cameraFront:"n (F)",cameraLeft:"Sol (L)",cameraTop:"st (T)",cameraMode:"Mod",cameraOrbit:"Eksen (Dner Tabla)",cameraSpherical:"Kresel (Trackball)",cameraPlane:"Dzlem (Trackball)",cameraProjection:"z Dm",cameraPerspective:"Perspektif",cameraOrthographic:"Orthografik",cameraFov:"Gr Alan",cameraPivot:"Eksen",fileTitle:"Dosyalar (ieri/dar)",fileImportTitle:"e Aktar",fileAdd:"Aktar (obj, sgl, ply, stl)",fileAutoMatrix:"lekle ve ortala",fileVertexSRGB:"sRGB verteks renk",fileExportSceneTitle:"Sahneyi Da Aktar",fileExportAll:"tmn ver",fileExportSGL:"Kaydet .sgl (SculptGL)",fileExportOBJ:"Kaydet .obj",fileExportPLY:"Kaydet .ply",fileExportSTL:"Kaydet .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Sahne",sceneReset:"Sahneyi temizle",sceneResetConfirm:"Net sahneyi dorulayn",sceneAddSphere:"Kre ekle",sceneAddCube:"Kp ekle",sceneAddPlane:"Dzlem ekle",sceneAddCylinder:"Silindir ekle",sceneAddTorus:"Halka ekle",sceneSelection:"Seim",sceneMerge:"Seimi birletir",sceneDuplicate:null,sceneDelete:"Seimi sil",meshTitle:"Nesne",meshNbVertices:"Verteks : ",meshNbFaces:"Cephe : ",topologyTitle:"Topoloji",multiresTitle:"oklu znrlk",multiresSubdivide:"Bl",multiresReverse:"Ters",multiresResolution:"znrlk",multiresNoLower:"Daha dk znrlk yok.",multiresNoHigher:"Daha yksek znrlk yok.",multiresDelHigher:"st znrl sil",multiresDelLower:"Alt znrl sil",multiresSelectLowest:"Tersine evirmeden nce en dk znrl se.",multiresSelectHighest:"Tesine evirmeden nce en yksek znrl se.",multiresWarnBigMesh:function(e){return"Sonraki znrlk "+e+' cepheden oluacak.\nEer devam etmek istiyorsanz, tekrar "bl" butonuna basn.'},multiresNotReversible:"Malesef bu nesneyi tersine evirmek mmkn deil.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voksel Remeshing",remeshRemesh:"Remesh",remeshResolution:"znrlk",remeshBlock:"Engelle",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dinamik Topoloji",dynamicActivated:"Aktifletirildi (no quads)",dynamicSubdivision:"Altblm",dynamicDecimation:"stblm",dynamicLinear:"Dorusal altblm",sculptTitle:"Oyma & Boyama",sculptBrush:"Fra",sculptInflate:"iir",sculptTwist:"Bklme",sculptSmooth:"Yumuat (-Shift)",sculptFlatten:"Dzletir",sculptPinch:"imdik",sculptCrease:"Kvrm",sculptDrag:"Srkle",sculptPaint:"Boya",sculptMasking:"Maskeleme (-Ctrl)",sculptMove:"Ta",sculptLocalScale:"Yerel lek",sculptTransform:"Transform (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinat alan",sculptGlobal:"Kresel",sculptLocal:"Yerel",sculptLocalTransform:"Sapma/Yunuslama/Yalpalama",sculptYaw:"Sapma",sculptPitch:"Yunuslama",sculptRoll:"Yalpalama",sculptCommon:"Genel",sculptTool:"Ara",sculptSymmetry:"Simetri",sculptContinuous:"Srekli",sculptRadius:"Yara (-X)",sculptIntensity:"Younluk (-C)",sculptHardness:"Sertlik",sculptCulling:"nce yzey (front vertex only)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Pozisyonu kilitle",sculptAlphaTex:"Kaplama",sculptImportAlpha:"Alfa kaplama ykle (jpg, png...)",sculptNegative:"Negatif (N or -Alt)",sculptColor:"Aklk",sculptRoughness:"Przllk",sculptMetallic:"Metalik",sculptClay:"Kil",sculptAccumulate:"Biriktir (limitsiz)",sculptColorGlobal:"Evrensel",sculptPickColor:"Materyal / Renk seici (-S)",sculptTangentialSmoothing:"Rahatlat",sculptTopologicalCheck:"Topoloji kontrol",sculptMoveAlongNormal:"Normal boyunca ta (N or -Alt)",sculptMaskingClear:"Temizle (-Ctrl + Drag)",sculptMaskingInvert:"Tersine evir (-Ctrl + Click)",sculptMaskingBlur:"Bulanklatr",sculptMaskingSharpen:"Keskinletir",sculptPBRTitle:"PBR materyali",sculptPaintAll:"Tmn boya",sculptExtractTitle:"kar",sculptExtractThickness:"Kalnlk",sculptExtractAction:"kar !",stateTitle:"Gemi",stateUndo:"Geri Al",stateRedo:"leri Al",stateMaxStack:"Maksimum Yn",pressureTitle:"Tablet pressure",pressureRadius:"Basn ap",pressureIntensity:"Basn hassasiyeti",renderingTitle:"Sahneleme",renderingGrid:"Izgaray gster",renderingSymmetryLine:"aynalama izgisini gster",renderingMatcap:"Matcap",renderingCurvature:"Erilik",renderingPBR:"PBR",renderingTransparency:"Transparanlk",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materyal",renderingImportUV:"e AKtar (jpg, png...)",renderingImportMatcap:"e AKtar (jpg, png...)",renderingExtra:"Ekstra",renderingFlat:"Dz glgeleme",renderingWireframe:"Tel kafes (W)",renderingExposure:"Teir",renderingEnvironment:"Ortam",renderingIsolate:"zole/Gster (I)",renderingFilmic:"Film Ton Elemesi",contour:"Kontr",contourShow:"Kontr gster",contourColor:"Renk",darkenUnselected:"Seilmeyenleri koyu yap",resolution:"znrlk",matcapPearl:"nci",matcapClay:"Kil",matcapSkin:"Deri",matcapGreen:"Yeil",matcapWhite:"Beyaz",sketchfabTitle:"Sketchfab'a git !",sketchfabUpload:"Ykle",sketchfabUploadMessage:'Ltfen sketchfab entegrasyon anahtarn giriniz.\nAnonim olarak kullanmak iin "guest" olarak braknz.\n(leme ve ykleme tamamlandnda yeni bir pencere alacak)',sketchfabUploadError:function(e){return"Sketchfab ykleme hatas :\n"+e},sketchfabUploadSuccess:"Ykleme baarl !\nAdresiniz burada :",sketchfabAbort:"Son yklemeyi iptal et ?",sketchfabUploadProcessing:"Hesaplanyor...\nModeliniz u adreste olacak :",about:"Hakknda & Yardm",alphaNone:"Hi Biri",alphaSquare:"Kare",alphaSkin:"Deri"},svenska:{backgroundTitle:"Bakgrund",backgroundReset:"terstll",backgroundImport:"Importera (jpg, png...)",backgroundFill:"Fyll",cameraTitle:"Kamera",cameraReset:"Vy",cameraCenter:"terstll (bar)",cameraFront:"Fram (F)",cameraLeft:"Vnster (L)",cameraTop:"ver (T)",cameraMode:"Lge",cameraOrbit:"Omloppsbana (skivtallrik)",cameraSpherical:"Sfrisk (trackball)",cameraPlane:"Plan (trackball)",cameraProjection:"Projektion",cameraPerspective:"Perspektiv",cameraOrthographic:"Ortografisk",cameraFov:"Fov",cameraPivot:"Plocka pivot",fileTitle:"Filer (import/export)",fileImportTitle:"Importera",fileAdd:"Lgg till (obj, sgl, ply, stl)",fileAutoMatrix:"Skala och centrera",fileVertexSRGB:"sRGB vertexfrg",fileExportSceneTitle:"Exportera Scen",fileExportAll:"Exportera alla",fileExportSGL:"Spara .sgl (SculptGL)",fileExportOBJ:"Spara .obj",fileExportPLY:"Spara .ply",fileExportSTL:"Spara .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scen",sceneReset:"Rensa scen",sceneResetConfirm:"Bekrfta klar scen",sceneAddSphere:"Lgg till sfr",sceneAddCube:"Lgg till kub",sceneAddPlane:"Lgg till plan",sceneAddCylinder:"Lgg till cylinder",sceneAddTorus:"Lgg till torus",sceneSelection:"Urval",sceneMerge:"Sammanfoga urval",sceneDuplicate:null,sceneDelete:"Radera valet",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologi",multiresTitle:"Upplsningar",multiresSubdivide:"Dela upp yta",multiresReverse:"Omvnd",multiresResolution:"Upplsning",multiresNoLower:"Det finns ingen lgre upplsningsniv.",multiresNoHigher:"Det finns ingen hgre upplsningsniv.",multiresDelHigher:"Ta bort hgre",multiresDelLower:"Ta bort lgre",multiresSelectLowest:"Vlj den lgsta upplsningen innan omvndning.",multiresSelectHighest:"Vlj den hgsta upplsningen innan uppdelning.",multiresWarnBigMesh:function(e){return"Nsta underavdelning niv kommer att ha "+e+' faces.\nOm du vet vad du gr, klicka igen p "dela upp yta".'},multiresNotReversible:"Tyvrr, det gr inte att omvnda denna mesh.\nMeshen r inte en produkt av en (loop-calmull) mngfaldsytindelning.",remeshTitle:"Voxel Meshombyggnation",remeshRemesh:"Bygg om mesh",remeshResolution:"Upplsning",remeshBlock:"Kuber",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamisk Topologi",dynamicActivated:"Aktiverad (inga quads)",dynamicSubdivision:"Ytindelning",dynamicDecimation:"Decimering",dynamicLinear:"Linjr ytindelning",sculptTitle:"Skulptering & Mleri",sculptBrush:"Pensel",sculptInflate:"Bls upp",sculptTwist:"Tvista",sculptSmooth:"Jmna ut (-Shift)",sculptFlatten:"Platta till",sculptPinch:"Nyp",sculptCrease:"Vecka",sculptDrag:"Dra",sculptPaint:"Mla",sculptMasking:"Maskera (-Ctrl)",sculptMove:"Flytta",sculptLocalScale:"Skala lokalt",sculptTransform:"Transformera (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinatutrymme",sculptGlobal:"Global",sculptLocal:"Lokal",sculptLocalTransform:"Gir/Lutning/Roll",sculptYaw:"Gir",sculptPitch:"Lutning",sculptRoll:"Roll",sculptCommon:"Generellt",sculptTool:"Verktyg",sculptSymmetry:"Symmetri",sculptContinuous:"Kontinuerlig",sculptRadius:"Radie (-X)",sculptIntensity:"Intensitet (-C)",sculptHardness:"Hrdhet",sculptCulling:"Tunn yta (endast frmre vertex)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Ls position",sculptAlphaTex:"Textur",sculptImportAlpha:"Importera alfatextur (jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Ytjmnhet",sculptMetallic:"Metallisk",sculptClay:"Lera",sculptAccumulate:"Ackumulera (ingen grns per strykning)",sculptColorGlobal:"Global",sculptPickColor:"Material / Frgvlgare (-S)",sculptTangentialSmoothing:"Tangentiell utjmning",sculptTopologicalCheck:"Topologisk check",sculptMoveAlongNormal:"Flytta lngsmed normal (N or -Alt)",sculptMaskingClear:"Rensa (-Ctrl + Drag)",sculptMaskingInvert:"Invertera (-Ctrl + Click)",sculptMaskingBlur:"Gr suddig",sculptMaskingSharpen:"Gr skarp",sculptPBRTitle:"PBR-material",sculptPaintAll:"Mla allt",sculptExtractTitle:"Extrahera",sculptExtractThickness:"Tjocklek",sculptExtractAction:"Extrahera!",stateTitle:"Historia",stateUndo:"ngra",stateRedo:"Gr om",stateMaxStack:"gra antal steg",pressureTitle:"pressureplatta",pressureRadius:"Tryckradie",pressureIntensity:"Tryckintensitet",renderingTitle:"Rendering",renderingGrid:"Visa rutnt",renderingSymmetryLine:"Visa speglingslinje",renderingMatcap:"MatCap",renderingCurvature:"Kurvatur",renderingPBR:"PBR",renderingTransparency:"Genomskinlighet",renderingNormal:"Normal shader",renderingUV:"UV-shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importera (jpg, png...)",renderingImportMatcap:"Importera (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Platt shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exponering",renderingEnvironment:"Milj",renderingIsolate:"Isolera/Visa (I)",renderingFilmic:"Filmiska frgtoner",contour:"Kontur",contourShow:"Visa kontur",contourColor:"Frg",darkenUnselected:"Skym ej valda",resolution:"Upplsning",matcapPearl:"Prla",matcapClay:"Lera",matcapSkin:"Hud",matcapGreen:"Grn",matcapWhite:"Vit",sketchfabTitle:"G till Sketchfab!",sketchfabUpload:"Ladda upp",sketchfabUploadMessage:'Vnligen fyll i din sketchfab API-nyckel.\nDu kan ven ange "guest" fr att ladda upp anonymt.\n(ett nytt fnster kommer att ppnas nr uppladdning och bearbetning r klar)',sketchfabUploadError:function(e){return"Sketchfab uppladdningsfel:\n"+e},sketchfabUploadSuccess:"Uppladdning lyckades!\nHr r din lnk:",sketchfabAbort:"Avbryta senaste uppladdningen?",sketchfabUploadProcessing:"Bearbetar...\nDin modell kommer bli tillgnglig hr:",about:"Om & Hjlp",alphaNone:"Ingen",alphaSquare:"Fyrkant",alphaSkin:"Hud"},franais:{backgroundTitle:"Fond d'cran",backgroundReset:"Rinitialiser",backgroundImport:"Importer (jpg, png...)",backgroundFill:"Remplir",cameraTitle:"Camra",cameraReset:"Vue",cameraCenter:"Reset (bar)",cameraFront:"De face (F)",cameraLeft:"De gauche (L)",cameraTop:"De haut (T)",cameraMode:"Mode",cameraOrbit:"Orbite (Turntable)",cameraSpherical:"Spherique (Trackball)",cameraPlane:"Planaire (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographique",cameraFov:"Champs de vision",cameraPivot:"Point de pivot",fileTitle:"Fichiers (importer/exporter)",fileImportTitle:"Importer",fileAdd:"Ajouter (obj, sgl, ply, stl)",fileAutoMatrix:"Mise a l'chelle et centrage",fileVertexSRGB:"Couleur de vertex en sRGB",fileExportSceneTitle:"Exporter Scene",fileExportAll:"Tout exporter",fileExportSGL:"Sauver .sgl (SculptGL)",fileExportOBJ:"Sauver .obj",fileExportPLY:"Sauver .ply",fileExportSTL:"Sauver .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scne",sceneReset:"Rinitialiser scne",sceneResetConfirm:"Confirmer rinitialiser la scne?",sceneAddSphere:"Ajouter sphere",sceneAddCube:"Ajouter cube",sceneAddPlane:"Ajouter plan",sceneAddCylinder:"Ajouter cylindre",sceneAddTorus:"Ajouter tore",sceneSelection:"Slection",sceneMerge:"Fusionner selection",sceneDuplicate:null,sceneDelete:"Supprimer la slection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Multirsolution",multiresSubdivide:"Subdiviser",multiresReverse:"Inverser",multiresResolution:"Rsolution",multiresNoLower:"Il n'y a pas de niveau de rsolution infrieur.",multiresNoHigher:"Il n'y a pas de niveau de rsolution plus lev.",multiresDelHigher:"Suppression suprieur",multiresDelLower:"Suppression infrieur",multiresSelectLowest:"Slectionnez la rsolution la plus basse avant d'inverser.",multiresSelectHighest:"Slectionnez la rsolution la plus leve avant de subdiviser.",multiresWarnBigMesh:function(e){return"Le prochain niveau de subdivision atteindra "+e+' faces.\nSi vous savez ce que vous faites, cliquez de nouveau sur "subdiviser".'},multiresNotReversible:"Dsol, il n'est pas possible d'inverser ce maillage.\nLe mesh n'est pas un produit d'une surface de subdivision (loop-catmull) provenant manifold.",remeshTitle:"Remaillage volumtrique",remeshRemesh:"Remaillage",remeshResolution:"Rsolution",remeshBlock:"Bloc",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Topologie dynamique",dynamicActivated:"Activat (pas quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Dcimation",dynamicLinear:"Subdivision linaire",sculptTitle:"Sculpture & Painture",sculptBrush:"Brosse",sculptInflate:"Gonfler",sculptTwist:"Tordre",sculptSmooth:"Lisser (-Shift)",sculptFlatten:"Aplatir",sculptPinch:"Pincer",sculptCrease:"Plier",sculptDrag:"Tirer",sculptPaint:"Peindre",sculptMasking:"Masquer (-Ctrl)",sculptMove:"Bouger",sculptLocalScale:"Mise  l'chelle locale",sculptTransform:"Transformer (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Espace de coordonnes",sculptGlobal:"Global",sculptLocal:"Local",sculptLocalTransform:"Lacet/Tangage/Roulis",sculptYaw:"Lacet",sculptPitch:"Tangage",sculptRoll:"Roulis",sculptCommon:"Commun",sculptTool:"Outil",sculptSymmetry:"Symtrie",sculptContinuous:"Continu",sculptRadius:"Rayon (-X)",sculptIntensity:"Intensit (-C)",sculptHardness:"Duret",sculptCulling:"Surface fine (vertex de face uniquement)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Bloquer position",sculptAlphaTex:"Texture",sculptImportAlpha:"Importer texture alpha (jpg, png...)",sculptNegative:"Ngatif (N ou -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosit",sculptMetallic:"Mtallique",sculptClay:"Argile",sculptAccumulate:"Accumuler effet",sculptColorGlobal:"Global",sculptPickColor:"Matriau / selection de couleur (-S)",sculptTangentialSmoothing:"Relaxer uniquement",sculptTopologicalCheck:"Vrification topologique",sculptMoveAlongNormal:"Extruder suivant la normale (N ou -Alt)",sculptMaskingClear:"Reset (-Ctrl + Drag)",sculptMaskingInvert:"Inverser (-Ctrl + Click)",sculptMaskingBlur:"Brouiller",sculptMaskingSharpen:"Aiguiser",sculptPBRTitle:"Matriaux physiques (PBR)",sculptPaintAll:"Peindre tout",sculptExtractTitle:"Extraire",sculptExtractThickness:"Epaisseur",sculptExtractAction:"Extraire !",stateTitle:"Historique",stateUndo:"Annuler",stateRedo:"Refaire",stateMaxStack:"Nombre maximale d'action",pressureTitle:"Pression de la tablette",pressureRadius:"Pression sur le rayon",pressureIntensity:"Pression sur l'intensit",renderingTitle:"Rendu",renderingGrid:"Afficher grille",renderingSymmetryLine:"Afficher ligne de symtrie",renderingMatcap:"Matcap",renderingCurvature:"Courbure",renderingPBR:"PBR",renderingTransparency:"Transparence",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Matriau",renderingImportUV:"Importer (jpg, png...)",renderingImportMatcap:"Importer (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Ombrage plat",renderingWireframe:"Fil de fer (W)",renderingExposure:"Exposition",renderingEnvironment:"Environment",renderingIsolate:"Isoler/Afficher (I)",renderingFilmic:"Tonemapping filmique",contour:"Contour",contourShow:"Afficher les contours",contourColor:"Couleur",darkenUnselected:"Assombrir non slction",resolution:"Rsolution",matcapPearl:"Perle",matcapClay:"Argile",matcapSkin:"Peau",matcapGreen:"Vert",matcapWhite:"Blanc",sketchfabTitle:"Vers Sketchfab !",sketchfabUpload:"Uploader",sketchfabUploadMessage:"Entrez votre cl d'API sketchfab.\n",sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Tlchargement fini !\nVoici le lien :",sketchfabAbort:"Annuler le dernier tlchargement ?",sketchfabUploadProcessing:"En traitement...\nLe modle sera disponible sur :",about:"A propos & aide",alphaNone:"Vide",alphaSquare:"Carr",alphaSkin:"Peau",remeshTitleMC:"Remaillage surfacique (manifold tris)",remeshRemeshMC:"Remaillage",remeshSmoothingMC:"Lisser topologie"},deutsch:{backgroundTitle:"Hintergrund",backgroundReset:"Zurcksetzen",backgroundImport:"Importieren (jpg, png...)",backgroundFill:"Fllen",cameraTitle:"Kamera",cameraReset:"Ansicht",cameraCenter:"Reset (space)",cameraFront:"Front (F)",cameraLeft:"Links (L)",cameraTop:"Oben (T)",cameraMode:"Modus",cameraOrbit:"Orbit (Drehscheibe)",cameraSpherical:"Sphrisch (Rollkugel)",cameraPlane:"Ebene (Rollkugel)",cameraProjection:"Projektion",cameraPerspective:"Perspektivisch",cameraOrthographic:"Orthographisch",cameraFov:"Sichtfeld (fov)",cameraPivot:"Pivot auswhlen",fileTitle:"Datei (import/export)",fileImportTitle:"Importieren",fileAdd:"Hinzufgen (obj, sgl, ply, stl)",fileAutoMatrix:"Skalieren und zentrieren",fileVertexSRGB:"Vertexfarbe sRGB",fileExportSceneTitle:"Exportieren",fileExportAll:"Alles Exportieren",fileExportSGL:"Speichern .sgl (SculptGL)",fileExportOBJ:"Speichern .obj",fileExportPLY:"Speichern .ply",fileExportSTL:"Speichern .stl",fileExportTextureTitle:"Texturen exportieren",fileExportTextureSize:"Gre",fileExportColor:"Farben speichern",fileExportRoughness:"Rauheit speichern",fileExportMetalness:"Metallisches speichern",sceneTitle:"Szene",sceneReset:"Szene lschen",sceneResetConfirm:"Besttige das Lschen der aktuellen Szene",sceneAddSphere:"Kugel hinzufgen",sceneAddCube:"Wrfel hinzufgen",sceneAddPlane:"Ebene hinzufgen",sceneAddCylinder:"Zylinder hinzufgen",sceneAddTorus:"Torus hinzufgen",sceneSelection:"Auswahl",sceneMerge:"Auswahl zusammenfhren",sceneDuplicate:"Auswahl kopieren",sceneDelete:"Auswahl lschen",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Mehrfachauflsung",multiresSubdivide:"Aufteilen",multiresReverse:"Umkehren",multiresResolution:"Auflsung",multiresNoLower:"Es gibt keine kleinere Auflsung.",multiresNoHigher:"Es gibt keine hhere Auflsung.",multiresDelHigher:"Hhere lschen",multiresDelLower:"Niedrigere lschen",multiresSelectLowest:"Whlen Sie vor dem Umkehren die kleinste Auflsung aus.",multiresSelectHighest:"Whlen Sie vor dem Umkehren die hchste Auflsung aus.",multiresWarnBigMesh:function(e){return"Die nchste Unterteilungsebene wird "+e+' Flchen erreichen\nWenn Sie wissen, was Sie tun, dann klicken Sie nocheinmal auf "umkehren".'},multiresNotReversible:"Es ist leider nicht mglich dieses Netz umzukehren.\nDas Netz ist kein Produkt einer (loop/catmull) Unterteilungsflche auf eines mannigfaltigen Netzes",remeshTitle:"Voxel remeshing (Vierecke)",remeshRemesh:"Remesh",remeshResolution:"Auflsung",remeshBlock:"Block",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Dynamische Topologie",dynamicActivated:"Aktiviert (ohne Vierecke)",dynamicSubdivision:"Aufteilung",dynamicDecimation:"Dezimierung",dynamicLinear:"Lineare Aufteilung",sculptTitle:"Modellieren & Bemalen",sculptBrush:"Pinsel",sculptInflate:"Aufblasen",sculptTwist:"Verdrehen",sculptSmooth:"Gltten (-Shift)",sculptFlatten:"Ebnen",sculptPinch:"Kneifen",sculptCrease:"Falten",sculptDrag:"Ziehen",sculptPaint:"Malen",sculptMasking:"Maskieren (-Strg)",sculptMove:"Bewegen",sculptLocalScale:"Lokales Skalieren",sculptTransform:"Transformieren (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Koordinatenraum",sculptGlobal:"Global",sculptLocal:"Lokal",sculptLocalTransform:"Gieren/Nicken/Rollen",sculptYaw:"Gieren",sculptPitch:"Nicken",sculptRoll:"Rollen",sculptCommon:"Allgemein",sculptTool:"Werkzeuge",sculptSymmetry:"Symmetrie",sculptContinuous:"Kontinuierlich",sculptRadius:"Radius (-X)",sculptIntensity:"Intensitt (-C)",sculptHardness:"Hrte",sculptCulling:"Dnne Oberflche (nur vorderer vertex)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Verriegelungsposition",sculptAlphaTex:"Textur",sculptImportAlpha:"Alpha tex importieren(jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rauheit",sculptMetallic:"Metallisches",sculptClay:"Lehm",sculptAccumulate:"Akkumulieren (Kein Limit pro Anschlag)",sculptColorGlobal:"Global",sculptPickColor:"Material / Farb Auswahl (-S)",sculptTangentialSmoothing:"Tangentiale Glttung",sculptTopologicalCheck:"Topologischer Check",sculptMoveAlongNormal:"Normal weiterlaufen (N or -Alt)",sculptMaskingClear:"Lschen (-Ctrl + Drag)",sculptMaskingInvert:"Invertieren (-Ctrl + Click)",sculptMaskingBlur:"Verwischen",sculptMaskingSharpen:"Schrfen",sculptPBRTitle:"PBR Materialen",sculptPaintAll:"Alles Anmalen",sculptExtractTitle:"Extrahieren",sculptExtractThickness:"Dicke",sculptExtractAction:"Extrahieren !",stateTitle:"Verlauf",stateUndo:"Rckgngig",stateRedo:"Wiederholen",stateMaxStack:"Max. Schritte",pressureTitle:"Tablet Druck",pressureRadius:"Druckradius",pressureIntensity:"Druckintensitt",renderingTitle:"Rendering",renderingGrid:"Gitter anzeigen",renderingSymmetryLine:"Spiegellinie anzeigen",renderingMatcap:"Matcap",renderingCurvature:"Krmmung",renderingPBR:"PBR",renderingTransparency:"Transparenz",renderingNormal:"Normale Shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importieren (jpg, png...)",renderingImportMatcap:"Importieren (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flaches Schattieren",renderingWireframe:"Drahtgitter (W)",renderingExposure:"Belichtung",renderingEnvironment:"Umgebung",renderingIsolate:"Isoliert/Zeige (I)",renderingFilmic:"Filmische Tonzuordnung",contour:"Kontur",contourShow:"Kontur anzeigen",contourColor:"Farbe",darkenUnselected:"Nicht markiertes abdunkeln",resolution:"Auflsung",matcapPearl:"Perle",matcapClay:"Ton",matcapSkin:"Haut",matcapGreen:"Grn",matcapWhite:"Wei",sketchfabTitle:"Hier gehts zu Sketchfab !",sketchfabUpload:"Hochladen",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"ber & Hilfe (Englisch)",alphaNone:"None",alphaSquare:"Wrfel",alphaSkin:"Haut",remeshTitleMC:"Voxel remeshing (mannigfaltige Dreiecke)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Topologie entspannen"},italiano:{backgroundTitle:"Sfondo",backgroundReset:"Resetta",backgroundImport:"Importa (jpg, png...)",backgroundFill:"Riempi",cameraTitle:"Camera",cameraReset:"Vista",cameraCenter:"Resetta (bar)",cameraFront:"Fronte (F)",cameraLeft:"Sinistra (L)",cameraTop:"Sopra (T)",cameraMode:"Modalit",cameraOrbit:"Orbita (Ruota intorno)",cameraSpherical:"Sferica (Trackball)",cameraPlane:"Planare (Trackball)",cameraProjection:"Proiezione",cameraPerspective:"Prospettiva",cameraOrthographic:"Ortografica",cameraFov:"Fov",cameraPivot:"Seleziona pivot",fileTitle:"Files (importa/esporta)",fileImportTitle:"Importa",fileAdd:"Aggiungi (obj, sgl, ply, stl)",fileAutoMatrix:"Scala e centra",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Esporta Scena",fileExportAll:"Exporta tutto",fileExportSGL:"Salva .sgl (SculptGL)",fileExportOBJ:"Salva .obj",fileExportPLY:"Salva .ply",fileExportSTL:"Salva .stl",fileExportTextureTitle:"Esporta textures",fileExportTextureSize:"Dimensione",fileExportColor:"Salva diffuse",fileExportRoughness:"Salva roughness",fileExportMetalness:"Salva metalness",sceneTitle:"Scena",sceneReset:"Pulisci scena",sceneResetConfirm:"Conferma pulitura scena",sceneAddSphere:"Aggiungi sfera",sceneAddCube:"Aggiungi cubo",sceneAddPlane:"Aggiungi piano",sceneAddCylinder:"Aggiungi cilindro",sceneAddTorus:"Aggiungi toroide",sceneSelection:"Selezione",sceneMerge:"Unisci selezione",sceneDuplicate:"Copia selezione",sceneDelete:"Elimina selezione",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologia",multiresTitle:"Multirisoluzione",multiresSubdivide:"Suddivisione",multiresReverse:"Invertire",multiresResolution:"Risoluzione",multiresNoLower:"Non esiste un livello di risoluzione inferiore.",multiresNoHigher:"Non esiste un livello di risoluzione pi alto.",multiresDelHigher:"Elimina superiore",multiresDelLower:"Elimina inferiore",multiresSelectLowest:"Selezionare la risoluzione pi bassa prima di invertire.",multiresSelectHighest:"Seleziona la risoluzione pi alta prima di suddividere.",multiresWarnBigMesh:function(e){return"Il livello di suddivisione successivo raggiunger "+e+' facce.\nSe sai cosa stai facendo, clicca di nuovo su "Suddividi".'},multiresNotReversible:"Spiacenti, non  possibile invertire questa mesh.\nLa mesh non  un prodotto di una superficie di suddivisione (loop-catmull) su una mesh collettore.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Risolutione",remeshBlock:"Blocca",retopoQuadTitle:"Quad retopology (experimental)",retopoQuadAction:"Retopo quads",retopoQuadResolution:"Resolution",retopoQuadRelax:"Relax iterations",retopoQuadIntensity:"Relax intensity",retopoQuadTangent:"Tangent relax",dynamicTitle:"Topologia Dinamica",dynamicActivated:"Attivata (no quads)",dynamicSubdivision:"Suddivisione",dynamicDecimation:"Decimazione",dynamicLinear:"Suddivisione Lineare",sculptTitle:"Scalpisci & Dipingi",sculptBrush:"Spazzola",sculptInflate:"Gonfia",sculptTwist:"Torci",sculptSmooth:"Ammorbidisci (-Shift)",sculptFlatten:"Appiattisci",sculptPinch:"Pizzica",sculptCrease:"Piega",sculptDrag:"Trascina",sculptPaint:"Dipingi",sculptMasking:"Maschera (-Ctrl)",sculptMove:"Muovi",sculptLocalScale:"Scala Locale",sculptTransform:"Trasformazioni (E)",modelingTitle:"Modeling",modelingMode:"Modeling mode",modelingSidebarTitle:"Modeling",modelingSelectionTitle:"Selection",modelingSelectVertex:"Vertex select",modelingSelectEdge:"Edge select",modelingSelectFace:"Face select",modelingSelectionAction:"Selection action",modelingActionReplace:"Replace",modelingActionAdd:"Add",modelingActionRemove:"Remove",modelingToolsTitle:"Modeling tools",modelingExtrude:"Extrude",modelingDelete:"Delete",modelingFill:"Fill",modelingBridge:"Bridge",modelingKnife:"Knife",modelingLoopCut:"Loop cut",modelingNotImplemented:"This modeling tool is not implemented yet.",sculptRotomoldTitle:"Rotomolding",sculptRotomoldEnable:"Enable rotomolding",sculptRotomoldSpeed:"Rotation speed (deg/s)",sculptRotomoldAxis:"Rotation axis",sculptRotomoldAxisX:"X",sculptRotomoldAxisY:"Y",sculptRotomoldAxisZ:"Z",sculptRotomoldPivot:"Rotation pivot",sculptRotomoldPivotMesh:"Mesh center",sculptRotomoldPivotWorld:"World origin",sculptGizmoTransform:"Gizmo",sculptCoordSpace:"Spazio coordinate",sculptGlobal:"Globale",sculptLocal:"Locale",sculptLocalTransform:"Imbardata/Beccheggio/Rollio",sculptYaw:"Imbardata",sculptPitch:"Beccheggio",sculptRoll:"Rollio",sculptCommon:"Comune",sculptTool:"Strumento",sculptSymmetry:"Simmetria",sculptContinuous:"Continua",sculptRadius:"Raggio (-X)",sculptIntensity:"Intensit (-C)",sculptHardness:"Durezza",sculptCulling:"Superficie sottile (solo vertici frontali)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Blocca posizione",sculptAlphaTex:"Texture",sculptImportAlpha:"Importa alpha tex (jpg, png...)",sculptNegative:"Negativo (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosit",sculptMetallic:"Metallico",sculptClay:"Clay",sculptAccumulate:"Accumulazione (no limit per stroke)",sculptColorGlobal:"Globale",sculptPickColor:"Materiale / Color picker (-S)",sculptTangentialSmoothing:"Solo Relax",sculptTopologicalCheck:"Controllo Topologia",sculptMoveAlongNormal:"Muovi lungo la normale (N o -Alt)",sculptMaskingClear:"Pulisci (-Ctrl + Drag)",sculptMaskingInvert:"Inverti (-Ctrl + Click)",sculptMaskingBlur:"Sfoca",sculptMaskingSharpen:"Nitidezza",sculptPBRTitle:"Materiali PBR",sculptPaintAll:"Dipingi tutto",sculptExtractTitle:"Estrazione",sculptExtractThickness:"Assottigliamento",sculptExtractAction:"Estrai !",stateTitle:"Story",stateUndo:"Indietro",stateRedo:"Avanti",stateMaxStack:"Pila massima",pressureTitle:"Pressione tavoletta",pressureRadius:"Raggio pressione",pressureIntensity:"Intensit pressione",renderingTitle:"Rendering",renderingGrid:"Vedi Griglia",renderingSymmetryLine:"Vedi linea di specchiatura",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Trasparenza",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materiale",renderingImportUV:"Importa (jpg, png...)",renderingImportMatcap:"Importa (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Shading piatto",renderingWireframe:"Wireframe (W)",renderingExposure:"Esposizione",renderingEnvironment:"Ambiente",renderingIsolate:"Isola/Vedi (I)",renderingFilmic:"Coloritura tipo Film",contour:"Contorno",contourShow:"Vedi contorno",contourColor:"Colore",darkenUnselected:"Scurisci i non selezionati",resolution:"Risolutione",matcapPearl:"Perla",matcapClay:"Argilla",matcapSkin:"Pelle",matcapGreen:"Verde",matcapWhite:"Bianco",sketchfabTitle:"Vai su Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Inserisci la tua chiave API di sketchfab.\nPuoi anche lasciare "guest" per caricare in modo anonimo.\n(verr visualizzata una nuova finestra al termine del caricamento e dell\'elaborazione)',sketchfabUploadError:function(e){return"Sketchfab errore upload :\n"+e},sketchfabUploadSuccess:"Caricato con successo !\nEcco il tuo link :",sketchfabAbort:"Annulla l'ultimo caricamento?",sketchfabUploadProcessing:"Processing...\nIl tuo modello sar disponibile su :",about:"Informazioni & Aiuto",alphaNone:"Nessuno",alphaSquare:"Quadrata",alphaSkin:"Pelle",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"}},n.select="english";var a=window.navigator.language||window.navigator.userLanguage;switch(a&&(a=a.substr(0,2)),"ja"===a?n.select="":"zh"===a?n.select="":"ko"===a?n.select="":"tr"===a?n.select="turkish":"sv"===a?n.select="svenska":"fr"===a?n.select="franais":"de"===a&&(n.select="deutsch"),(0,r.A)().language){case"english":n.select="english";break;case"chinese":n.select="";break;case"korean":n.select="";break;case"japanese":n.select="";break;case"russian":n.select="";break;case"turkish":n.select="turkish";break;case"swedish":n.select="svenska";break;case"french":n.select="franais";break;case"german":n.select="deutsch";break;case"italian":n.select="italiano"}const s=n},968(e,t,i){"use strict";i.d(t,{p8:()=>r,tb:()=>n});var r=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>oo}),__webpack_require__(61);var e=__webpack_require__(322),t=__webpack_require__(13),i=__webpack_require__(142),r=__webpack_require__(406),n=__webpack_require__(445),a=__webpack_require__(827),s=__webpack_require__(263),o=__webpack_require__(968);function l(){var e=new o.tb(9);return o.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function c(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function h(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],_=t[12],f=t[13],g=t[14],m=t[15],v=i*o-r*s,y=i*l-n*s,b=i*u-a*s,A=r*l-n*o,T=r*u-a*o,M=n*u-a*l,S=c*f-h*_,E=c*g-d*_,R=c*m-p*_,k=h*g-d*f,x=h*m-p*f,w=d*m-p*g,C=v*w-y*x+b*k+A*R-T*E+M*S;return C?(C=1/C,e[0]=(o*w-l*x+u*k)*C,e[1]=(l*R-s*w-u*E)*C,e[2]=(s*x-o*R+u*S)*C,e[3]=(n*x-r*w-a*k)*C,e[4]=(i*w-n*R+a*E)*C,e[5]=(r*R-i*x-a*S)*C,e[6]=(f*M-g*T+m*A)*C,e[7]=(g*b-_*M-m*y)*C,e[8]=(_*T-f*b+m*v)*C,e):null}function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const p=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._buffer=t.createBuffer(),this._type=i,this._hint=r,this._size=0}var t,i;return t=e,(i=[{key:"bind",value:function(){this._buffer||(this._buffer=this._gl.createBuffer()),this._gl.bindBuffer(this._type,this._buffer)}},{key:"release",value:function(){this._gl.deleteBuffer(this._buffer),this._buffer=null,this._size=0}},{key:"update",value:function(e,t){this.bind(),void 0!==t&&t!==e.length&&(e=e.subarray(0,t)),e.length>this._size?(this._gl.bufferData(this._type,e,this._hint),this._size=e.length):this._gl.bufferSubData(this._type,0,e)}}])&&d(t.prototype,i),e}();function _(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const f=function(){function e(t,i,r,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._location=t.getAttribLocation(i,r),this._size=n,this._type=a}var t,i;return t=e,(i=[{key:"unbind",value:function(){this._gl.disableVertexAttribArray(this._location)}},{key:"bindToBuffer",value:function(e){var t=this._gl;e.bind(),t.enableVertexAttribArray(this._location),t.vertexAttribPointer(this._location,this._size,this._type,!1,0,0)}}])&&_(t.prototype,i),e}(),g="// reference\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n#define RANGE 5.0\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col) {\n    vec4 rgbm;\n    vec3 color = col / RANGE;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col) {\n  return RANGE * col.rgb * col.a;\n}\n";var m={vertexName:"VertexName",fragmentName:"FragmentName",activeAttributes:{vertex:!0,normal:!0,material:!0,color:!0}};m.showSymmetryLine=(0,s.A)().mirrorline,m.darkenUnselected=(0,s.A)().darkenunselected,m.uniformNames={},m.uniformNames.commonUniforms=["uMV","uMVP","uN","uEM","uEN","uFlat","uPlaneO","uPlaneN","uSym","uCurvature","uAlpha","uFov","uDarken"],m.strings={},m.strings.colorSpaceGLSL=g,m.strings.vertUniforms=["uniform mat4 uMV;","uniform mat4 uMVP;","uniform mat3 uN;","uniform mat4 uEM;","uniform mat3 uEN;","uniform float uAlpha;"].join("\n"),m.strings.fragColorUniforms=["uniform vec3 uPlaneN;","uniform vec3 uPlaneO;","uniform int uSym;","uniform int uDarken;","uniform float uCurvature;","uniform float uFov;","varying float vMasking;","uniform int uFlat;"].join("\n"),m.strings.fragColorFunction=["// http://madebyevan.com/shaders/curvature/\n#extension GL_OES_standard_derivatives : enable\nvec3 computeCurvature( const in vec3 vertex, const in vec3 normal, const in vec3 color, const in float str, const in float fov) {\n  if(str < 1e-3)\n    return color;\n#ifndef GL_OES_standard_derivatives\n    return color * pow(length(normal), str * 100.0);\n#else\n  vec3 n = normalize(normal);\n  // Compute curvature\n  vec3 dx = dFdx(n);\n  vec3 dy = dFdy(n);\n  vec3 xneg = n - dx;\n  vec3 xpos = n + dx;\n  vec3 yneg = n - dy;\n  vec3 ypos = n + dy;\n  // fov < 0.0 means ortho\n  float depth = fov > 0.0 ? length(vertex) * fov : -fov;\n  float cur = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str * 80.0 / depth;\n  return mix(mix(color, color * 0.3, clamp(-cur * 15.0, 0.0, 1.0)), color * 2.0, clamp(cur * 25.0, 0.0, 1.0));\n#endif\n}\n",g,"#extension GL_OES_standard_derivatives : enable","vec3 getNormal() {","  #ifndef GL_OES_standard_derivatives","    return normalize(gl_FrontFacing ? vNormal : -vNormal);","  #else","    return uFlat == 0 ? normalize(gl_FrontFacing ? vNormal : -vNormal) : -normalize(cross(dFdy(vVertex), dFdx(vVertex)));","  #endif","}","vec4 encodeFragColor(const in vec3 frag, const in float alpha) {","  vec3 col = computeCurvature(vVertex, vNormal, frag, uCurvature, uFov);","  if(uDarken == 1) col *= 0.3;","  col *= (0.3 + 0.7 * vMasking);","  if(uSym == 1 && abs(dot(uPlaneN, vVertex - uPlaneO)) < 0.15)","      col = min(col * 1.5, 1.0);","  return alpha != 1.0 ? vec4(col * alpha, alpha) : encodeRGBM(col);","}"].join("\n");var v,y=function(e){var t="",i=e.match(/^\s*(#extension).*/gm);if(i)for(var r={},n=0,a=i.length;n<a;++n){var s=i[n].substr(i[n].indexOf("#extension"));e=e.replace(i[n],""),r[s]||(r[s]=!0,t+=s+"\n")}var o="";-1===e.indexOf("#version")&&(o+="#version 100\n");var l="";return/precision\s+(high|low|medium)p\s+float/.test(e)||(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n"),o+t+l+e};m.getOrCreate=function(e){if(this.program)return this;var t="\n#define SHADER_NAME "+this.vertexName+"\n",i="\n#define SHADER_NAME "+this.fragmentName+"\n",r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,y(this.vertex+t)),e.compileShader(r);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,y(this.fragment+i)),e.compileShader(n);var a=this.program=e.createProgram();e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var s=e.getShaderInfoLog(r),o=e.getShaderInfoLog(n),l=e.getProgramInfoLog(a);return s&&console.warn(this.vertexName+" (vertex)\n"+s),o&&console.warn(this.fragmentName+" (fragment)\n"+o),l&&console.warn(this.fragmentName+" (program)\n"+l),this.initAttributes(e),this.initUniforms(e),this},m.initUniforms=function(e){for(var t=this.program,i=this.uniformNames,r=this.uniforms,n=0,a=i.length;n<a;++n){var s=i[n];r[s]=e.getUniformLocation(t,s)}},m.updateUniforms=(v=[0,0,0],function(t,i){var r=t.getGL(),n=m.darkenUnselected&&i.getIndexSelectMesh(t)<0,a=m.showSymmetryLine&&t.getID()===i.getMesh().getID()&&i.getSculptManager().getSymmetry(),s=this.uniforms;r.uniformMatrix4fv(s.uEM,!1,t.getEditMatrix()),r.uniformMatrix3fv(s.uEN,!1,t.getEN()),r.uniformMatrix4fv(s.uMV,!1,t.getMV()),r.uniformMatrix4fv(s.uMVP,!1,t.getMVP()),r.uniformMatrix3fv(s.uN,!1,t.getN()),r.uniform1i(s.uDarken,n?1:0),r.uniform1i(s.uFlat,t.getFlatShading()),r.uniform3fv(s.uPlaneO,e.Z0(v,t.getSymmetryOrigin(),t.getMV())),r.uniform3fv(s.uPlaneN,e.S8(v,e.ei(v,t.getSymmetryNormal(),t.getN()))),r.uniform1i(s.uSym,a?1:0),r.uniform1f(s.uAlpha,t.getOpacity()),r.uniform1f(s.uCurvature,t.getCurvature());var o=i.getCamera();r.uniform1f(s.uFov,o.isOrthographic()?25*-Math.abs(o._trans[2]):o.getFov())}),m.draw=function(e,t){e.getGL().useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e,t),this.drawBuffer(e)},m.drawBuffer=function(e){var t=e.getGL();e.isUsingDrawArrays()?t.drawArrays(e.getMode(),0,e.getCount()):(e.getIndexBuffer().bind(),t.drawElements(e.getMode(),e.getCount(),t.UNSIGNED_INT,0)),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.unbindAttributes()},m.setTextureParameters=function(e,t){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),n.A.isPowerOfTwo(t.width)&&n.A.isPowerOfTwo(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))},m.onLoadTexture0=function(e,t,i){this.texture0=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),m.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),i&&i.render()},m.getDummyTexture=function(e){return this._dummyTex||(this._dummyTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._dummyTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.bindTexture(e.TEXTURE_2D,null)),this._dummyTex},m.getOrCreateTexture0=function(e,t,i){if(void 0!==this.texture0)return this.texture0;this.texture0=null;var r=new Image;return r.src=t,r.onload=this.onLoadTexture0.bind(this,e,r,i),!1},m.initAttributes=function(e){var t=this.program,i=this.attributes;i.aVertex=new f(e,t,"aVertex",3,e.FLOAT),i.aNormal=new f(e,t,"aNormal",3,e.FLOAT),i.aColor=new f(e,t,"aColor",3,e.FLOAT),i.aMaterial=new f(e,t,"aMaterial",3,e.FLOAT)},m.bindAttributes=function(e){var t=this.attributes,i=this.activeAttributes;i.vertex&&t.aVertex.bindToBuffer(e.getVertexBuffer()),i.normal&&t.aNormal.bindToBuffer(e.getNormalBuffer()),i.color&&t.aColor.bindToBuffer(e.getColorBuffer()),i.material&&t.aMaterial.bindToBuffer(e.getMaterialBuffer())},m.unbindAttributes=function(){var e=this.attributes,t=this.activeAttributes;t.vertex&&e.aVertex.unbind(),t.normal&&e.aNormal.unbind(),t.color&&e.aColor.unbind(),t.material&&e.aMaterial.unbind()},m.getCopy=function(){for(var e=Object.keys(m),t={},i=0,r=e.length;i<r;++i)t[e[i]]=this[e[i]];return t.program=null,t};const b=m,A="#define PI 3.1415926535897932384626433832795\n#define PI_2 (2.0 * 3.1415926535897932384626433832795)\n#define INV_PI 1.0 / PI\n#define INV_LOG2 1.4426950408889634073599246810019\n\nuniform sampler2D uTexture0;\nuniform float uExposure;\nuniform mat3 uIblTransform;\nuniform vec3 uSPH[9];\n\nuniform vec2 uEnvSize;\n#define LIMIT_LOD 5.0\n\n// https://mynameismjp.wordpress.com/2008/12/12/logluv-encoding-for-hdr/\nconst mat3 LUVInverse = mat3(6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720,\n                             0.3007, -1.088, 5.6268);\nvec3 decodeLUV(const in vec4 logLuv) {\n  float Le = logLuv.z * 255.0 + logLuv.w;\n  vec3 xp;\n  xp.y = exp2((Le - 127.0) / 2.0);\n  xp.z = xp.y / logLuv.y;\n  xp.x = logLuv.x * xp.z;\n  return max(LUVInverse * xp, 0.0);\n}\n\nvec2 toUVMipmap(const in float lod, const in vec2 uv) {\n  float widthForLevel = uEnvSize.x / exp2(lod);\n  vec2 uvSpaceLocal = vec2(1.0) + uv * (widthForLevel - 2.0);\n  uvSpaceLocal.y += uEnvSize.y - widthForLevel * 2.0;\n  return uvSpaceLocal / uEnvSize;\n}\n\nvec2 directionToUV(const in vec3 dir) {\n  vec3 signOct = sign(dir);\n  vec3 uvOct = dir / dot(dir, signOct);\n  if (uvOct.z < 0.0) {\n    uvOct.xy = signOct.xy * (1.0 - abs(uvOct)).yx;\n  }\n  return uvOct.xy * 0.5 + 0.5;\n}\n\nvec3 texturePanoramaLod(const in vec3 direction, const in float rLinear) {\n  float lod = rLinear * (LIMIT_LOD - 1.0);\n  vec2 uvBase = directionToUV(direction);\n  return decodeLUV(mix(texture2D(uTexture0, toUVMipmap(floor(lod), uvBase)),\n                       texture2D(uTexture0, toUVMipmap(ceil(lod), uvBase)),\n                       fract(lod)));\n}\n\nvec3 integrateBRDFApprox(const in vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\n  vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\n  return specular * AB.x + AB.y;\n}\n\nvec3 getSpecularDominantDir(const in vec3 N, const in vec3 R,\n                            const in float realRoughness) {\n  float smoothness = 1.0 - realRoughness;\n  return mix(N, R, smoothness * (sqrt(smoothness) + realRoughness));\n}\n\nvec3 approximateSpecularIBL(const in vec3 specularColor, float rLinear,\n                            const in vec3 N, const in vec3 V) {\n  float NoV = clamp(dot(N, V), 0.0, 1.0);\n  vec3 R = normalize((2.0 * NoV) * N - V);\n  R = getSpecularDominantDir(N, R, rLinear);\n  vec3 prefilteredColor = texturePanoramaLod(uIblTransform * R, rLinear);\n  return prefilteredColor * integrateBRDFApprox(specularColor, rLinear, NoV);\n}\n\n// expect shCoefs uniform\n// https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\nvec3 sphericalHarmonics(const in vec3 N) {\n  float x = N.x;\n  float y = N.y;\n  float z = -N.z;\n  vec3 result = uSPH[0] + uSPH[1] * y + uSPH[2] * z + uSPH[3] * x +\n                uSPH[4] * y * x + uSPH[5] * y * z +\n                uSPH[6] * (3.0 * z * z - 1.0) + uSPH[7] * (z * x) +\n                uSPH[8] * (x * x - y * y);\n  return max(result, vec3(0.0));\n}\n\nvec3 computeIBL_UE4(const in vec3 N, const in vec3 V, const in vec3 albedo,\n                    const in float roughness, const in vec3 specular) {\n  vec3 color = albedo * sphericalHarmonics(uIblTransform * N);\n  color += approximateSpecularIBL(specular, roughness, N, V);\n  return color;\n}\n";var T=b.getCopy();T.vertexName=T.fragmentName="ShadingPBR",T.textures={};var M="resources/environments/";T.environments=[{path:M+"mpumalanga_veld_1k.png",sph:[.136819,.174125,.253762,.027778,.056838,.131221,.074356,.086793,.099181,-.07904,-.091269,-.102346,-.02755,-.0323,-.039217,.031822,.034773,.039945,.017235,.021044,.026136,-.106608,-.11864,-.132761,.041,.049794,.061183],exposure:2.5,name:"Mpumalanga veld"},{path:M+"venetian_crossroads_1k.png",sph:[.200626,.198426,.209579,.090452,.127807,.18839,.093188,.103245,.106131,.033349,.054751,.067044,.07435,.08167,.079716,.063127,.08594,.10171,.007751,.00571,-791e-6,.104134,.103979,.094236,-.022747,-.028166,-.037714],exposure:2.5,name:"Venetian crossroads"},{path:M+"studio_small_01_1k.png",sph:[.534107,.589985,.617478,.119999,.13048,.128019,.089872,.088707,.088017,.099999,.151282,.138458,.005015,.035588,.027592,.114999,.116739,.120579,-.057997,-.069532,-.070401,.385123,.411714,.454725,.303242,.333004,.35027],exposure:.5,name:"Studio small 01"},{path:M+"moonless_golf_1k.png",sph:[.137579,.112906,.09347,.070711,.066043,.065337,-.029564,-.02072,-.007737,-.037254,-.03327,-.028294,-.023847,-.021208,-.018767,-.007873,-.002587,.003955,.009241,.007711,.006063,.017917,.011733,.007669,.036859,.026285,.01474],exposure:1,name:"Moonless golf"},{path:M+"winter_river_1k.png",sph:[.560145,.554695,.513523,-.213105,-.15519,-.063568,.135182,.114211,.069349,.172852,.15182,.105477,.065753,.06405,.052622,.096352,.086557,.063826,.02183,.01656,.008804,.186193,.16372,.119627,.025363,.022278,.014461],exposure:.5,name:"Winter river"}];var S=(0,s.A)();T.idEnv=Math.min(S.environment,T.environments.length-1),T.exposure=void 0===S.exposure?T.environments[T.idEnv].exposure:Math.min(S.exposure,5),T.uniforms={},T.attributes={},T.uniformNames=["uIblTransform","uTexture0","uAlbedo","uRoughness","uMetallic","uExposure","uSPH","uEnvSize"],Array.prototype.push.apply(T.uniformNames,b.uniformNames.commonUniforms),T.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",b.strings.vertUniforms,"uniform float uRoughness;","uniform float uMetallic;","uniform vec3 uAlbedo;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","varying float vMasking;","void main() {","  vAlbedo = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vRoughness = uRoughness >= 0.0 ? uRoughness : aMaterial.x;","  vMetallic = uMetallic >= 0.0 ? uMetallic : aMaterial.y;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),T.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","uniform float uAlpha;",b.strings.fragColorUniforms,b.strings.fragColorFunction,A,"","void main(void) {","  vec3 normal = getNormal();","  float roughness = max( 0.0001, vRoughness );","  vec3 linColor = sRGBToLinear(vAlbedo);","  vec3 albedo = linColor * (1.0 - vMetallic);","  vec3 specular = mix( vec3(0.04), linColor, vMetallic);","","  vec3 color = uExposure * computeIBL_UE4( normal, -normalize(vVertex), albedo, roughness, specular );","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),T.onLoadEnvironment=function(e,t,i,r){if(!e.status||200===e.status||e.response&&e.response.byteLength){var n=e.width||Math.sqrt(e.response.byteLength/8),a=2*n;r.size=[n,a],r.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,r.texture),e.response?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,a,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e.response)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),i&&i.render()}},T.getOrCreateEnvironment=function(e,t,i){if(void 0!==i.texture)return i.texture;if(i.texture=null,i.path.endsWith("png")){var r=new Image;return r.src=i.path,r.onload=T.onLoadEnvironment.bind(this,r,e,t,i),null}var n=new XMLHttpRequest;return n.open("GET",i.path,!0),n.responseType="arraybuffer",n.onload=T.onLoadEnvironment.bind(this,n,e,t,i),n.send(null),null};var E=l();T.updateUniforms=function(e,t){var i=e.getGL(),r=this.uniforms;u(E,t.getCamera().getView()),i.uniformMatrix3fv(r.uIblTransform,!1,c(E,E)),i.uniform3fv(r.uAlbedo,e.getAlbedo()),i.uniform1f(r.uRoughness,e.getRoughness()),i.uniform1f(r.uMetallic,e.getMetallic()),i.uniform1f(r.uExposure,T.exposure);var n=T.environments[T.idEnv];i.uniform3fv(r.uSPH,n.sph),n.size&&i.uniform2fv(r.uEnvSize,n.size),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,T.getOrCreateEnvironment(i,t,n)||this.getDummyTexture(i)),i.uniform1i(r.uTexture0,0),b.updateUniforms.call(this,e,t)};const R=T;var k=__webpack_require__(865),x=b.getCopy();x.vertexName=x.fragmentName="Matcap",x.textures={},x.createTexture=function(e,t,i){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),x.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),x.textures[i]=r};var w="resources/matcaps/";x.matcaps=[{path:w+"matcapFV.jpg",name:"matcap FV"},{path:w+"redClay.jpg",name:"Red clay"},{path:w+"skinHazardousarts.jpg",name:"Skin hazardousarts"},{path:w+"skinHazardousarts2.jpg",name:"Skin Hazardousarts2"},{path:w+"pearl.jpg",name:(0,k.A)("matcapPearl")},{path:w+"clay.jpg",name:(0,k.A)("matcapClay")},{path:w+"skin.jpg",name:(0,k.A)("matcapSkin")},{path:w+"green.jpg",name:(0,k.A)("matcapGreen")},{path:w+"white.jpg",name:(0,k.A)("matcapWhite")}],x.uniforms={},x.attributes={},x.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(x.uniformNames,b.uniformNames.commonUniforms),x.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",b.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying float vMasking;","varying vec3 vVertexPres;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  vVertexPres = vVertex / max(1.0, abs(uMV[3][2]));","  gl_Position = uMVP * vertex4;","}"].join("\n"),x.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vVertexPres;","varying vec3 vNormal;","varying vec3 vColor;","uniform float uAlpha;",b.strings.fragColorUniforms,b.strings.fragColorFunction,"void main() {","  vec3 normal = getNormal();","  vec3 nm_z = normalize(vVertexPres);","  vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);","  vec3 nm_y = cross(nm_x, nm_z);","  vec2 texCoord = 0.5 + 0.5 * vec2(dot(normal, nm_x), dot(normal, nm_y));","  vec3 color = sRGBToLinear(texture2D(uTexture0, texCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),x.updateUniforms=function(e,t){var i=e.getGL(),r=this.uniforms;i.activeTexture(i.TEXTURE0),e.setTexture0(x.textures[e.getMatcap()]),i.bindTexture(i.TEXTURE_2D,e.getTexture0()||this.getDummyTexture(i)),i.uniform1i(r.uTexture0,0),i.uniform3fv(r.uAlbedo,e.getAlbedo()),b.updateUniforms.call(this,e,t)};const C=x;var P=b.getCopy();P.vertexName=P.fragmentName="ShowNormal",P.uniforms={},P.attributes={},P.activeAttributes={vertex:!0,normal:!0,material:!0},P.uniformNames=[],Array.prototype.push.apply(P.uniformNames,b.uniformNames.commonUniforms),P.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aMaterial;",b.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying float vMasking;","void main() {","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),P.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","uniform float uAlpha;",b.strings.fragColorUniforms,b.strings.fragColorFunction,"void main() {","  gl_FragColor = encodeFragColor(sRGBToLinear(getNormal() * 0.5 + 0.5), uAlpha);","}"].join("\n");const D=P;var I=b.getCopy();I.vertexName=I.fragmentName="ShowUV",I.texPath="resources/uv.png",I.uniforms={},I.attributes={},I.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(I.uniformNames,b.uniformNames.commonUniforms),I.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec2 aTexCoord;","attribute vec3 aMaterial;",b.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","varying float vMasking;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vTexCoord = aTexCoord;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),I.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","uniform float uAlpha;",b.strings.fragColorUniforms,b.strings.fragColorFunction,"void main() {","  vec3 color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),I.draw=b.draw,I.drawBuffer=b.drawBuffer,I.getOrCreate=b.getOrCreate,I.initUniforms=b.initUniforms,I.initAttributes=function(e){b.initAttributes.call(this,e),I.attributes.aTexCoord=new f(e,I.program,"aTexCoord",2,e.FLOAT)},I.bindAttributes=function(e){b.bindAttributes.call(this,e),I.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},I.updateUniforms=function(e,t){var i=e.getGL(),r=this.uniforms;i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.getOrCreateTexture0(i,I.texPath,t)||this.getDummyTexture(i)),i.uniform1i(r.uTexture0,0),i.uniform3fv(r.uAlbedo,e.getAlbedo()),b.updateUniforms.call(this,e,t)};const F=I;var L=b.getCopy();L.vertexName=L.fragmentName="Wireframe",L.uniforms={},L.attributes={},L.activeAttributes={vertex:!0,material:!0},L.uniformNames=["uMVP","uEM"],L.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;","uniform mat4 uMVP;","uniform mat4 uEM;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  vec4 pos = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","  pos[3] += 0.0001;","  gl_Position = pos;","}"].join("\n"),L.fragment=["void main() {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.4);","}"].join("\n"),L.getOrCreate=b.getOrCreate,L.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),e.getWireframeBuffer().bind(),t.drawElements(t.LINES,2*e.getRenderNbEdges(),t.UNSIGNED_INT,0)},L.updateUniforms=function(e){var t=e.getGL();t.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getMVP()),t.uniformMatrix4fv(this.uniforms.uEM,!1,e.getEditMatrix())};const O=L;var V=b.getCopy();V.vertexName=V.fragmentName="FlatColor",V.uniforms={},V.attributes={},V.activeAttributes={vertex:!0,material:!0},V.uniformNames=["uColor"],Array.prototype.push.apply(V.uniformNames,b.uniformNames.commonUniforms),V.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;",b.strings.vertUniforms,"varying vec3 vVertex;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  gl_Position = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","}"].join("\n"),V.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),V.updateUniforms=function(e,t){e.getGL().uniform3fv(this.uniforms.uColor,e.getFlatColor()),b.updateUniforms.call(this,e,t)};const N=V;var B=b.getCopy();B.vertexName=B.fragmentName="ShowSelection",B.uniforms={},B.attributes={},B.activeAttributes={vertex:!0},B.uniformNames=["uMVP","uColor"],B.vertex=["attribute vec3 aVertex;","uniform mat4 uMVP;","void main() {","  gl_Position = uMVP * vec4(aVertex, 1.0);","}"].join("\n"),B.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),B.draw=function(e,t,i){var r=e.getGL();r.useProgram(this.program),r.uniform3fv(this.uniforms.uColor,e.getColor()),t&&(r.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getCircleMVP()),B.attributes.aVertex.bindToBuffer(e.getCircleBuffer()),r.drawArrays(r.LINE_LOOP,0,e.getCircleBuffer()._size/3)),r.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotMVP()),B.attributes.aVertex.bindToBuffer(e.getDotBuffer()),r.drawArrays(r.TRIANGLE_FAN,0,e.getDotBuffer()._size/3),i&&(r.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotSymmetryMVP()),r.drawArrays(r.TRIANGLE_FAN,0,e.getDotBuffer()._size/3))};const U=B;var G=b.getCopy();G.vertexName=G.fragmentName="Background",G.uniforms={},G.attributes={},G.uniformNames=["uTexture0","uBackgroundType","uIblTransform","uSPH","uBlur","uEnvSize"],G.vertex=["attribute vec2 aVertex;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aTexCoord;","  gl_Position = vec4(aVertex, 1.0, 1.0);","}"].join("\n"),G.fragment=["varying vec2 vTexCoord;",b.strings.colorSpaceGLSL,A,"uniform int uBackgroundType;\nuniform float uBlur;\n\nvoid main() {\n  vec3 color;\n  if (uBackgroundType == 0) {\n    color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb);\n  } else {\n    vec3 dir = uIblTransform * vec3(vTexCoord.xy * 2.0 - 1.0, -1.0);\n    dir = normalize(dir);\n    if (uBackgroundType == 1) {\n      color = texturePanoramaLod(dir, uBlur * uBlur);\n    } else {\n      color = sphericalHarmonics(dir);\n    }\n  }\n  gl_FragColor = encodeRGBM(color);\n}\n"].join("\n"),G.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},G.initAttributes=function(e){var t=G.program,i=G.attributes;i.aVertex=new f(e,t,"aVertex",2,e.FLOAT),i.aTexCoord=new f(e,t,"aTexCoord",2,e.FLOAT)},G.bindAttributes=function(e){var t=G.attributes;t.aVertex.bindToBuffer(e.getVertexBuffer()),t.aTexCoord.bindToBuffer(e.getTexCoordBuffer())};var j=l();G.updateUniforms=function(e){var t,i=this.uniforms,r=e._main,n=R.environments[R.idEnv],a=e.getGL();a.uniform1i(i.uBackgroundType,e.getType()),t=0===e.getType()?e.getTexture():R.getOrCreateEnvironment(a,r,n)||e.getTexture(),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t),a.uniform1i(i.uTexture0,0),u(j,r.getCamera().getView()),a.uniformMatrix3fv(i.uIblTransform,!1,c(j,j)),a.uniform3fv(i.uSPH,n.sph),n.size&&a.uniform2fv(i.uEnvSize,n.size),a.uniform1f(i.uBlur,e.getBlur())};const W=G;var z=b.getCopy();z.vertexName=z.fragmentName="Merge",z.FILMIC=(0,s.A)().filmic,z.uniforms={},z.attributes={},z.uniformNames=["uTexture0","uTexture1","uFilmic"],z.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),z.fragment=["uniform sampler2D uTexture0;","uniform sampler2D uTexture1;","uniform int uFilmic;","varying vec2 vTexCoord;",b.strings.colorSpaceGLSL,"void main() {","  vec4 transparent = texture2D(uTexture1, vTexCoord);","  vec3 color = decodeRGBM(texture2D(uTexture0, vTexCoord))*(1.0-transparent.a) + transparent.rgb;","  if(uFilmic == 1){","    vec3 x = max(vec3(0.0), color - vec3(0.004));","    gl_FragColor = vec4((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06), 1.0);","  }else{","    gl_FragColor = vec4(linearTosRGB(color), 1.0);","  }","}"].join("\n"),z.draw=function(e,t){var i=e.getGL();i.useProgram(this.program),z.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t._rttOpaque.getTexture()),i.uniform1i(this.uniforms.uTexture0,0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t._rttTransparent.getTexture()),i.uniform1i(this.uniforms.uTexture1,1),i.uniform1i(this.uniforms.uFilmic,z.FILMIC),i.drawArrays(i.TRIANGLES,0,3)},z.initAttributes=function(e){z.attributes.aVertex=new f(e,z.program,"aVertex",2,e.FLOAT)};const X=z;var K=b.getCopy();K.vertexName=K.fragmentName="Fxaa",K.FILMIC=(0,s.A)().filmic,K.uniforms={},K.attributes={},K.uniformNames=["uTexture0","uInvSize"],K.vertex=["attribute vec2 aVertex;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","void main() {","  vUVM = aVertex * 0.5 + 0.5;","  vUVNW = vUVM + vec2(-1.0, -1.0) * uInvSize;","  vUVNE = vUVM + vec2(1.0, -1.0) * uInvSize;","  vUVSW = vUVM + vec2(-1.0, 1.0) * uInvSize;","  vUVSE = vUVM + vec2(1.0, 1.0) * uInvSize;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),K.fragment=["uniform sampler2D uTexture0;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","// https://github.com/mattdesl/glsl-fxaa\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n\nvec3 fxaa(const in sampler2D tex, const in vec2 uvNW, const in vec2 uvNE, const in vec2 uvSW, const in vec2 uvSE, const in vec2 uvM, const in vec2 invRes) {\n    const vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(texture2D(tex, uvNW).xyz, luma);\n    float lumaNE = dot(texture2D(tex, uvNE).xyz, luma);\n    float lumaSW = dot(texture2D(tex, uvSW).xyz, luma);\n    float lumaSE = dot(texture2D(tex, uvSE).xyz, luma);\n    float lumaM  = dot(texture2D(tex, uvM).xyz,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * invRes;\n    \n    vec3 rgbA = 0.5 * ( texture2D(tex, uvM + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, uvM + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * ( texture2D(tex, uvM - dir * 0.5).xyz + texture2D(tex, uvM + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if((lumaB < lumaMin) || (lumaB > lumaMax))\n      return rgbA;\n    return rgbB;\n}",b.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = vec4(fxaa(uTexture0, vUVNW, vUVNE, vUVSW, vUVSE, vUVM, uInvSize), 1.0);","}"].join("\n"),K.draw=function(e,t){var i=e.getGL();i.useProgram(this.program),K.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t._rttMerge.getTexture()),i.uniform1i(this.uniforms.uTexture0,0),i.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),i.drawArrays(i.TRIANGLES,0,3)},K.initAttributes=function(e){K.attributes.aVertex=new f(e,K.program,"aVertex",2,e.FLOAT)};const Y=K;var H=b.getCopy();H.vertexName=H.fragmentName="SobelContour",H.color=(0,s.A)().outlinecolor,H.uniforms={},H.attributes={},H.uniformNames=["uTexture0","uColor","uInvSize"],H.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.0, 1.0);","}"].join("\n"),H.fragment=["#extension GL_OES_standard_derivatives : enable","uniform sampler2D uTexture0;","uniform vec4 uColor;","varying vec2 vTexCoord;","uniform vec2 uInvSize;","\nfloat outlineDistance( const in vec2 uv, const in sampler2D tex, const in vec2 invSize ) {\n  float fac0 = 2.0;\n  float fac1 = 1.0;\n  float ox = invSize.x;\n  float oy = invSize.y;\n  vec4 texel0 = texture2D(tex, uv + vec2(ox, oy));\n  vec4 texel1 = texture2D(tex, uv + vec2(ox, 0.0));\n  vec4 texel2 = texture2D(tex, uv + vec2(ox, -oy));\n  vec4 texel3 = texture2D(tex, uv + vec2(0.0, -oy));\n  vec4 texel4 = texture2D(tex, uv + vec2(-ox, -oy));\n  vec4 texel5 = texture2D(tex, uv + vec2(-ox, 0.0));\n  vec4 texel6 = texture2D(tex, uv + vec2(-ox, oy));\n  vec4 texel7 = texture2D(tex, uv + vec2(0.0, oy));\n  vec4 rowx = -fac0 * texel5 + fac0 * texel1 + -fac1 * texel6 + fac1 * texel0 + -fac1 * texel4 + fac1 * texel2;\n  vec4 rowy = -fac0 * texel3 + fac0 * texel7 + -fac1 * texel4 + fac1 * texel6 + -fac1 * texel2 + fac1 * texel0;\n  return dot(rowy, rowy) + dot(rowx, rowx);\n}\n",b.strings.colorSpaceGLSL,"void main() {","  float mag = outlineDistance(vTexCoord, uTexture0, uInvSize);","  if (mag < 1.5) discard;","  gl_FragColor = vec4(sRGBToLinear(uColor.rgb) * uColor.a, uColor.a);","}"].join("\n"),H.draw=function(e){var t=e.getGL();t.useProgram(this.program),H.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform4fv(this.uniforms.uColor,H.color),t.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},H.initAttributes=function(e){H.attributes.aVertex=new f(e,H.program,"aVertex",2,e.FLOAT)};const q=H;var Z=b.getCopy();Z.CHANNEL_VALUE=0,Z.vertexName=Z.fragmentName="PaintUV",Z.uniforms={},Z.attributes={},Z.uniformNames=["uChannelPaint"],Z.activeAttributes={color:!0,material:!0},Z.vertex=["attribute vec2 aTexCoord;","attribute vec3 aColor;","attribute vec3 aMaterial;","varying vec3 vColor;","varying vec2 vMaterial;","void main() {","  vColor = aColor;","  vMaterial = aMaterial.xy;","  gl_Position = vec4((aTexCoord * 2.0 - 1.0) * vec2(1.0, -1.0), 0.5, 1.0);","}"].join("\n"),Z.fragment=["varying vec3 vColor;","varying vec2 vMaterial;","uniform int uChannelPaint;","void main() {","  gl_FragColor = vec4(uChannelPaint == 0 ? vColor : uChannelPaint == 1 ? vMaterial.xxx : vMaterial.yyy, 1.0);","}"].join("\n"),Z.initAttributes=function(e){b.initAttributes.call(this,e),Z.attributes.aTexCoord=new f(e,Z.program,"aTexCoord",2,e.FLOAT)},Z.bindAttributes=function(e){b.bindAttributes.call(this,e),Z.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},Z.updateUniforms=function(e){e.getGL().uniform1i(this.uniforms.uChannelPaint,Z.CHANNEL_VALUE)};const Q=Z;var J=b.getCopy();J.vertexName=J.fragmentName="Blur",J.INPUT_TEXTURE=null,J.uniforms={},J.attributes={},J.uniformNames=["uTexture0","uInvSize"],J.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),J.fragment=["uniform sampler2D uTexture0;","varying vec2 vTexCoord;","uniform vec2 uInvSize;",b.strings.colorSpaceGLSL,"void main() {","    const int KER_SIZE = 8;","    vec4 avg = texture2D(uTexture0, vTexCoord);","    if (avg.a < 0.1) {","        for (int i = -KER_SIZE; i <= KER_SIZE; ++i) {","            for (int j = -KER_SIZE; j <= KER_SIZE; ++j) {","                if (i == 0 && j == 0) continue;","                vec4 fetch = texture2D(uTexture0, vTexCoord + vec2(i, j) * uInvSize);","                avg.rgb += sRGBToLinear(fetch.rgb) * fetch.a;","                avg.a += fetch.a;","            }","        }","        avg.rgb = avg.a == 0.0 ? vec3(0.0) : linearTosRGB(avg.rgb / avg.a);","    }","    gl_FragColor = vec4(avg.rgb, 1.0);","}"].join("\n"),J.draw=function(e){var t=e.getGL();t.useProgram(this.program),J.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,J.INPUT_TEXTURE.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform2fv(this.uniforms.uInvSize,J.INPUT_TEXTURE.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},J.initAttributes=function(e){J.attributes.aVertex=new f(e,J.program,"aVertex",2,e.FLOAT)};const $=J;var ee=[];ee[r.A.Shader.PBR]=R,ee[r.A.Shader.MATCAP]=C,ee[r.A.Shader.NORMAL]=D,ee[r.A.Shader.UV]=F,ee[r.A.Shader.WIREFRAME]=O,ee[r.A.Shader.FLAT]=N,ee[r.A.Shader.SELECTION]=U,ee[r.A.Shader.BACKGROUND]=W,ee[r.A.Shader.MERGE]=X,ee[r.A.Shader.FXAA]=Y,ee[r.A.Shader.CONTOUR]=q,ee[r.A.Shader.PAINTUV]=Q,ee[r.A.Shader.BLUR]=$;const te=ee;function ie(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var re=a.vt(),ne=a.vt(),ae=[0,0,0],se=[0,0,0],oe=[0,0,1],le=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this._circleBuffer=new p(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._dotBuffer=new p(e,e.ARRAY_BUFFER,e.STATIC_DRAW),this._cacheDotMVP=a.vt(),this._cacheDotSymMVP=a.vt(),this._cacheCircleMVP=a.vt(),this._color=new Float32Array([.8,0,0]),this._offsetX=0,this._isEditMode=!1,this.init()}var i,n;return i=t,n=[{key:"getGL",value:function(){return this._gl}},{key:"getCircleBuffer",value:function(){return this._circleBuffer}},{key:"getDotBuffer",value:function(){return this._dotBuffer}},{key:"getCircleMVP",value:function(){return this._cacheCircleMVP}},{key:"getDotMVP",value:function(){return this._cacheDotMVP}},{key:"getDotSymmetryMVP",value:function(){return this._cacheDotSymMVP}},{key:"getColor",value:function(){return this._color}},{key:"setIsEditMode",value:function(e){this._isEditMode=e}},{key:"getIsEditMode",value:function(){return this._isEditMode}},{key:"setOffsetX",value:function(e){this._offsetX=e}},{key:"getOffsetX",value:function(){return this._offsetX}},{key:"init",value:function(){this.getCircleBuffer().update(this._getCircleVertices(1)),this.getDotBuffer().update(this._getDotVertices(.05,10))}},{key:"release",value:function(){this.getCircleBuffer().release(),this.getDotBuffer().release()}},{key:"_getCircleVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=2*Math.PI,n=i?1:0,a=i?t+2:t,s=new Float32Array(3*a),o=n;o<a;++o){var l=3*o,u=r*o/t;s[l]=Math.cos(u)*e,s[l+1]=Math.sin(u)*e}return s}},{key:"_getDotVertices",value:function(e,t){return this._getCircleVertices(e,t,!0)}},{key:"_updateMatricesBackground",value:function(t,i){var r=i.getSculptManager().getCurrentTool().getScreenRadius(),n=.5*t._width,s=.5*t._height;a.v3(re,-n,n,-s,s,-10,10),a.D_(ne),a.Tl(ne,ne,e.hZ(ae,-n+i._mouseX+this._offsetX,s-i._mouseY,0)),a.hs(this._cacheCircleMVP,ne,e.hZ(ae,r,r,r)),a.lK(this._cacheCircleMVP,re,this._cacheCircleMVP),a.hs(this._cacheDotMVP,ne,e.hZ(ae,50,50,50)),a.lK(this._cacheDotMVP,re,this._cacheDotMVP),a.hs(this._cacheDotSymMVP,this._cacheDotSymMVP,[0,0,0])}},{key:"_updateMatricesMesh",value:function(t,i){var r=i.getPicking(),n=i.getPickingSymmetry(),s=Math.sqrt(r.computeWorldRadius2(!0)),o=i.getSculptManager().getCurrentTool().getScreenRadius(),l=r.getMesh(),u=s/o*50;r.polyLerp(l.getNormals(),se),e.ei(se,se,h(ne,l.getMatrix())),e.S8(se,se);var c=Math.acos(e.Om(oe,se));e.$A(se,oe,se),a.D_(ne),a.Tl(ne,ne,e.Z0(ae,r.getIntersectionPoint(),l.getMatrix())),a.e$(ne,ne,c,se),a.lK(re,t.getProjection(),t.getView()),a.hs(this._cacheCircleMVP,ne,e.hZ(ae,s,s,s)),a.lK(this._cacheCircleMVP,re,this._cacheCircleMVP),a.hs(this._cacheDotMVP,ne,e.hZ(ae,u,u,u)),a.lK(this._cacheDotMVP,re,this._cacheDotMVP),e.Z0(ae,n.getIntersectionPoint(),l.getMatrix()),a.D_(ne),a.Tl(ne,ne,ae),a.e$(ne,ne,c,se),a.hs(ne,ne,e.hZ(ae,u,u,u)),a.lK(this._cacheDotSymMVP,re,ne)}},{key:"render",value:function(t){var i=t.getPicking().getMesh()&&!this._isEditMode;i?this._updateMatricesMesh(t.getCamera(),t):this._updateMatricesBackground(t.getCamera(),t);var n=t._action===r.A.Action.NOTHING;e.hZ(this._color,.8,n&&i?0:.4,0),te[r.A.Shader.SELECTION].getOrCreate(this._gl).draw(this,n,t.getSculptManager().getSymmetry()),this._isEditMode=!1}}],n&&ie(i.prototype,n),t}();const ue=le;function ce(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var he=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._cbContinuous=this.updateContinuous.bind(this),this._lastMouseX=0,this._lastMouseY=0}var t,i;return t=e,i=[{key:"setToolMesh",value:function(e){this._forceToolMesh=e}},{key:"getMesh",value:function(){return this._forceToolMesh||this._main.getMesh()}},{key:"start",value:function(e){var t=this._main,i=t.getPicking();if(!i.intersectionMouseMeshes())return!1;var r=t.setOrUnsetMesh(i.getMesh(),e);if(!r)return!1;i.initAlpha();var n=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null;return n&&(n.intersectionMouseMesh(r),n.initAlpha()),this.pushState(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,this.startSculpt(),!0}},{key:"end",value:function(){this.getMesh()&&this.getMesh().balanceOctree()}},{key:"pushState",value:function(){this._main.getStateManager().pushStateGeometry(this.getMesh())}},{key:"startSculpt",value:function(){!0!==this._lockPosition&&this.sculptStroke()}},{key:"preUpdate",value:function(e){var t=this._main,i=t.getPicking(),n=t._action===r.A.Action.SCULPT_EDIT;if(!n||e){n?i.intersectionMouseMesh():i.intersectionMouseMeshes();var a=i.getMesh();a&&t.getSculptManager().getSymmetry()&&t.getPickingSymmetry().intersectionMouseMesh(a)}}},{key:"update",value:function(e){if(!0===this._lockPosition)return this.updateSculptLock(e);this.sculptStroke()}},{key:"updateSculptLock",value:function(e){var t=this._main;e||this._main.getStateManager().getCurrentState().undo();var i=t.getPicking(),r=this._radius,n=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,s=t._mouseY-this._lastMouseY;this._radius=Math.sqrt(a*a+s*s);var o=a/this._radius,l=s/this._radius;this.makeStroke(this._lastMouseX+.001*o,this._lastMouseY+.001*l,i,n),this._radius=r,this.updateRender(),t.setCanvasCursor("default")}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),i=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,r=e._mouseX-this._lastMouseX,n=e._mouseY-this._lastMouseY,a=Math.sqrt(r*r+n*n),s=.15*this._radius*e.getPixelRatio();if(!(a<=s)){var o=1/Math.floor(a/s);r*=o,n*=o;for(var l=this._lastMouseX+r,u=this._lastMouseY+n,c=o;c<=1&&this.makeStroke(l,u,t,i);c+=o)l+=r,u+=n;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}},{key:"updateRender",value:function(){this.updateMeshBuffers(),this._main.render()}},{key:"makeStroke",value:function(e,t,i,r){var n=this.getMesh();i.intersectionMouseMesh(n,e,t);var a=i.getMesh();a&&(i.pickVerticesInSphere(i.getLocalRadius2()),i.computePickedNormal());var s,o=n.isDynamic&&!this._lockPosition;return o&&a&&this.stroke(i,!1),r&&(r.intersectionMouseMesh(n,e,t),(s=r.getMesh())&&(r.setLocalRadius2(i.getLocalRadius2()),r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal())),!o&&a&&this.stroke(i,!1),s&&this.stroke(r,!0),a||s}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateGeometryBuffers()}},{key:"updateContinuous",value:function(){if(this._lockPosition)return this.update(!0);var e=this._main,t=e.getPicking(),i=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null;this.makeStroke(e._mouseX,e._mouseY,t,i),this.updateRender()}},{key:"getFrontVertices",value:function(e,t){for(var i=e.length,r=new Uint32Array(n.A.getMemory(4*i),0,i),a=0,s=this.getMesh().getNormals(),o=t[0],l=t[1],u=t[2],c=0;c<i;++c){var h=e[c],d=3*h;s[d]*o+s[d+1]*l+s[d+2]*u<=0&&(r[a++]=h)}return new Uint32Array(r.subarray(0,a))}},{key:"areaNormal",value:function(e){for(var t=this.getMesh(),i=t.getNormals(),r=t.getMaterials(),n=0,a=0,s=0,o=0,l=e.length;o<l;++o){var u=3*e[o],c=r[u+2];n+=i[u]*c,a+=i[u+1]*c,s+=i[u+2]*c}var h=Math.sqrt(n*n+a*a+s*s);if(0!==h)return[n*(h=1/h),a*h,s*h]}},{key:"areaCenter",value:function(e){for(var t=this.getMesh(),i=t.getVertices(),r=t.getMaterials(),n=e.length,a=0,s=0,o=0,l=0,u=0;u<n;++u){var c=3*e[u],h=r[c+2];l+=h,a+=i[c]*h,s+=i[c+1]*h,o+=i[c+2]*h}return[a/l,s/l,o/l]}},{key:"updateProxy",value:function(e){var t=this.getMesh(),i=t.getVertices(),r=t.getVerticesProxy();if(i!==r)for(var a=t.getVerticesStateFlags(),s=n.A.STATE_FLAG,o=0,l=e.length;o<l;++o){var u=e[o];if(a[u]!==s){var c=3*u;r[c]=i[c],r[c+1]=i[c+1],r[c+2]=i[c+2]}}}},{key:"laplacianSmooth",value:function(e,t,i){for(var r=this.getMesh(),n=r.getVerticesRingVertStartCount(),a=r.getVerticesRingVert(),s=a instanceof Array?a:null,o=r.getVerticesOnEdge(),l=i||r.getVertices(),u=e.length,c=0;c<u;++c){var h,d,p=3*c,_=e[c];s?(h=0,d=(a=s[_]).length):d=(h=n[2*_])+n[2*_+1];var f=0,g=d-h;if(g<=2)f=3*_,t[p]=l[f],t[p+1]=l[f+1],t[p+2]=l[f+2];else{var m=0,v=0,y=0,b=0;if(1===o[_]){var A=0;for(b=h;b<d;++b)1===o[f=a[b]]&&(m+=l[f*=3],v+=l[f+1],y+=l[f+2],++A);if(A>=2){t[p]=m/A,t[p+1]=v/A,t[p+2]=y/A;continue}m=v=y=0}for(b=h;b<d;++b)m+=l[f=3*a[b]],v+=l[f+1],y+=l[f+2];t[p]=m/g,t[p+1]=v/g,t[p+2]=y/g}}}},{key:"dynamicTopology",value:function(e){var t=this.getMesh(),i=e.getPickedVertices();if(!t.isDynamic)return i;var r=t.getSubdivisionFactor(),a=t.getDecimationFactor();if(0===r&&0===a)return i;0===i.length&&(i=t.getVerticesFromFaces([e.getPickedFace()]),this._main.getStateManager().pushVertices(i));var s=t.getFacesFromVertices(i),o=e.getLocalRadius2(),l=e.getIntersectionPoint(),u=o*(1.1-r)*.2,c=u/4.2025*a;this._main.getStateManager().pushFaces(s),r&&(s=t.subdivide(s,l,o,u,this._main.getStateManager())),a&&(s=t.decimate(s,l,o,c,this._main.getStateManager()));for(var h=(i=t.getVerticesFromFaces(s)).length,d=n.A.SCULPT_FLAG,p=t.getVerticesSculptFlags(),_=new Uint32Array(n.A.getMemory(4*h),0,h),f=0,g=0;g<h;++g){var m=i[g];p[m]===d&&(_[f++]=m)}return _=new Uint32Array(_.subarray(0,f)),t.updateTopology(s,i),t.updateGeometry(s,i),_}},{key:"getUnmaskedVertices",value:function(){return this.filterMaskedVertices(0,1/0)}},{key:"getMaskedVertices",value:function(){return this.filterMaskedVertices(-1/0,1)}},{key:"filterMaskedVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=this.getMesh(),r=i.getMaterials(),a=i.getNbVertices(),s=new Uint32Array(n.A.getMemory(4*a),0,a),o=0,l=0;l<a;++l){var u=r[3*l+2];u>e&&u<t&&(s[o++]=l)}return new Uint32Array(s.subarray(0,o))}},{key:"postRender",value:function(e){e.render(this._main)}},{key:"addSculptToScene",value:function(){}},{key:"getScreenRadius",value:function(){return(this._radius||1)*this._main.getPixelRatio()}}],i&&ce(t.prototype,i),e}();const de=he;function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function _e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},fe(e,t)}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}var me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ge(n);if(a){var i=ge(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.75,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e);var n=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=n);var a=this.areaNormal(n);if(a){var s=this.areaCenter(n);e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.flatten(t,a,s,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(t),t)}}},{key:"flatten",value:function(e,t,i,r,n,a,s){for(var o=this.getMesh(),l=o.getVertices(),u=o.getMaterials(),c=Math.sqrt(n),h=!1===this._accumulate&&!1===this._lockPosition?o.getVerticesProxy():l,d=r[0],p=r[1],_=r[2],f=i[0],g=i[1],m=i[2],v=t[0],y=t[1],b=t[2],A=this._negative?-1:1,T=0,M=e.length;T<M;++T){var S=3*e[T],E=l[S],R=l[S+1],k=l[S+2],x=(E-f)*v+(R-g)*y+(k-m)*b;if(!(x*A>0)){var w=h[S]-d,C=h[S+1]-p,P=h[S+2]-_,D=Math.sqrt(w*w+C*C+P*P)/c;if(!(D>=1)){var I=D*D;I=3*I*I-4*I*D+1,I*=x*a*u[S+2]*s.getAlpha(E,R,k),l[S]-=v*I,l[S+1]-=y*I,l[S+2]-=b*I}}}}}],r&&_e(t.prototype,r),o}(de);const ve=me;function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function be(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){return Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ae(e,t)}function Te(e){return Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Te(e)}var Me=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(l,t);var r,n,a,s,o=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=Te(a);if(s){var i=Te(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=50,t._intensity=.5,t._negative=!1,t._clay=!0,t._culling=!1,t._accumulate=!0,t._idAlpha=0,t._lockPosition=!1,t}return r=l,n=[{key:"stroke",value:function(t){var r=t.getPickedVertices(),n=this._intensity*i.A.getPressureIntensity();this._accumulate||this._lockPosition||this.updateProxy(r),this._main.getStateManager().pushVertices(r),this._lockPosition||(r=this.dynamicTopology(t));var a=this.getFrontVertices(r,t.getEyeDirection());this._culling&&(r=a);var s=t.getLocalRadius2();if(t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),this._clay){var o=this.areaNormal(a);if(!o)return;var l=this._lockPosition?t.getIntersectionPoint():this.areaCenter(a),u=.1*Math.sqrt(s);e.Ln(l,l,o,this._negative?-u:u),ve.prototype.flatten.call(this,r,o,l,t.getIntersectionPoint(),s,n,t)}else this.brush(r,t.getPickedNormal(),t.getIntersectionPoint(),s,n,t);var c=this.getMesh();c.updateGeometry(c.getFacesFromVertices(r),r)}},{key:"brush",value:function(e,t,i,r,n,a){var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=this._accumulate||this._lockPosition?o:s.getVerticesProxy(),c=Math.sqrt(r),h=n*c*.1;this._negative&&(h=-h);for(var d=i[0],p=i[1],_=i[2],f=t[0],g=t[1],m=t[2],v=0,y=e.length;v<y;++v){var b=3*e[v],A=u[b]-d,T=u[b+1]-p,M=u[b+2]-_,S=Math.sqrt(A*A+T*T+M*M)/c;if(!(S>=1)){var E=o[b],R=o[b+1],k=o[b+2],x=S*S;x=3*x*x-4*x*S+1,x*=l[b+2]*h*a.getAlpha(E,R,k),o[b]=E+f*x,o[b+1]=R+g*x,o[b+2]=k+m*x}}}}],n&&be(r.prototype,n),l}(de);const Se=Me;function Ee(e){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ee(e)}function Re(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ke(e,t){return ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ke(e,t)}function xe(e){return xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xe(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=xe(n);if(a){var i=xe(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.3,t._negative=!1,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.inflate(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"inflate",value:function(e,t,i,r,n){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=a.getVerticesProxy(),u=a.getNormals(),c=Math.sqrt(i),h=r*c*.1;this._negative&&(h=-h);for(var d=t[0],p=t[1],_=t[2],f=0,g=e.length;f<g;++f){var m=3*e[f],v=l[m]-d,y=l[m+1]-p,b=l[m+2]-_,A=Math.sqrt(v*v+y*y+b*b)/c;if(!(A>=1)){var T=A*A;T=3*T*T-4*T*A+1,T*=h;var M=s[m],S=s[m+1],E=s[m+2],R=u[m],k=u[m+1],x=u[m+2];T/=Math.sqrt(R*R+k*k+x*x),T*=o[m+2]*n.getAlpha(M,S,E),s[m]=M+R*T,s[m+1]=S+k*T,s[m+2]=E+x*T}}}}],r&&Re(t.prototype,r),o}(de);const Ce=we;function Pe(e,t,i){return e[0]=t,e[1]=i,e}function De(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function Ie(e,t){var i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function Fe(e,t){return e[0]*t[0]+e[1]*t[1]}var Le,Oe=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},Ve=function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.hypot(i,r)};function Ne(){var e=new o.tb(4);return o.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Be(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ue(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function Ge(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=s*l-r*o,e}function je(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),l=Math.cos(i);return e[0]=r*l-a*o,e[1]=n*l+s*o,e[2]=a*l+r*o,e[3]=s*l-n*o,e}Le=new o.tb(2),o.tb!=Float32Array&&(Le[0]=0,Le[1]=0),function(){var e=new o.tb(4);o.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var We=function(e,t,i,r){var n=new o.tb(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},ze=function(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],l=i[1],u=i[2],c=i[3];return e[0]=r*c+s*o+n*u-a*l,e[1]=n*c+s*l+a*o-r*u,e[2]=a*c+s*u+r*l-n*o,e[3]=s*c-r*o-n*l-a*u,e},Xe=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Ke=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=a*s,e},Ye=(e.vt(),e.fA(1,0,0),e.fA(0,1,0),Ne(),Ne(),l(),__webpack_require__(693));function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function qe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ze(e,t){return Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ze(e,t)}function Qe(e){return Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qe(e)}var Je=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(o,t);var i,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=Qe(n);if(a){var i=Qe(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=75,t._culling=!1,t._twistData={normal:[0,0,0],center:[0,0]},t._twistDataSym={normal:[0,0,0],center:[0,0]},t._idAlpha=0,t}return i=o,r=[{key:"startSculpt",value:function(){var e=this._main,t=e._mouseX,i=e._mouseY,r=e.getPicking();if(this.initTwistData(r,t,i,this._twistData),e.getSculptManager().getSymmetry()){var n=e.getPickingSymmetry();n.intersectionMouseMesh(),n.setLocalRadius2(r.getLocalRadius2()),n.getMesh()&&this.initTwistData(n,t,i,this._twistDataSym)}}},{key:"initTwistData",value:function(t,i,r,n){t.pickVerticesInSphere(t.getLocalRadius2()),e.ze(n.normal,t.getEyeDirection()),Pe(n.center,i,r)}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX,i=e._mouseY,r=e._lastMouseX,n=e._lastMouseY,a=e.getPicking(),s=a.getLocalRadius2();if(a.pickVerticesInSphere(s),this.stroke(a,t,i,r,n,this._twistData),e.getSculptManager().getSymmetry()){var o=e.getPickingSymmetry();o.getMesh()&&(o.pickVerticesInSphere(s),this.stroke(o,r,n,t,i,this._twistDataSym))}this.updateRender(),e.setCanvasCursor("default")}},{key:"stroke",value:function(e,t,i,r,n,a){var s=e.getPickedVertices();this._main.getStateManager().pushVertices(s),s=this.dynamicTopology(e),this._culling&&(s=this.getFrontVertices(s,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.twist(s,e.getIntersectionPoint(),e.getLocalRadius2(),t,i,r,n,a,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(s),s)}},{key:"twist",value:function(t,i,r,n,a,s,o,l,u){var c,h,d,p=this.getMesh(),_=l.center,f=[n-_[0],a-_[1]];if(h=(c=f)[0],d=c[1],!(Math.hypot(h,d)<30)){Ie(f,f);var g=l.normal,m=[0,0,0,0],v=[s-_[0],o-_[1]];Ie(v,v);for(var y=Ye.A.signedAngle2d(f,v),b=p.getVertices(),A=p.getMaterials(),T=1/Math.sqrt(r),M=i[0],S=i[1],E=i[2],R=[0,0,0],k=0,x=t.length;k<x;++k){var w=3*t[k],C=b[w],P=b[w+1],D=b[w+2],I=C-M,F=P-S,L=D-E,O=Math.sqrt(I*I+F*F+L*L)*T,V=O*O;V=3*V*V-4*V*O+1,Ue(m,g,V*=y*A[w+2]*u.getAlpha(C,P,D)),e.hZ(R,C,P,D),e.jb(R,R,i),e.gL(R,R,m),e.WQ(R,R,i),b[w]=R[0],b[w+1]=R[1],b[w+2]=R[2]}}}}],r&&qe(i.prototype,r),o}(de);const $e=Je;function et(e){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},et(e)}function tt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function it(e,t){return it=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},it(e,t)}function rt(e){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rt(e)}var nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&it(e,t)}(l,e);var t,r,a,s,o=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=rt(a);if(s){var i=rt(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=50,t._intensity=.75,t._culling=!1,t._tangent=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=l,r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._tangent?this.smoothTangent(t,r,e):this.smooth(t,r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"smooth",value:function(e,t,i){var r=this.getMesh(),a=r.getVertices(),s=r.getMaterials(),o=e.length,l=new Float32Array(n.A.getMemory(4*o*3),0,3*o);this.laplacianSmooth(e,l);for(var u=0;u<o;++u){var c=3*e[u],h=a[c],d=a[c+1],p=a[c+2],_=3*u,f=t*s[c+2];i&&(f*=i.getAlpha(h,d,p));var g=1-f;a[c]=h*g+l[_]*f,a[c+1]=d*g+l[_+1]*f,a[c+2]=p*g+l[_+2]*f}}},{key:"smoothTangent",value:function(e,t,i){var r=this.getMesh(),a=r.getVertices(),s=r.getMaterials(),o=r.getNormals(),l=e.length,u=new Float32Array(n.A.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,u);for(var c=0;c<l;++c){var h=3*e[c],d=a[h],p=a[h+1],_=a[h+2],f=o[h],g=o[h+1],m=o[h+2],v=f*f+g*g+m*m;if(0!==v){f*=v=1/Math.sqrt(v),g*=v,m*=v;var y=3*c,b=u[y],A=u[y+1],T=u[y+2],M=f*(b-d)+g*(A-p)+m*(T-_),S=t*s[h+2];i&&(S*=i.getAlpha(d,p,_)),a[h]=d+(b-f*M-d)*S,a[h+1]=p+(A-g*M-p)*S,a[h+2]=_+(T-m*M-_)*S}}}},{key:"smoothAlongNormals",value:function(e,t,i){var r=this.getMesh(),a=r.getVertices(),s=r.getMaterials(),o=r.getNormals(),l=e.length,u=new Float32Array(n.A.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,u);for(var c=0;c<l;++c){var h=3*e[c],d=a[h],p=a[h+1],_=a[h+2],f=o[h],g=o[h+1],m=o[h+2],v=3*c,y=1/(f*f+g*g+m*m),b=f*(u[v]-d)+g*(u[v+1]-p)+m*(u[v+2]-_);b*=y*t*s[h+2],i&&(b*=i.getAlpha(d,p,_)),a[h]=d+f*b,a[h+1]=p+g*b,a[h+2]=_+m*b}}}],r&&tt(t.prototype,r),l}(de);const at=nt;function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ot(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lt(e,t){return lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},lt(e,t)}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}var ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ut(n);if(a){var i=ut(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.75,t._negative=!1,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.pinch(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"pinch",value:function(e,t,i,r,n){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(i),u=t[0],c=t[1],h=t[2],d=.05*r;this._negative&&(d=-d);for(var p=0,_=e.length;p<_;++p){var f=3*e[p],g=s[f],m=s[f+1],v=s[f+2],y=u-g,b=c-m,A=h-v,T=Math.sqrt(y*y+b*b+A*A)/l,M=T*T;M=3*M*M-4*M*T+1,M*=d*o[f+2]*n.getAlpha(g,m,v),s[f]=g+y*M,s[f+1]=m+b*M,s[f+2]=v+A*M}}}],r&&ot(t.prototype,r),o}(de);const ht=ct;function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}function pt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _t(e,t){return _t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_t(e,t)}function ft(e){return ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ft(e)}var gt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_t(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ft(n);if(a){var i=ft(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=25,t._intensity=.75,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.crease(t,e.getPickedNormal(),e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"crease",value:function(e,t,i,r,n,a){var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=s.getVerticesProxy(),c=Math.sqrt(r),h=i[0],d=i[1],p=i[2],_=t[0],f=t[1],g=t[2],m=.07*n,v=m*c;this._negative&&(v=-v);for(var y=0,b=e.length;y<b;++y){var A=3*e[y],T=h-u[A],M=d-u[A+1],S=p-u[A+2],E=Math.sqrt(T*T+M*M+S*S)/c;if(!(E>=1)){var R=o[A],k=o[A+1],x=o[A+2],w=E*E;w=3*w*w-4*w*E+1,w*=l[A+2]*a.getAlpha(R,k,x);var C=Math.pow(w,5)*v;w*=m,o[A]=R+T*w+_*C,o[A+1]=k+M*w+f*C,o[A+2]=x+S*w+g*C}}}}],r&&pt(t.prototype,r),o}(de);const mt=gt;function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function yt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bt(e,t){return bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},bt(e,t)}function At(e){return At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},At(e)}var Tt=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(l,t);var i,r,n,s,o=(n=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=At(n);if(s){var i=At(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=150,t._dragDir=[0,0,0],t._dragDirSym=[0,0,0],t._idAlpha=0,t}return i=l,r=[{key:"sculptStroke",value:function(){var t=this._main,i=this.getMesh(),r=t.getPicking(),n=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,s=t._mouseY-this._lastMouseY,o=Math.sqrt(a*a+s*s),l=.15*this._radius,u=1/Math.floor(o/l);a*=u,s*=u;var c=this._lastMouseX,h=this._lastMouseY;if(r.getMesh()){r._mesh=i,n&&(n._mesh=i,e.C(n.getIntersectionPoint(),r.getIntersectionPoint()),Ye.A.mirrorPoint(n.getIntersectionPoint(),i.getSymmetryOrigin(),i.getSymmetryNormal()));for(var d=0;d<1&&this.makeStroke(c,h,r,n);d+=u)c+=a,h+=s;this.updateRender(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY}}},{key:"makeStroke",value:function(e,t,i,r){var n=this.getMesh();return this.updateDragDir(i,e,t),i.pickVerticesInSphere(i.getLocalRadius2()),i.computePickedNormal(),n.isDynamic&&this.stroke(i,!1),r&&(this.updateDragDir(r,e,t,!0),r.setLocalRadius2(i.getLocalRadius2()),r.pickVerticesInSphere(r.getLocalRadius2())),n.isDynamic||this.stroke(i,!1),r&&this.stroke(r,!0),!0}},{key:"stroke",value:function(e,t){var i=e.getPickedVertices();this._main.getStateManager().pushVertices(i),i=this.dynamicTopology(e),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.drag(i,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var r=this.getMesh();r.updateGeometry(r.getFacesFromVertices(i),i)}},{key:"drag",value:function(e,t,i,r,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(i),u=t[0],c=t[1],h=t[2],d=r?this._dragDirSym:this._dragDir,p=d[0],_=d[1],f=d[2],g=0,m=e.length;g<m;++g){var v=3*e[g],y=s[v],b=s[v+1],A=s[v+2],T=y-u,M=b-c,S=A-h,E=Math.sqrt(T*T+M*M+S*S)/l,R=E*E;R=3*R*R-4*R*E+1,R*=o[v+2]*n.getAlpha(y,b,A),s[v]=y+p*R,s[v+1]=b+_*R,s[v+2]=A+f*R}}},{key:"updateDragDir",value:function(t,i,r,n){var s=this.getMesh(),o=t.unproject(i,r,0),l=t.unproject(i,r,.1),u=a.vt();a.B8(u,s.getMatrix()),e.Z0(o,o,u),e.Z0(l,l,u);var c=this._dragDir;if(n){c=this._dragDirSym;var h=s.getSymmetryOrigin(),d=s.getSymmetryNormal();Ye.A.mirrorPoint(o,h,d),Ye.A.mirrorPoint(l,h,d)}var p=t.getIntersectionPoint();t.setIntersectionPoint(Ye.A.vertexOnLine(p,o,l)),e.jb(c,t.getIntersectionPoint(),p),t._mesh=s,t.updateLocalAndWorldRadius2();var _=t.getEyeDirection();e.jb(_,l,o),e.S8(_,_)}}],r&&yt(i.prototype,r),l}(de);const Mt=Tt;function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Et(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rt(e,t,i){return Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xt(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}},Rt(e,t,i||e)}function kt(e,t){return kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},kt(e,t)}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}var wt=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(l,t);var r,n,a,s,o=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=xt(a);if(s){var i=xt(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(i=o.call(this,t))._radius=50,i._hardness=.75,i._intensity=.75,i._culling=!1,i._color=e.fA(1,.766,.336),i._material=e.fA(.3,.95,0),i._pickColor=!1,i._pickCallback=null,i._idAlpha=0,i._lockPosition=!1,i._writeAlbedo=!0,i._writeRoughness=!0,i._writeMetalness=!0,i}return r=l,n=[{key:"end",value:function(){this._pickColor=!1,Rt(xt(l.prototype),"end",this).call(this)}},{key:"pushState",value:function(e){this._pickColor&&!e||this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"startSculpt",value:function(){if(this._pickColor)return this.pickColor(this._main.getPicking());Rt(xt(l.prototype),"startSculpt",this).call(this)}},{key:"update",value:function(e){if(!0===this._pickColor)return this.updatePickColor();Rt(xt(l.prototype),"update",this).call(this,e)}},{key:"updateContinuous",value:function(){if(!0===this._pickColor)return this.updatePickColor();Rt(xt(l.prototype),"updateContinuous",this).call(this)}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():(e.updateColorBuffer(),e.updateMaterialBuffer())}},{key:"updatePickColor",value:function(){var e=this._main.getPicking();e.intersectionMouseMesh()&&this.pickColor(e)}},{key:"setPickCallback",value:function(e){this._pickCallback=e}},{key:"pickColor",value:function(e){var t=this.getMesh(),i=this._color;e.polyLerp(t.getMaterials(),i);var r=i[0],n=i[1];e.polyLerp(t.getColors(),i),this._pickCallback(i,r,n)}},{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*i.A.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.paint(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,this._hardness,e);var n=this.getMesh();n.updateDuplicateColorsAndMaterials(t),n.isUsingDrawArrays()&&n.updateDrawArrays(n.getFacesFromVertices(t))}},{key:"paint",value:function(e,t,i,r,n,a){for(var s=this.getMesh(),o=s.getVertices(),l=s.getColors(),u=s.getMaterials(),c=this._color,h=this._material[0],d=this._material[1],p=Math.sqrt(i),_=c[0],f=c[1],g=c[2],m=t[0],v=t[1],y=t[2],b=2*(1-n),A=0,T=e.length;A<T;++A){var M=3*e[A],S=o[M],E=o[M+1],R=o[M+2],k=S-m,x=E-v,w=R-y,C=Math.sqrt(k*k+x*x+w*w)/p;C>1&&(C=1);var P=Math.pow(1-C,b),D=1-(P*=r*u[M+2]*a.getAlpha(S,E,R));this._writeAlbedo&&(l[M]=l[M]*D+_*P,l[M+1]=l[M+1]*D+f*P,l[M+2]=l[M+2]*D+g*P),this._writeRoughness&&(u[M]=u[M]*D+h*P),this._writeMetalness&&(u[M+1]=u[M+1]*D+d*P)}}},{key:"paintAll",value:function(){var e=this.getMesh(),t=this.getUnmaskedVertices();if(0!==t.length){this.pushState(!0),this._main.getStateManager().pushVertices(t);for(var i=e.getColors(),r=e.getMaterials(),n=this._color,a=this._material[0],s=this._material[1],o=n[0],l=n[1],u=n[2],c=0,h=t.length;c<h;++c){var d=3*t[c],p=r[d+2],_=1-p;this._writeAlbedo&&(i[d]=i[d]*_+o*p,i[d+1]=i[d+1]*_+l*p,i[d+2]=i[d+2]*_+u*p),this._writeRoughness&&(r[d]=r[d]*_+a*p),this._writeMetalness&&(r[d+1]=r[d+1]*_+s*p)}e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}}}],n&&Et(r.prototype,n),l}(de);const Ct=wt;function Pt(e){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pt(e)}function Dt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function It(e,t){return It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},It(e,t)}function Ft(e){return Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ft(e)}var Lt=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(l,t);var i,r,n,s,o=(n=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=Ft(n);if(s){var i=Ft(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==Pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=150,t._intensity=1,t._topoCheck=!0,t._negative=!1,t._moveData={center:[0,0,0],dir:[0,0],vProxy:null},t._moveDataSym={center:[0,0,0],dir:[0,0],vProxy:null},t._idAlpha=0,t}return i=l,r=[{key:"startSculpt",value:function(){var e=this._main,t=e.getPicking();if(this.initMoveData(t,this._moveData),e.getSculptManager().getSymmetry()){var i=e.getPickingSymmetry();i.intersectionMouseMesh(),i.setLocalRadius2(t.getLocalRadius2()),i.getMesh()&&this.initMoveData(i,this._moveDataSym)}}},{key:"initMoveData",value:function(t,i){this._topoCheck?t.pickVerticesInSphereTopological(t.getLocalRadius2()):t.pickVerticesInSphere(t.getLocalRadius2()),e.C(i.center,t.getIntersectionPoint());var r=t.getPickedVertices();this._main.getStateManager().pushVertices(r);for(var n=t.getMesh().getVertices(),a=r.length,s=i.vProxy=new Float32Array(3*a),o=0;o<a;++o){var l=3*r[o],u=3*o;s[u]=n[l],s[u+1]=n[l+1],s[u+2]=n[l+2]}}},{key:"copyVerticesProxy",value:function(e,t){for(var i=e.getPickedVertices(),r=this.getMesh().getVertices(),n=t.vProxy,a=0,s=i.length;a<s;++a){var o=3*i[a],l=3*a;r[o]=n[l],r[o+1]=n[l+1],r[o+2]=n[l+2]}}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),i=e.getPickingSymmetry(),r=e.getSculptManager().getSymmetry()&&i.getMesh();t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),r&&(i.updateAlpha(!1),i.setIdAlpha(this._idAlpha)),this.copyVerticesProxy(t,this._moveData),r&&this.copyVerticesProxy(i,this._moveDataSym);var n=e._mouseX,a=e._mouseY;this.updateMoveDir(t,n,a),this.move(t.getPickedVertices(),t.getIntersectionPoint(),t.getLocalRadius2(),this._moveData,t),r&&(this.updateMoveDir(i,n,a,!0),this.move(i.getPickedVertices(),i.getIntersectionPoint(),i.getLocalRadius2(),this._moveDataSym,i));var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t.getPickedVertices()),t.getPickedVertices()),r&&s.updateGeometry(s.getFacesFromVertices(i.getPickedVertices()),i.getPickedVertices()),this.updateRender(),e.setCanvasCursor("default")}},{key:"move",value:function(e,t,i,r,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(i),u=r.vProxy,c=t[0],h=t[1],d=t[2],p=r.dir,_=p[0],f=p[1],g=p[2],m=0,v=e.length;m<v;++m){var y=3*e[m],b=3*m,A=u[b],T=u[b+1],M=u[b+2],S=A-c,E=T-h,R=M-d,k=Math.sqrt(S*S+E*E+R*R)/l,x=k*k;x=3*x*x-4*x*k+1,x*=o[y+2]*n.getAlpha(A,T,M),s[y]+=_*x,s[y+1]+=f*x,s[y+2]+=g*x}}},{key:"updateMoveDir",value:function(t,i,r,n){var s=this.getMesh(),o=t.unproject(i,r,0),l=t.unproject(i,r,.1),u=a.vt();a.B8(u,s.getMatrix()),e.Z0(o,o,u),e.Z0(l,l,u);var c=n?this._moveDataSym:this._moveData;if(n){var h=s.getSymmetryOrigin(),d=s.getSymmetryNormal();Ye.A.mirrorPoint(o,h,d),Ye.A.mirrorPoint(l,h,d)}if(this._negative){var p=e.xg(Ye.A.vertexOnLine(c.center,o,l),c.center);e.S8(c.dir,t.computePickedNormal()),e.hs(c.dir,c.dir,i<this._lastMouseX?-p:p)}else e.jb(c.dir,Ye.A.vertexOnLine(c.center,o,l),c.center);e.hs(c.dir,c.dir,this._intensity);var _=t.getEyeDirection();e.jb(_,l,o),e.S8(_,_)}}],r&&Dt(i.prototype,r),l}(de);const Ot=Lt;function Vt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t||null,this._depth=t?t._depth+1:0,this._children=[],this._aabbLoose=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._aabbSplit=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._iFaces=[],this._flag=0}var t,i;return t=e,(i=[{key:"resetNbFaces",value:function(e){var t=this._iFaces;t.length=e;for(var i=0;i<e;++i)t[i]=i}},{key:"build",value:function(t){var i=0,r=e.STACK;r[0]=this;for(var n=1,a=[];n>0;){var s=r[--n],o=s._iFaces.length;if(o>e.MAX_FACES&&s._depth<e.MAX_DEPTH){s.constructChildren(t);var l=s._children;for(i=0;i<8;++i)r[n+i]=l[i];n+=8}else o>0&&a.push(s)}var u=a.length;for(i=0;i<u;++i)a[i].constructLeaf(t)}},{key:"constructLeaf",value:function(e){for(var t=this._iFaces,i=t.length,r=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0,u=e.getFaceBoxes(),c=e.getFacePosInLeaf(),h=e.getFaceLeaf(),d=0;d<i;++d){var p=t[d];h[p]=this,c[p]=d;var _=u[p*=6],f=u[p+1],g=u[p+2],m=u[p+3],v=u[p+4],y=u[p+5];_<r&&(r=_),m>s&&(s=m),f<n&&(n=f),v>o&&(o=v),g<a&&(a=g),y>l&&(l=y)}this.expandsAabbLoose(r,n,a,s,o,l)}},{key:"constructChildren",value:function(t){for(var i=this._aabbSplit,r=i[0],n=i[1],a=i[2],s=i[3],o=i[4],l=i[5],u=.5*(s-r),c=.5*(o-n),h=.5*(l-a),d=.5*(s+r),p=.5*(o+n),_=.5*(l+a),f=new e(this),g=new e(this),m=new e(this),v=new e(this),y=new e(this),b=new e(this),A=new e(this),T=new e(this),M=f._iFaces,S=g._iFaces,E=m._iFaces,R=v._iFaces,k=y._iFaces,x=b._iFaces,w=A._iFaces,C=T._iFaces,P=t.getFaceCenters(),D=this._iFaces,I=D.length,F=0;F<I;++F){var L=D[F],O=3*L,V=P[O],N=P[O+1],B=P[O+2];V>d?N>p?B>_?w.push(L):x.push(L):B>_?E.push(L):S.push(L):N>p?B>_?C.push(L):k.push(L):B>_?R.push(L):M.push(L)}f.setAabbSplit(r,n,a,d,p,_),g.setAabbSplit(r+u,n,a,d+u,p,_),m.setAabbSplit(d,p-c,_,s,o-c,l),v.setAabbSplit(r,n,a+h,d,p,_+h),y.setAabbSplit(r,n+c,a,d,p+c,_),b.setAabbSplit(d,p,_-h,s,o,l-h),A.setAabbSplit(d,p,_,s,o,l),T.setAabbSplit(d-u,p,_,s-u,o,l),this._children.length=0,this._children.push(f,g,m,v,y,b,A,T),D.length=0}},{key:"setAabbSplit",value:function(e,t,i,r,n,a){var s=this._aabbSplit;s[0]=e,s[1]=t,s[2]=i,s[3]=r,s[4]=n,s[5]=a}},{key:"setAabbLoose",value:function(e,t,i,r,n,a){var s=this._aabbLoose;s[0]=e,s[1]=t,s[2]=i,s[3]=r,s[4]=n,s[5]=a}},{key:"collectIntersectRay",value:function(t,i,r,n){var a=t[0],s=t[1],o=t[2],l=1/i[0],u=1/i[1],c=1/i[2],h=0,d=e.STACK;d[0]=this;for(var p=1;p>0;){var _=d[--p],f=_._aabbLoose,g=(f[0]-a)*l,m=(f[3]-a)*l,v=(f[1]-s)*u,y=(f[4]-s)*u,b=(f[2]-o)*c,A=(f[5]-o)*c,T=Math.max(Math.min(g,m),Math.min(v,y),Math.min(b,A)),M=Math.min(Math.max(g,m),Math.max(v,y),Math.max(b,A));if(!(M<0||T>M)){var S=_._children;if(8===S.length){for(var E=0;E<8;++E)d[p+E]=S[E];p+=8}else{n&&n.push(_);var R=_._iFaces;r.set(R,h),h+=R.length}}}return new Uint32Array(r.subarray(0,h))}},{key:"collectIntersectSphere",value:function(t,i,r,n){var a=t[0],s=t[1],o=t[2],l=0,u=e.STACK;u[0]=this;for(var c=1;c>0;){var h,d,p,_=u[--c],f=_._aabbLoose;if(!((h=f[0]>a?f[0]-a:f[3]<a?f[3]-a:0)*h+(d=f[1]>s?f[1]-s:f[4]<s?f[4]-s:0)*d+(p=f[2]>o?f[2]-o:f[5]<o?f[5]-o:0)*p>i)){var g=_._children;if(8===g.length){for(var m=0;m<8;++m)u[c+m]=g[m];c+=8}else{n&&n.push(_);var v=_._iFaces;r.set(v,l),l+=v.length}}}return new Uint32Array(r.subarray(0,l))}},{key:"addFace",value:function(t,i,r,n,a,s,o,l,u,c){var h=e.STACK;h[0]=this;for(var d=1;d>0;){var p=h[--d],_=p._aabbSplit;if(!(l<=_[0]||u<=_[1]||c<=_[2]||l>_[3]||u>_[4]||c>_[5])){var f=p._aabbLoose;i<f[0]&&(f[0]=i),r<f[1]&&(f[1]=r),n<f[2]&&(f[2]=n),a>f[3]&&(f[3]=a),s>f[4]&&(f[4]=s),o>f[5]&&(f[5]=o);var g=p._children;if(8!==g.length)return p._iFaces.push(t),p;for(var m=0;m<8;++m)h[d+m]=g[m];d+=8}}}},{key:"pruneIfPossible",value:function(){for(var e=this;e._parent;){var t=e._parent,i=t._children;if(0===i.length)return;for(var r=0;r<8;++r){var n=i[r];if(n._iFaces.length>0||8===n._children.length)return}i.length=0,e=t}}},{key:"expandsAabbLoose",value:function(e,t,i,r,n,a){for(var s=this;s;){var o=s._aabbLoose,l=!1;e<o[0]&&(o[0]=e,l=!0),t<o[1]&&(o[1]=t,l=!0),i<o[2]&&(o[2]=i,l=!0),r>o[3]&&(o[3]=r,l=!0),n>o[4]&&(o[4]=n,l=!0),a>o[5]&&(o[5]=a,l=!0),s=l?s._parent:null}}}])&&Vt(t.prototype,i),e}();Nt.FLAG=0,Nt.MAX_DEPTH=8,Nt.MAX_FACES=100,function(){for(var e=1+7*Nt.MAX_DEPTH,t=Nt.STACK=new Array(e),i=0;i<e;++i)t[i]=null}();const Bt=Nt;var Ut=function(e){var t=(0,s.A)();return{_gl:e,_shaderType:t.shader,_flatShading:t.flatshading,_showWireframe:t.wireframe,_matcap:Math.min(t.matcap,C.matcaps.length-1),_curvature:Math.min(t.curvature,5),_texture0:null,_useDrawArrays:!1,_vertexBuffer:new p(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_normalBuffer:new p(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_colorBuffer:new p(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_materialBuffer:new p(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_texCoordBuffer:new p(e,e.ARRAY_BUFFER,e.STATIC_DRAW),_indexBuffer:new p(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_wireframeBuffer:new p(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_albedo:new Float32Array([-1,-1,-1]),_roughness:-.18,_metallic:-.78,_alpha:1,_flatColor:new Float32Array([1,0,0]),_mode:e.TRIANGLES}};Ut.ONLY_DRAW_ARRAYS=!1;const Gt=Ut;function jt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Wt=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._id=t.ID++,this._meshData=null,this._transformData=null,this._renderData=null,this._isVisible=!0}var i,s,o;return i=t,s=[{key:"setID",value:function(e){this._id=e}},{key:"isVisible",value:function(){return this._isVisible}},{key:"setVisible",value:function(e){this._isVisible=e}},{key:"setVertices",value:function(e){this._meshData._verticesXYZ=e,this._meshData._nbVertices=e.length/3}},{key:"setFaces",value:function(e){this._meshData._facesABCD=e,this._meshData._nbFaces=e.length/4}},{key:"setTexCoords",value:function(e){this._meshData._texCoordsST=e,this._meshData._nbTexCoords=e.length/2}},{key:"setColors",value:function(e){this._meshData._colorsRGB=e}},{key:"setMaterials",value:function(e){this._meshData._materialsPBR=e}},{key:"setVerticesDuplicateStartCount",value:function(e){this._meshData._duplicateStartCount=e}},{key:"setFacesTexCoord",value:function(e){this._meshData._UVfacesABCD=e}},{key:"setMeshData",value:function(e){this._meshData=e}},{key:"setRenderData",value:function(e){this._renderData=e}},{key:"setTransformData",value:function(e){this._transformData=e}},{key:"setNbVertices",value:function(e){this._meshData._nbVertices=e}},{key:"setNbFaces",value:function(e){this._meshData._nbFaces=e}},{key:"getID",value:function(){return this._id}},{key:"getRenderData",value:function(){return this._renderData}},{key:"getMeshData",value:function(){return this._meshData}},{key:"getTransformData",value:function(){return this._transformData}},{key:"getNbVertices",value:function(){return this._meshData._nbVertices}},{key:"getNbFaces",value:function(){return this._meshData._nbFaces}},{key:"getNbQuads",value:function(){return this.getNbTriangles()-this.getNbFaces()}},{key:"getNbTriangles",value:function(){return this._meshData._trianglesABC.length/3}},{key:"getNbTexCoords",value:function(){return this._meshData._nbTexCoords}},{key:"hasUV",value:function(){return null!==this._meshData._texCoordsST}},{key:"getVertices",value:function(){return this._meshData._verticesXYZ}},{key:"getColors",value:function(){return this._meshData._colorsRGB}},{key:"getNormals",value:function(){return this._meshData._normalsXYZ}},{key:"getMaterials",value:function(){return this._meshData._materialsPBR}},{key:"getVerticesTagFlags",value:function(){return this._meshData._vertTagFlags}},{key:"getVerticesSculptFlags",value:function(){return this._meshData._vertSculptFlags}},{key:"getVerticesStateFlags",value:function(){return this._meshData._vertStateFlags}},{key:"getVerticesRingVertStartCount",value:function(){return this._meshData._vrvStartCount}},{key:"getVerticesRingVert",value:function(){return this._meshData._vertRingVert}},{key:"getVerticesRingFaceStartCount",value:function(){return this._meshData._vrfStartCount}},{key:"getVerticesRingFace",value:function(){return this._meshData._vertRingFace}},{key:"getVerticesOnEdge",value:function(){return this._meshData._vertOnEdge}},{key:"getVerticesProxy",value:function(){return this._meshData._vertProxy}},{key:"getFaces",value:function(){return this._meshData._facesABCD}},{key:"hasOnlyTriangles",value:function(){return this.getNbTriangles()===this.getNbFaces()}},{key:"hasOnlyQuads",value:function(){return this.getNbTriangles()===2*this.getNbFaces()}},{key:"getFaceNormals",value:function(){return this._meshData._faceNormalsXYZ}},{key:"getFaceBoxes",value:function(){return this._meshData._faceBoxes}},{key:"getFaceCenters",value:function(){return this._meshData._faceCentersXYZ}},{key:"getFacesTagFlags",value:function(){return this._meshData._facesTagFlags}},{key:"getFaceEdges",value:function(){return this._meshData._faceEdges}},{key:"getFacesToTriangles",value:function(){return this._meshData._facesToTriangles}},{key:"getTrianglesTexCoord",value:function(){return this._meshData._UVtrianglesABC}},{key:"getTriangles",value:function(){return this._meshData._trianglesABC}},{key:"getEdges",value:function(){return this._meshData._edges}},{key:"getNbEdges",value:function(){return this._meshData._edges.length}},{key:"getTexCoords",value:function(){return this._meshData._texCoordsST}},{key:"getVerticesDuplicateStartCount",value:function(){return this._meshData._duplicateStartCount}},{key:"getFacesTexCoord",value:function(){return this._meshData._UVfacesABCD}},{key:"getVerticesDrawArrays",value:function(){return this._meshData._DAverticesXYZ||this.updateDrawArrays(),this._meshData._DAverticesXYZ}},{key:"getNormalsDrawArrays",value:function(){return this._meshData._DAnormalsXYZ}},{key:"getColorsDrawArrays",value:function(){return this._meshData._DAcolorsRGB}},{key:"getMaterialsDrawArrays",value:function(){return this._meshData._DAmaterialsPBR}},{key:"getTexCoordsDrawArrays",value:function(){return this._meshData._DAtexCoordsST}},{key:"getOctree",value:function(){return this._meshData._octree}},{key:"getCenter",value:function(){return this._transformData._center}},{key:"getMV",value:function(){return this._transformData._lastComputedMV}},{key:"getMVP",value:function(){return this._transformData._lastComputedMVP}},{key:"getN",value:function(){return this._transformData._lastComputedN}},{key:"getEN",value:function(){return this._transformData._lastComputedEN}},{key:"getDepth",value:function(){return this._transformData._lastComputedDepth}},{key:"getMatrix",value:function(){return this._transformData._matrix}},{key:"getYawPitchRoll",value:function(){return this._transformData._yawPitchRoll}},{key:"setYawPitchRoll",value:function(t,i,r){e.hZ(this._transformData._yawPitchRoll,t,i,r),this._applyYawPitchRoll()}},{key:"updateYawPitchRollFromMatrix",value:function(){!function(t,i){var r=i[0],n=i[1],a=i[2],s=i[4],o=i[5],l=i[6],u=i[8],c=i[9],h=i[10],d=Math.hypot(r,n,a),p=Math.hypot(s,o,l),_=Math.hypot(u,c,h);d>0&&(r/=d,n/=d,a/=d),p>0&&(s/=p,o/=p,l/=p),_>0&&(u/=_,c/=_,h/=_);var f=Math.asin(Math.max(-1,Math.min(1,-c))),g=Math.atan2(u,h),m=Math.atan2(n,o);e.hZ(t,g,f,m)}(this._transformData._yawPitchRoll,this._transformData._matrix)}},{key:"_applyYawPitchRoll",value:function(){var e=this._transformData,t=e._matrix,i=this.getScale(),r=t[12],n=t[13],s=t[14];!function(e,t,i,r){a.D_(e),a.Z8(e,e,t),a.eL(e,e,i),a.Qr(e,e,r)}(t,e._yawPitchRoll[0],e._yawPitchRoll[1],e._yawPitchRoll[2]),a.hs(t,t,[i,i,i]),t[12]=r,t[13]=n,t[14]=s}},{key:"getEditMatrix",value:function(){return this._transformData._editMatrix}},{key:"getScale2",value:function(){var e=this._transformData._matrix;return e[0]*e[0]+e[4]*e[4]+e[8]*e[8]}},{key:"getScale",value:function(){return Math.sqrt(this.getScale2())}},{key:"getSymmetryOrigin",value:function(){var t=e.vt(),i=this._transformData,r=i._symmetryOffset*this.computeLocalRadius();return e.Ln(t,i._center,i._symmetryNormal,r)}},{key:"getSymmetryOffset",value:function(){return this._transformData._symmetryOffset}},{key:"setSymmetryOffset",value:function(e){this._transformData._symmetryOffset=e}},{key:"getSymmetryNormal",value:function(){return this._transformData._symmetryNormal}},{key:"getFacePosInLeaf",value:function(){return this._meshData._facePosInLeaf}},{key:"getFaceLeaf",value:function(){return this._meshData._faceLeaf}},{key:"getLeavesToUpdate",value:function(){return this._meshData._leavesToUpdate}},{key:"getLocalBound",value:function(){return this._meshData._octree._aabbLoose}},{key:"getRenderNbEdges",value:function(){return this.getNbEdges()}},{key:"init",value:function(){this.initColorsAndMaterials(),this.allocateArrays(),this.initTopology(),this.updateGeometry(),this._renderData&&this.updateDuplicateColorsAndMaterials(),this.updateCenter()}},{key:"initTopology",value:function(){this.initFaceRings(),this.optimize(),this.initEdges(),this.initVertexRings(),this.initRenderTriangles()}},{key:"updateGeometry",value:function(e,t){this.updateFacesAabbAndNormal(e),this.updateVerticesNormal(t),this.updateOctree(e),this._renderData&&(this.updateDuplicateGeometry(t),this.updateDrawArrays(e))}},{key:"allocateArrays",value:function(){var e=this.getNbVertices();if(this.hasUV()){var t=this._meshData._texCoordsST.length/2,i=new Float32Array(3*t);i.set(this._meshData._verticesXYZ),this._meshData._verticesXYZ=i,this._meshData._normalsXYZ=new Float32Array(3*t),i=new Float32Array(3*t),this._meshData._colorsRGB&&i.set(this._meshData._colorsRGB),this._meshData._colorsRGB=i,i=new Float32Array(3*t),this._meshData._materialsPBR&&i.set(this._meshData._materialsPBR),this._meshData._materialsPBR=i}else this._meshData._normalsXYZ=this._meshData._normalsXYZ||new Float32Array(3*e),this._meshData._colorsRGB=this._meshData._colorsRGB||new Float32Array(3*e),this._meshData._materialsPBR=this._meshData._materialsPBR||new Float32Array(3*e);this._meshData._vertOnEdge=new Uint8Array(e),this._meshData._vrvStartCount=new Uint32Array(2*e),this._meshData._vrfStartCount=new Uint32Array(2*e),this._meshData._vertTagFlags=new Int32Array(e),this._meshData._vertSculptFlags=new Int32Array(e),this._meshData._vertStateFlags=new Int32Array(e),this._meshData._vertProxy=new Float32Array(3*e);var r=this.getNbFaces();this._meshData._faceEdges=new Uint32Array(4*r),this._meshData._facesToTriangles=new Uint32Array(r),this._meshData._faceBoxes=new Float32Array(6*r),this._meshData._faceNormalsXYZ=new Float32Array(3*r),this._meshData._faceCentersXYZ=new Float32Array(3*r),this._meshData._facesTagFlags=new Int32Array(r),this._meshData._facePosInLeaf=new Uint32Array(r);var n=this._meshData._faceLeaf;n.length=r;for(var a=0;a<r;++a)n[a]=null}},{key:"initColorsAndMaterials",value:function(){var e=this.getNbVertices(),t=0,i=3*e;if(!this._meshData._colorsRGB||this._meshData._colorsRGB.length!==i){var r=this._meshData._colorsRGB=new Float32Array(i);for(t=0;t<i;++t)r[t]=1}if(!this._meshData._materialsPBR||this._meshData._materialsPBR.length!==i){var n=this._meshData._materialsPBR=new Float32Array(i);for(t=0;t<e;++t){var a=3*t;n[a]=.18,n[a+1]=.08,n[a+2]=1}}}},{key:"initFaceRings",value:function(){var e=this.getFaces(),t=this.getNbVertices(),i=this.getNbFaces(),r=0,a=0,s=new Uint32Array(t);for(r=0;r<i;++r){s[e[a=4*r]]++,s[e[a+1]]++,s[e[a+2]]++;var o=e[a+3];o!==n.A.TRI_INDEX&&s[o]++}var l=this.getVerticesRingFaceStartCount(),u=0;for(r=0;r<t;++r){var c=s[r];l[2*r]=u,l[2*r+1]=c,u+=c}var h=new Uint32Array(n.A.getMemory(4*i*6),0,6*i);for(u=0,r=0;r<i;++r){var d=e[a=4*r],p=e[a+1],_=e[a+2],f=e[a+3];h[l[2*d]+--s[d]]=r,h[l[2*p]+--s[p]]=r,h[l[2*_]+--s[_]]=r,f!==n.A.TRI_INDEX&&(h[l[2*f]+--s[f]]=r,++u)}this._meshData._vertRingFace=new Uint32Array(h.subarray(0,3*i+u))}},{key:"updateVerticesNormal",value:function(e){for(var t=this.getVerticesRingFaceStartCount(),i=this.getVerticesRingFace(),r=i instanceof Array?i:null,n=this.getNormals(),a=this.getFaceNormals(),s=void 0===e,o=s?this.getNbVertices():e.length,l=0;l<o;++l){var u,c,h=s?l:e[l];r?(u=0,c=(i=r[h]).length):c=(u=t[2*h])+t[2*h+1];for(var d=0,p=0,_=0,f=u;f<c;++f){var g=3*i[f];d+=a[g],p+=a[g+1],_+=a[g+2]}var m=c-u;0!==m&&(m=1/m),n[h*=3]=d*m,n[h+1]=p*m,n[h+2]=_*m}}},{key:"initVertexRings",value:function(){for(var e=this.getVerticesRingVertStartCount(),t=this._meshData._vertRingVert=new Uint32Array(2*this.getNbEdges()),i=this.getVerticesRingFaceStartCount(),r=this.getVerticesRingFace(),a=this.getVerticesTagFlags(),s=this.getVerticesOnEdge(),o=this.getFaces(),l=0,u=0,c=this.getNbVertices();u<c;++u){for(var h=++n.A.TAG_FLAG,d=i[2*u],p=d+i[2*u+1],_=0,f=d;f<p;++f){var g=4*r[f],m=o[g],v=o[g+1],y=o[g+2],b=o[g+3];m===u?m=b!==n.A.TRI_INDEX?b:y:v===u||b===u?v=y:y===u&&b!==n.A.TRI_INDEX&&(m=b),a[m]!==h&&(t[l+_++]=m,a[m]=h),a[v]!==h&&(t[l+_++]=v,a[v]=h)}e[2*u]=l,e[2*u+1]=_,l+=_,p-d!==_&&(s[u]=1)}}},{key:"expandsVertices",value:function(e,t){var i=++n.A.TAG_FLAG,r=e.length,a=this.getVerticesRingVertStartCount(),s=this.getVerticesRingVert(),o=s instanceof Array?s:null,l=this.getVerticesTagFlags(),u=r,c=this.getNbVertices(),h=new Uint32Array(n.A.getMemory(4*c),0,c);h.set(e);var d=0;for(d=0;d<r;++d)l[h[d]]=i;for(var p=0;t;){for(--t,d=p;d<r;++d){var _,f,g=h[d];o?(_=0,f=(s=o[g]).length):f=(_=a[2*g])+a[2*g+1];for(var m=_;m<f;++m){var v=s[m];l[v]!==i&&(l[v]=i,h[u++]=v)}}p=r,r=u}return new Uint32Array(h.subarray(0,u))}},{key:"getVerticesFromFaces",value:function(e){for(var t=++n.A.TAG_FLAG,i=e.length,r=this.getVerticesTagFlags(),a=this.getFaces(),s=0,o=new Uint32Array(n.A.getMemory(4*e.length*4),0,4*e.length),l=0;l<i;++l){var u=4*e[l],c=a[u],h=a[u+1],d=a[u+2],p=a[u+3];r[c]!==t&&(r[c]=t,o[s++]=c),r[h]!==t&&(r[h]=t,o[s++]=h),r[d]!==t&&(r[d]=t,o[s++]=d),p!==n.A.TRI_INDEX&&r[p]!==t&&(r[p]=t,o[s++]=p)}return new Uint32Array(o.subarray(0,s))}},{key:"updateFacesAabbAndNormal",value:function(e){for(var t=this.getFaceNormals(),i=this.getFaceBoxes(),r=this.getFaceCenters(),a=this.getVertices(),s=this.getFaces(),o=void 0===e,l=o?this.getNbFaces():e.length,u=0;u<l;++u){var c=o?u:e[u],h=3*c,d=4*c,p=6*c,_=3*s[d],f=3*s[d+1],g=3*s[d+2],m=s[d+3],v=m!==n.A.TRI_INDEX;v&&(m*=3);var y=a[_],b=a[_+1],A=a[_+2],T=a[f],M=a[f+1],S=a[f+2],E=a[g],R=a[g+1],k=a[g+2],x=T-y,w=M-b,C=S-A,P=E-y,D=R-b,I=k-A,F=w*I-C*D,L=C*P-x*I,O=x*D-w*P,V=y<T?y<E?y:E:T<E?T:E,N=y>T?y>E?y:E:T>E?T:E,B=b<M?b<R?b:R:M<R?M:R,U=b>M?b>R?b:R:M>R?M:R,G=A<S?A<k?A:k:S<k?S:k,j=A>S?A>k?A:k:S>k?S:k;if(v){var W=a[m],z=a[m+1],X=a[m+2];W<V&&(V=W),W>N&&(N=W),z<B&&(B=z),z>U&&(U=z),X<G&&(G=X),X>j&&(j=X),F+=(w=R-z)*I-(C=k-X)*D,L+=C*P-(x=E-W)*I,O+=x*D-w*P}t[h]=F,t[h+1]=L,t[h+2]=O,i[p]=V,i[p+1]=B,i[p+2]=G,i[p+3]=N,i[p+4]=U,i[p+5]=j,r[h]=.5*(V+N),r[h+1]=.5*(B+U),r[h+2]=.5*(G+j)}}},{key:"expandsFaces",value:function(e,t){var i=++n.A.TAG_FLAG,r=e.length,a=this.getVerticesRingFaceStartCount(),s=this.getVerticesRingFace(),o=s instanceof Array?s:null,l=this.getFacesTagFlags(),u=this.getFaces(),c=r,h=new Uint32Array(n.A.getMemory(4*this.getNbFaces()),0,this.getNbFaces());h.set(e);var d=0;for(d=0;d<r;++d)l[h[d]]=i;for(var p=0;t;){for(--t,d=p;d<r;++d)for(var _=4*h[d],f=0;f<4;++f){var g=u[_+f];if(g!==n.A.TRI_INDEX){var m,v;o?(m=0,v=(s=o[g]).length):v=(m=a[2*g])+a[2*g+1];for(var y=m;y<v;++y){var b=s[y];l[b]!==i&&(l[b]=i,h[c++]=b)}}}p=r,r=c}return new Uint32Array(h.subarray(0,c))}},{key:"getFacesFromVertices",value:function(e){for(var t=++n.A.TAG_FLAG,i=e.length,r=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),s=a instanceof Array?a:null,o=this.getFacesTagFlags(),l=0,u=new Uint32Array(n.A.getMemory(4*this.getNbFaces()),0,this.getNbFaces()),c=0;c<i;++c){var h,d,p=e[c];s?(h=0,d=(a=s[p]).length):d=(h=r[2*p])+r[2*p+1];for(var _=h;_<d;++_){var f=a[_];o[f]!==t&&(o[f]=t,u[l++]=f)}}return new Uint32Array(u.subarray(0,l))}},{key:"initRenderTriangles",value:function(){this.hasUV()&&(this._meshData._UVtrianglesABC=this.computeTrianglesFromFaces(this.getFacesTexCoord())),this._meshData._trianglesABC=this.computeTrianglesFromFaces(this.getFaces())}},{key:"computeTrianglesFromFaces",value:function(e){for(var t=this.getNbFaces(),i=this.getFacesToTriangles(),r=new Uint32Array(n.A.getMemory(4*t*6),0,6*t),a=0,s=0;s<t;++s){i[s]=a;var o=4*s,l=e[o],u=e[o+1],c=e[o+2],h=e[o+3],d=3*a;r[d]=l,r[d+1]=u,r[d+2]=c,++a,h!==n.A.TRI_INDEX&&(r[d=3*a]=l,r[d+1]=c,r[d+2]=h,++a)}return new Uint32Array(r.subarray(0,3*a))}},{key:"initEdges",value:function(){for(var e=this.getFaces(),t=this.getFaceEdges(),i=0,r=new Uint32Array(this.getNbVertices()),a=this.getVerticesRingFaceStartCount(),s=this.getVerticesRingFace(),o=0,l=this.getNbVertices();o<l;++o)for(var u=a[2*o],c=u+a[2*o+1],h=i,d=u;d<c;++d){var p=4*s[d],_=e[p],f=e[p+1],g=e[p+2],m=e[p+3],v=0,y=0;m===n.A.TRI_INDEX?(o>_&&(y=p+(o===f?0:2),(v=r[_])<=h?(t[y]=i,r[_]=++i):t[y]=v-1),o>f&&(y=p+(o===_?0:1),(v=r[f])<=h?(t[y]=i,r[f]=++i):t[y]=v-1),o>g&&(y=p+(o===_?2:1),(v=r[g])<=h?(t[y]=i,r[g]=++i):t[y]=v-1),t[p+3]=n.A.TRI_INDEX):(o>_&&o!==g&&(y=p+(o===f?0:3),(v=r[_])<=h?(t[y]=i,r[_]=++i):t[y]=v-1),o>f&&o!==m&&(y=p+(o===_?0:1),(v=r[f])<=h?(t[y]=i,r[f]=++i):t[y]=v-1),o>g&&o!==_&&(y=p+(o===f?1:2),(v=r[g])<=h?(t[y]=i,r[g]=++i):t[y]=v-1),o>m&&o!==f&&(y=p+(o===_?3:2),(v=r[m])<=h?(t[y]=i,r[m]=++i):t[y]=v-1))}for(var b=this._meshData._edges=new Uint8ClampedArray(i),A=0,T=this.getNbFaces();A<T;++A){var M=4*A;b[t[M]]++,b[t[M+1]]++,b[t[M+2]]++;var S=t[M+3];S!==n.A.TRI_INDEX&&b[S]++}}},{key:"getWireframe",value:function(){var e,t=this.getNbEdges(),i=this.isUsingDrawArrays();if(i){if(this._meshData._drawArraysWireframe&&this._meshData._drawArraysWireframe.length===2*t)return this._meshData._drawArraysWireframe;e=this._meshData._drawArraysWireframe=new Uint32Array(2*t)}else{if(this._meshData._drawElementsWireframe&&this._meshData._drawElementsWireframe.length===2*t)return this._meshData._drawElementsWireframe;e=this._meshData._drawElementsWireframe=new Uint32Array(2*t)}for(var r=this.getFaces(),a=this.getFaceEdges(),s=this.getNbFaces(),o=this.getFacesToTriangles(),l=0,u=new Uint8Array(t),c=0;c<s;++c){var h,d,p,_=4*c,f=r[_+3],g=f!==n.A.TRI_INDEX;if(i){var m=3*o[c];h=m,d=m+1,p=m+2,g&&(f=m+5)}else h=r[_],d=r[_+1],p=r[_+2];var v=a[_],y=a[_+1],b=a[_+2],A=a[_+3];0===u[v]&&(u[v]=1,e[2*l]=h,e[2*l+1]=d,l++),0===u[y]&&(u[y]=1,e[2*l]=d,e[2*l+1]=p,l++),0===u[b]&&(u[b]=1,e[2*l]=p,e[2*l+1]=g?f:h,l++),g&&0===u[A]&&(u[A]=1,e[2*l]=f,e[2*l+1]=h,l++)}return i?this._meshData._drawArraysWireframe:this._meshData._drawElementsWireframe}},{key:"updateDuplicateGeometry",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getVertices(),i=this.getColors(),r=this.getMaterials(),n=this.getNormals(),a=this.getVerticesDuplicateStartCount(),s=void 0===e,o=s?this.getNbVertices():e.length,l=0;l<o;++l){var u=s?l:e[l],c=a[2*u];if(0!==c)for(var h=c+a[2*u+1],d=3*u,p=t[d],_=t[d+1],f=t[d+2],g=n[d],m=n[d+1],v=n[d+2],y=i[d],b=i[d+1],A=i[d+2],T=r[d],M=r[d+1],S=r[d+2],E=c;E<h;++E){var R=3*E;t[R]=p,t[R+1]=_,t[R+2]=f,n[R]=g,n[R+1]=m,n[R+2]=v,i[R]=y,i[R+1]=b,i[R+2]=A,r[R]=T,r[R+1]=M,r[R+2]=S}}}},{key:"updateDuplicateColorsAndMaterials",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getColors(),i=this.getMaterials(),r=this.getVerticesDuplicateStartCount(),n=void 0===e,a=n?this.getNbVertices():e.length,s=0;s<a;++s){var o=n?s:e[s],l=r[2*o];if(0!==l)for(var u=l+r[2*o+1],c=3*o,h=t[c],d=t[c+1],p=t[c+2],_=i[c],f=i[c+1],g=i[c+2],m=l;m<u;++m){var v=3*m;t[v]=h,t[v+1]=d,t[v+2]=p,i[v]=_,i[v+1]=f,i[v+2]=g}}}},{key:"initTexCoordsDataFromOBJData",value:function(e,t){var i=this.getFaces(),r=i.length;if(r===t.length){var a=e.length/2,s=this.getNbVertices(),o=0,l=0,u=0,c=0;for(o=0;o<r;++o)t[o]>=a&&(t[o]=i[o]);var h=new Int32Array(s),d=new Float32Array(n.A.getMemory(4*s*2),0,2*s),p=[],_=0,f=0;for(o=0;o<r;++o)if((u=i[o])!==n.A.TRI_INDEX){var g=t[o];if((c=h[u])!==g+1)if(0!==c)if(c>0)h[u]=--_,p.push([g]),++f;else{var m=p[-c-1],v=m.length;for(l=0;l<v&&m[l]!==g;++l);l===v&&(++f,m.push(g))}else h[u]=g+1,d[2*u]=e[2*g],d[2*u+1]=e[2*g+1]}var y=new Float32Array(2*(s+f));y.set(d);var b=this._meshData._duplicateStartCount=new Uint32Array(2*s);for(_=0,o=0;o<s;++o)if(!((c=h[o])>=0)){var A=p[-c-1],T=A.length,M=s+_;for(b[2*o]=M,b[2*o+1]=T,_+=T,l=0;l<T;++l){var S=2*A[l],E=2*(M+l);y[E]=e[S],y[E+1]=e[S+1]}}var R=new Uint32Array(i);for(r=i.length,o=0;o<r;++o)if((u=R[o])!==n.A.TRI_INDEX&&!((c=h[u])>0)){var k=t[o],x=p[-c-1],w=x.length;for(l=0;l<w;++l)if(k===x[l]){R[o]=b[2*u]+l;break}}this.setTexCoords(y),this.setFacesTexCoord(R)}}},{key:"setAlreadyDrawArrays",value:function(){this._meshData._DAverticesXYZ=this.getVertices(),this._meshData._DAnormalsXYZ=this.getNormals(),this._meshData._DAcolorsRGB=this.getColors(),this._meshData._DAmaterialsPBR=this.getMaterials()}},{key:"updateDrawArrays",value:function(e){if(this.isUsingDrawArrays()){var t=this.getVertices(),i=this.getNormals(),r=this.getColors(),a=this.getMaterials(),s=this.getFaces(),o=this.getNbTriangles(),l=this.hasOnlyTriangles()?null:this.getFacesToTriangles(),u=void 0===e,c=this._meshData._DAverticesXYZ,h=this._meshData._DAnormalsXYZ,d=this._meshData._DAcolorsRGB,p=this._meshData._DAmaterialsPBR;(!c||c.length<9*o)&&(c=this._meshData._DAverticesXYZ=new Float32Array(9*o),h=this._meshData._DAnormalsXYZ=new Float32Array(9*o),d=this._meshData._DAcolorsRGB=new Float32Array(9*o),p=this._meshData._DAmaterialsPBR=new Float32Array(9*o));for(var _=u?this.getNbFaces():e.length,f=0;f<_;++f){var g=u?f:e[f],m=9*(l?l[g]:g),v=3*s[g*=4],y=3*s[g+1],b=3*s[g+2];c[m]=t[v],c[m+1]=t[v+1],c[m+2]=t[v+2],c[m+3]=t[y],c[m+4]=t[y+1],c[m+5]=t[y+2],c[m+6]=t[b],c[m+7]=t[b+1],c[m+8]=t[b+2],d[m]=r[v],d[m+1]=r[v+1],d[m+2]=r[v+2],d[m+3]=r[y],d[m+4]=r[y+1],d[m+5]=r[y+2],d[m+6]=r[b],d[m+7]=r[b+1],d[m+8]=r[b+2],p[m]=a[v],p[m+1]=a[v+1],p[m+2]=a[v+2],p[m+3]=a[y],p[m+4]=a[y+1],p[m+5]=a[y+2],p[m+6]=a[b],p[m+7]=a[b+1],p[m+8]=a[b+2],h[m]=i[v],h[m+1]=i[v+1],h[m+2]=i[v+2],h[m+3]=i[y],h[m+4]=i[y+1],h[m+5]=i[y+2],h[m+6]=i[b],h[m+7]=i[b+1],h[m+8]=i[b+2];var A=s[g+3];A!==n.A.TRI_INDEX&&(A*=3,c[m+=9]=t[v],c[m+1]=t[v+1],c[m+2]=t[v+2],c[m+3]=t[b],c[m+4]=t[b+1],c[m+5]=t[b+2],c[m+6]=t[A],c[m+7]=t[A+1],c[m+8]=t[A+2],d[m]=r[v],d[m+1]=r[v+1],d[m+2]=r[v+2],d[m+3]=r[b],d[m+4]=r[b+1],d[m+5]=r[b+2],d[m+6]=r[A],d[m+7]=r[A+1],d[m+8]=r[A+2],p[m]=a[v],p[m+1]=a[v+1],p[m+2]=a[v+2],p[m+3]=a[b],p[m+4]=a[b+1],p[m+5]=a[b+2],p[m+6]=a[A],p[m+7]=a[A+1],p[m+8]=a[A+2],h[m]=i[v],h[m+1]=i[v+1],h[m+2]=i[v+2],h[m+3]=i[b],h[m+4]=i[b+1],h[m+5]=i[b+2],h[m+6]=i[A],h[m+7]=i[A+1],h[m+8]=i[A+2])}this.isUsingTexCoords()&&this.updateDrawArraysTexCoord(e)}}},{key:"updateDrawArraysTexCoord",value:function(e){var t=this.getNbTriangles(),i=this.getFacesToTriangles(),r=void 0===e,a=this._meshData._DAtexCoordsST;a&&a.length===6*t||(a=this._meshData._DAtexCoordsST=new Float32Array(6*t));for(var s=this.getTexCoords(),o=this.getFacesTexCoord(),l=r?this.getNbFaces():e.length,u=0;u<l;++u){var c=r?u:e[u],h=6*i[c],d=2*o[c*=4],p=2*o[c+1],_=2*o[c+2];a[h]=s[d],a[h+1]=s[d+1],a[h+2]=s[p],a[h+3]=s[p+1],a[h+4]=s[_],a[h+5]=s[_+1];var f=o[c+3];f!==n.A.TRI_INDEX&&(f*=3,a[h+=6]=s[d],a[h+1]=s[d+1],a[h+2]=s[_],a[h+3]=s[_+1],a[h+4]=s[f],a[h+5]=s[f+1])}}},{key:"updateCenter",value:function(){var t=this.getLocalBound();e.hZ(this._transformData._center,.5*(t[0]+t[3]),.5*(t[1]+t[4]),.5*(t[2]+t[5]))}},{key:"updateMatrices",value:function(e){h(this._transformData._lastComputedEN,this._transformData._editMatrix),a.lK(this._transformData._lastComputedMV,e.getView(),this._transformData._matrix),h(this._transformData._lastComputedN,this._transformData._lastComputedMV),a.lK(this._transformData._lastComputedMVP,e.getProjection(),this._transformData._lastComputedMV);var t=this._transformData._center,i=this._transformData._lastComputedMVP;this._transformData._lastComputedDepth=i[2]*t[0]+i[6]*t[1]+i[10]*t[2]+i[14]}},{key:"computeLocalRadius",value:function(){var t=this.getLocalBound();return.5*e.xg([t[0],t[1],t[2]],[t[3],t[4],t[5]])}},{key:"normalizeSize",value:function(){var e=n.A.SCALE/(2*this.computeLocalRadius());a.hs(this._transformData._matrix,this._transformData._matrix,[e,e,e])}},{key:"computeWorldBound",value:function(){var e=this._meshData._worldBound,t=this.getLocalBound(),i=this.getMatrix();e[0]=e[3]=i[12],e[1]=e[4]=i[13],e[2]=e[5]=i[14];for(var r=0;r<3;++r)for(var n=4*r,a=t[r],s=t[r+3],o=0;o<3;++o){var l=i[n+o],u=l*s,c=l*a;u<c?(e[o]+=u,e[o+3]+=c):(e[o]+=c,e[o+3]+=u)}return e}},{key:"intersectRay",value:function(e,t,i){var r=this.getNbFaces(),a=new Uint32Array(n.A.getMemory(4*r),0,r);return this._meshData._octree.collectIntersectRay(e,t,a,i?this._meshData._leavesToUpdate:void 0)}},{key:"intersectSphere",value:function(e,t,i){var r=this.getNbFaces(),a=new Uint32Array(n.A.getMemory(4*r),0,r);return this._meshData._octree.collectIntersectSphere(e,t,a,i?this._meshData._leavesToUpdate:void 0)}},{key:"updateOctree",value:function(e){e?this.updateOctreeAdd(this.updateOctreeRemove(e)):this.computeOctree()}},{key:"computeAabb",value:function(){for(var e=this.getNbVertices(),t=this.getVertices(),i=1/0,r=1/0,n=1/0,a=-1/0,s=-1/0,o=-1/0,l=0;l<e;++l){var u=3*l,c=t[u],h=t[u+1],d=t[u+2];c<i&&(i=c),c>a&&(a=c),h<r&&(r=h),h>s&&(s=h),d<n&&(n=d),d>o&&(o=d)}return[i,r,n,a,s,o]}},{key:"computeOctree",value:function(){var e=this.computeAabb(),t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=n-t,l=a-i,u=s-r,c=.2*Math.sqrt(o*o+l*l+u*u),h=1e-16;n-t<h&&(t-=c,n+=c),a-i<h&&(i-=c,a+=c),s-r<h&&(r-=c,s+=c);var d=.3*o,p=.3*l,_=.3*u,f=t-d,g=n+d,m=i-p,v=a+p,y=r-_,b=s+_,A=this._meshData._octree=new Bt;A.resetNbFaces(this.getNbFaces()),A.setAabbLoose(t,i,r,n,a,s),A.setAabbSplit(f,m,y,g,v,b),A.build(this)}},{key:"updateOctreeRemove",value:function(e){for(var t=this.getFaceCenters(),i=this.getFaceBoxes(),r=this._meshData._facePosInLeaf,a=this._meshData._faceLeaf,s=e.length,o=0,l=new Uint32Array(n.A.getMemory(4*s),0,s),u=0;u<s;++u){var c=e[u],h=6*c,d=3*c,p=a[c],_=p._aabbSplit,f=t[d],g=t[d+1],m=t[d+2];if(f<=_[0]||g<=_[1]||m<=_[2]||f>_[3]||g>_[4]||m>_[5]){l[o++]=e[u];var v=p._iFaces;if(v.length>0){var y=v[v.length-1],b=r[c];v[b]=y,r[y]=b,v.pop()}}else p.expandsAabbLoose(i[h],i[h+1],i[h+2],i[h+3],i[h+4],i[h+5])}return new Uint32Array(l.subarray(0,o))}},{key:"updateOctreeAdd",value:function(e){for(var t=this.getFaceCenters(),i=this.getFaceBoxes(),r=this._meshData._facePosInLeaf,n=this._meshData._faceLeaf,a=e.length,s=this._meshData._octree,o=s._aabbSplit,l=o[0],u=o[1],c=o[2],h=o[3],d=o[4],p=o[5],_=0;_<a;++_){var f=e[_],g=6*f,m=i[g],v=i[g+1],y=i[g+2],b=i[g+3],A=i[g+4],T=i[g+5];if(m>h||b<l||v>d||A<u||y>p||T<c){this.computeOctree(),this._meshData._leavesToUpdate.length=0;break}var M=3*f,S=s.addFace(f,m,v,y,b,A,T,t[M],t[M+1],t[M+2]);if(S)r[f]=S._iFaces.length-1,n[f]=S;else{var E=n[f]._iFaces;r[f]=E.length,E.push(e[_])}}}},{key:"balanceOctree",value:function(){++Bt.FLAG;for(var e=this._meshData._leavesToUpdate,t=e.length,i=0;i<t;++i){var r=e[i];r._flag!==Bt.FLAG&&(0===r._iFaces.length?r.pruneIfPossible():r._iFaces.length>Bt.MAX_FACES&&r._depth<Bt.MAX_DEPTH&&r.build(this),r._flag=Bt.FLAG)}e.length=0}},{key:"setFlatColor",value:function(e){this.getFlatColor().set(e)}},{key:"setAlbedo",value:function(e){this.getAlbedo().set(e)}},{key:"setMode",value:function(e){this._renderData._mode=e}},{key:"setRoughness",value:function(e){this._renderData._roughness=e}},{key:"setMetallic",value:function(e){this._renderData._metallic=e}},{key:"setOpacity",value:function(e){this._renderData._alpha=e}},{key:"setTexture0",value:function(e){this._renderData._texture0=e}},{key:"setMatcap",value:function(e){this._renderData._matcap=e}},{key:"setCurvature",value:function(e){this._renderData._curvature=e}},{key:"setFlatShading",value:function(e){this._renderData._flatShading=e}},{key:"setShowWireframe",value:function(e){this._renderData._showWireframe=!Gt.ONLY_DRAW_ARRAYS&&e,this.updateWireframeBuffer()}},{key:"setUseDrawArrays",value:function(e){this._renderData._useDrawArrays=e}},{key:"getGL",value:function(){return this._renderData._gl}},{key:"getCount",value:function(){var e=this.getGL();return this.getMode()===e.TRIANGLES?3*this.getNbTriangles():this.getMode()===e.LINES?this.getNbVertices():0}},{key:"getVertexBuffer",value:function(){return this._renderData._vertexBuffer}},{key:"getNormalBuffer",value:function(){return this._renderData._normalBuffer}},{key:"getColorBuffer",value:function(){return this._renderData._colorBuffer}},{key:"getMaterialBuffer",value:function(){return this._renderData._materialBuffer}},{key:"getTexCoordBuffer",value:function(){return this._renderData._texCoordBuffer}},{key:"getIndexBuffer",value:function(){return this._renderData._indexBuffer}},{key:"getWireframeBuffer",value:function(){return this._renderData._wireframeBuffer}},{key:"getRoughness",value:function(){return this._renderData._roughness}},{key:"getMetallic",value:function(){return this._renderData._metallic}},{key:"getOpacity",value:function(){return this._renderData._alpha}},{key:"getFlatColor",value:function(){return this._renderData._flatColor}},{key:"getMode",value:function(){return this._renderData._mode}},{key:"getAlbedo",value:function(){return this._renderData._albedo}},{key:"getTexture0",value:function(){return this._renderData._texture0}},{key:"getMatcap",value:function(){return this._renderData._matcap}},{key:"getCurvature",value:function(){return this._renderData._curvature}},{key:"getFlatShading",value:function(){return this._renderData._flatShading}},{key:"getShowWireframe",value:function(){return this._renderData._showWireframe}},{key:"isUsingDrawArrays",value:function(){return this._renderData._useDrawArrays||Gt.ONLY_DRAW_ARRAYS}},{key:"isUsingTexCoords",value:function(){var e=this._renderData._shaderType;return e===r.A.Shader.UV||e===r.A.Shader.PAINTUV}},{key:"isTransparent",value:function(){return this._renderData._alpha<.99}},{key:"getShaderType",value:function(){return this._renderData._shaderType}},{key:"setShaderType",value:function(e){var t=this.hasUV();if(e===r.A.Shader.UV&&!t){if(this._renderData._shaderType!==r.A.Shader.UV)return;e=r.A.Shader.MATCAP}this._renderData._shaderType=e,t&&(this.updateDuplicateGeometry(),this.updateDrawArrays()),this.updateBuffers()}},{key:"initRender",value:function(){this.setShaderType(this._renderData._shaderType),this.setShowWireframe(this.getShowWireframe())}},{key:"render",value:function(e){this.isVisible()&&te[this.getShaderType()].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderWireframe",value:function(e){this.isVisible()&&te[r.A.Shader.WIREFRAME].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderFlatColor",value:function(e){this.isVisible()&&te[r.A.Shader.FLAT].getOrCreate(this.getGL()).draw(this,e)}},{key:"getRenderNbVertices",value:function(){return this.isUsingDrawArrays()?this.getCount():this.isUsingTexCoords()?this.getNbTexCoords():this.getNbVertices()}},{key:"updateVertexBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.getVertices();this.getVertexBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateNormalBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.getNormals();this.getNormalBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateColorBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getColorsDrawArrays():this.getColors();this.getColorBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateMaterialBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.getMaterials();this.getMaterialBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateTexCoordBuffer",value:function(){if(this.isUsingTexCoords()){var e=this.isUsingDrawArrays()?this.getTexCoordsDrawArrays():this.getTexCoords();this.getTexCoordBuffer().update(e,2*this.getRenderNbVertices())}}},{key:"updateIndexBuffer",value:function(){if(!this.isUsingDrawArrays()){var e=this.isUsingTexCoords()?this.getTrianglesTexCoord():this.getTriangles();this.getIndexBuffer().update(e,3*this.getNbTriangles())}}},{key:"updateWireframeBuffer",value:function(){this.getShowWireframe()&&this.getWireframeBuffer().update(this.getWireframe(),2*this.getNbEdges())}},{key:"updateGeometryBuffers",value:function(){this.updateVertexBuffer(),this.updateNormalBuffer()}},{key:"updateBuffers",value:function(){this.updateGeometryBuffers(),this.updateColorBuffer(),this.updateMaterialBuffer(),this.updateTexCoordBuffer(),this.updateIndexBuffer(),this.updateWireframeBuffer()}},{key:"release",value:function(){this.getTexture0()&&this.getGL().deleteTexture(this.getTexture0()),this.getVertexBuffer().release(),this.getNormalBuffer().release(),this.getColorBuffer().release(),this.getMaterialBuffer().release(),this.getIndexBuffer().release(),this.getWireframeBuffer().release()}},{key:"copyRenderConfig",value:function(e){this.setFlatShading(e.getFlatShading()),this.setShowWireframe(e.getShowWireframe()),this.setShaderType(e.getShaderType()),this.setMatcap(e.getMatcap()),this.setTexture0(e.getTexture0()),this.setCurvature(e.getCurvature()),this.setOpacity(e.getOpacity())}},{key:"copyTransformData",value:function(t){e.C(this.getCenter(),t.getCenter()),a.C(this.getMatrix(),t.getMatrix()),a.C(this.getEditMatrix(),t.getEditMatrix()),e.C(this.getSymmetryNormal(),t.getSymmetryNormal())}},{key:"copyData",value:function(e){this.setVertices(e.getVertices().slice()),this.setFaces(e.getFaces().slice()),this.setColors(e.getColors().slice()),this.setMaterials(e.getMaterials().slice()),e.hasUV()&&this.initTexCoordsDataFromOBJData(e.getTexCoords(),e.getFacesTexCoord()),this.init(),this.initRender(),this.copyTransformData(e),this.copyRenderConfig(e)}},{key:"optimize",value:function(){0!==this.getNbFaces()&&t.OPTIMIZE&&(this.optimizePostTransform(),this.optimizePreTransform(),this.initFaceRings())}},{key:"computeCacheScore",value:function(){var e=this.getFaces(),t=this.getNbFaces(),i=[];i.length=32;for(var r=0,a=0,s=0;s<t;++s)for(var o=3*s,l=e[o+3]!==n.A.TRI_INDEX?4:3,u=0;u<l;++u){var c=e[o+u];for(a=0;a<32;++a){if(void 0===i[a]){i[a]=c,r++;break}if(i[a]===c)break}32===a&&(r++,i.shift(),i.push(c))}return{ACMR:r/t,ACTVR:r/this.getNbVertices()}}},{key:"optimizePostTransform",value:function(){var e=0,t=this.hasUV(),i=this.getFaces(),r=t?this.getFacesTexCoord():i,a=this.getNbFaces(),s=this.getNbVertices(),o=t?this.getNbTexCoords():s,l=this.getVerticesDuplicateStartCount(),u=new Uint32Array(o-s);if(t)for(e=0;e<o;++e)for(var c=l[2*e],h=c+l[2*e+1],d=c;d<h;++d)u[d-s]=e;var p=this.getVerticesRingFaceStartCount(),_=this.getVerticesRingFace(),f=new Int32Array(o);for(e=0;e<s;++e)f[e]=p[2*e+1];for(e=s;e<o;++e)f[e]=p[2*u[e-s]+1];for(var g=new Uint32Array(o),m=33,v=0,y=new Uint32Array(n.A.getMemory(4*a*4),0,4*a),b=0,A=new Uint8Array(a),T=new Uint32Array(4*a),M=t?new Uint32Array(4*a):T,S=0,E=0;E>=0;){var R=[],k=E>=s?u[E-s]:E,x=p[2*k],w=x+p[2*k+1];for(e=x;e<w;++e){var C=_[e];if(!A[C]){A[C]=1;var P=4*C,D=y[b++]=T[S++]=r[P],I=y[b++]=T[S++]=r[P+1],F=y[b++]=T[S++]=r[P+2],L=T[S++]=r[P+3],O=L!==n.A.TRI_INDEX;t&&(M[S-4]=i[P],M[S-3]=i[P+1],M[S-2]=i[P+2],M[S-1]=i[P+3]),R.push(D,I,F),--f[D],--f[I],--f[F],m-g[D]>32&&(g[D]=m++),m-g[I]>32&&(g[I]=m++),m-g[F]>32&&(g[F]=m++),O&&(y[b++]=L,R.push(L),--f[L],m-g[L]>32&&(g[L]=m++))}}E=-1;var V=-1,N=R.length;for(e=0;e<N;++e){var B=R[e],U=f[B];if(!(U<=0)){var G=0,j=m-g[B];j+2*U<=32&&(G=j),G>V&&(V=G,E=B)}}if(-1===E){for(;b>0;){var W=y[--b];if(f[W]>0){E=W;break}}if(-1===E)for(;v<o;)if(f[v++]>0){E=v-1;break}}}r.set(T.subarray(0,4*a)),t&&i.set(M.subarray(0,4*a))}},{key:"optimizePreTransform",value:function(){var e=this.getVertices(),t=this.getColors(),i=this.getMaterials(),r=this.getNbVertices(),a=this.getFaces(),s=4*this.getNbFaces(),o=new Float32Array(3*r),l=new Float32Array(3*r),u=new Float32Array(3*r),c=new Uint32Array(r),h=0,d=0;for(d=0;d<s;++d){var p=a[d];if(p!==n.A.TRI_INDEX){var _=c[p]-1;if(-1===_){var f=3*h,g=3*p;o[f]=e[g],o[f+1]=e[g+1],o[f+2]=e[g+2],l[f]=t[g],l[f+1]=t[g+1],l[f+2]=t[g+2],u[f]=i[g],u[f+1]=i[g+1],u[f+2]=i[g+2],_=h++,c[p]=_+1}a[d]=_}}var m=r-h;if(m>0&&this.setNbVertices(h),this.hasUV()){var v=this.getFacesTexCoord();for(d=0;d<s;++d){var y=v[d];y<r?v[d]=c[y]-1:y!==n.A.TRI_INDEX&&(v[d]-=m)}var b=this.getNbTexCoords(),A=this.getNbTexCoords()-m,T=this.getTexCoords(),M=new Float32Array(2*A),S=new Uint32Array(2*h),E=this.getVerticesDuplicateStartCount();for(d=0;d<r;++d){var R=2*d,k=E[R],x=2*(c[d]-1);x<0||(k>0&&(S[x]=k-m,S[x+1]=E[R+1]),M[x]=T[R],M[x+1]=T[R+1])}for(d=r;d<b;++d){var w=2*d,C=2*(d-m);M[C]=T[w],M[C+1]=T[w+1]}this.setVerticesDuplicateStartCount(S),this.setTexCoords(M)}e.set(o),t.set(l),i.set(u)}}],o=[{key:"sortFunction",value:function(e,t){var i=e.isTransparent(),r=t.isTransparent();return i&&!r?1:!i&&r?-1:(t.getDepth()-e.getDepth())*(i&&r?1:-1)}}],s&&jt(i.prototype,s),o&&jt(i,o),t}();Wt.OPTIMIZE=!0,Wt.ID=0;const zt=Wt,Xt=function(){return{_center:e.vt(),_matrix:a.vt(),_editMatrix:a.vt(),_yawPitchRoll:e.vt(),_symmetryNormal:[1,0,0],_symmetryOffset:0,_lastComputedMV:a.vt(),_lastComputedMVP:a.vt(),_lastComputedN:l(),_lastComputedEN:l(),_lastComputedDepth:0,_lastWorldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}},Kt=function(){return{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}};function Yt(e){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(e)}function Ht(e,t){return Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ht(e,t)}function qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zt(e){return Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Zt(e)}const Qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(n,e);var t,i,r=(t=n,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=Zt(t);if(i){var n=Zt(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return function(e,t){return!t||"object"!==Yt(t)&&"function"!=typeof t?qt(e):t}(this,e)});function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=r.call(this))._id=zt.ID++,e&&(t._renderData=new Gt(e,qt(t))),t._meshData=new Kt,t._transformData=new Xt,t}return n}(zt);function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function $t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ei(e,t){return ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ei(e,t)}function ti(e){return ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ti(e)}var ii=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ei(e,t)}(u,t);var i,r,a,s,o=(a=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ti(a);if(s){var i=ti(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=o.call(this,e))._radius=50,t._hardness=.25,t._intensity=1,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t._thickness=1,t}return i=u,r=[{key:"pushState",value:function(){this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateMaterialBuffer()}},{key:"stroke",value:function(e){Ct.prototype.stroke.call(this,e)}},{key:"dynamicTopology",value:function(e){return e.getPickedVertices()}},{key:"paint",value:function(e,t,i,r,n,a){for(var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=Math.sqrt(i),c=t[0],h=t[1],d=t[2],p=2*(1-n),_=this._negative?-r:r,f=0,g=e.length;f<g;++f){var m=3*e[f],v=o[m],y=o[m+1],b=o[m+2],A=v-c,T=y-h,M=b-d,S=Math.sqrt(A*A+T*T+M*M)/u;S>1&&(S=1);var E=Math.pow(1-S,p);E*=_*a.getAlpha(v,y,b),l[m+2]=Math.min(Math.max(l[m+2]+E,0),1)}}},{key:"updateAndRenderMask",value:function(){var e=this.getMesh();e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}},{key:"blur",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){t=e.expandsVertices(t,1),this.pushState(),this._main.getStateManager().pushVertices(t);var i=e.getMaterials(),r=t.length,n=new Float32Array(3*r);this.laplacianSmooth(t,n,i);for(var a=0;a<r;++a)i[3*t[a]+2]=n[3*a+2];this.updateAndRenderMask()}}},{key:"sharpen",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var i=e.getMaterials(),r=t.length,n=0;n<r;++n){var a=3*t[n]+2,s=i[a];i[a]=s>.5?Math.min(s+.1,1):Math.max(s-1,0)}this.updateAndRenderMask()}}},{key:"clear",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var i=e.getMaterials(),r=0,n=t.length;r<n;++r)i[3*t[r]+2]=1;this.updateAndRenderMask()}}},{key:"invert",value:function(e,t){var i=t;i||(i=this.getMesh()),e||this._main.getStateManager().pushStateCustom(this.invert.bind(this,!0,i));for(var r=i.getMaterials(),n=0,a=i.getNbVertices();n<a;++n)r[3*n+2]=1-r[3*n+2];this.updateAndRenderMask()}},{key:"remapAndMirrorIndices",value:function(e,t,i){var r=this.getMesh().getNbVertices(),a=new Uint32Array(n.A.getMemory(4*r),0,r),s=0,o=0,l=i.length;for(s=0;s<l;++s)a[i[s]]=s;var u=2*t;for(s=0;s<u;++s){var c=s<t?0:l;e[o=4*s]=a[e[o]]+c,e[o+1]=a[e[o+1]]+c,e[o+2]=a[e[o+2]]+c;var h=e[o+3];h!==n.A.TRI_INDEX&&(e[o+3]=a[h]+c)}var d=e.length/4;for(s=u;s<d;++s)e[o=4*s]=a[e[o]],e[o+1]=a[e[o+1]],e[o+2]=a[e[o+2]]+l,e[o+3]=a[e[o+3]]+l}},{key:"invertFaces",value:function(e){for(var t=0,i=e.length/4;t<i;++t){var r=4*t,n=e[r];e[r]=e[r+2],e[r+2]=n}}},{key:"extractFaces",value:function(e,t,i){for(var r=this.getMesh(),a=r.getFaces(),s=r.getMaterials(),o=r.getVerticesOnEdge(),l=0===this._thickness,u=e.length,c=new Uint32Array(n.A.getMemory(4*u*4*3),0,4*u*3),h=l?u:2*u,d=0;d<u;++d){var p=4*d,_=4*e[d],f=c[p]=a[_],g=c[p+1]=a[_+1],m=c[p+2]=a[_+2],v=c[p+3]=a[_+3];if(!l){var y=v!==n.A.TRI_INDEX,b=s[3*f+2]>=i||o[f]>=1,A=s[3*g+2]>=i||o[g]>=1,T=s[3*m+2]>=i||o[m]>=1,M=!!y&&(s[3*v+2]>=i||o[v]>=1);c[p+=4*u]=m,c[p+1]=g,c[p+2]=f,c[p+3]=v,A&&(b&&(c[p=4*h++]=c[p+3]=g,c[p+1]=c[p+2]=f),T&&(c[p=4*h++]=c[p+3]=m,c[p+1]=c[p+2]=g)),y?M&&(b&&(c[p=4*h++]=c[p+3]=f,c[p+1]=c[p+2]=v),T&&(c[p=4*h++]=c[p+3]=v,c[p+1]=c[p+2]=m)):b&&T&&(c[p=4*h++]=c[p+3]=f,c[p+1]=c[p+2]=m)}}var S=new Uint32Array(c.subarray(0,4*h));return this.remapAndMirrorIndices(S,u,t),this._thickness>0&&this.invertFaces(S),S}},{key:"extractVertices",value:function(t){var i=this.getMesh(),r=i.getVertices(),n=i.getNormals(),a=i.getMatrix(),s=h(l(),a),o=t.length,u=new Float32Array(2*o*3),c=[0,0,0],d=[0,0,0],p=3*o,_=this._thickness,f=.01;_<0&&(f=-f);for(var g=0;g<o;++g){var m=3*g,v=3*t[g];c[0]=r[v],c[1]=r[v+1],c[2]=r[v+2],d[0]=n[v],d[1]=n[v+1],d[2]=n[v+2],e.ei(d,d,s),e.S8(d,d),e.Z0(c,c,a),e.Ln(c,c,d,f),u[m]=c[0],u[m+1]=c[1],u[m+2]=c[2],e.Ln(c,c,d,_),u[m+=p]=c[0],u[m+1]=c[1],u[m+2]=c[2]}return u}},{key:"smoothBorder",value:function(e,t){for(var i=2*t.length,r=new Uint32Array(e.getNbFaces()-i),n=0,a=r.length;n<a;++n)r[n]=i+n;var s=e.expandsVertices(e.getVerticesFromFaces(r),1),o=new at;o.setToolMesh(e),o.smooth(s,1),o.smooth(s,1),o.smooth(s,1)}},{key:"extract",value:function(){var e=this.getMesh(),t=this.filterMaskedVertices(-1/0,.5);if(0!==t.length){var i=e.getFacesFromVertices(t);t=e.getVerticesFromFaces(i);var r=this.extractFaces(i,t,.5),n=this.extractVertices(t),a=new Qt(e.getGL());a.setVertices(n),a.setFaces(r),a.initColorsAndMaterials(),a.allocateArrays(),a.initTopology(),0!==this._thickness&&this.smoothBorder(a,i),a.updateGeometry(),a.updateDuplicateColorsAndMaterials(),a.copyRenderConfig(e),a.initRender();var s=this._main;s.addNewMesh(a),s.setMesh(e)}}}],r&&$t(i.prototype,r),u}(de);const ri=ii;function ni(e){return ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ni(e)}function ai(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function si(e,t){return si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},si(e,t)}function oi(e){return oi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oi(e)}var li=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&si(e,t)}(s,e);var t,i,r,n,a=(r=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=oi(r);if(n){var i=oi(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==ni(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e))._radius=50,t._culling=!1,t._idAlpha=0,t}return t=s,i=[{key:"startSculpt",value:function(){var e=this._main;if(e.getSculptManager().getSymmetry()){var t=e.getPickingSymmetry();t.intersectionMouseMesh(),t.setLocalRadius2(e.getPicking().getLocalRadius2())}}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX-e._lastMouseX,i=e.getPicking(),r=i.getLocalRadius2();if(i.pickVerticesInSphere(r),this.stroke(i,t),e.getSculptManager().getSymmetry()){var n=e.getPickingSymmetry();n.getMesh()&&(n.pickVerticesInSphere(r),this.stroke(n,t))}this.updateRender()}},{key:"stroke",value:function(e,t){var i=e.getPickedVertices();this._main.getStateManager().pushVertices(i),i=this.dynamicTopology(e),this._culling&&(i=this.getFrontVertices(i,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.scale(i,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var r=this.getMesh();r.updateGeometry(r.getFacesFromVertices(i),i)}},{key:"scale",value:function(e,t,i,r,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=.01*r,u=Math.sqrt(i),c=t[0],h=t[1],d=t[2],p=0,_=e.length;p<_;++p){var f=3*e[p],g=s[f],m=s[f+1],v=s[f+2],y=g-c,b=m-h,A=v-d,T=Math.sqrt(y*y+b*b+A*A)/u,M=T*T;M=3*M*M-4*M*T+1,M*=l*o[f+2]*n.getAlpha(g,m,v),s[f]=g+y*M,s[f+1]=m+b*M,s[f+2]=v+A*M}}}],i&&ai(t.prototype,i),s}(de);const ui=li;var ci=function(e,t){this.previous=null,this.next=null,this.v1=e,this.v2=t},hi=function(e){if(!(e.length<=2)){var t=e.length,i=e[0].v1,r=e[0].v2,n=e[0],a=n;e[0]=e[--t];for(var s=0;s<t;){var o=e[s];if(o.v1===r){if(o.previous=a,a.next=o,a=o,r=e[s].v2,e[s]=e[--t],r===i)break;s=0}else s++}if(e.length=t,r===i)return n.previous=a,a.next=n,n}},di=function(e,t,i,r,a,s){var o=e.getVertices(),l=e.getColors(),u=e.getMaterials(),c=e.getNbVertices()+r.length/3,h=t,d=0,p=0,_=0,f=0,g=0,m=0,v=0,y=0,b=0,A=0;do{var T=h.next,M=h.v1,S=h.v2,E=T.v2;i.push(M,S,c,n.A.TRI_INDEX),S*=3,E*=3,A++,d+=o[M*=3],p+=o[M+1],_+=o[M+2],f+=l[M],g+=l[M+1],m+=l[M+2],v+=u[M],y+=u[M+1],b+=u[M+2];var R=o[S],k=o[S+1],x=o[S+2],w=o[M]-R,C=o[M+1]-k,P=o[M+2]-x,D=o[E]-R,I=o[E+1]-k,F=o[E+2]-x,L=w*w+C*C+P*P,O=D*D+I*I+F*F;h.angle=Math.acos((w*D+C*I+P*F)/Math.sqrt(L*O)),h=T}while(h!==t);r.push(d/A,p/A,_/A),a.push(f/A,g/A,m/A),s.push(v/A,y/A,b/A)},pi=function(e,t,i,r,n){var a=new Qt;return a.setID(e.getID()),a.setVertices(t),r&&a.setColors(r),n&&a.setMaterials(n),a.setFaces(i),a.setTransformData(e.getTransformData()),a.setRenderData(e.getRenderData()),zt.OPTIMIZE=!1,a.init(),zt.OPTIMIZE=!0,a},_i={createClosedMesh:function(e){var t=function(e){var t=function(e){for(var t=e.getEdges(),i=e.getFaces(),r=e.getFaceEdges(),a=[],s=0,o=e.getNbFaces();s<o;++s){var l=4*s,u=r[l+3],c=u!==n.A.TRI_INDEX;1===t[r[l]]&&a.push(new ci(i[l],i[l+1])),1===t[r[l+1]]&&a.push(new ci(i[l+1],i[l+2])),1===t[r[l+2]]&&a.push(new ci(i[l+2],i[c?l+3:l])),c&&1===t[u]&&a.push(new ci(i[l+3],i[l]))}for(var h=[];;){var d=hi(a);if(!d)break;h.push(d)}return h}(e);if(0===t.length)return e;for(var i=[],r=[],a=[],s=[],o=0,l=t.length;o<l;++o)di(e,t[o],i,r,a,s);var u=3*e.getNbVertices(),c=u+r.length,h=new Float32Array(c);h.set(e.getVertices().subarray(0,u));var d=new Float32Array(c);d.set(e.getColors().subarray(0,u));var p=new Float32Array(c);p.set(e.getMaterials().subarray(0,u)),c>u&&(h.set(r,u),d.set(a,u),p.set(s,u));var _=new Uint32Array(4*e.getNbFaces()+i.length);return _.set(e.getFaces()),i.length>0&&_.set(i,4*e.getNbFaces()),pi(e,h,_,d,p)}(e);if(t===e){var i=3*e.getNbVertices(),r=4*e.getNbFaces(),a=new Uint32Array(e.getFaces().subarray(0,r)),s=new Float32Array(e.getVertices().subarray(0,i)),o=new Float32Array(e.getColors().subarray(0,i)),l=new Float32Array(e.getMaterials().subarray(0,i));t=pi(e,s,a,o,l)}return t}};const fi=_i;var gi={BLOCK:!1},mi=function(){for(var e=new Uint32Array(24),t=0,i=0;i<8;++i)for(var r=1;r<=4;r<<=1){var n=i^r;i<=n&&(e[t++]=i,e[t++]=n)}return e}(),vi=function(e){for(var t=new Uint32Array(256),i=0;i<256;++i){for(var r=0,n=0;n<24;n+=2)r|=!!(i&1<<e[n])!=!!(i&1<<e[n+1])?1<<(n>>1):0;t[i]=r}return t}(mi),yi=function(e,t,i,r,n,a){for(var s=e.colorField,o=e.materialField,l=e.distanceField,u=0,c=0,h=0,d=0,p=0,_=0,f=0,g=0,m=0,v=i[0],y=i[0]*i[1],b=0;b<2;++b)for(var A=0;A<2;++A)for(var T=0;T<2;++T){var M=r+T+A*v+b*y,S=3*M,E=l[M];t[m]=E,g|=E<0?1<<m:0,m++,E!==1/0&&(f+=E=Math.min(1/Math.abs(E),1e15),u+=s[S]*E,c+=s[S+1]*E,h+=s[S+2]*E,d+=o[S]*E,p+=o[S+1]*E,_+=o[S+2]*E)}return 0!==g&&255!==g&&(f>0&&(f=1/f),n.push(u*f,c*f,h*f),a.push(d*f,p*f,_*f)),g},bi=[0,0,0],Ai=function(e,t,i,r,n){bi[0]=bi[1]=bi[2]=0;for(var a=0,s=0;s<12;++s)if(e&1<<s&&(++a,!gi.BLOCK)){var o=t[s<<1],l=t[1+(s<<1)],u=i[o],c=u-i[l];if(!(Math.abs(c)<1e-7)){c=u/c;for(var h=0,d=1;h<3;++h,d<<=1){var p=o&d;bi[h]+=p!==(l&d)?p?1-c:c:p?1:0}}}for(var _=1/a,f=0;f<3;++f)bi[f]=r[f]+_*bi[f];n.push(bi[0],bi[1],bi[2])},Ti=function(e,t,i,r,n,a,s){for(var o=0;o<3;++o)if(e&1<<o){var l=(o+1)%3,u=(o+2)%3;if(0!==a[l]&&0!==a[u]){var c=r[l],h=r[u];1&t?s.push(i[n],i[n-c],i[n-c-h],i[n-h]):s.push(i[n],i[n-h],i[n-c-h],i[n-c])}}};gi.computeSurface=function(e){var t=e.dims,i=[],r=[],n=[],a=[],s=0,o=new Int32Array(3),l=new Int32Array([1,t[0]+1,(t[0]+1)*(t[1]+1)]),u=new Float32Array(8),c=1,h=new Int32Array(2*l[2]);for(o[2]=0;o[2]<t[2]-1;++o[2],s+=t[0],c^=1,l[2]=-l[2]){var d=1+(t[0]+1)*(1+c*(t[1]+1));for(o[1]=0;o[1]<t[1]-1;++o[1],++s,d+=2)for(o[0]=0;o[0]<t[0]-1;++o[0],++s,++d){var p=yi(e,u,t,s,r,n);if(0!==p&&255!==p){var _=vi[p];h[d]=i.length/3,Ai(_,mi,u,o,i),Ti(_,p,h,l,d,o,a)}}}return{colors:new Float32Array(r),materials:new Float32Array(n),vertices:new Float32Array(i),faces:new Uint32Array(a)}};const Mi=gi;var Si={BLOCK:!1},Ei=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Ri=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],ki=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],xi=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],wi=function(e,t,i,r,n,a){for(var s=e.colorField,o=e.materialField,l=e.distanceField,u=0,c=0,h=0,d=0,p=0,_=0,f=0,g=0,m=i[0],v=i[0]*i[1],y=0;y<8;++y){var b=ki[y],A=r+b[0]+b[1]*m+b[2]*v,T=3*A,M=l[A];t[y]=M,g|=M>0?1<<y:0,M!==1/0&&(f+=M=Math.min(1/Math.abs(M),1e15),u+=s[T]*M,c+=s[T+1]*M,h+=s[T+2]*M,d+=o[T]*M,p+=o[T+1]*M,_+=o[T+2]*M)}return 0!==Ei[g]&&(f>0&&(f=1/f),n[0]=u*f,n[1]=c*f,n[2]=h*f,a[0]=d*f,a[1]=p*f,a[2]=_*f),g};Si.computeSurface=function(e){var t=e.dims,i=new Map,r=[],a=[],s=[],o=[],l=0,u=new Int32Array(3),c=new Float32Array(8),h=new Array(12),d=new Float32Array(3),p=new Float32Array(3),_=new Float32Array(3);for(u[2]=0;u[2]<t[2]-1;++u[2],l+=t[0])for(u[1]=0;u[1]<t[1]-1;++u[1],++l)for(u[0]=0;u[0]<t[0]-1;++u[0],++l){var f=wi(e,c,t,l,p,_),g=Ei[f];if(0!==g){for(var m=0;m<12;++m)if(g&1<<m){var v=xi[m],y=ki[v[0]],b=ki[v[1]],A=c[v[0]],T=A-c[v[1]],M=0;Math.abs(T)>1e-6&&(M=A/T);for(var S=0;S<3;++S)d[S]=u[S]+y[S]+M*(b[S]-y[S]);var E=d[0]+"+"+d[1]+"+"+d[2],R=i.get(E);R>=0?h[m]=R:(h[m]=r.length/3,i.set(E,h[m]),r.push(d[0],d[1],d[2]),a.push(p[0],p[1],p[2]),s.push(_[0],_[1],_[2]))}for(var k=Ri[f],x=0;x<k.length;x+=3)o.push(h[k[x]],h[k[x+1]],h[k[x+2]],n.A.TRI_INDEX)}}return{colors:new Float32Array(a),materials:new Float32Array(s),vertices:new Float32Array(r),faces:new Uint32Array(o)}};const Ci=Si;var Pi={RESOLUTION:150,BLOCK:!1,SMOOTHING:!0},Di=function(e,t){for(var i=t.min,r=t.step,n=t.dims,a=1/r,s=i[0],o=i[1],l=i[2],u=n[0],c=u*n[1],h=t.distanceField,d=t.crossedEdges,p=t.colorField,_=t.materialField,f=e.getTriangles(),g=e.getVertices(),m=e.getColors(),v=e.getMaterials(),y=e.getNbTriangles(),b=[0,0,0],A=[0,0,0],T=[0,0,0],M=[0,0,0],S=[0,0,0],E=[0,0,0],R=[0,0,0,0],k=[[1,0,0],[0,1,0],[0,0,1]],x=1/3,w=0;w<y;++w)for(var C=3*w,P=3*f[C],D=3*f[C+1],I=3*f[C+2],F=b[0]=g[P],L=b[1]=g[P+1],O=b[2]=g[P+2],V=A[0]=g[D],N=A[1]=g[D+1],B=A[2]=g[D+2],U=T[0]=g[I],G=T[1]=g[I+1],j=T[2]=g[I+2],W=(m[P]+m[D]+m[I])*x,z=(m[P+1]+m[D+1]+m[I+1])*x,X=(m[P+2]+m[D+2]+m[I+2])*x,K=(v[P]+v[D]+v[I])*x,Y=(v[P+1]+v[D+1]+v[I+1])*x,H=(v[P+2]+v[D+2]+v[I+2])*x,q=F<V?F<U?F:U:V<U?V:U,Z=F>V?F>U?F:U:V>U?V:U,Q=L<N?L<G?L:G:N<G?N:G,J=L>N?L>G?L:G:N>G?N:G,$=O<B?O<j?O:j:B<j?B:j,ee=O>B?O>j?O:j:B>j?B:j,te=M[0]=V-F,ie=M[1]=N-L,re=M[2]=B-O,ne=S[0]=U-F,ae=S[1]=G-L,se=S[2]=j-O,oe=te*te+ie*ie+re*re,le=te*ne+ie*ae+re*se,ue=ne*ne+ae*ae+se*se,ce=Math.floor((q-s)*a),he=Math.floor((Q-o)*a),de=Math.floor(($-l)*a),pe=Math.ceil((Z-s)*a),_e=Math.ceil((J-o)*a),fe=Math.ceil((ee-l)*a),ge=de;ge<=fe;++ge)for(var me=he;me<=_e;++me)for(var ve=ce;ve<=pe;++ve){var ye=s+ve*r,be=o+me*r,Ae=l+ge*r,Te=ve+me*u+ge*c;E[0]=ye,E[1]=be,E[2]=Ae;var Me=Ye.A.distance2PointTriangleEdges(E,M,S,b,oe,le,ue,R);if((Me=Math.sqrt(Me))<h[Te]){h[Te]=Me;var Se=3*Te;p[Se]=W,p[Se+1]=z,p[Se+2]=X,_[Se]=K,_[Se+1]=Y,_[Se+2]=H}if(!(Me>r))for(var Ee=0;Ee<3;++Ee){var Re=R[Ee]-E[Ee];if(!(Re<0||Re>r)){var ke=3*Te+Ee;if(1!==d[ke]){var xe=Ye.A.intersectionRayTriangleEdges(E,k[Ee],M,S,b);xe<0||xe>r||(d[ke]=1)}}}}},Ii=function(e,t,i,r,n){var a=new Qt(e.getGL());return a.setID(e.getID()),a.setFaces(t),a.setVertices(i),r&&a.setColors(r),n&&a.setMaterials(n),a.setRenderData(e.getRenderData()),a.init(),a.initRender(),a};Pi.remesh=function(t,i,s){console.time("remesh total"),console.time("1. prepareMeshes");var o=function(t){for(var i=[1/0,1/0,1/0,-1/0,-1/0,-1/0],n=[0,0,0],a=0,s=t.length;a<s;++a){var o=t[a];o.isUsingTexCoords()&&o.setShaderType(r.A.Shader.MATCAP);for(var l=o.getMatrix(),u=(o=t[a]=fi.createClosedMesh(o)).getVertices(),c=0,h=o.getNbVertices();c<h;++c){var d=3*c;n[0]=u[d],n[1]=u[d+1],n[2]=u[d+2],e.Z0(n,n,l);var p=u[d]=n[0],_=u[d+1]=n[1],f=u[d+2]=n[2];p<i[0]&&(i[0]=p),_<i[1]&&(i[1]=_),f<i[2]&&(i[2]=f),p>i[3]&&(i[3]=p),_>i[4]&&(i[4]=_),f>i[5]&&(i[5]=f)}}return i}(t=t.slice());console.timeEnd("1. prepareMeshes"),console.time("2. voxelization");for(var l,u=function(e){for(var t=Math.max(e[3]-e[0],e[4]-e[1],e[5]-e[2])/Pi.RESOLUTION,i=1.51*t,r=1.51*t,a=[e[0]-i,e[1]-i,e[2]-i],s=[e[3]+r,e[4]+r,e[5]+r],o=Math.ceil((s[0]-a[0])/t),l=Math.ceil((s[1]-a[1])/t),u=Math.ceil((s[2]-a[2])/t),c=o*l*u,h=n.A.getMemory(31*c),d=new Float32Array(h,0,c),p=new Float32Array(h,4*c,3*c),_=new Float32Array(h,16*c,3*c),f=new Uint8Array(h,28*c,3*c),g=0;g<c;++g)d[g]=1/0;for(var m=0,v=3*c;m<v;++m)f[m]=0;for(var y=0,b=3*c;y<b;++y)p[y]=_[y]=-1;var A={};return A.dims=[o,l,u],A.step=t,A.min=a,A.max=s,A.crossedEdges=f,A.distanceField=d,A.colorField=p,A.materialField=_,A}(o),c=0,h=t.length;c<h;++c)Di(t[c],u);console.timeEnd("2. voxelization"),console.time("3. flood"),function(e){var t=e.step,i=e.dims,r=i[0],n=r*i[1],a=e.crossedEdges,s=e.distanceField,o=s.length,l=new Uint8Array(o),u=new Int32Array(o);u[0]=0;for(var c=1,h=[-1,1,-r,r,-n,n],d=[0,0,1,1,2,2],p=h.length,_=0,f=0;c>0;){var g=u[--c];if(s[g]<t)for(_=0;_<p;++_){var m=h[_];(f=g+m)>=o||f<0||1!==l[f]&&s[f]!==1/0&&0===a[3*(m>=0?g:f)+d[_]]&&(l[f]=1,u[c++]=f)}else for(_=0;_<p;++_)(f=g+h[_])>=o||f<0||1!==l[f]&&(l[f]=1,u[c++]=f)}for(var v=0;v<o;++v)0===s[v]&&console.log("hit"),0===l[v]&&(s[v]=-s[v])}(u),console.timeEnd("3. flood"),s?(console.time("4. marchingCubes"),Ci.BLOCK=Pi.BLOCK,l=Ci.computeSurface(u),console.timeEnd("4. marchingCubes")):(console.time("4. surfaceNets"),Mi.BLOCK=Pi.BLOCK,l=Mi.computeSurface(u),console.timeEnd("4. surfaceNets")),console.time("5. createMesh");var d=Ii(i,l.faces,l.vertices,l.colors,l.materials);return console.timeEnd("5. createMesh"),function(t,i){var r=[i[0],i[1],i[2]],n=[i[3],i[4],i[5]],s=e.xg(r,n),o=e.WQ([],r,n);e.hs(o,o,.5);var l=t.getLocalBound(),u=[l[0],l[1],l[2]],c=[l[3],l[4],l[5]],h=e.xg(u,c),d=e.WQ([],u,c);e.hs(d,d,.5);var p=s/h,_=e.hs([],o,1/p);e.jb(_,_,d);var f=t.getMatrix();a.D_(f),a.hs(f,f,[p,p,p]),a.Tl(f,f,_)}(d,o),s&&Pi.SMOOTHING&&(console.time("6. tangential smoothing"),function(e){for(var t=e.getNbVertices(),i=new Uint32Array(t),r=0;r<t;++r)i[r]=r;var n=new at;n.setToolMesh(e),n.smoothTangent(i,1),e.updateGeometry(),e.updateGeometryBuffers()}(d),console.timeEnd("6. tangential smoothing")),console.timeEnd("remesh total"),console.log("\n"),d},Pi.mergeArrays=function(t,i){var r,a,s=0,o=0,l=0,u=0,c=t.length,h=0;for(r=0;r<c;++r)s+=t[r].getNbVertices(),o+=t[r].getNbFaces(),l+=t[r].getNbQuads(),u+=t[r].getNbTriangles();i.nbVertices=s,i.nbFaces=o,i.nbQuads=l,i.nbTriangles=u;var d=i.vertices=void 0!==i.vertices?new Float32Array(3*s):null,p=i.colors=void 0!==i.colors?new Float32Array(3*s):null,_=i.materials=void 0!==i.materials?new Float32Array(3*s):null,f=i.faces=void 0!==i.faces?new Uint32Array(4*o):null,g=i.triangles=void 0!==i.triangles?new Uint32Array(3*u):null,m=[0,0,0],v=0,y=0,b=0,A=0;for(r=0;r<c;++r){var T=t[r],M=T.getVertices(),S=T.getColors(),E=T.getMaterials(),R=T.getFaces(),k=T.getTriangles(),x=T.getNbVertices(),w=T.getNbFaces(),C=T.getNbTriangles(),P=T.getMatrix();for(a=0;a<x;++a)h=3*a,m[0]=M[h],m[1]=M[h+1],m[2]=M[h+2],e.Z0(m,m,P),d[v+h]=m[0],d[v+h+1]=m[1],d[v+h+2]=m[2],p&&(p[v+h]=S[h],p[v+h+1]=S[h+1],p[v+h+2]=S[h+2]),_&&(_[v+h]=E[h],_[v+h+1]=E[h+1],_[v+h+2]=E[h+2]);if(v+=3*x,f)for(a=0;a<w;++a)f[y+(h=4*a)]=R[h]+A,f[y+h+1]=R[h+1]+A,f[y+h+2]=R[h+2]+A,f[y+h+3]=R[h+3]===n.A.TRI_INDEX?n.A.TRI_INDEX:R[h+3]+A;if(g)for(a=0;a<C;++a)g[b+(h=3*a)]=k[h]+A,g[b+h+1]=k[h+1]+A,g[b+h+2]=k[h+2]+A;A+=x,y+=4*w,b+=3*C}return i},Pi.mergeMeshes=function(e,t){var i={vertices:null,colors:null,materials:null,faces:null};return Pi.mergeArrays(e,i),Ii(t,i.faces,i.vertices,i.colors,i.materials)};const Fi=Pi;var Li={},Oi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=new Float32Array(4);u[0]=0,u[1]=1,u[2]=2,u[3]=3;var c=new Float32Array(12);return c[0]=e,c[1]=t,c[2]=i,c[3]=e+r,c[4]=t+n,c[5]=i+a,c[6]=e+r+s,c[7]=t+n+o,c[8]=i+a+l,c[9]=e+s,c[10]=t+o,c[11]=i+l,{faces:u,vertices:c}},Vi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Float32Array(24);t[1]=t[2]=t[4]=t[6]=t[7]=t[9]=t[10]=t[11]=t[14]=t[18]=t[21]=t[23]=.5*-e,t[0]=t[3]=t[5]=t[8]=t[12]=t[13]=t[15]=t[16]=t[17]=t[19]=t[20]=t[22]=.5*e;var i=new Float32Array(28);i[0]=i[6]=i[8]=i[10]=i[11]=i[13]=i[16]=i[23]=i[25]=.5,i[1]=i[3]=1,i[2]=i[4]=i[9]=i[12]=i[14]=i[15]=i[18]=.25,i[5]=i[7]=i[21]=i[24]=i[26]=i[27]=.75,i[17]=i[19]=i[20]=i[22]=0;var r=new Uint32Array(24),n=new Uint32Array(24);return r[0]=r[8]=r[21]=n[0]=0,r[1]=r[11]=r[12]=n[1]=1,r[2]=r[15]=r[16]=n[2]=n[15]=n[16]=2,r[3]=r[19]=r[22]=n[3]=n[19]=n[22]=3,r[4]=r[9]=r[20]=n[4]=n[9]=4,r[7]=r[10]=r[13]=n[5]=n[18]=n[23]=5,r[6]=r[14]=r[17]=n[6]=n[14]=n[17]=6,r[5]=r[18]=r[23]=n[7]=n[10]=7,n[8]=8,n[11]=9,n[12]=10,n[13]=11,n[20]=12,n[21]=13,{vertices:t,uv:i,faces:r,facesUV:n}},Ni=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=s&&0===e,u=o&&0===t,c=.5*i,h=(a+1)*r,d=a*r;s&&(h+=1,d+=r),o&&(h+=1,d+=r),(l||u)&&(h-=r,d-=r);var p,_=new Float32Array(3*h),f=new Uint32Array(4*d),g=0,m=0,v=0,y=0,b=l?1:0,A=u?a-1:a;for(v=b;v<=A;v++){var T=v/a,M=T*(t-e)+e;for(y=0;y<r;y++){var S=2*Math.PI*y/r;_[m=3*g++]=M*Math.sin(S),_[m+1]=-T*i+c,_[m+2]=M*Math.cos(S)}}for(g=0,y=0;y<r;y++){var E=y===r-1?0:y+1;for(v=b;v<A;v++)f[m=4*g++]=r*v+y,f[m+1]=r*(v+1)+y,f[m+2]=r*(v+1)+E,f[m+3]=r*v+E}if(s)for(_[3*(p=(o?_.length-6:_.length-3)/3)+1]=c,y=0;y<r;y++)f[m=4*g++]=y,f[m+1]=y===r-1?0:y+1,f[m+2]=p,f[m+3]=n.A.TRI_INDEX;if(o){_[3*(p=(_.length-3)/3)+1]=-c,l&&--v;var R=r*v;for(y=0;y<r;y++)f[m=4*g++]=y===r-1?R:R+y+1,f[m+1]=R+y,f[m+2]=p,f[m+3]=n.A.TRI_INDEX}return{vertices:_,faces:f}},Bi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*Math.PI,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,s=2*Math.PI-i<.01,o=r*a,l=o;s||(o+=2,l+=r);var u=s?a:a-1,c=new Float32Array(3*o),h=new Uint32Array(4*l),d=0,p=0,_=0,f=0;for(_=0;_<a;++_)for(f=0;f<r;++f){var g=_/u*i,m=f/r*Math.PI*2;c[p=3*d++]=(e+t*Math.cos(m))*Math.cos(g),c[p+1]=t*Math.sin(m),c[p+2]=(e+t*Math.cos(m))*Math.sin(g)}for(d=0,_=0;_<u;++_){var v=_===a-1?0:_+1;for(f=0;f<r;++f){h[p=4*d++]=r*_+f;var y=f===r-1?0:f+1;h[p+1]=r*_+y,h[p+2]=r*v+y,h[p+3]=r*v+f}}if(!s){var b=(c.length-6)/3;for(c[3*b]=e,f=0;f<r;f++)h[p=4*d++]=b,h[p+1]=f===r-1?0:f+1,h[p+2]=f,h[p+3]=n.A.TRI_INDEX;c[3*++b]=e*Math.cos(i),c[3*b+2]=e*Math.sin(i);var A=r*_;for(f=0;f<r;f++)h[p=4*d++]=b,h[p+1]=A+f,h[p+2]=f===r-1?A:A+f+1,h[p+3]=n.A.TRI_INDEX}return{vertices:c,faces:h}},Ui=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:20,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:u;u+=2,c+=2;var h=new Float32Array(2*(u+c)*3),d=0,p=0,_=r/(u-1),f=n/(u-1),g=a/(u-1),m=e+r+s,v=t+n+o,y=i+a+l;for(d=0;d<u;++d)h[p=6*d]=e+_*d,h[p+1]=t+f*d,h[p+2]=i+g*d,h[p+3]=m-_*(u-d-1),h[p+4]=v-f*(u-d-1),h[p+5]=y-g*(u-d-1);for(_=s/(c-1),f=o/(c-1),g=l/(c-1),d=0;d<c;++d)h[p=6*(u+d)]=e+_*d,h[p+1]=t+f*d,h[p+2]=i+g*d,h[p+3]=m-_*(c-d-1),h[p+4]=v-f*(c-d-1),h[p+5]=y-g*(c-d-1);return{vertices:h}},Gi=function(e,t){var i=new Qt(e);return i.setVertices(t.vertices),t.faces&&i.setFaces(t.faces),t.uv&&t.facesUV&&i.initTexCoordsDataFromOBJData(t.uv,t.facesUV),i.init(),e&&i.initRender(),i},ji=Array.prototype.slice;Li.createGrid=function(e){var t=Gi(e,Ui.apply(this,ji.call(arguments,1)));return e&&(t.setMode(e.LINES),t.setUseDrawArrays(!0),t.setAlreadyDrawArrays()),t},Li.createCube=function(e){return Gi(e,Vi.apply(this,ji.call(arguments,1)))},Li.createCylinder=function(e){return Gi(e,Ni.apply(this,ji.call(arguments,1)))},Li.createTorus=function(e){return Gi(e,Bi.apply(this,ji.call(arguments,1)))},Li.createPlane=function(e){return Gi(e,Oi.apply(this,ji.call(arguments,1)))},Li.createArrow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=Gi(null,Ni(t,t,i,a,s)),l=Gi(null,Ni(0,t*r,i*n,a,s));l.getMatrix()[13]=.5*i;var u={vertices:null,faces:null};return Fi.mergeArrays([o,l],u),Gi(e,u)},Li.createLine2D=function(e){var t=Gi(e,{vertices:new Float32Array([arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,0])});return e&&(t.setMode(e.LINES),t.setUseDrawArrays(!0),t.setAlreadyDrawArrays()),t};const Wi=Li;function zi(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xi=e.fA(.7,.2,.2),Ki=e.fA(.2,.7,.2),Yi=e.fA(.2,.2,.7),Hi=e.fA(.4,.4,.4),qi=e.fA(.8,.4,.2),Zi=1.5*1.3,Qi=Ne(),Ji=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return{_finalMatrix:a.vt(),_baseMatrix:a.vt(),_color:e.vt(),_colorSelect:e.fA(1,1,0),_drawGeo:null,_pickGeo:null,_isSelected:!1,_type:t,_nbAxis:i,_lastInter:[0,0,0],updateMatrix:function(){a.C(this._drawGeo.getMatrix(),this._finalMatrix),a.C(this._pickGeo.getMatrix(),this._finalMatrix)},updateFinalMatrix:function(e){a.lK(this._finalMatrix,e,this._baseMatrix)}}},$i=1024,er=2048,tr=4096,ir=8192,rr=15360,nr=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._main=e,this._gl=e._gl,this._activatedType=t.TRANS_XYZ|t.ROT_XYZ|t.PLANE_XYZ|t.SCALE_XYZW|t.ROT_W,this._coordSpace=t.COORD_GLOBAL,this._transX=Ji(t.TRANS_X,0),this._transY=Ji(t.TRANS_Y,1),this._transZ=Ji(t.TRANS_Z,2),this._planeX=Ji(t.PLANE_X,0),this._planeY=Ji(t.PLANE_Y,1),this._planeZ=Ji(t.PLANE_Z,2),this._scaleX=Ji(t.SCALE_X,0),this._scaleY=Ji(t.SCALE_Y,1),this._scaleZ=Ji(t.SCALE_Z,2),this._scaleW=Ji(t.SCALE_W),this._rotX=Ji(t.ROT_X,0),this._rotY=Ji(t.ROT_Y,1),this._rotZ=Ji(t.ROT_Z,2),this._rotW=Ji(t.ROT_W),this._lineHelper=Wi.createLine2D(this._gl),this._lineHelper.setShaderType(r.A.Shader.FLAT),this._lastDistToEye=0,this._isEditing=!1,this._selected=null,this._pickables=[],this._editLineOrigin=[0,0,0],this._editLineDirection=[0,0,0],this._editOffset=[0,0,0],this._editAxis=a.vt(),this._editAxisInv=a.vt(),this._editLocal=[],this._editTrans=a.vt(),this._editScaleRot=[],this._editLocalInv=[],this._editTransInv=a.vt(),this._editScaleRotInv=[],this._initTranslate(),this._initRotate(),this._initScale(),this._initPickables()}var i,n,s;return i=t,n=[{key:"_normalizeRotationColumns",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);t>0&&(e[0]/=t,e[1]/=t,e[2]/=t),i>0&&(e[4]/=i,e[5]/=i,e[6]/=i),r>0&&(e[8]/=r,e[9]/=r,e[10]/=r)}},{key:"_computeLocalAxisMatrix",value:function(e,t){a.C(t,e.getMatrix()),t[12]=t[13]=t[14]=0,this._normalizeRotationColumns(t);var i=a.vt();a.C(i,e.getEditMatrix()),i[12]=i[13]=i[14]=0,this._normalizeRotationColumns(i),a.lK(t,t,i)}},{key:"setActivatedType",value:function(e){this._activatedType=e,this._initPickables()}},{key:"setCoordSpace",value:function(e){this._coordSpace=e}},{key:"getCoordSpace",value:function(){return this._coordSpace}},{key:"_initPickables",value:function(){var e=this._pickables;e.length=0;var t=this._activatedType;1&t&&e.push(this._transX._pickGeo),2&t&&e.push(this._transY._pickGeo),4&t&&e.push(this._transZ._pickGeo),128&t&&e.push(this._planeX._pickGeo),256&t&&e.push(this._planeY._pickGeo),512&t&&e.push(this._planeZ._pickGeo),8&t&&e.push(this._rotX._pickGeo),16&t&&e.push(this._rotY._pickGeo),32&t&&e.push(this._rotZ._pickGeo),t&$i&&e.push(this._scaleX._pickGeo),t&er&&e.push(this._scaleY._pickGeo),t&tr&&e.push(this._scaleZ._pickGeo),t&ir&&e.push(this._scaleW._pickGeo)}},{key:"_createArrow",value:function(t,i,n){var s=t._baseMatrix;a.e$(s,s,.5*Math.PI,i),a.Tl(s,s,[0,1.25,0]),e.C(t._color,n),t._pickGeo=Wi.createArrow(this._gl,.125,2.5,3),t._pickGeo._gizmo=t,t._drawGeo=Wi.createArrow(this._gl,.025,2.5,7.5,.25),t._drawGeo.setShaderType(r.A.Shader.FLAT)}},{key:"_createPlane",value:function(t,i,n,a,s,o,l,u){e.C(t._color,i),t._pickGeo=Wi.createPlane(this._gl,0,0,0,n,a,s,o,l,u),t._pickGeo._gizmo=t,t._drawGeo=Wi.createPlane(this._gl,0,0,0,n,a,s,o,l,u),t._drawGeo.setShaderType(r.A.Shader.FLAT)}},{key:"_initTranslate",value:function(){var t=[0,0,0];this._createArrow(this._transX,e.hZ(t,0,0,-1),Xi),this._createArrow(this._transY,e.hZ(t,0,1,0),Ki),this._createArrow(this._transZ,e.hZ(t,1,0,0),Yi);var i=.5;this._createPlane(this._planeX,Xi,0,i,0,0,0,i),this._createPlane(this._planeY,Ki,i,0,0,0,0,i),this._createPlane(this._planeZ,Yi,i,0,0,0,i,0)}},{key:"_createCircle",value:function(t,i,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.C(t._color,n),t._pickGeo=Wi.createTorus(this._gl,a,.125*s,i,6,64),t._pickGeo._gizmo=t,t._drawGeo=Wi.createTorus(this._gl,a,.025*s,i,6,64),t._drawGeo.setShaderType(r.A.Shader.FLAT)}},{key:"_initRotate",value:function(){this._createCircle(this._rotX,Math.PI,Xi),this._createCircle(this._rotY,Math.PI,Ki),this._createCircle(this._rotZ,Math.PI,Yi),this._createCircle(this._rotW,2*Math.PI,Hi)}},{key:"_createCube",value:function(t,i,n){var s=t._baseMatrix;a.e$(s,s,.5*Math.PI,i),a.Tl(s,s,[0,1.5,0]),e.C(t._color,n),t._pickGeo=Wi.createCube(this._gl,.42),t._pickGeo._gizmo=t,t._drawGeo=Wi.createCube(this._gl,.35),t._drawGeo.setShaderType(r.A.Shader.FLAT)}},{key:"_initScale",value:function(){var t=[0,0,0];this._createCube(this._scaleX,e.hZ(t,0,0,-1),Xi),this._createCube(this._scaleY,e.hZ(t,0,1,0),Ki),this._createCube(this._scaleZ,e.hZ(t,1,0,0),Yi),this._createCircle(this._scaleW,2*Math.PI,qi,Zi,2)}},{key:"_updateArcRotation",value:function(e){Qi[0]=e[2],Qi[1]=0,Qi[2]=-e[0],Qi[3]=1+e[1],Ke(Qi,Qi),a.I0(this._rotW._baseMatrix,Qi),a.I0(this._scaleW._baseMatrix,Qi),function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),l=Math.cos(i);e[0]=r*l+n*o,e[1]=n*l-r*o,e[2]=a*l+s*o,e[3]=s*l-a*o}(Qi,Be(Qi),.5*Math.PI),je(Qi,Qi,Math.atan2(-e[1],-e[2])),a.I0(this._rotX._baseMatrix,Qi),je(Qi,Be(Qi),Math.atan2(-e[0],-e[2])),a.I0(this._rotY._baseMatrix,Qi),Ge(Qi,Be(Qi),.5*Math.PI),je(Qi,Qi,Math.atan2(-e[0],e[1])),a.I0(this._rotZ._baseMatrix,Qi)}},{key:"_computeCenterGizmo",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],i=this._main.getSelectedMeshes(),r=[0,0,0],n=[0,0,0],a=0;a<i.length;++a){var s=i[a];e.Z0(n,s.getCenter(),s.getEditMatrix()),e.Z0(n,n,s.getMatrix()),e.WQ(r,r,n)}return e.hs(t,r,1/i.length),t}},{key:"_updateMatrices",value:function(){var t=this._main.getCamera(),i=this._computeCenterGizmo(),r=t.computePosition();this._lastDistToEye=this._isEditing?this._lastDistToEye:e.xg(r,i);var n=80*this._lastDistToEye/t.getConstantScreen(),s=a.vt();if(a.Tl(s,s,i),1===this._coordSpace){var o=this._main.getSelectedMeshes();if(o.length>0){var l=o[0],u=a.vt();this._computeLocalAxisMatrix(l,u),a.lK(s,s,u)}}a.hs(s,s,[n,n,n]),this._updateArcRotation(e.S8(r,e.jb(r,i,r))),this._transX.updateFinalMatrix(s),this._transY.updateFinalMatrix(s),this._transZ.updateFinalMatrix(s),this._planeX.updateFinalMatrix(s),this._planeY.updateFinalMatrix(s),this._planeZ.updateFinalMatrix(s),this._rotX.updateFinalMatrix(s),this._rotY.updateFinalMatrix(s),this._rotZ.updateFinalMatrix(s),this._rotW.updateFinalMatrix(s),this._scaleX.updateFinalMatrix(s),this._scaleY.updateFinalMatrix(s),this._scaleZ.updateFinalMatrix(s),this._scaleW.updateFinalMatrix(s)}},{key:"_drawGizmo",value:function(e){e.updateMatrix();var t=e._drawGeo;t.setFlatColor(e._isSelected?e._colorSelect:e._color),t.updateMatrices(this._main.getCamera()),t.render(this._main)}},{key:"_updateLineHelper",value:function(e,t,i,r){var n=this._lineHelper.getVertices(),a=this._main,s=a.getCanvasWidth(),o=a.getCanvasHeight();n[0]=e/s*2-1,n[1]=(o-t)/o*2-1,n[3]=i/s*2-1,n[4]=(o-r)/o*2-1,this._lineHelper.updateVertexBuffer()}},{key:"_saveEditMatrices",value:function(){var e=this._main.getSelectedMeshes(),t=this._computeCenterGizmo();a.Tl(this._editTrans,a.D_(this._editTrans),t),a.B8(this._editTransInv,this._editTrans);for(var i=0;i<e.length;++i)this._editLocal[i]=a.vt(),this._editScaleRot[i]=a.vt(),this._editLocalInv[i]=a.vt(),this._editScaleRotInv[i]=a.vt(),a.C(this._editLocal[i],e[i].getMatrix()),a.C(this._editScaleRot[i],this._editLocal[i]),this._editScaleRot[i][12]=this._editScaleRot[i][13]=this._editScaleRot[i][14]=0,a.B8(this._editLocalInv[i],this._editLocal[i]),a.B8(this._editScaleRotInv[i],this._editScaleRot[i]);a.D_(this._editAxis),a.D_(this._editAxisInv),1===this._coordSpace&&e.length>0&&(this._computeLocalAxisMatrix(e[0],this._editAxis),a.B8(this._editAxisInv,this._editAxis))}},{key:"_startRotateEdit",value:function(){var t=this._main,i=t.getCamera(),r=[0,0,0];this._computeCenterGizmo(r),e.C(r,i.project(r));var n=this._editLineDirection,a=0===this._selected._nbAxis?-1:1,s=this._selected._lastInter;e.hZ(n,-a*s[2],-a*s[1],a*s[0]),e.Z0(n,n,this._selected._finalMatrix),e.C(n,i.project(n)),Ie(n,Oe(n,n,r)),Pe(this._editLineOrigin,t._mouseX,t._mouseY)}},{key:"_startTranslateEdit",value:function(){var t=this._main,i=t.getCamera(),r=this._editLineOrigin,n=this._editLineDirection;this._computeCenterGizmo(r);var a=this._selected._nbAxis;-1!==a&&(e.hZ(n,0,0,0)[a]=1),1===this._coordSpace&&e.Z0(n,n,this._editAxis),e.WQ(n,r,n),e.C(r,i.project(r)),e.C(n,i.project(n)),Ie(n,Oe(n,n,r));var s=this._editOffset;s[0]=t._mouseX-r[0],s[1]=t._mouseY-r[1]}},{key:"_startPlaneEdit",value:function(){var t=this._main,i=t.getCamera(),r=this._editLineOrigin;this._computeCenterGizmo(r),e.C(r,i.project(r));var n=this._editOffset;n[0]=t._mouseX-r[0],n[1]=t._mouseY-r[1],Pe(this._editLineOrigin,t._mouseX,t._mouseY)}},{key:"_startScaleEdit",value:function(){this._startTranslateEdit()}},{key:"_updateRotateEdit",value:function(){var e=this._main,t=this._editLineOrigin,i=this._editLineDirection,r=[e._mouseX,e._mouseY,0];Oe(r,r,t);var n=Fe(r,i);this._updateLineHelper(t[0],t[1],t[0]+i[0]*n,t[1]+i[1]*n);var s=2.5*n/Math.min(e.getCanvasWidth(),e.getCanvasHeight());s%=2*Math.PI;for(var o=this._selected._nbAxis,l=this._main.getSelectedMeshes(),u=0;u<l.length;++u){var c=l[u].getEditMatrix();a.D_(c),0===o?a.eL(c,c,-s):1===o?a.Z8(c,c,-s):2===o&&a.Qr(c,c,-s),this._scaleRotateEditMatrix(c,u)}e.render()}},{key:"_updateTranslateEdit",value:function(){var t=this._main,i=t.getCamera(),r=this._editLineOrigin,n=this._editLineDirection,a=[t._mouseX,t._mouseY,0];Oe(a,a,r),Oe(a,a,this._editOffset),De(a,r,n,Fe(a,n)),this._updateLineHelper(r[0],r[1],a[0],a[1]);var s=i.unproject(a[0],a[1],0),o=i.unproject(a[0],a[1],.1);e.Z0(s,s,this._editTransInv),e.Z0(o,o,this._editTransInv),1===this._coordSpace&&(e.Z0(s,s,this._editAxisInv),e.Z0(o,o,this._editAxisInv)),e.S8(a,e.jb(a,o,s));var l=[0,0,0];l[this._selected._nbAxis]=1;var u=-e.Om(a,l),c=e.Om(s,a),h=Math.abs(1-u*u),d=-e.Om(s,l);l[this._selected._nbAxis]=(u*c-d)/h,this._updateMatrixTranslate(l),t.render()}},{key:"_updatePlaneEdit",value:function(){var t=this._main,i=t.getCamera(),r=[t._mouseX,t._mouseY,0];Oe(r,r,this._editOffset),this._updateLineHelper(this._editLineOrigin[0],this._editLineOrigin[1],t._mouseX,t._mouseY);var n=i.unproject(r[0],r[1],0),a=i.unproject(r[0],r[1],.1);e.Z0(n,n,this._editTransInv),e.Z0(a,a,this._editTransInv),1===this._coordSpace&&(e.Z0(n,n,this._editAxisInv),e.Z0(a,a,this._editAxisInv));var s=[0,0,0];s[this._selected._nbAxis]=1;var o=e.Om(n,s),l=e.Om(a,s);if(o===l)return!1;var u=-o/(l-o);s[0]=n[0]+(a[0]-n[0])*u,s[1]=n[1]+(a[1]-n[1])*u,s[2]=n[2]+(a[2]-n[2])*u,this._updateMatrixTranslate(s),t.render()}},{key:"_updateMatrixTranslate",value:function(t){for(var i=[0,0,0],r=this._main.getSelectedMeshes(),n=0;n<r.length;++n){1===this._coordSpace?e.C(i,t):e.Z0(i,t,this._editScaleRotInv[n]);var s=r[n].getEditMatrix();a.D_(s),a.Tl(s,s,i)}}},{key:"_updateScaleEdit",value:function(){var t=this._main,i=this._editLineOrigin,r=this._editLineDirection,n=this._selected._nbAxis,s=[t._mouseX,t._mouseY,0];-1!==n&&(Oe(s,s,i),De(s,i,r,Fe(s,r))),this._updateLineHelper(i[0],i[1],s[0],s[1]);var o=e.Il(this._editOffset),l=[1,1,1],u=Math.max(-.99,(Ve(i,s)-o)/o);-1===n?(l[0]+=u,l[1]+=u,l[2]+=u):l[n]+=u;for(var c=this._main.getSelectedMeshes(),h=0;h<c.length;++h){var d=c[h].getEditMatrix();a.D_(d),a.hs(d,d,l),this._scaleRotateEditMatrix(d,h)}t.render()}},{key:"_scaleRotateEditMatrix",value:function(e,t){a.lK(e,this._editTrans,e),a.lK(e,e,this._editTransInv),0===this._coordSpace&&(a.lK(e,this._editLocalInv[t],e),a.lK(e,e,this._editLocal[t]))}},{key:"addGizmoToScene",value:function(e){return e.push(this._transX._drawGeo),e.push(this._transY._drawGeo),e.push(this._transZ._drawGeo),e.push(this._planeX._drawGeo),e.push(this._planeY._drawGeo),e.push(this._planeZ._drawGeo),e.push(this._rotX._drawGeo),e.push(this._rotY._drawGeo),e.push(this._rotZ._drawGeo),e.push(this._rotW._drawGeo),e.push(this._scaleX._drawGeo),e.push(this._scaleY._drawGeo),e.push(this._scaleZ._drawGeo),e.push(this._scaleW._drawGeo),e}},{key:"render",value:function(){this._updateMatrices();var e=this._isEditing&&this._selected?this._selected._type:this._activatedType;64&e&&this._drawGizmo(this._rotW),1&e&&this._drawGizmo(this._transX),2&e&&this._drawGizmo(this._transY),4&e&&this._drawGizmo(this._transZ),128&e&&this._drawGizmo(this._planeX),256&e&&this._drawGizmo(this._planeY),512&e&&this._drawGizmo(this._planeZ),8&e&&this._drawGizmo(this._rotX),16&e&&this._drawGizmo(this._rotY),32&e&&this._drawGizmo(this._rotZ),e&$i&&this._drawGizmo(this._scaleX),e&er&&this._drawGizmo(this._scaleY),e&tr&&this._drawGizmo(this._scaleZ),e&ir&&this._drawGizmo(this._scaleW),this._isEditing&&this._lineHelper.render(this._main)}},{key:"onMouseOver",value:function(){if(this._isEditing){var t=this._selected._type;return 56&t?this._updateRotateEdit():7&t?this._updateTranslateEdit():896&t?this._updatePlaneEdit():t&rr&&this._updateScaleEdit(),!0}var i=this._main,r=i.getPicking(),n=i._mouseX,a=i._mouseY,s=this._pickables;r.intersectionMouseMeshes(s,n,a),this._selected&&(this._selected._isSelected=!1);var o=r.getMesh();return o?(this._selected=o._gizmo,this._selected._isSelected=!0,e.C(this._selected._lastInter,r.getIntersectionPoint()),!0):(this._selected=null,!1)}},{key:"onMouseDown",value:function(){var e=this._selected;if(!e)return!1;this._isEditing=!0;var t=e._type;return this._saveEditMatrices(),56&t?this._startRotateEdit():7&t?this._startTranslateEdit():896&t?this._startPlaneEdit():t&rr&&this._startScaleEdit(),!0}},{key:"onMouseUp",value:function(){this._isEditing=!1}}],s=[{key:"TRANS_X",get:function(){return 1}},{key:"TRANS_Y",get:function(){return 2}},{key:"TRANS_Z",get:function(){return 4}},{key:"ROT_X",get:function(){return 8}},{key:"ROT_Y",get:function(){return 16}},{key:"ROT_Z",get:function(){return 32}},{key:"ROT_W",get:function(){return 64}},{key:"PLANE_X",get:function(){return 128}},{key:"PLANE_Y",get:function(){return 256}},{key:"PLANE_Z",get:function(){return 512}},{key:"SCALE_X",get:function(){return $i}},{key:"SCALE_Y",get:function(){return er}},{key:"SCALE_Z",get:function(){return tr}},{key:"SCALE_W",get:function(){return ir}},{key:"TRANS_XYZ",get:function(){return 7}},{key:"ROT_XYZ",get:function(){return 56}},{key:"PLANE_XYZ",get:function(){return 896}},{key:"SCALE_XYZW",get:function(){return rr}},{key:"COORD_GLOBAL",get:function(){return 0}},{key:"COORD_LOCAL",get:function(){return 1}}],n&&zi(i.prototype,n),s&&zi(i,s),t}();const ar=nr;function sr(e){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sr(e)}function or(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lr(e,t){return lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},lr(e,t)}function ur(e){return ur=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ur(e)}var cr=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}(l,t);var i,r,n,s,o=(n=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ur(n);if(s){var i=ur(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==sr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._gizmo=new ar(e),t}return i=l,r=[{key:"isIdentity",value:function(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]}},{key:"preUpdate",value:function(){var e=this._main.getPicking(),t=e.getMesh();this._gizmo.onMouseOver(),e._mesh=t,this._main.setCanvasCursor("default")}},{key:"start",value:function(e){var t=this._main,i=this.getMesh(),r=t.getPicking();return i&&this._gizmo.onMouseDown()?(r._mesh=i,!0):!!r.intersectionMouseMeshes(t.getMeshes(),t._mouseX,t._mouseY)&&!!t.setOrUnsetMesh(r.getMesh(),e)&&(this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!1)}},{key:"end",value:function(){if(this._gizmo.onMouseUp(),this.getMesh()&&!this.isIdentity(this.getMesh().getEditMatrix())){for(var e=this._main.getSelectedMeshes(),t=0;t<e.length;++t){this._forceToolMesh=e[t],this.pushState(),t>0&&(this._main.getStateManager().getCurrentState().squash=!0);var i=this.getUnmaskedVertices();this._main.getStateManager().pushVertices(i),this.applyEditMatrix(i),0!==i.length&&this.updateMeshBuffers()}this._forceToolMesh=null}}},{key:"applyEditMatrix",value:function(t){var i=this.getMesh(),r=i.getEditMatrix(),n=i.getMaterials(),s=i.getVertices(),o=[0,0,0],l=i.getNbVertices(),u=t.length===l;if(u)for(var c=2;c<3*l;c+=3)if(Math.abs(n[c]-1)>1e-6){u=!1;break}if(u)return a.lK(i.getMatrix(),i.getMatrix(),r),i.updateYawPitchRollFromMatrix(),void a.D_(r);for(var h=0,d=t.length;h<d;++h){var p=3*t[h],_=n[p+2],f=o[0]=s[p],g=o[1]=s[p+1],m=o[2]=s[p+2];e.Z0(o,o,r);var v=1-_;s[p]=f*v+o[0]*_,s[p+1]=g*v+o[1]*_,s[p+2]=m*v+o[2]*_}e.Z0(i.getCenter(),i.getCenter(),r),a.D_(r),t.length===i.getNbVertices()?i.updateGeometry():i.updateGeometry(i.getFacesFromVertices(t),t)}},{key:"update",value:function(){}},{key:"postRender",value:function(){this.getMesh()&&this._gizmo.render()}},{key:"addSculptToScene",value:function(e){this.getMesh()&&this._gizmo.addGizmoToScene(e)}}],r&&or(i.prototype,r),l}(de);const hr=cr;function dr(e){return dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(e)}function pr(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t){return _r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_r(e,t)}function fr(e){return fr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fr(e)}var gr=[0,0,0],mr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_r(e,t)}(o,e);var t,i,r,a,s=(r=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=fr(r);if(a){var i=fr(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==dr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._selectionMode=o.Mode.FACE,t._selectionAction=o.Action.REPLACE,t}return t=o,i=[{key:"start",value:function(e){var t=this._main,i=t.getPicking();if(!i.intersectionMouseMeshes())return!1;var r=t.setOrUnsetMesh(i.getMesh(),e);return!!r&&-1!==i.getPickedFace()&&(this._main.getStateManager().pushStateColorAndMaterial(r),this.applySelection(r,i),this.updateRender(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!0)}},{key:"update",value:function(){}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e&&(e.isDynamic?e.updateBuffers():(e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateMaterialBuffer()))}},{key:"applySelection",value:function(e,t){var i=this.getSelectionVertices(e,t);if(i.length){var r=e.getMaterials(),n=e.getNbVertices();if(this._selectionAction===o.Action.REPLACE)for(var a=0;a<n;++a)r[3*a+2]=0;for(var s=this._selectionAction===o.Action.REMOVE?0:1,l=0,u=i.length;l<u;++l)r[3*i[l]+2]=s}}},{key:"getSelectionVertices",value:function(e,t){var i=t.getPickedFace(),r=e.getFaces(),a=4*i,s=r[a],l=r[a+1],u=r[a+2],c=r[a+3],h=[s,l,u];if(c!==n.A.TRI_INDEX&&h.push(c),this._selectionMode===o.Mode.FACE)return h;var d=t.getIntersectionPoint();return gr[0]=d[0],gr[1]=d[1],gr[2]=d[2],this._selectionMode===o.Mode.VERTEX?[this.getClosestVertex(e,h,gr)]:this._selectionMode===o.Mode.EDGE?this.getClosestEdge(e,h,gr):h}},{key:"getClosestVertex",value:function(e,t,i){for(var r=e.getVertices(),n=t[0],a=1/0,s=0,o=t.length;s<o;++s){var l=3*t[s],u=r[l]-i[0],c=r[l+1]-i[1],h=r[l+2]-i[2],d=u*u+c*c+h*h;d<a&&(a=d,n=t[s])}return n}},{key:"getClosestEdge",value:function(e,t,i){var r=[[t[0],t[1]],[t[1],t[2]],[t[2],t[0]]];4===t.length&&(r.push([t[2],t[3]]),r.push([t[3],t[0]]));for(var n=e.getVertices(),a=r[0],s=1/0,o=0,l=r.length;o<l;++o){var u=r[o],c=this.distanceToSegmentSquared(n,u[0],u[1],i);c<s&&(s=c,a=u)}return a}},{key:"distanceToSegmentSquared",value:function(e,t,i,r){var n=3*t,a=3*i,s=e[n],o=e[n+1],l=e[n+2],u=e[a]-s,c=e[a+1]-o,h=e[a+2]-l,d=r[0]-s,p=r[1]-o,_=r[2]-l,f=u*u+c*c+h*h;if(0===f)return d*d+p*p+_*_;var g=(d*u+p*c+_*h)/f;g<0?g=0:g>1&&(g=1);var m=s+u*g-r[0],v=o+c*g-r[1],y=l+h*g-r[2];return m*m+v*v+y*y}},{key:"selectAll",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),i=e.getNbVertices(),r=0;r<i;++r)t[3*r+2]=1;this.updateRender()}}},{key:"clearSelection",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),i=e.getNbVertices(),r=0;r<i;++r)t[3*r+2]=0;this.updateRender()}}},{key:"invertSelection",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),i=e.getNbVertices(),r=0;r<i;++r){var n=3*r+2;t[n]=t[n]>.5?0:1}this.updateRender()}}}],i&&pr(t.prototype,i),o}(de);mr.Mode={VERTEX:0,EDGE:1,FACE:2},mr.Action={REPLACE:0,ADD:1,REMOVE:2};const vr=mr;var yr=[];yr[r.A.Tools.BRUSH]=Se,yr[r.A.Tools.INFLATE]=Ce,yr[r.A.Tools.TWIST]=$e,yr[r.A.Tools.SMOOTH]=at,yr[r.A.Tools.FLATTEN]=ve,yr[r.A.Tools.PINCH]=ht,yr[r.A.Tools.CREASE]=mt,yr[r.A.Tools.DRAG]=Mt,yr[r.A.Tools.PAINT]=Ct,yr[r.A.Tools.MOVE]=Ot,yr[r.A.Tools.MASKING]=ri,yr[r.A.Tools.LOCALSCALE]=ui,yr[r.A.Tools.TRANSFORM]=hr,yr[r.A.Tools.ELEMENTSELECT]=vr,yr[r.A.Tools.BRUSH].uiName="sculptBrush",yr[r.A.Tools.INFLATE].uiName="sculptInflate",yr[r.A.Tools.TWIST].uiName="sculptTwist",yr[r.A.Tools.SMOOTH].uiName="sculptSmooth",yr[r.A.Tools.FLATTEN].uiName="sculptFlatten",yr[r.A.Tools.PINCH].uiName="sculptPinch",yr[r.A.Tools.CREASE].uiName="sculptCrease",yr[r.A.Tools.DRAG].uiName="sculptDrag",yr[r.A.Tools.PAINT].uiName="sculptPaint",yr[r.A.Tools.MOVE].uiName="sculptMove",yr[r.A.Tools.MASKING].uiName="sculptMasking",yr[r.A.Tools.LOCALSCALE].uiName="sculptLocalScale",yr[r.A.Tools.TRANSFORM].uiName="sculptTransform",yr[r.A.Tools.ELEMENTSELECT].uiName="sculptElementSelect";const br=yr;function Ar(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Tr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._toolIndex=r.A.Tools.BRUSH,this._tools=[],this._symmetry=!0,this._continuous=!1,this._sculptTimer=-1,this._selection=new ue(t._gl),this.init()}var t,i;return t=e,i=[{key:"setToolIndex",value:function(e){this._toolIndex=e}},{key:"getToolIndex",value:function(){return this._toolIndex}},{key:"getCurrentTool",value:function(){return this._tools[this._toolIndex]}},{key:"getSymmetry",value:function(){return this._symmetry}},{key:"getTool",value:function(e){return this._tools[e]}},{key:"getSelection",value:function(){return this._selection}},{key:"init",value:function(){for(var e=this._main,t=this._tools,i=0,r=br.length;i<r;++i)br[i]&&(t[i]=new br[i](e))}},{key:"canBeContinuous",value:function(){switch(this._toolIndex){case r.A.Tools.TWIST:case r.A.Tools.MOVE:case r.A.Tools.DRAG:case r.A.Tools.LOCALSCALE:case r.A.Tools.TRANSFORM:case r.A.Tools.ELEMENTSELECT:return!1;default:return!0}}},{key:"isUsingContinuous",value:function(){return this._continuous&&this.canBeContinuous()}},{key:"start",value:function(e){var t=this.getCurrentTool(),i=t.start(e);return this._main.getPicking().getMesh()&&this.isUsingContinuous()&&(this._sculptTimer=window.setInterval(t._cbContinuous,16.6)),i}},{key:"end",value:function(){this.getCurrentTool().end(),-1!==this._sculptTimer&&(clearInterval(this._sculptTimer),this._sculptTimer=-1)}},{key:"preUpdate",value:function(){this.getCurrentTool().preUpdate(this.canBeContinuous())}},{key:"update",value:function(){this.isUsingContinuous()||this.getCurrentTool().update()}},{key:"postRender",value:function(){this.getCurrentTool().postRender(this._selection)}},{key:"addSculptToScene",value:function(e){return this.getCurrentTool().addSculptToScene(e)}}],i&&Ar(t.prototype,i),e}();const Mr=Tr;function Sr(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Er={LINEAR:!1},Rr=function(){function e(t,i,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._vArOut=i,this._cArOut=r,this._mArOut=n,this._vAr=t.getVertices(),this._cAr=t.getColors(),this._mAr=t.getMaterials(),this._eAr=t.getEdges(),this._nbVertices=t.getNbVertices(),this._tagEdges=new Int32Array(t.getNbEdges())}var t,i;return t=e,(i=[{key:"computeTriangleEdgeVertex",value:function(e,t,i,r){var n=this._vAr,a=this._cAr,s=this._mAr,o=this._eAr,l=this._vArOut,u=this._cArOut,c=this._mArOut,h=this._tagEdges,d=3*e,p=3*t,_=3*i,f=h[r]-1,g=-1===f?this._nbVertices++:f,m=3*g,v=o[r];if(1===v||v>=3||Er.LINEAR){if(-1!==f)return g;h[r]=g+1,l[m]=.5*(n[d]+n[p]),l[m+1]=.5*(n[d+1]+n[p+1]),l[m+2]=.5*(n[d+2]+n[p+2]),u[m]=.5*(a[d]+a[p]),u[m+1]=.5*(a[d+1]+a[p+1]),u[m+2]=.5*(a[d+2]+a[p+2]),c[m]=.5*(s[d]+s[p]),c[m+1]=.5*(s[d+1]+s[p+1]),c[m+2]=.5*(s[d+2]+s[p+2])}else-1===f?(h[r]=g+1,l[m]=.125*n[_]+.375*(n[d]+n[p]),l[m+1]=.125*n[_+1]+.375*(n[d+1]+n[p+1]),l[m+2]=.125*n[_+2]+.375*(n[d+2]+n[p+2]),u[m]=.125*a[_]+.375*(a[d]+a[p]),u[m+1]=.125*a[_+1]+.375*(a[d+1]+a[p+1]),u[m+2]=.125*a[_+2]+.375*(a[d+2]+a[p+2]),c[m]=.125*s[_]+.375*(s[d]+s[p]),c[m+1]=.125*s[_+1]+.375*(s[d+1]+s[p+1]),c[m+2]=.125*s[_+2]+.375*(s[d+2]+s[p+2])):(l[m]+=.125*n[_],l[m+1]+=.125*n[_+1],l[m+2]+=.125*n[_+2],u[m]+=.125*a[_],u[m+1]+=.125*a[_+1],u[m+2]+=.125*a[_+2],c[m]+=.125*s[_],c[m+1]+=.125*s[_+1],c[m+2]+=.125*s[_+2]);return g}},{key:"computeQuadEdgeVertex",value:function(e,t,i,r,n){var a=this._vAr,s=this._cAr,o=this._mAr,l=this._eAr,u=this._vArOut,c=this._cArOut,h=this._mArOut,d=this._tagEdges,p=3*e,_=3*t,f=3*i,g=3*r,m=d[n]-1,v=-1===m?this._nbVertices++:m,y=3*v,b=l[n];if(1===b||b>=3||Er.LINEAR){if(-1!==m)return v;d[n]=v+1,u[y]=.5*(a[p]+a[_]),u[y+1]=.5*(a[p+1]+a[_+1]),u[y+2]=.5*(a[p+2]+a[_+2]),c[y]=.5*(s[p]+s[_]),c[y+1]=.5*(s[p+1]+s[_+1]),c[y+2]=.5*(s[p+2]+s[_+2]),h[y]=.5*(o[p]+o[_]),h[y+1]=.5*(o[p+1]+o[_+1]),h[y+2]=.5*(o[p+2]+o[_+2])}else-1===m?(d[n]=v+1,u[y]=.0625*(a[f]+a[g])+.375*(a[p]+a[_]),u[y+1]=.0625*(a[f+1]+a[g+1])+.375*(a[p+1]+a[_+1]),u[y+2]=.0625*(a[f+2]+a[g+2])+.375*(a[p+2]+a[_+2]),c[y]=.0625*(s[f]+s[g])+.375*(s[p]+s[_]),c[y+1]=.0625*(s[f+1]+s[g+1])+.375*(s[p+1]+s[_+1]),c[y+2]=.0625*(s[f+2]+s[g+2])+.375*(s[p+2]+s[_+2]),h[y]=.0625*(o[f]+o[g])+.375*(o[p]+o[_]),h[y+1]=.0625*(o[f+1]+o[g+1])+.375*(o[p+1]+o[_+1]),h[y+2]=.0625*(o[f+2]+o[g+2])+.375*(o[p+2]+o[_+2])):(u[y]+=.0625*(a[f]+a[g]),u[y+1]+=.0625*(a[f+1]+a[g+1]),u[y+2]+=.0625*(a[f+2]+a[g+2]),c[y]+=.0625*(s[f]+s[g]),c[y+1]+=.0625*(s[f+1]+s[g+1]),c[y+2]+=.0625*(s[f+2]+s[g+2]),h[y]+=.0625*(o[f]+o[g]),h[y+1]+=.0625*(o[f+1]+o[g+1]),h[y+2]+=.0625*(o[f+2]+o[g+2]));return v}},{key:"computeFaceVertex",value:function(e,t,i,r){var n=3*e,a=3*t,s=3*i,o=3*r,l=this._vAr,u=this._cAr,c=this._mAr,h=this._vArOut,d=this._cArOut,p=this._mArOut,_=this._nbVertices++,f=3*_;return h[f]=.25*(l[n]+l[a]+l[s]+l[o]),h[f+1]=.25*(l[n+1]+l[a+1]+l[s+1]+l[o+1]),h[f+2]=.25*(l[n+2]+l[a+2]+l[s+2]+l[o+2]),d[f]=.25*(u[n]+u[a]+u[s]+u[o]),d[f+1]=.25*(u[n+1]+u[a+1]+u[s+1]+u[o+1]),d[f+2]=.25*(u[n+2]+u[a+2]+u[s+2]+u[o+2]),p[f]=.25*(c[n]+c[a]+c[s]+c[o]),p[f+1]=.25*(c[n+1]+c[a+1]+c[s+1]+c[o+1]),p[f+2]=.25*(c[n+2]+c[a+2]+c[s+2]+c[o+2]),_}}])&&Sr(t.prototype,i),e}(),kr=function(e,t,i,r){var a=e.getNbVertices();i.set(e.getColors().subarray(0,3*a)),r.set(e.getMaterials().subarray(0,3*a));for(var s=e.getVertices(),o=e.getFaces(),l=e.getEdges(),u=e.getFaceEdges(),c=e.getVerticesOnEdge(),h=e.getVerticesRingVertStartCount(),d=e.getVerticesRingVert(),p=e.getVerticesRingFaceStartCount(),_=e.getVerticesRingFace(),f=e.hasOnlyTriangles(),g=0;g<a;++g){var m=3*g,v=0,y=0,b=0,A=0,T=0,M=0,S=0;if(c[g]||Er.LINEAR){var E=p[2*g],R=E+p[2*g+1];for(M=E;M<R;++M){var k=4*_[M],x=o[k],w=o[k+1],C=o[k+2],P=o[k+3],D=P===n.A.TRI_INDEX;S=n.A.TRI_INDEX,x===g?1===l[u[k]]?S=w:1===l[u[D?k+2:k+3]]&&(S=D?C:P):w===g?1===l[u[k]]?S=x:1===l[u[k+1]]&&(S=C):C===g?1===l[u[k+1]]?S=w:1===l[u[k+2]]&&(S=D?x:P):P===g&&(1===l[u[k+2]]?S=C:1===l[u[k+3]]&&(S=x)),S!==n.A.TRI_INDEX&&(v+=s[S*=3],y+=s[S+1],b+=s[S+2],A++)}A<2?(t[m]=s[m],t[m+1]=s[m+1],t[m+2]=s[m+2]):(A=.25/A,T=.75,t[m]=s[m]*T+v*A,t[m+1]=s[m+1]*T+y*A,t[m+2]=s[m+2]*T+b*A)}else{var I=h[2*g],F=h[2*g+1],L=I+F;for(M=I;M<L;++M)v+=s[S=3*d[M]],y+=s[S+1],b+=s[S+2];if(f)6===F?(A=.0625,T=.625):3===F?(A=.1875,T=.4375):(A=.375/F,T=.625),t[m]=s[m]*T+v*A,t[m+1]=s[m+1]*T+y*A,t[m+2]=s[m+2]*T+b*A;else{var O=0,V=0,N=0,B=0,U=p[2*g],G=U+p[2*g+1],j=0;for(M=U;M<G;++M){var W=o[3+(S=4*_[M])];if(W!==n.A.TRI_INDEX){j++;var z,X=o[S],K=o[S+1],Y=o[S+2];O+=s[z=X===g?3*Y:K===g?3*W:Y===g?3*X:3*K],V+=s[z+1],N+=s[z+2]}}j!==G-U?0!==j?(A=.5*(T=1/(1+.5*F+.25*j)),B=.25*T,t[m]=s[m]*T+v*A+O*B,t[m+1]=s[m+1]*T+y*A+V*B,t[m+2]=s[m+2]*T+b*A+N*B):(6===F?(A=.0625,T=.625):3===F?(A=.1875,T=.4375):(A=.375/F,T=.625),t[m]=s[m]*T+v*A,t[m+1]=s[m+1]*T+y*A,t[m+2]=s[m+2]*T+b*A):(4===F?(T=.5625,A=.09375,B=.015625):T=1-((A=1.5/(F*F))+(B=.25/(F*F)))*F,t[m]=s[m]*T+v*A+O*B,t[m+1]=s[m+1]*T+y*A+V*B,t[m+2]=s[m+2]*T+b*A+N*B)}}}},xr=function(e,t,i,r,a){for(var s=e.getFaces(),o=e.getFaceEdges(),l=new Rr(e,t,i,r),u=0,c=e.getNbFaces();u<c;++u){var h,d,p,_,f,g=4*u,m=s[g],v=s[g+1],y=s[g+2],b=s[g+3],A=b!==n.A.TRI_INDEX;A?(h=l.computeQuadEdgeVertex(m,v,y,b,o[g]),d=l.computeQuadEdgeVertex(v,y,b,m,o[g+1]),p=l.computeQuadEdgeVertex(y,b,m,v,o[g+2]),_=l.computeQuadEdgeVertex(b,m,v,y,o[g+3]),f=l.computeFaceVertex(m,v,y,b)):(h=l.computeTriangleEdgeVertex(m,v,y,o[g]),d=l.computeTriangleEdgeVertex(v,y,m,o[g+1]),p=l.computeTriangleEdgeVertex(y,m,v,o[g+2])),a&&(g*=4,A?(a[g+1]=a[g+4]=h,a[g+6]=a[g+9]=d,a[g+11]=a[g+14]=p,a[g+3]=a[g+12]=_,a[g+2]=a[g+7]=a[g+8]=a[g+13]=f,a[g]=m,a[g+5]=v,a[g+10]=y,a[g+15]=b):(a[g]=a[g+5]=a[g+8]=h,a[g+1]=a[g+10]=a[g+12]=d,a[g+2]=a[g+6]=a[g+14]=p,a[g+3]=a[g+7]=a[g+11]=a[g+15]=n.A.TRI_INDEX,a[g+4]=m,a[g+9]=v,a[g+13]=y))}return l._tagEdges};Er.fullSubdivision=function(e,t){var i=e.getNbVertices()+e.getNbEdges()+e.getNbQuads();t.setVertices(new Float32Array(3*i)),t.setColors(new Float32Array(3*i)),t.setMaterials(new Float32Array(3*i)),t.setFaces(new Uint32Array(4*e.getNbFaces()*4)),kr(e,t.getVertices(),t.getColors(),t.getMaterials());var r=xr(e,t.getVertices(),t.getColors(),t.getMaterials(),t.getFaces());e.hasUV()&&function(e,t,i){var r=t.getNbVertices(),a=new Uint32Array(2*r);a.set(e.getVerticesDuplicateStartCount());var s=e.getFaces(),o=e.getFacesTexCoord(),l=3*t.getNbFaces(),u=e.getTexCoords(),c=new Float32Array(n.A.getMemory(4*l*2),0,2*l),h=0,d=e.getNbVertices(),p=r-d;for(h=0;h<d;++h){var _=a[2*h];_>0&&(a[2*h]=_+p)}c.set(u),c.set(u.subarray(2*d),2*(d+p));var f=p+e.getNbTexCoords(),g=e.getFaceEdges(),m=new Uint32Array(i.length),v=new Uint32Array(i.length);for(d=s.length,h=0;h<d;++h){var y=g[h];if(y!==n.A.TRI_INDEX){var b=(h+1)%4==0?h-3:h+1,A=o[h],T=o[b];T===n.A.TRI_INDEX&&(T=o[h-2]);var M=i[y]-1,S=v[y],E=A>T?A:T,R=A<T?A:T;0!==S?S===E&&m[y]===R||(c[2*f]=.5*(u[2*A]+u[2*T]),c[2*f+1]=.5*(u[2*A+1]+u[2*T+1]),a[2*M]=f++,a[2*M+1]=1):(c[2*M]=.5*(u[2*A]+u[2*T]),c[2*M+1]=.5*(u[2*A+1]+u[2*T+1]),m[y]=R,v[y]=E)}}var k=new Float32Array(2*f);k.set(c.subarray(0,2*f)),t.setTexCoords(k),t.setVerticesDuplicateStartCount(a),function(e,t,i){for(var r=e.getFacesTexCoord(),a=t.getFaces(),s=new Uint32Array(a.length),o=e.getFaceEdges(),l=e.getNbVertices(),u=t.getNbVertices()-l,c=t.getVerticesDuplicateStartCount(),h=t.getTexCoords(),d=0,p=e.getNbFaces();d<p;++d){var _=4*d,f=r[_],g=r[_+1],m=r[_+2],v=r[_+3];f>=l&&(f+=u),g>=l&&(g+=u),m>=l&&(m+=u),v!==n.A.TRI_INDEX&&v>=l&&(v+=u);var y=o[_],b=i[y]-1;b<0?b=c[2*(-b-1)]:c[2*b]>0&&(i[y]=-b);var A=i[y=o[_+1]]-1;A<0?A=c[2*(-A-1)]:c[2*A]>0&&(i[y]=-A);var T=i[y=o[_+2]]-1;if(T<0?T=c[2*(-T-1)]:c[2*T]>0&&(i[y]=-T),_*=4,v!==n.A.TRI_INDEX){var M=i[y=o[4*d+3]]-1;M<0?M=c[2*(-M-1)]:c[2*M]>0&&(i[y]=-M),s[_+1]=s[_+4]=b,s[_+6]=s[_+9]=A,s[_+11]=s[_+14]=T,s[_+3]=s[_+12]=M,s[_+2]=s[_+7]=s[_+8]=s[_+13]=a[_+2],s[_]=f,s[_+5]=g,s[_+10]=m,s[_+15]=v;var S=2*a[_+2];h[S]=.25*(h[2*f]+h[2*g]+h[2*m]+h[2*v]),h[S+1]=.25*(h[2*f+1]+h[2*g+1]+h[2*m+1]+h[2*v+1])}else s[_]=s[_+5]=s[_+8]=b,s[_+1]=s[_+10]=s[_+12]=A,s[_+2]=s[_+6]=s[_+14]=T,s[_+3]=s[_+7]=s[_+11]=s[_+15]=n.A.TRI_INDEX,s[_+4]=f,s[_+9]=g,s[_+13]=m}t.setFacesTexCoord(s)}(e,t,i)}(e,t,r),t.allocateArrays()},Er.partialSubdivision=function(e,t,i,r){kr(e,t,i,r),xr(e,t,i,r)};const wr=Er;var Cr={importOBJ:function(e,t){for(var i=[],r=[],a=[],s=[],o=[],l=[],u=[],c=[],h=[],d=0,p=0,_=0,f=0,g=e.split("\n"),m=[],v=1/255,y=g.length,b=0;b<y;++b){var A=g[b].trim();if(0!==A.length){var T,M=A[0];if("v"===M)" "===(T=A[1])?(m=A.split(/\s+/),r.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),m[4]&&a.push(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6])),++_):"t"===T&&(m=A.split(/\s+/),u.push(parseFloat(m[1]),parseFloat(m[2])),++f);else if("f"===M){var S=(m=A.split(/\s+/)).length-1;if(S<3)continue;for(var E=Math.ceil(S/2)-1,R=0;R<E;++R){var k=R+1,x=R+2,w=S-k,C=S-R;w===x&&(w=C,C=n.A.TRI_INDEX);var P,D=m[k].split("/"),I=m[x].split("/"),F=m[w].split("/"),L=C!==n.A.TRI_INDEX;L&&(P=m[C].split("/"));var O=parseInt(D[0],10),V=parseInt(I[0],10),N=parseInt(F[0],10),B=L?parseInt(P[0],10):void 0;if((!L||B!==O&&B!==V&&B!==N)&&O!==V&&O!==N&&V!==N)if(O=(O<0?O+_:O-1)-d,V=(V<0?V+_:V-1)-d,N=(N<0?N+_:N-1)-d,L&&(B=(B<0?B+_:B-1)-d),c.push(O,V,N,L?B:n.A.TRI_INDEX),D[1]){var U=parseInt(D[1],10),G=parseInt(I[1],10),j=parseInt(F[1],10),W=L?parseInt(P[1],10):void 0;U=(U<0?U+f:U-1)-p,G=(G<0?G+f:G-1)-p,j=(j<0?j+f:j-1)-p,L&&(W=(W<0?W+f:W-1)-p),h.push(U,G,j,L?W:n.A.TRI_INDEX)}else h.length>0&&h.push(O,V,N,L?B:n.A.TRI_INDEX)}}else if("#"===M){if("M"!==A[1])continue;if(A.startsWith("#MRGB "))for(var z=(m=A.split(/\s+/))[1],X=2,K=z.length;X<K;X+=8){var Y=parseInt(z.substr(X,6),16);s.push((Y>>16)*v,(Y>>8&255)*v,(255&Y)*v)}else if(A.startsWith("#MAT "))for(var H=(m=A.split(/\s+/))[1],q=0,Z=H.length;q<Z;q+=6){var Q=parseInt(H.substr(q,6),16);l.push((Q>>16)*v,(Q>>8&255)*v,(255&Q)*v)}}else A.startsWith("o ")&&(i.length>0&&(Cr.initMeshOBJ(i[i.length-1],r,c,a,o,u,h,s,l),d=_,p=f),i.push(new Qt(t)))}}return 0===i.length&&(i[0]=new Qt(t)),Cr.initMeshOBJ(i[i.length-1],r,c,a,o,u,h,s,l),i},initMeshOBJ:function(e,t,i,r,n,a,s,o,l){e.setVertices(new Float32Array(t)),e.setFaces(new Uint32Array(i)),o.length===t.length?e.setColors(new Float32Array(o)):r.length===t.length&&e.setColors(new Float32Array(r)),l.length===t.length?e.setMaterials(new Float32Array(l)):n.length===t.length&&e.setMaterials(new Float32Array(n)),a.length>0&&s.length===i.length&&e.initTexCoordsDataFromOBJData(a,s),t.length=i.length=0,o.length=r.length=0,l.length=n.length=0,a.length=s.length=0}};const Pr=Cr;var Dr={VERSION:3,exportSGL:function(e,t){var i,r=e.length,n=4*(9+31*r),a=0;for(a=0;a<r;++a)n+=4*(i=e[a]).getNbVertices()*3,i.getColors()&&(n+=4*i.getNbVertices()*3),i.getMaterials()&&(n+=4*i.getNbVertices()*3),n+=4*i.getNbFaces()*4,i.hasUV()&&(n+=4*i.getNbTexCoords()*2,n+=4*i.getNbFaces()*4);var s=new ArrayBuffer(n),o=new Float32Array(s),l=new Uint32Array(s),u=0;l[u++]=Dr.VERSION,l[u++]=t._showGrid,l[u++]=b.showSymmetryLine,l[u++]=t._showContour;var c=t.getCamera();for(l[u++]=c.getProjectionType(),l[u++]=c.getMode(),o[u++]=c.getFov(),l[u++]=c.getUsePivot(),l[u++]=r,a=0;a<r;++a){i=e[a],l[u++]=i.getShaderType(),l[u++]=i.getMatcap(),l[u++]=i.getShowWireframe(),l[u++]=i.getFlatShading(),o[u++]=i.getOpacity(),o.set(i.getCenter(),u),u+=3,o.set(i.getMatrix(),u),u+=16,o[u++]=i.getScale();var h=i.getNbVertices();l[u++]=h,o.set(i.getVertices().subarray(0,3*h),u),u+=3*h;var d=i.getColors()?h:0;l[u++]=d,d>0&&o.set(i.getColors().subarray(0,3*h),u),u+=3*d;var p=i.getMaterials()?h:0;l[u++]=p,p>0&&o.set(i.getMaterials().subarray(0,3*h),u),u+=3*p;var _=i.getNbFaces();l[u++]=_,l.set(i.getFaces().subarray(0,4*_),u),u+=4*_;var f=i.hasUV(),g=i.getNbTexCoords();l[u++]=f?g:0,f&&(o.set(i.getTexCoords().subarray(0,2*g),u),u+=2*g),l[u++]=f?_:0,f&&(l.set(i.getFacesTexCoord().subarray(0,4*_),u),u+=4*_)}var m=new DataView(s,0,4*u);return new Blob([m])}};const Ir=Dr;var Fr={},Lr=function(e){for(var t=new Uint32Array(e),i=t.length/4,r=0;r<i;++r){var a=4*r+3;e[a]<0&&(t[a]=n.A.TRI_INDEX)}return t};Fr.importSGL=function(e,t,i){var r=new Float32Array(e),n=new Uint32Array(e),a=new Int32Array(e),s=0,o=n[s++];if(o>Ir.VERSION)return[];if(o>=2){i._showGrid=n[s++],b.showSymmetryLine=n[s++],i._showContour=n[s++];var l=i.getCamera();l.setProjectionType(n[s++]),l.setMode(n[s++]),l.setFov(r[s++]),l.setUsePivot(n[s++])}for(var u=n[s++],c=new Array(u),h=0;h<u;++h){var d=c[h]=new Qt(t);if(o>=2){var p=d.getRenderData();p._shaderType=n[s++],p._matcap=n[s++],p._showWireframe=n[s++],p._flatShading=n[s++],p._alpha=r[s++]}d.getCenter().set(r.subarray(s,s+3)),s+=3,d.getMatrix().set(r.subarray(s,s+16)),s+=16,s++;var _=n[s++];d.setVertices(r.subarray(s,s+3*_)),s+=3*_,(_=n[s++])>0&&d.setColors(r.subarray(s,s+3*_)),s+=3*_,(_=n[s++])>0&&d.setMaterials(r.subarray(s,s+3*_)),s+=3*_,_=n[s++],o<=2?d.setFaces(Lr(a.subarray(s,s+4*_))):d.setFaces(n.subarray(s,s+4*_)),s+=4*_;var f=null;(_=n[s++])&&(f=r.subarray(s,s+2*_)),s+=2*_;var g=null;(_=n[s++])&&(g=o<=2?Lr(a.subarray(s,s+4*_)):n.subarray(s,s+4*_)),s+=4*_,f&&g&&d.initTexCoordsDataFromOBJData(f,g)}return c};const Or=Fr;var Vr={},Nr=function(e){switch(e){case"uchar":case"char":case"int8":case"uint8":return 1;case"ushort":case"short":case"int16":case"uint16":return 2;case"uint":case"int":case"float":case"int32":case"uint32":case"float32":return 4;case"double":case"float64":return 8;default:return 0}},Br=function(e,t){var i=t?1/255:1;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return function(e){return parseInt(e,10)*i};case"float":case"double":case"float32":case"float64":return parseFloat;default:return function(e){return e}}},Ur=function(e,t,i){var r=i?1/255:1,n=t.offsetOctet;switch(t.type){case"int8":case"char":return function(t){return e.getInt8(t+n)*r};case"uint8":case"uchar":return function(t){return e.getUint8(t+n)*r};case"int16":case"short":return function(t){return e.getInt16(t+n,!0)*r};case"uint16":case"ushort":return function(t){return e.getUint16(t+n,!0)*r};case"int32":case"int":return function(t){return e.getInt32(t+n,!0)*r};case"uint32":case"uint":return function(t){return e.getUint32(t+n,!0)*r};case"float32":case"float":return function(t){return e.getFloat32(t+n,!0)};case"float64":case"double":return function(t){return e.getFloat64(t+n,!0)}}},Gr=function(e,t){var i=e.properties,r=e.objProperties={};e.offsetOctet=0;for(var n=0,a=i.length;n<a;++n){var s=i[n],o=r[s.name]={};o.type=s.type,o.type2=s.type2,t.isBinary?(o.offsetOctet=e.offsetOctet,e.offsetOctet+=Nr(s.type)):o.id=n}},jr=function(e,t){Gr(e,t);var i,r=t.vertices=new Float32Array(3*e.count),n=e.objProperties;(n.red||n.green||n.blue)&&(i=t.colors=new Float32Array(3*e.count)),t.isBinary?function(e,t,i,r){var n,a,s,o=e.count,l=e.objProperties,u=e.offsetOctet,c=u*o,h=new DataView(t.buffer,t.offsetOctet,c),d=Ur(h,l.x,!0),p=Ur(h,l.y,!0),_=Ur(h,l.z,!0);l.red&&(n=Ur(h,l.red,!0)),l.green&&(a=Ur(h,l.green,!0)),l.blue&&(s=Ur(h,l.blue,!0));for(var f=0;f<o;++f){var g=3*f,m=f*u;i[g]=d(m),i[g+1]=p(m),i[g+2]=_(m),n&&(r[g]=n(m)),a&&(r[g+1]=a(m)),s&&(r[g+2]=s(m))}t.offsetOctet+=c}(e,t,r,i):function(e,t,i,r){var n,a,s,o,l,u,c=e.count,h=t.lines,d=e.objProperties,p=t.offsetLine,_=Br(d.x.type,!0),f=Br(d.y.type,!0),g=Br(d.z.type,!0),m=d.x.id,v=d.y.id,y=d.z.id;d.red&&(n=Br(d.red.type,!0)),d.green&&(a=Br(d.green.type,!0)),d.blue&&(s=Br(d.blue.type,!0)),d.red&&(o=d.red.id),d.green&&(l=d.green.id),d.blue&&(u=d.blue.id);for(var b=0;b<c;++b){var A=3*b,T=h[p+b].trim().split(/\s+/);i[A]=_(T[m]),i[A+1]=f(T[v]),i[A+2]=g(T[y]),n&&(r[A]=n(T[o])),a&&(r[A+1]=a(T[l])),s&&(r[A+2]=s(T[u]))}t.offsetLine+=c}(e,t,r,i)},Wr=function(e,t,i,r){for(var a=e.count,s=e.objProperties,o=s&&(s.vertex_index||s.vertex_indices)||e.properties[0],l=new DataView(t.buffer,t.offsetOctet),u=Ur(l,o),c=Ur(l,{type:o.type2,offsetOctet:o.offsetOctet+Nr(o.type)}),h=Nr(o.type2),d=e.offsetOctet,p=0,_=0,f=0;f<a;++f){var g=u(p);3!==g&&4!==g||(i[_++]=c(p),i[_++]=c(p+h),i[_++]=c(p+2*h),i[_++]=3===g?n.A.TRI_INDEX:c(p+3*h)),p+=g*h+d}r||(t.faces=i.subarray(0,_)),t.offsetOctet+=p},zr=function(e,t){Gr(e,t);var i=t.faces=new Uint32Array(4*e.count);t.isBinary?Wr(e,t,i):function(e,t,i){for(var r=e.count,a=t.lines,s=e.objProperties,o=t.offsetLine,l=s.vertex_index||s.vertex_indices,u=Br(l.type),c=Br(l.type2),h=l.id,d=0,p=0;p<r;++p){var _=a[o+p].trim().split(/\s+/),f=u(_[0]);3!==f&&4!==f||(i[d]=c(_[h+1]),i[d+1]=c(_[h+2]),i[d+2]=c(_[h+3]),i[d+3]=4===f?c(_[h+4]):n.A.TRI_INDEX,d+=4)}t.offsetLine+=r}(e,t,i)},Xr=function(e,t){var i=e.count;t.isBinary?Wr(e,t,[],!0):t.offsetLine+=i};Vr.importPLY=function(e,t){for(var i=function(e){for(var t,i=n.A.ab2str(e).split("\n"),r={isBinary:!1,start:0,elements:[],lines:i,buffer:e,vertices:null,faces:null,colors:null,offsetLine:0,offsetOctet:0},a=0;;){var s=i[a++];if(r.offsetOctet+=s.length+1,r.offsetLine=a,(s=s.trim()).startsWith("format binary"))r.isBinary=!0;else if(s.startsWith("element"))t=s.split(/\s+/),r.elements.push({name:t[1],count:parseInt(t[2],10),properties:[]});else if(s.startsWith("property")){var o="list"===(t=s.split(/\s+/))[1];r.elements[r.elements.length-1].properties.push({type:t[o?2:1],type2:o?t[3]:void 0,name:t[o?4:2]})}else if(s.startsWith("end_header"))break}return r}(e),r=i.elements,a=0,s=r.length;a<s;++a){var o=r[a];"vertex"===o.name?jr(o,i):"face"===o.name?zr(o,i):Xr(o,i)}var l=new Qt(t);return l.setVertices(i.vertices),l.setFaces(i.faces),l.setColors(i.colors),[l]};const Kr=Vr;var Yr={importSTL:function(e,t){var i,r=new Uint32Array(e,80,1)[0]||0,a=84+50*r===e.byteLength,s=a?Yr.importBinarySTL(e,r):Yr.importAsciiSTL(n.A.ab2str(e));a&&(i=s[1],s=s[0]),r=s.length/9;for(var o=new Map,l=[0],u=new Uint32Array(4*r),c=0;c<r;++c){var h=4*c,d=9*c;u[h]=Yr.detectNewVertex(o,s,i,d,l),u[h+1]=Yr.detectNewVertex(o,s,i,d+3,l),u[h+2]=Yr.detectNewVertex(o,s,i,d+6,l),u[h+3]=n.A.TRI_INDEX}var p=new Qt(t);return p.setVertices(s.subarray(0,3*l[0])),i&&p.setColors(i.subarray(0,3*l[0])),p.setFaces(u),[p]},detectNewVertex:function(e,t,i,r,n){var a=t[r],s=t[r+1],o=t[r+2],l=a+"+"+s+"+"+o,u=e.get(l);if(void 0===u){u=n[0],e.set(l,u);var c=3*u;t[c]=a,t[c+1]=s,t[c+2]=o,i&&(i[c]=i[r],i[c+1]=i[r+1],i[c+2]=i[r+2]),n[0]++}return u},importAsciiSTL:function(e){for(var t=e.split("\n"),i=t.length,r=new Float32Array(Math.ceil(9*i/7)),n=0,a=0;a<i;++a)if(t[a].trim().startsWith("facet")){var s=t[a+2].trim().split(/\s+/);r[n++]=parseFloat(s[1]),r[n++]=parseFloat(s[2]),r[n++]=parseFloat(s[3]),s=t[a+3].trim().split(/\s+/),r[n++]=parseFloat(s[1]),r[n++]=parseFloat(s[2]),r[n++]=parseFloat(s[3]),s=t[a+4].trim().split(/\s+/),r[n++]=parseFloat(s[1]),r[n++]=parseFloat(s[2]),r[n++]=parseFloat(s[3])}return r.subarray(0,n)},importBinarySTL:function(e,t){var i=new Uint8Array(e),r=i.subarray(0,80),n=-1!==String.fromCharCode.apply(null,r).indexOf("COLOR="),a=0,s=new Uint8Array(36*t),o=new Uint8Array(2*t),l=96,u=0,c=0;for(a=0;a<t;a++){for(var h=0;h<36;++h)s[u++]=i[l++];o[c++]=i[l++],o[c++]=i[l++],l+=12}var d=new Uint16Array(o.buffer);o=new Float32Array(9*t);var p=1/31;for(a=0;a<t;++a){u=9*a;var _=d[a],f=1,g=1,m=1,v=32768&_;n?v||(f=(31&_)*p,g=(_>>5&31)*p,m=(_>>10&31)*p):v&&(f=(_>>10&31)*p,g=(_>>5&31)*p,m=(31&_)*p),o[u]=o[u+3]=o[u+6]=f,o[u+1]=o[u+4]=o[u+7]=g,o[u+2]=o[u+5]=o[u+8]=m}return[new Float32Array(s.buffer),o]}};const Hr=Yr,qr={importOBJ:Pr.importOBJ,importSGL:Or.importSGL,importPLY:Kr.importPLY,importSTL:Hr.importSTL};var Zr=__webpack_require__(241),Qr=__webpack_require__.n(Zr);function Jr(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const $r=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._menu=null,this.init(t)}var t,i;return t=e,(i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("backgroundTitle"));this._bg=this._main.getBackground(),t.addCombobox("Type",this._bg._type,this.onBackgroundType.bind(this),["Image","Environment","Ambient env"]),this._ctrlBlur=t.addSlider("Blur",this._bg._blur,this.onEnvBlur.bind(this),0,1,.01),this._ctrlBlur.setVisibility(1===this._bg._type),t.addTitle("Image"),t.addButton((0,k.A)("backgroundReset"),this,"resetBackground"),t.addButton((0,k.A)("backgroundImport"),this,"importBackground"),t.addCheckbox((0,k.A)("backgroundFill"),this._main.getBackground()._fill,this.updateFill.bind(this))}},{key:"updateFill",value:function(e){this._bg._fill=e,this._main.onCanvasResize()}},{key:"resetBackground",value:function(){this._bg.deleteTexture(),this._main.render()}},{key:"onEnvBlur",value:function(e){this._bg._blur=e,this._main.render()}},{key:"onBackgroundType",value:function(e){this._bg.setType(e),this._main.onCanvasResize(),this._main.render(),this._ctrlBlur.setVisibility(1===e)}},{key:"importBackground",value:function(){document.getElementById("backgroundopen").click()}}])&&Jr(t.prototype,i),e}();function en(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var tn=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._menu=null,this._camera=this._main.getCamera(),this._cameraTimer=-1,this._cbTranslation=this.cbOnTranslation.bind(this),this.init(t)}var t,i;return t=e,i=[{key:"init",value:function(e){var t=this._camera,i=this._menu=e.addMenu((0,k.A)("cameraTitle"));i.addTitle((0,k.A)("cameraReset")),i.addDualButton((0,k.A)("cameraCenter"),(0,k.A)("cameraFront"),this.resetCamera.bind(this),this.resetFront.bind(this)),i.addDualButton((0,k.A)("cameraLeft"),(0,k.A)("cameraTop"),this.resetLeft.bind(this),this.resetTop.bind(this)),this._ctrlProjectionTitle=i.addTitle((0,k.A)("cameraProjection"));var n=[];n[r.A.Projection.PERSPECTIVE]=(0,k.A)("cameraPerspective"),n[r.A.Projection.ORTHOGRAPHIC]=(0,k.A)("cameraOrthographic"),this._ctrlProjection=i.addCombobox("",t.getProjectionType(),this.onCameraTypeChange.bind(this),n),this._ctrlFov=i.addSlider((0,k.A)("cameraFov"),t.getFov(),this.onFovChange.bind(this),10,90,1),this._ctrlFov.setVisibility(t.getProjectionType()===r.A.Projection.PERSPECTIVE),i.addTitle((0,k.A)("cameraMode"));var a=[];a[r.A.CameraMode.ORBIT]=(0,k.A)("cameraOrbit"),a[r.A.CameraMode.SPHERICAL]=(0,k.A)("cameraSpherical"),a[r.A.CameraMode.PLANE]=(0,k.A)("cameraPlane"),i.addCombobox("",t.getMode(),this.onCameraModeChange.bind(this),a),this._ctrlPivot=i.addCheckbox((0,k.A)("cameraPivot"),t.getUsePivot(),this.onPivotChange.bind(this)),i.addSlider("speed",this._main,"_cameraSpeed",.05,1,.001)}},{key:"onCameraModeChange",value:function(e){this._camera.setMode(e),this._main.render()}},{key:"onCameraTypeChange",value:function(e){this._camera.setProjectionType(e),this._ctrlFov.setVisibility(e===r.A.Projection.PERSPECTIVE),this._main.render()}},{key:"onFovChange",value:function(e){this._camera.setFov(e),this._main.render()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault();var t=this._main,i=t.getCamera();switch(e.handled=!0,e.shiftKey&&t._action===r.A.Action.CAMERA_ROTATE&&(i.snapClosestRotation(),t.render()),s.A.getShortKey(e.which)){case r.A.KeyAction.STRIFE_LEFT:i._moveX=-1;break;case r.A.KeyAction.STRIFE_RIGHT:i._moveX=1;break;case r.A.KeyAction.STRIFE_UP:i._moveZ=-1;break;case r.A.KeyAction.STRIFE_DOWN:i._moveZ=1;break;default:e.handled=!1}!0===e.handled&&-1===this._cameraTimer&&(this._cameraTimer=window.setInterval(this._cbTranslation,16.6))}}},{key:"cbOnTranslation",value:function(){var e=this._main;e.getCamera().updateTranslation(),e.render()}},{key:"onKeyUp",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault(),e.handled=!0;var t=this._camera;switch(s.A.getShortKey(e.which)){case r.A.KeyAction.STRIFE_LEFT:case r.A.KeyAction.STRIFE_RIGHT:t._moveX=0;break;case r.A.KeyAction.STRIFE_UP:case r.A.KeyAction.STRIFE_DOWN:t._moveZ=0;break;case r.A.KeyAction.CAMERA_RESET:this.resetCamera();break;case r.A.KeyAction.CAMERA_FRONT:this.resetFront();break;case r.A.KeyAction.CAMERA_TOP:this.resetTop();break;case r.A.KeyAction.CAMERA_LEFT:this.resetLeft();break;default:e.handled=!1}-1!==this._cameraTimer&&0===t._moveX&&0===t._moveZ&&(clearInterval(this._cameraTimer),this._cameraTimer=-1)}}},{key:"resetCamera",value:function(){this._camera.resetView(),this._main.render()}},{key:"resetFront",value:function(){this._camera.toggleViewFront(),this._main.render()}},{key:"resetLeft",value:function(){this._camera.toggleViewLeft(),this._main.render()}},{key:"resetTop",value:function(){this._camera.toggleViewTop(),this._main.render()}},{key:"onPivotChange",value:function(){this._camera.toggleUsePivot(),this._main.render()}}],i&&en(t.prototype,i),e}();const rn=tn;function nn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const an=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=i,this._menu=null,this.init(t)}var t,i;return t=e,(i=[{key:"init",value:function(e){this._langs=Object.keys(k.A.languages),this._menu=e.addMenu("Language"),this._menu.addCombobox("",this._langs.indexOf(k.A.select),this.onLangChange.bind(this),this._langs)}},{key:"onLangChange",value:function(e){k.A.select=this._langs[parseInt(e,10)],this._ctrlGui.initGui()}}])&&nn(t.prototype,i),e}();var sn=__webpack_require__(464),on=__webpack_require__(442),ln={exportOBJ:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="s 0\n",n=[1,1],a=0,s=e.length;a<s;++a)r+="o mesh_"+a+"\n",r=ln.addMesh(e[a],r,n,t,i);return new Blob([r])}},un=function(e,t,i){for(var r=0,n=t.length;r<n;r++)e[i++]=t.charCodeAt(r);return i};ln.addMesh=function(t,i,r,a,s){var o=t.getVertices(),l=t.getColors(),u=t.getMaterials(),c=t.getFaces(),h=t.getNbVertices(),d=t.getNbFaces(),p=t.getNbTexCoords(),_=t.getMatrix(),f=0,g=0,m="",v=0;v=s?128*h:79*h,v+=45*p+66*d;var y=new Uint8Array(Math.max(1e3,v)),b=0,A=[0,0,0];for(f=0;f<h;++f)g=3*f,A[0]=o[g],A[1]=o[g+1],A[2]=o[g+2],e.Z0(A,A,_),m="v "+A[0]+" "+A[1]+" "+A[2],m+=s?" "+l[g]+" "+l[g+1]+" "+l[g+2]+"\n":"\n",b=un(y,m,b);if(a){var T=Math.ceil(h/64);for(f=0;f<T;++f){m="#MRGB ",g=64*f;for(var M=f===T-1?h:g+64;g<M;++g){m+="ff";var S=3*g,E=Math.round(255*l[S]).toString(16),R=Math.round(255*l[S+1]).toString(16),k=Math.round(255*l[S+2]).toString(16);m+=1===E.length?"0"+E:E,m+=1===R.length?"0"+R:R,m+=1===k.length?"0"+k:k}b=un(y,m+="\n",b)}for(T=Math.ceil(h/46),f=0;f<T;++f){m="#MAT ",g=46*f;for(var x=f===T-1?h:g+46;g<x;++g){var w=3*g,C=Math.round(255*u[w]).toString(16),P=Math.round(255*u[w+1]).toString(16),D=Math.round(255*u[w+2]).toString(16);m+=1===C.length?"0"+C:C,m+=1===P.length?"0"+P:P,m+=1===D.length?"0"+D:D}b=un(y,m+="\n",b)}}var I=t.getFacesTexCoord(),F=t.getTexCoords(),L=t.hasUV();if(L)for(f=0;f<p;++f)m="vt "+F[g=2*f]+" "+F[g+1]+"\n",b=un(y,m,b);var O=r[0],V=r[1];for(r[0]+=h,r[1]+=p,f=0;f<d;++f){var N=c[3+(g=4*f)];L?(m="f "+(O+c[g])+"/"+(V+I[g]),m+=" "+(O+c[g+1])+"/"+(V+I[g+1]),m+=" "+(O+c[g+2])+"/"+(V+I[g+2]),m+=N!==n.A.TRI_INDEX?" "+(O+N)+"/"+(V+I[g+3])+"\n":"\n"):(m="f "+(O+c[g]),m+=" "+(O+c[g+1]),m+=" "+(O+c[g+2]),m+=N!==n.A.TRI_INDEX?" "+(O+N)+"\n":"\n"),b=un(y,m,b)}if(y=y.subarray(0,b),window.TextDecoder)return i+(new TextDecoder).decode(y);for(f=0;f<b;++f)i+=String.fromCharCode(y[f]);return i};const cn=ln;var hn={},dn=function(e){return Fi.mergeArrays(e,{vertices:null,colors:null,faces:null})};hn.exportAsciiPLY=function(e){var t=dn(e),i=t.nbVertices,r=t.nbFaces,a=t.vertices,s=t.colors,o=t.faces,l=0,u=0,c="ply\nformat ascii 1.0\ncomment created by SculptGL\n";for(c+="element vertex "+i+"\n",c+="property float x\nproperty float y\nproperty float z\n",c+="property uchar red\nproperty uchar green\nproperty uchar blue\n",c+="element face "+r+"\n",c+="property list uchar uint vertex_indices\nend_header\n",l=0;l<i;++l)c+=a[u=3*l]+" "+a[u+1]+" "+a[u+2]+" "+(255*s[u]|0)+" "+(255*s[u+1]|0)+" "+(255*s[u+2]|0)+"\n";for(l=0;l<r;++l){var h=o[3+(u=4*l)],d=h!==n.A.TRI_INDEX;c+=(d?"4 ":"3 ")+o[u]+" "+o[u+1]+" "+o[u+2]+(d?" "+h+"\n":"\n")}return new Blob([c])},hn.exportBinaryPLY=function(e,t){var i=dn(e),r=i.nbVertices,a=i.nbFaces,s=i.nbQuads,o=i.nbTriangles,l=i.vertices,u=i.colors,c=i.faces,h=0,d=0,p=0;if(t&&t.swapXY)for(h=0;h<r;++h){var _=l[1+(p=3*h)];l[p+1]=-l[p+2],l[p+2]=_}var f="ply\nformat binary_"+(n.A.littleEndian?"little":"big")+"_endian 1.0\ncomment created by SculptGL\n";f+="element vertex "+r+"\n",f+="property float x\nproperty float y\nproperty float z\n",f+="property uchar red\nproperty uchar green\nproperty uchar blue\n",f+="element face "+a+"\n",f+="property list uchar uint vertex_indices\nend_header\n";var g=4*l.length+u.length,m=4*(4*s+3*o)+a,v=f.length+g+2*m,y=new Uint8Array(v),b=new DataView(y.buffer);d=f.length;var A=0;for(A=0;A<d;++A)y[A]=f.charCodeAt(A);for(h=0;h<r;++h)d=3*h,b.setFloat32(A,l[d],!0),A+=4,b.setFloat32(A,l[d+1],!0),A+=4,b.setFloat32(A,l[d+2],!0),A+=4,b.setUint8(A,Math.round(255*u[d])),A+=1,b.setUint8(A,Math.round(255*u[d+1])),A+=1,b.setUint8(A,Math.round(255*u[d+2])),A+=1;for(h=0;h<a;++h){var T=c[3+(d=4*h)]!==n.A.TRI_INDEX;b.setUint8(A,T?4:3),A+=1,b.setUint32(A,c[d],!0),A+=4,b.setUint32(A,c[d+1],!0),A+=4,b.setUint32(A,c[d+2],!0),A+=4,T&&(b.setUint32(A,c[d+3],!0),A+=4)}return new Blob([y])};const pn=hn;var _n={},fn=function(t){for(var i=Fi.mergeArrays(t,{vertices:null,colors:null,triangles:null}),r=i.vertices,n=i.triangles,a=e.vt(),s=e.vt(),o=e.vt(),l=i.faceNormals=new Float32Array(3*i.nbTriangles),u=0;u<i.nbTriangles;++u){var c=3*u,h=3*n[c],d=3*n[c+1],p=3*n[c+2];e.hZ(a,r[h],r[h+1],r[h+2]),e.hZ(s,r[d],r[d+1],r[d+2]),e.hZ(o,r[p],r[p+1],r[p+2]),e.jb(s,s,a),e.jb(o,o,s),e.$A(a,s,o),e.S8(a,a),l[c]=a[0],l[c+1]=a[1],l[c+2]=a[2]}return i};_n.exportAsciiSTL=function(e){for(var t=fn(e),i=t.nbTriangles,r=t.vertices,n=t.triangles,a=t.faceNormals,s="solid mesh\n",o=0;o<i;++o){var l=3*o;s+=" facet normal "+a[l]+" "+a[l+1]+" "+a[l+2]+"\n",s+="  outer loop\n";var u=3*n[l],c=3*n[l+1],h=3*n[l+2];s+="   vertex "+r[u]+" "+r[u+1]+" "+r[u+2]+"\n",s+="   vertex "+r[c]+" "+r[c+1]+" "+r[c+2]+"\n",s+="   vertex "+r[h]+" "+r[h+1]+" "+r[h+2]+"\n",s+="  endloop\n",s+=" endfacet\n"}return s+="endsolid mesh\n",new Blob([s])},_n.exportBinarySTL=function(e,t){var i,r,n=fn(e),a=n.nbTriangles,s=n.vertices,o=n.colors,l=n.triangles,u=n.faceNormals;if(t&&t.swapXY){var c=n.nbVertices;for(i=0;i<c;++i){var h=s[1+(r=3*i)];s[r+1]=-s[r+2],s[r+2]=h}}var d=new Uint8Array(84+50*a),p=t&&t.colorMagic;if(p){var _=[67,79,76,79,82,61,255,255,255,255];for(i=0;i<_.length;++i)d[i]=_[i]}new DataView(d.buffer).setUint32(80,a,!0);var f=new Uint8Array(s.buffer),g=new Uint8Array(u.buffer),m=84,v=0,y=p?0:32768,b=31/3;for(i=0;i<a;++i){for(r=12*i,v=0;v<12;++v)d[m++]=g[r++];var A=3*l[r=3*i],T=3*l[r+1],M=3*l[r+2],S=4*A;for(v=0;v<12;++v)d[m++]=f[S++];var E=4*T;for(v=0;v<12;++v)d[m++]=f[E++];var R=4*M;for(v=0;v<12;++v)d[m++]=f[R++];var k=Math.round((o[A]+o[T]+o[M])*b),x=Math.round((o[A+1]+o[T+1]+o[M+1])*b)<<5,w=Math.round((o[A+2]+o[T+2]+o[M+2])*b);p?w<<=10:k<<=10;var C=k+x+w+y;d[m++]=255&C,d[m++]=C>>8}return new Blob([d])};const gn=_n;var mn=__webpack_require__(863),vn=__webpack_require__.n(mn);function yn(e){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(e)}var bn={exportSketchfab:function(e,t){if(window.sketchfabOAuth2Config){var i=new XMLHttpRequest;return new(vn())(window.sketchfabOAuth2Config).connect().then(function(r){!function(e,t,i,r){e.open("POST","https://api.sketchfab.com/v2/models",!0),e.onprogress=function(e){if(e.lengthComputable&&e.total){var t=Math.round(100*e.loaded/e.total);r.setVisibility("Sketchfab upload: "+t+"%")}};var n=function(){r.setMessage("")};e.onerror=n,e.onabort=n,e.onload=function(){n();var t=JSON.parse(e.responseText),r=t.uid;r?(window.prompt((0,k.A)("sketchfabUploadProcessing"),"https://sketchfab.com/models/"+r),function e(){var t=new XMLHttpRequest,n="https://api.sketchfab.com/v2/models/"+r+"/status";"object"===yn(i)&&i.hasOwnProperty("token_type")&&"Bearer"===i.token_type?(t.open("GET",n,!0),t.setRequestHeader("Authorization","Bearer "+i.access_token)):t.open("GET",n+"?token="+i,!0),t.onload=function(){var i=JSON.parse(t.responseText);"FAILED"===i.processing?window.alert((0,k.A)("sketchfabUploadError",i.warning.generic.join("\n"))):"SUCCEEDED"===i.processing?window.prompt((0,k.A)("sketchfabUploadSuccess"),"https://sketchfab.com/models/"+r):window.setTimeout(e,5e3)},t.send()}()):window.alert((0,k.A)("sketchfabUploadError",t.detail))},r.setMessage("Creating zip..."),on.zip.useWebWorkers=!0,on.zip.workerScriptsPath="worker/",on.zip.createWriter(new on.zip.BlobWriter("application/zip"),function(n){var a=pn.exportBinaryPLY(t.getMeshes(),{swapXY:!0});n.add("yourMesh.ply",new on.zip.BlobReader(a),function(){n.close(bn.exportFileSketchfab.bind(this,i,e,r))})},onerror)}(i,e,r,t)}).catch(function(e){console.error(e)}),i}},exportFileSketchfab:function(e,t,i,r){if(!t.isAborted){var n=new FormData;n.append("modelFile",r,"sculptglModel.zip"),n.append("name","My model"),n.append("tags","sculptgl"),"object"===yn(e)&&e.hasOwnProperty("token_type")&&"Bearer"===e.token_type?t.setRequestHeader("Authorization","Bearer "+e.access_token):n.append("token",e),i.setMessage("Sketchfab upload..."),t.send(n)}}};const An=bn;var Tn={exportSculpteo:function(e,t){var i=new XMLHttpRequest;i.open("POST","uploadSculpteo.php",!0),i.onprogress=function(e){if(e.lengthComputable&&e.total){var i=Math.round(100*e.loaded/e.total);t.setMessage("Sculpteo upload: "+i+"%")}};var r=function(){t.setMessage("")};i.onerror=r,i.onabort=r,i.onload=function(){if(r(),200===this.status){var e=i.responseText.match(/\/print\/(.+?)(?=")/);e&&window.open("https://www.sculpteo.com/en"+e[0],"_blank")}};var n=e.getMeshes(),a=e.computeBoundingBoxMeshes(n),s=e.computeRadiusFromBoundingBox(a),o=pn.exportBinaryPLY(n,{swapXY:!0});return t.setMessage("Creating zip..."),on.zip.useWebWorkers=!0,on.zip.workerScriptsPath="worker/",on.zip.createWriter(new on.zip.BlobWriter("application/zip"),function(e){e.add("yourMesh.ply",new on.zip.BlobReader(o),function(){e.close(Tn.exportFileSculpteo.bind(this,s,i,t))})},onerror),i},exportFileSculpteo:function(e,t,i,r){if(!t.isAborted){var n=new FormData;n.append("file",r),n.append("name","fromSculptgl"),n.append("scale",4/e),i.setMessage("Sculpteo upload..."),t.send(n)}}};const Mn=Tn;var Sn={exportMaterialise:function(e,t){var i=new XMLHttpRequest;i.open("POST","https://i.materialise.com/web-api/tool/20cc0fd6-3cef-4111-a201-0b87026d892c/model",!0),i.onprogress=function(e){if(e.lengthComputable&&e.total){var i=Math.round(100*e.loaded/e.total);t.setMessage("Materialise upload: "+i+"%")}};var r=function(){t.setMessage("")};i.onerror=r,i.onabort=r,i.onload=function(){if(r(),200===i.status){var e=JSON.parse(i.responseText);window.open("https://i.materialise.com/en/3dprint#modelId="+e.modelID,"_blank")}};var n=e.getMeshes(),a=e.computeBoundingBoxMeshes(n),s=e.computeRadiusFromBoundingBox(a),o=gn.exportBinarySTL(n,{colorMagic:!0,swapXY:!0});return t.setMessage("Creating zip..."),on.zip.useWebWorkers=!0,on.zip.workerScriptsPath="worker/",on.zip.createWriter(new on.zip.BlobWriter("application/zip"),function(e){e.add("yourMesh.stl",new on.zip.BlobReader(o),function(){e.close(Sn.exportFileMaterialise.bind(this,s,i,t))})},onerror),i},exportFileMaterialise:function(e,t,i,r){if(!t.isAborted){var n=new FormData;n.append("file",r,"yourMesh.zip"),i.setMessage("Materialise upload..."),t.send(n)}}};const En=Sn;var Rn={};Rn.exportOBJ=cn.exportOBJ,Rn.exportSGL=Ir.exportSGL,Rn.exportAsciiPLY=pn.exportAsciiPLY,Rn.exportBinaryPLY=pn.exportBinaryPLY,Rn.exportAsciiSTL=gn.exportAsciiSTL,Rn.exportBinarySTL=gn.exportBinarySTL,Rn.exportSketchfab=An.exportSketchfab,Rn.exportSculpteo=Mn.exportSculpteo,Rn.exportMaterialise=En.exportMaterialise;const kn=Rn;var xn={_gl:null,_checkRTT:{},_webGLExtensions:{}};xn.HALF_FLOAT=xn.HALF_FLOAT_OES=36193,xn.checkRTTSupport=function(e,t){var i=xn._gl;if(void 0===i)return!1;var r=e+","+t;if(void 0!==xn._checkRTT[r])return xn._checkRTT[r];var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,2,2,0,i.RGBA,e,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t);var a=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0);var s=xn._checkRTT[r]=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;return i.deleteTexture(n),i.deleteFramebuffer(a),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null),s},xn.hasRTTLinearHalfFloat=function(){return xn._webGLExtensions.OES_texture_half_float_linear&&xn.checkRTTSupport(xn.HALF_FLOAT,xn._gl.LINEAR)},xn.hasRTTLinearFloat=function(){return xn._webGLExtensions.OES_texture_float_linear&&xn.checkRTTSupport(xn._gl.FLOAT,xn._gl.LINEAR)},xn.hasRTTHalfFloat=function(){return xn._webGLExtensions.OES_texture_half_float&&xn.checkRTTSupport(xn.HALF_FLOAT,xn._gl.NEAREST)},xn.hasRTTFloat=function(){return xn._webGLExtensions.OES_texture_float&&xn.checkRTTSupport(xn._gl.FLOAT,xn._gl.NEAREST)},xn.getWebGLExtension=function(e){return xn._webGLExtensions[e]},xn.getWebGLExtensions=function(){return xn._webGLExtensions},xn.initWebGLExtensions=function(e){xn._gl=e;for(var t=e.getSupportedExtensions(),i=xn._webGLExtensions,r=0,n=t.length;r<n;++r){var a=t[r];i[a]=e.getExtension(a)}};const wn=xn;function Cn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pn,Dn=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.createRenderbuffer(),n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._texture=t.createTexture(),this._depth=r,this._framebuffer=t.createFramebuffer(),this._shaderType=i,this._invSize=new Float32Array(2),this._vertexBuffer=null,n&&wn.hasRTTHalfFloat()?this._type=wn.HALF_FLOAT_OES:n&&wn.hasRTTFloat()?this._type=t.FLOAT:this._type=t.UNSIGNED_BYTE,this.setWrapRepeat(!1),this.setFilterNearest(!1),this.init()}var t,i;return t=e,i=[{key:"getGL",value:function(){return this._gl}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getFramebuffer",value:function(){return this._framebuffer}},{key:"getTexture",value:function(){return this._texture}},{key:"getDepth",value:function(){return this._depth}},{key:"getInverseSize",value:function(){return this._invSize}},{key:"init",value:function(){var e=this._gl;Pn||(Pn=new p(e,e.ARRAY_BUFFER,e.STATIC_DRAW)).update(new Float32Array([-1,-1,4,-1,-1,4])),this._vertexBuffer=Pn}},{key:"setWrapRepeat",value:function(e){this._wrapRepeat=e}},{key:"setFilterNearest",value:function(e){this._filterNearest=e}},{key:"onResize",value:function(e,t){var i=this._gl;this._invSize[0]=1/e,this._invSize[1]=1/t,i.bindTexture(i.TEXTURE_2D,this._texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,this._type,null);var r=this._filterNearest?i.NEAREST:i.LINEAR;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r);var n=this._wrapRepeat?i.REPEAT:i.CLAMP_TO_EDGE;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,n),this._depth&&(i.bindRenderbuffer(i.RENDERBUFFER,this._depth),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t)),i.bindFramebuffer(i.FRAMEBUFFER,this._framebuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this._depth),i.bindTexture(i.TEXTURE_2D,null)}},{key:"release",value:function(){this._texture&&this._gl.deleteTexture(this._texture),this.getVertexBuffer().release()}},{key:"render",value:function(e){te[this._shaderType].getOrCreate(this._gl).draw(this,e)}}],i&&Cn(t.prototype,i),e}();const In=Dn;function Fn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Ln=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._ctrlGui=i,this._menu=null,this._parent=t,this._exportAll=!0,this._objColorZbrush=!0,this._objColorAppended=!1,this.init(t)}var t,i;return t=e,(i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("fileTitle"));t.addTitle((0,k.A)("fileImportTitle")),t.addButton((0,k.A)("fileAdd"),this,"addFile"),t.addCheckbox((0,k.A)("fileAutoMatrix"),this._main,"_autoMatrix"),t.addCheckbox((0,k.A)("fileVertexSRGB"),this._main,"_vertexSRGB"),t.addTitle((0,k.A)("fileExportSceneTitle")),t.addCheckbox((0,k.A)("fileExportAll"),this,"_exportAll"),t.addButton((0,k.A)("fileExportSGL"),this,"saveFileAsSGL"),t.addButton((0,k.A)("fileExportOBJ"),this,"saveFileAsOBJ"),t.addButton((0,k.A)("fileExportPLY"),this,"saveFileAsPLY"),t.addButton((0,k.A)("fileExportSTL"),this,"saveFileAsSTL"),t.addCheckbox("OBJ color zbrush",this,"_objColorZbrush"),t.addCheckbox("OBJ color append",this,"_objColorAppended"),t.addButton((0,k.A)("sketchfabTitle"),this._ctrlGui,"exportSketchfab"),t.addTitle((0,k.A)("fileExportTextureTitle")),this._guiTexSize=t.addSlider((0,k.A)("fileExportTextureSize"),10,this.onTextureSize.bind(this),8,12,1),this._guiTexSize.setValue(10),t.addButton((0,k.A)("fileExportColor"),this,"saveColor"),t.addButton((0,k.A)("fileExportRoughness"),this,"saveRoughness"),t.addButton((0,k.A)("fileExportMetalness"),this,"saveMetalness")}},{key:"addFile",value:function(){document.getElementById("fileopen").click()}},{key:"onTextureSize",value:function(e){this._texSize=1<<e,this._guiTexSize.domInputText.value=this._texSize}},{key:"_getExportMeshes",value:function(){if(this._exportAll)return this._main.getMeshes();var e=this._main.getSelectedMeshes();return e.length?e:void 0}},{key:"_extractTexture",value:function(e,t,i){var r=document.createElement("canvas");r.width=t,r.height=i;var n=new Uint8Array(4*t*i);if(e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return console.error("FRAMEBUFFER not complete"),r;e.flush(),e.finish(),e.readPixels(0,0,t,i,e.RGBA,e.UNSIGNED_BYTE,n);var a=r.getContext("2d"),s=a.getImageData(0,0,t,i);return s.data.set(n),a.putImageData(s,0,0),r}},{key:"_getRttPaint",value:function(e){return this._rttPaint||(this._rttPaint=new In(e,r.A.Shader.PAINTUV,null),this._rttPaint.setWrapRepeat(!0),this._rttPaint.setFilterNearest(!0),$.INPUT_TEXTURE=this._getRttPaint()),this._rttPaint}},{key:"_getRttBlur",value:function(e){return this._rttBlur||(this._rttBlur=new In(e,r.A.Shader.BLUR,null)),this._rttBlur}},{key:"_saveTexture",value:function(e){var t=this._main.getMesh();if(t)if(t.getTexCoords()){var i=t.getGL(),n=this._texSize,a=this._texSize,s=t.getShaderType();t.setShaderType(r.A.Shader.PAINTUV);var o=this._getRttPaint(i);o.onResize(n,a),i.bindFramebuffer(i.FRAMEBUFFER,o.getFramebuffer()),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,n,a),t.render(),t.setShaderType(s),this._blurImage(i,n,a),this._extractTexture(i,n,a).toBlob(function(t){(0,sn.saveAs)(t,e+".png")}.bind(this)),this._main.onCanvasResize()}else window.alert("The selected mesh has no UV!")}},{key:"_blurImage",value:function(e,t,i){var r=this._getRttBlur(e);r.onResize(t,i),e.bindFramebuffer(e.FRAMEBUFFER,r.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),r.render(this._main)}},{key:"saveColor",value:function(){Q.CHANNEL_VALUE=0,this._saveTexture("diffuse")}},{key:"saveRoughness",value:function(){Q.CHANNEL_VALUE=1,this._saveTexture("roughness")}},{key:"saveMetalness",value:function(){Q.CHANNEL_VALUE=2,this._saveTexture("metalness")}},{key:"saveFileAsSGL",value:function(){var e=this._getExportMeshes();e&&this._save(kn.exportSGL(e,this._main),"yourMesh.sgl")}},{key:"saveFileAsOBJ",value:function(){var e=this._getExportMeshes();e&&this._save(kn.exportOBJ(e,this._objColorZbrush,this._objColorAppended),"yourMesh.obj")}},{key:"saveFileAsPLY",value:function(){var e=this._getExportMeshes();e&&this._save(kn.exportBinaryPLY(e),"yourMesh.ply")}},{key:"saveFileAsSTL",value:function(){var e=this._getExportMeshes();e&&this._save(kn.exportBinarySTL(e),"yourMesh.stl")}},{key:"_save",value:function(e,t,i){if(!i)return(0,sn.saveAs)(e,t);on.zip.useWebWorkers=!0,on.zip.workerScriptsPath="worker/",on.zip.createWriter(new on.zip.BlobWriter("application/zip"),function(i){i.add(t,new on.zip.BlobReader(e),function(){i.close(function(e){(0,sn.saveAs)(e,"yourMesh.zip")})})},onerror)}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&e.altKey&&78===t?(this._main.clearScene(),e.handled=!0):!e.ctrlKey||79!==t&&73!==t?e.ctrlKey&&69===t&&(this.saveFileAsOBJ(),e.handled=!0):(this.addFile(),e.handled=!0)}}}])&&Fn(t.prototype,i),e}();function On(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Vn=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this.domVerts=null,this.domFaces=null,this.domUl=null,this.init(t)}var t,i;return t=e,(i=[{key:"init",value:function(e){this.domVerts=document.createElement("ul"),this.domVerts.innerHTML=(0,k.A)("meshNbVertices"),this.domFaces=document.createElement("ul"),this.domFaces.innerHTML=(0,k.A)("meshNbFaces"),this.domUl=document.createElement("span"),this.domUl.appendChild(this.domVerts),this.domUl.appendChild(this.domFaces);var t=this.domUl.style;t.cursor="default",void 0===t.float?t.cssFloat="right":t.float="right",e.domTopbar.appendChild(this.domUl)}},{key:"updateMeshInfo",value:function(){var e=this._main.getMesh();this.domVerts.innerHTML=(0,k.A)("meshNbVertices")+(e?e.getNbVertices():0),this.domFaces.innerHTML=(0,k.A)("meshNbFaces")+(e?e.getNbFaces():0)}}])&&On(t.prototype,i),e}();function Nn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Bn=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._ctrlGui=r,this._sculptManager=r._main.getSculptManager(),this._isEnabled=!1,this._menuTop=null,this._menuSide=null,this._ctrlMode=null,this._ctrlSelectVertex=null,this._ctrlSelectEdge=null,this._ctrlSelectFace=null,this._ctrlActionReplace=null,this._ctrlActionAdd=null,this._ctrlActionRemove=null,this.init(t,i)}var t,i;return t=e,(i=[{key:"init",value:function(e,t){this._menuTop=e.addMenu((0,k.A)("modelingTitle")),this._ctrlMode=this._menuTop.addCheckbox((0,k.A)("modelingMode"),!1,this.onToggle.bind(this)),this._menuSide=t.addMenu((0,k.A)("modelingSidebarTitle")),this._menuSide.close(),this._menuSide.addTitle((0,k.A)("modelingSelectionTitle"));var i=this._sculptManager.getTool(r.A.Tools.ELEMENTSELECT);this._ctrlSelectVertex=this._menuSide.addCheckbox((0,k.A)("modelingSelectVertex"),i._selectionMode===i.constructor.Mode.VERTEX,function(){this.setSelectionMode(i.constructor.Mode.VERTEX)}.bind(this)),this._ctrlSelectEdge=this._menuSide.addCheckbox((0,k.A)("modelingSelectEdge"),i._selectionMode===i.constructor.Mode.EDGE,function(){this.setSelectionMode(i.constructor.Mode.EDGE)}.bind(this)),this._ctrlSelectFace=this._menuSide.addCheckbox((0,k.A)("modelingSelectFace"),i._selectionMode===i.constructor.Mode.FACE,function(){this.setSelectionMode(i.constructor.Mode.FACE)}.bind(this)),this._menuSide.addTitle((0,k.A)("modelingSelectionAction")),this._ctrlActionReplace=this._menuSide.addCheckbox((0,k.A)("modelingActionReplace"),i._selectionAction===i.constructor.Action.REPLACE,function(){this.setSelectionAction(i.constructor.Action.REPLACE)}.bind(this)),this._ctrlActionAdd=this._menuSide.addCheckbox((0,k.A)("modelingActionAdd"),i._selectionAction===i.constructor.Action.ADD,function(){this.setSelectionAction(i.constructor.Action.ADD)}.bind(this)),this._ctrlActionRemove=this._menuSide.addCheckbox((0,k.A)("modelingActionRemove"),i._selectionAction===i.constructor.Action.REMOVE,function(){this.setSelectionAction(i.constructor.Action.REMOVE)}.bind(this)),this._menuSide.addButton((0,k.A)("sculptElementSelectAll"),i,"selectAll"),this._menuSide.addButton((0,k.A)("sculptElementSelectClear"),i,"clearSelection"),this._menuSide.addButton((0,k.A)("sculptElementSelectInvert"),i,"invertSelection"),this._menuSide.addTitle((0,k.A)("modelingToolsTitle")),this._menuSide.addButton((0,k.A)("modelingExtrude"),this,"extrudeSelection"),this._menuSide.addButton((0,k.A)("modelingDelete"),this,"notImplemented"),this._menuSide.addButton((0,k.A)("modelingFill"),this,"notImplemented"),this._menuSide.addButton((0,k.A)("modelingBridge"),this,"notImplemented"),this._menuSide.addButton((0,k.A)("modelingKnife"),this,"notImplemented"),this._menuSide.addButton((0,k.A)("modelingLoopCut"),this,"notImplemented")}},{key:"notImplemented",value:function(){window.alert((0,k.A)("modelingNotImplemented"))}},{key:"extrudeSelection",value:function(){var e=this._main.getModelingSystem();e?e.extrudeSelection(.15):window.alert((0,k.A)("modelingNotImplemented"))}},{key:"setSelectionMode",value:function(e){var t=this._sculptManager.getTool(r.A.Tools.ELEMENTSELECT);t._selectionMode=e,this._ctrlSelectVertex.setValue(e===t.constructor.Mode.VERTEX,!0),this._ctrlSelectEdge.setValue(e===t.constructor.Mode.EDGE,!0),this._ctrlSelectFace.setValue(e===t.constructor.Mode.FACE,!0);var i=this._main.getModelingSystem();i&&i.setSelectionMode(e)}},{key:"setSelectionAction",value:function(e){var t=this._sculptManager.getTool(r.A.Tools.ELEMENTSELECT);t._selectionAction=e,this._ctrlActionReplace.setValue(e===t.constructor.Action.REPLACE,!0),this._ctrlActionAdd.setValue(e===t.constructor.Action.ADD,!0),this._ctrlActionRemove.setValue(e===t.constructor.Action.REMOVE,!0);var i=this._main.getModelingSystem();i&&i.setSelectionAction(e)}},{key:"onToggle",value:function(e){this._isEnabled=e,this._ctrlGui.setModelingMode(e),this._main.enableModelingSystem(e),e&&(this._sculptManager.setToolIndex(r.A.Tools.ELEMENTSELECT),this._main.getPicking().updateLocalAndWorldRadius2(),this.setSelectionMode(this._sculptManager.getTool(r.A.Tools.ELEMENTSELECT).constructor.Mode.FACE),this.setSelectionAction(this._sculptManager.getTool(r.A.Tools.ELEMENTSELECT).constructor.Action.REPLACE),this._main.render())}},{key:"updateMesh",value:function(e){this._isEnabled=e;var t=e&&!!this._main.getMesh();this._menuSide.setVisibility(t)}}])&&Nn(t.prototype,i),e}();var Un={RESOLUTION:150,RELAX_ITERATIONS:6,RELAX_INTENSITY:.4,TANGENT:!0,remesh:function(e,t){var i=Fi.RESOLUTION;Fi.RESOLUTION=Un.RESOLUTION;var r=Fi.remesh(e,t,!1);return Fi.RESOLUTION=i,Un.relax(r),r},relax:function(e){if(e&&!(Un.RELAX_ITERATIONS<=0)){for(var t=e.getNbVertices(),i=new Uint32Array(t),r=0;r<t;++r)i[r]=r;var n=new at(null);n.setToolMesh(e);for(var a=0;a<Un.RELAX_ITERATIONS;++a)Un.TANGENT?n.smoothTangent(i,Un.RELAX_INTENSITY):n.smooth(i,Un.RELAX_INTENSITY),e.updateGeometry();e.updateGeometryBuffers()}}};const Gn=Un;function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function Wn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t){return zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},zn(e,t)}function Xn(e){return Xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Xn(e)}var Kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zn(e,t)}(o,e);var t,i,r,a,s=(r=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=Xn(r);if(a){var i=Xn(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==jn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(i=s.call(this)).setID(e.getID()),i.setMeshData(t?e.getMeshData():{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}),i.setRenderData(e.getRenderData()),i.setTransformData(e.getTransformData()),i._detailsXYZ=null,i._detailsRGB=null,i._detailsPBR=null,i._vertMapping=null,i._evenMapping=!1,i}return t=o,i=[{key:"optimize",value:function(){}},{key:"getEvenMapping",value:function(){return this._evenMapping}},{key:"getVerticesMapping",value:function(){return this._vertMapping}},{key:"setVerticesMapping",value:function(e){this._vertMapping=e}},{key:"setEvenMapping",value:function(e){this._evenMapping=e}},{key:"higherSynthesis",value:function(e){e.computePartialSubdivision(this.getVertices(),this.getColors(),this.getMaterials(),this.getNbVertices()),this.applyDetails()}},{key:"lowerAnalysis",value:function(e){this.copyDataFromHigherRes(e);var t=e.getNbVertices(),i=new Float32Array(3*t),r=new Float32Array(3*t),n=new Float32Array(3*t);this.computePartialSubdivision(i,r,n,t),e.computeDetails(i,r,n,t)}},{key:"copyDataFromHigherRes",value:function(e){var t=this.getVertices(),i=this.getColors(),r=this.getMaterials(),n=this.getNbVertices(),a=e.getVertices(),s=e.getColors(),o=e.getMaterials();if(!1===this.getEvenMapping())t.set(a.subarray(0,3*n)),i.set(s.subarray(0,3*n)),r.set(o.subarray(0,3*n));else for(var l=this.getVerticesMapping(),u=0;u<n;++u){var c=3*u,h=3*l[u];t[c]=a[h],t[c+1]=a[h+1],t[c+2]=a[h+2],i[c]=s[h],i[c+1]=s[h+1],i[c+2]=s[h+2],r[c]=o[h],r[c+1]=o[h+1],r[c+2]=o[h+2]}}},{key:"computePartialSubdivision",value:function(e,t,i,r){var n=this.getVerticesMapping();if(n){var a=new Float32Array(3*r),s=new Float32Array(3*r),o=new Float32Array(3*r);wr.partialSubdivision(this,a,s,o);var l=!0===this.getEvenMapping()?0:this.getNbVertices();l>0&&(e.set(a.subarray(0,3*l)),t.set(s.subarray(0,3*l)),i.set(o.subarray(0,3*l)));for(var u=l;u<r;++u){var c=3*u,h=3*n[u];e[h]=a[c],e[h+1]=a[c+1],e[h+2]=a[c+2],t[h]=s[c],t[h+1]=s[c+1],t[h+2]=s[c+2],i[h]=o[c],i[h+1]=o[c+1],i[h+2]=o[c+2]}}else wr.partialSubdivision(this,e,t,i)}},{key:"applyDetails",value:function(){var e=this.getVerticesRingVertStartCount(),t=this.getVerticesRingVert(),i=this.getVertices(),r=this.getNormals(),a=this.getColors(),s=this.getMaterials(),o=this.getNbVertices(),l=new Float32Array(n.A.getMemory(3*o*4),0,3*o);l.set(i.subarray(0,3*o));for(var u=this._detailsXYZ,c=this._detailsRGB,h=this._detailsPBR,d=Math.min,p=Math.max,_=0;_<o;++_){var f=3*_;a[f]=d(1,p(0,a[f]+c[f])),a[f+1]=d(1,p(0,a[f+1]+c[f+1])),a[f+2]=d(1,p(0,a[f+2]+c[f+2])),s[f]=d(1,p(0,s[f]+h[f])),s[f+1]=d(1,p(0,s[f+1]+h[f+1])),s[f+2]=d(1,p(0,s[f+2]+h[f+2]));var g=l[f],m=l[f+1],v=l[f+2],y=r[f],b=r[f+1],A=r[f+2],T=y*y+b*b+A*A;if(0!==T){y*=T=1/Math.sqrt(T),b*=T,A*=T;var M=3*t[e[2*_]],S=l[M]-g,E=l[M+1]-m,R=l[M+2]-v;if(0!==(T=(S-=y*(T=S*y+E*b+R*A))*S+(E-=b*T)*E+(R-=A*T)*R)){var k=b*(R*=T=1/Math.sqrt(T))-A*(E*=T),x=A*(S*=T)-y*R,w=y*E-b*S,C=u[f],P=u[f+1],D=u[f+2];i[f]=g+y*C+S*P+k*D,i[f+1]=m+b*C+E*P+x*D,i[f+2]=v+A*C+R*P+w*D}}}}},{key:"computeDetails",value:function(e,t,i,r){for(var n=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),s=this.getVertices(),o=this.getNormals(),l=this.getColors(),u=this.getMaterials(),c=this.getNbVertices(),h=this._detailsXYZ=new Float32Array(3*r),d=this._detailsRGB=new Float32Array(3*r),p=this._detailsPBR=new Float32Array(3*r),_=0;_<c;++_){var f=3*_;d[f]=l[f]-t[f],d[f+1]=l[f+1]-t[f+1],d[f+2]=l[f+2]-t[f+2],p[f]=u[f]-i[f],p[f+1]=u[f+1]-i[f+1],p[f+2]=u[f+2]-i[f+2];var g=o[f],m=o[f+1],v=o[f+2],y=g*g+m*m+v*v;if(0!==y){g*=y=1/Math.sqrt(y),m*=y,v*=y;var b=3*a[n[2*_]],A=e[b]-e[f],T=e[b+1]-e[f+1],M=e[b+2]-e[f+2];if(0!==(y=(A-=g*(y=A*g+T*m+M*v))*A+(T-=m*y)*T+(M-=v*y)*M)){var S=m*(M*=y=1/Math.sqrt(y))-v*(T*=y),E=v*(A*=y)-g*M,R=g*T-m*A,k=s[f]-e[f],x=s[f+1]-e[f+1],w=s[f+2]-e[f+2];h[f]=g*k+m*x+v*w,h[f+1]=A*k+T*x+M*w,h[f+2]=S*k+E*x+R*w}}}}}],i&&Wn(t.prototype,i),o}(zt);const Yn=Kn;var Hn={},qn=function(e,t,i){var r=++n.A.TAG_FLAG,a=e.getVerticesTagFlags(),s=e.getVerticesRingVertStartCount(),o=e.getVerticesRingVert(),l=e.getVerticesOnEdge(),u=function(e,t,i){var r=0,n=e.getNbVertices();for(r=0;r<n;++r)if(0===t[r]&&1===i[r])return r;var a=e.getVerticesOnEdge();for(r=0;r<n&&(0!==t[r]||1===a[r]);++r);if(r===n)return-1;for(r=0;r<n;++r)if(0===t[r])return r;return-1}(e,i,t);if(u<0)return!1;i[u]=1;var c=new Uint32Array(n.A.getMemory(4*e.getNbVertices()),0,e.getNbVertices());c[0]=u;for(var h=1;h>0;){var d=c[--h],p=s[2*d],_=p+s[2*d+1],f=0,g=++r;for(f=p;f<_;++f){var m=o[f];if(a[m]=g,1===i[m])return n.A.TAG_FLAG=r,!1;i[m]=-1,a[m]=g}for(g=++r,f=p;f<_;++f){var v=o[f];if(0!==t[v]&&!l[v])return n.A.TAG_FLAG=r,!1;for(var y=s[2*v],b=y+s[2*v+1],A=y;A<b;++A){var T=o[A];if(T!==d&&!(a[T]>=g-1)&&(a[T]=g,0===i[T])){for(var M=s[2*T],S=M+s[2*T+1],E=0,R=M;R<S;++R)a[o[R]]===g-1&&E++;2===E?i[T]=-1:(i[T]=1,c[h++]=T)}}}}return n.A.TAG_FLAG=r,!0};Hn.computeReverse=function(e,t){var i=e.getNbFaces();if(i%4!=0)return!1;var r=new Int8Array(e.getNbVertices());if(!function(e,t){for(var i=e.getNbVertices(),r=function(e){for(var t=e.getNbVertices(),i=e.getFaces(),r=e.getVerticesOnEdge(),a=e.getVerticesRingVertStartCount(),s=e.getVerticesRingFace(),o=e.getVerticesRingFaceStartCount(),l=new Int8Array(t),u=0;u<t;++u){for(var c=2*u,h=a[c+1],d=o[c],p=o[c+1],_=r[u],f=0,g=d,m=d+p;g<m;++g)f+=i[4*s[g]+3]===n.A.TRI_INDEX?0:1;0===f?(!_&&6!==h||_&&4!==h)&&(l[u]=1):f===p?(!_&&4!==h||_&&3!==h)&&(l[u]=1):(_||5!==h)&&(l[u]=1)}return l}(e),a=!0;a;){if(!qn(e,r,t))return!1;a=!1;for(var s=0;s<i;++s)if(0===t[s]){a=!0;break}}return!0}(e,r))return!1;var a=new Int32Array(i/4);return!!function(e,t,i,r){var a=e.getFaceEdges(),s=e.getFaces(),o=new Int32Array(e.getNbEdges()),l=0,u=e.getNbFaces(),c=0,h=new Uint32Array(e.getNbVertices()),d=new Uint32Array(u);for(l=0;l<u;++l)d[l]=n.A.TRI_INDEX;for(l=0;l<u;++l){var p=4*l,_=s[p],f=s[p+1],g=s[p+2],m=s[p+3],v=i[_],y=i[f],b=i[g];if(m!==n.A.TRI_INDEX){var A=0,T=0,M=0;1===v?(A=_,T=g,M=o[a[p+1]]-1,o[a[p+2]]=_+1):1===y?(A=f,T=m,M=o[a[p+2]]-1,o[a[p+3]]=f+1):1===b?(A=g,T=_,M=o[a[p+3]]-1,o[a[p]]=g+1):(A=m,T=f,M=o[a[p]]-1,o[a[p+1]]=m+1);var S=h[T]-1;if(S<0)r[c]=-T-1,d[4*c+3]=A,h[T]=++c;else{var E=4*S;M<0?d[E+2]>=n.A.TRI_INDEX-1?(d[E+2]=A,d[E]=n.A.TRI_INDEX-1):d[E]===n.A.TRI_INDEX?d[E+1]=A:(d[E+1]=d[E+2],d[E+2]=A):d[E+1]===M?d[E]=A:(d[E]=d[E+1],d[E+2]===M?d[E+1]=A:(d[E+1]=d[E+2],d[E+2]=A))}}else{if(v+y+b===-3){r[c++]=l;continue}1===v?o[a[p+1]]=_+1:1===y?o[a[p+2]]=f+1:1===b&&(o[a[p]]=g+1)}}for(u/=4,l=0;l<u;++l){var R=r[l],k=4*l;if(R<0){var x=n.A.TRI_INDEX-1;if(d[k]>=x||d[k+1]>=n.A.TRI_INDEX||d[k+2]>=n.A.TRI_INDEX)return!1}else{var w=4*R;d[k]=o[a[w]]-1,d[k+1]=o[a[w+1]]-1,d[k+2]=o[a[w+2]]-1}}return t.setFaces(d),!0}(e,t,r,a)&&(function(e,t,i){var r=0,a=new Uint32Array(e.getNbVertices());t.setVerticesMapping(a);var s=t.getFaces(),o=new Int32Array(e.getNbVertices()),l=0,u=4*t.getNbFaces();for(l=0;l<u;++l){var c=s[l];if(c!==n.A.TRI_INDEX){var h=o[c]-1;-1===h&&(h=r++,o[c]=h+1,a[h]=c),s[l]=h}}t.setVertices(new Float32Array(3*r));var d=e.getFaces(),p=e.getVerticesRingFace(),_=e.getVerticesRingFaceStartCount(),f=new Uint8Array(e.getNbVertices());for(u/=4,l=0;l<u;++l){var g,m,v,y,b,A,T,M,S,E,R=i[l];if(R>=0){var k=4*R;g=d[k+1],m=d[k+2],v=d[k],y=n.A.TRI_INDEX,b=n.A.TRI_INDEX}else{b=-R-1;for(var x=4*l,w=a[s[x]],C=a[s[x+1]],P=a[s[x+2]],D=a[s[x+3]],I=_[2*b],F=I+4,L=I;L<F;++L){var O=4*p[L],V=d[O],N=d[O+1],B=d[O+2],U=d[O+3];V===w?g=N:N===w?g=B:B===w?g=U:U===w&&(g=V),V===C?m=N:N===C?m=B:B===C?m=U:U===C&&(m=V),V===P?v=N:N===P?v=B:B===P?v=U:U===P&&(v=V),V===D?y=N:N===D?y=B:B===D?y=U:U===D&&(y=V)}}A=f[g],T=f[m],M=f[v],S=y!==n.A.TRI_INDEX?f[y]:-1,E=b!==n.A.TRI_INDEX?f[b]:-1,0===A&&(f[g]=1,a[r++]=g),0===T&&(f[m]=1,a[r++]=m),0===M&&(f[v]=1,a[r++]=v),0===S&&(f[y]=1,a[r++]=y),0===E&&(f[b]=1,a[r++]=b)}}(e,t,a),function(e,t){var i=e.getVertices(),r=e.getColors(),a=e.getMaterials(),s=t.getVertices(),o=new Float32Array(s.length),l=new Float32Array(s.length);t.setColors(o),t.setMaterials(l);var u=t.getVerticesMapping(),c=0,h=t.getNbVertices();for(c=0;c<h&&!(u[c]>=h);++c);if(c===h){var d=t.getFaces(),p=d.length;for(c=0;c<p;++c){var _=d[c];_!==n.A.TRI_INDEX&&(d[c]=u[_])}for(c=0;c<h;++c)u[c]=c;s.set(i.subarray(0,3*h)),o.set(r.subarray(0,3*h)),l.set(a.subarray(0,3*h))}else for(t.setEvenMapping(!0),c=0;c<h;++c){var f=3*c,g=3*u[c];s[f]=i[g],s[f+1]=i[g+1],s[f+2]=i[g+2],o[f]=r[g],o[f+1]=r[g+1],o[f+2]=r[g+2],l[f]=a[g],l[f+1]=a[g+1],l[f+2]=a[g+2]}}(e,t),e.hasUV()&&function(e,t,i){for(var r=e.getVerticesDuplicateStartCount(),a=t.getNbVertices(),s=new Uint32Array(2*a),o=t.getVerticesMapping(),l=e.getTexCoords(),u=new Float32Array(n.A.getMemory(4*e.getNbTexCoords()*2),0,2*e.getNbTexCoords()),c=new Uint32Array(a),h=a,d=0;d<a;++d){var p=o[d],_=r[2*p];if(u[2*d]=l[2*p],u[2*d+1]=l[2*p+1],0!==_){for(var f=c[d]=_-h,g=r[2*p+1],m=h,v=h+g;m<v;++m)u[2*m]=l[2*(f+m)],u[2*m+1]=l[2*(f+m)+1];s[2*d]=h,s[2*d+1]=g,h+=g}}t.setTexCoords(new Float32Array(u.subarray(0,2*h))),t.setVerticesDuplicateStartCount(s),function(e,t,i,r){for(var a=e.getFaces(),s=e.getFacesTexCoord(),o=e.getVerticesRingFaceStartCount(),l=e.getVerticesRingFace(),u=e.getVerticesDuplicateStartCount(),c=t.getFaces(),h=new Uint32Array(c),d=t.getVerticesMapping(),p=0,_=c.length;p<_;++p){var f=c[p];if(f!==n.A.TRI_INDEX){var g=d[f];if(0!==u[2*g]){var m=p%4,v=i[(p-m)/4],y=n.A.TRI_INDEX;if(v>=0){var b,A,T=4*v;0===m?(b=a[T+1],A=a[T]):1===m?(b=a[T+2],A=a[T+1]):(b=a[T],A=a[T+2]);for(var M=o[2*g],S=M+o[2*g+1],E=M;E<S;++E){var R=4*l[E],k=a[R],x=a[R+1],w=a[R+2];if(k===b?x===A&&(y=s[R+2]):x===b?w===A&&(y=s[R]):w===b&&k===A&&(y=s[R+1]),y!==n.A.TRI_INDEX)break}}else for(var C=o[2*(v=-v-1)],P=C+4,D=C;D<P;++D){var I=4*l[D];if(a[I]===g?y=s[I]:a[I+1]===g?y=s[I+1]:a[I+2]===g?y=s[I+2]:a[I+3]===g&&(y=s[I+3]),y!==n.A.TRI_INDEX)break}h[p]=y===g?y:y-r[f]}}}t.setFacesTexCoord(h)}(e,t,i,c)}(e,t,a),t.allocateArrays(),!0)};const Zn=Hn;function Qn(e){return Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qn(e)}function Jn(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $n(e,t,i){return $n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ta(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}},$n(e,t,i||e)}function ea(e,t){return ea=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ea(e,t)}function ta(e){return ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ta(e)}var ia=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ea(e,t)}(o,e);var t,i,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ta(n);if(a){var i=ta(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==Qn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this)).setID(e.getID()),t.setRenderData(e.getRenderData()),t.setTransformData(e.getTransformData()),t._meshes=[new Yn(e,!0)],t.setSelection(0);var i=e.getGL();return t._indexBuffer=new p(i,i.ELEMENT_ARRAY_BUFFER,i.STATIC_DRAW),t._wireframeBuffer=new p(i,i.ELEMENT_ARRAY_BUFFER,i.STATIC_DRAW),t}return t=o,i=[{key:"getCurrentMesh",value:function(){return this._meshes[this._sel]}},{key:"setSelection",value:function(e){this._sel=e,this.setMeshData(this.getCurrentMesh().getMeshData())}},{key:"addLevel",value:function(){if(this._meshes.length-1!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh().getNbFaces(),t="addLevel : "+e+" -> "+4*e;console.time(t);var i=this.getCurrentMesh(),r=new Yn(i);return i.setVerticesMapping(void 0),wr.fullSubdivision(i,r),r.initTopology(),this.pushMesh(r),this.initRender(),console.timeEnd(t),r}},{key:"computeReverse",value:function(){if(0!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh(),t=new Yn(e);return Zn.computeReverse(e,t)?(t.initTopology(),this.unshiftMesh(t),this.initRender(),t):void 0}},{key:"lowerLevel",value:function(){return 0===this._sel?this._meshes[0]:(this._meshes[this._sel-1].lowerAnalysis(this.getCurrentMesh()),this.setSelection(this._sel-1),this.updateResolution(),this.getCurrentMesh())}},{key:"higherLevel",value:function(){return this._sel===this._meshes.length-1||(this._meshes[this._sel+1].higherSynthesis(this.getCurrentMesh()),this.setSelection(this._sel+1),this.updateResolution()),this.getCurrentMesh()}},{key:"updateResolution",value:function(){this.updateGeometry(),this.updateDuplicateColorsAndMaterials(),this.updateBuffers();var e=this._meshes[this.getLowIndexRender()];this._indexBuffer.update(e.getTriangles()),this._wireframeBuffer.update(e.getWireframe())}},{key:"selectResolution",value:function(e){for(;this._sel>e;)this.lowerLevel();for(;this._sel<e;)this.higherLevel()}},{key:"findIndexFromMesh",value:function(e){for(var t=this._meshes,i=0,r=t.length;i<r;++i)if(e===t[i])return i}},{key:"selectMesh",value:function(e){var t=this.findIndexFromMesh(e);this.selectResolution(t)}},{key:"pushMesh",value:function(e){this._meshes.push(e),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"unshiftMesh",value:function(e){this._meshes.unshift(e),this.setSelection(1),this.lowerLevel()}},{key:"popMesh",value:function(){this._meshes.pop(),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"shiftMesh",value:function(){this._meshes.shift(),this.setSelection(0),this.updateResolution()}},{key:"deleteLower",value:function(){this._meshes.splice(0,this._sel),this.setSelection(0)}},{key:"deleteHigher",value:function(){this._meshes.splice(this._sel+1)}},{key:"getLowIndexRender",value:function(){for(var e=this._sel;e>=0;){var t=this._meshes[e];if(!0===t.getEvenMapping())return e===this._sel?e:e+1;if(t.getNbTriangles()<5e5)return e;--e}return 0}},{key:"_renderLow",value:function(e){var t=this.getRenderData(),i=this._sel,r=this.getIndexBuffer();this.setSelection(this.getLowIndexRender()),t._indexBuffer=this._indexBuffer,$n(ta(o.prototype),"render",this).call(this,e),t._indexBuffer=r,this.setSelection(i)}},{key:"_renderWireframeLow",value:function(e){var t=this.getRenderData(),i=this._sel,r=this.getWireframeBuffer();this.setSelection(this.getLowIndexRender()),t._wireframeBuffer=this._wireframeBuffer,$n(ta(o.prototype),"renderWireframe",this).call(this,e),t._wireframeBuffer=r,this.setSelection(i)}},{key:"_canUseLowRender",value:function(e){return!(this.isUsingTexCoords()||this.isUsingDrawArrays()||o.RENDER_HINT===o.PICKING||o.RENDER_HINT===o.NONE||e.getMesh()===this&&o.RENDER_HINT!==o.CAMERA||this.getLowIndexRender()===this._sel)}},{key:"render",value:function(e){return this._canUseLowRender(e)?this._renderLow(e):$n(ta(o.prototype),"render",this).call(this,e)}},{key:"renderWireframe",value:function(e){return this._canUseLowRender(e)?this._renderWireframeLow(e):$n(ta(o.prototype),"renderWireframe",this).call(this,e)}}],r=[{key:"NONE",get:function(){return 0}},{key:"SCULPT",get:function(){return 1}},{key:"CAMERA",get:function(){return 2}},{key:"PICKING",get:function(){return 3}}],i&&Jn(t.prototype,i),r&&Jn(t,r),o}(zt);ia.RENDER_HINT=0;const ra=ia;var na,aa,sa,oa,la,ua={_mesh:null,_linear:!1,_verticesMap:new Map,_states:null,_center:[0,0,0],_radius2:0,_edgeMax2:0},ca=function(e,t,i,r,a){var s=ua._mesh,o=s.getVerticesRingVert(),l=s.getVerticesRingFace(),u=s.getFacePosInLeaf(),c=s.getFaceLeaf(),h=s.getFacesStateFlags(),d=s.getFaces(),p=4*e;d[p]=t,d[p+1]=a,d[p+2]=r,d[p+3]=n.A.TRI_INDEX;var _=c[e],f=_._iFaces;o[a].push(r),o[r].push(a);var g=s.getNbTriangles();l[a].push(e,g),d[p=4*g]=a,d[p+1]=i,d[p+2]=r,d[p+3]=n.A.TRI_INDEX,h[g]=n.A.STATE_FLAG,c[g]=_,u[g]=f.length,l[r].push(g),n.A.replaceElement(l[i],e,g),f.push(g),s.addNbFace(1)},ha=function(e){for(var t=ua._mesh,i=t.getVerticesRingVert(),r=t.getFaces(),a=e.length,s=new Uint32Array(n.A.getMemory(8*a),0,2*a),o=0,l=ua._verticesMap,u=0;u<a;++u){var c=e[u],h=4*c,d=r[h],p=r[h+1],_=r[h+2],f=l.get(Math.min(d,p)+"+"+Math.max(d,p)),g=l.get(Math.min(p,_)+"+"+Math.max(p,_)),m=l.get(Math.min(d,_)+"+"+Math.max(d,_)),v=i[d].length,y=i[p].length,b=i[_].length,A=0;if(f?A=g?m?v<y&&v<b?2:y<b?3:1:v<b?2:1:m&&y<b?3:1:g?A=m&&y<v?3:2:m&&(A=3),1===A)ca(c,d,p,_,f);else if(2===A)ca(c,p,_,d,g);else{if(3!==A)continue;ca(c,_,d,p,m)}s[o++]=c,s[o++]=t.getNbTriangles()-1}return new Uint32Array(s.subarray(0,o))},da=function(e,t,i,r){var a=ua._mesh,s=a.getVertices(),o=a.getNormals(),l=a.getColors(),u=a.getMaterials(),c=a.getFaces(),h=a.getFacePosInLeaf(),d=a.getFaceLeaf(),p=a.getVerticesRingVert(),_=a.getVerticesRingFace(),f=a.getFacesStateFlags(),g=a.getVerticesStateFlags(),m=ua._verticesMap,v=Math.min(t,i)+"+"+Math.max(t,i),y=!1,b=m.get(v);void 0===b&&(b=a.getNbVertices(),y=!0,m.set(v,b)),p[r].push(b);var A=4*e;c[A]=t,c[A+1]=b,c[A+2]=r,c[A+3]=n.A.TRI_INDEX;var T=a.getNbTriangles();c[A=4*T]=b,c[A+1]=i,c[A+2]=r,c[A+3]=n.A.TRI_INDEX,f[T]=n.A.STATE_FLAG,_[r].push(T),n.A.replaceElement(_[i],e,T);var M=d[e],S=M._iFaces;if(d[T]=M,h[T]=S.length,S.push(T),!y)return p[b].push(r),_[b].push(e,T),void a.addNbFace(1);var E=3*t,R=s[E],k=s[E+1],x=s[E+2],w=o[E],C=o[E+1],P=o[E+2],D=3*i,I=s[D],F=s[D+1],L=s[D+2],O=o[D],V=o[D+1],N=o[D+2],B=w+O,U=C+V,G=P+N;if(o[A=3*b]=.5*B,o[A+1]=.5*U,o[A+2]=.5*G,l[A]=.5*(l[E]+l[D]),l[A+1]=.5*(l[E+1]+l[D+1]),l[A+2]=.5*(l[E+2]+l[D+2]),u[A]=.5*(u[E]+u[D]),u[A+1]=.5*(u[E+1]+u[D+1]),u[A+2]=.5*(u[E+2]+u[D+2]),ua._linear)s[A]=.5*(R+I),s[A+1]=.5*(k+F),s[A+2]=.5*(x+L);else{var j=w*w+C*C+P*P;0===j?w=1:(w*=j=1/Math.sqrt(j),C*=j,P*=j),0===(j=O*O+V*V+N*N)?O=1:(O*=j=1/Math.sqrt(j),V*=j,N*=j);var W=w*O+C*V+P*N,z=R-I,X=k-F,K=x-L,Y=.12*(W<=-1?Math.PI:W>=1?0:Math.acos(W));Y*=Math.sqrt(z*z+X*X+K*K),(j=B*B+U*U+G*G)>0&&(Y/=Math.sqrt(j)),z*(w-O)+X*(C-V)+K*(P-N)<0&&(Y=-Y),s[A]=.5*(R+I)+B*Y,s[A+1]=.5*(k+F)+U*Y,s[A+2]=.5*(x+L)+G*Y}g[b]=n.A.STATE_FLAG,p[b]=[t,i,r],_[b]=[e,T],n.A.replaceElement(p[t],i,b),n.A.replaceElement(p[i],t,b),a.addNbVertice(1),a.addNbFace(1)},pa=(na=[0,0,0],aa=[0,0,0],sa=[0,0,0],oa=Ye.A.triangleInsideSphere,la=Ye.A.pointInsideTriangle,function(t,i){var r=ua._mesh,n=r.getVertices(),a=r.getFaces(),s=4*t,o=3*a[s],l=3*a[s+1],u=3*a[s+2];if(na[0]=n[o],na[1]=n[o+1],na[2]=n[o+2],aa[0]=n[l],aa[1]=n[l+1],aa[2]=n[l+2],sa[0]=n[u],sa[1]=n[u+1],sa[2]=n[u+2],i&&!oa(ua._center,ua._radius2,na,aa,sa)&&!la(ua._center,na,aa,sa))return 0;var c=r.getMaterials(),h=c[o+2],d=c[l+2],p=c[u+2],_=e.lo(na,aa),f=e.lo(aa,sa),g=e.lo(na,sa);return _>f&&_>g?.5*(h+d)*_>ua._edgeMax2?1:0:f>g?.5*(d+p)*f>ua._edgeMax2?2:0:.5*(h+p)*g>ua._edgeMax2?3:0}),_a=function(e){var t=ua._mesh,i=t.getNbVertices(),r=t.getNbTriangles();ua._verticesMap=new Map;var a=function(e){for(var t=e.length,i=n.A.getMemory(5*t),r=new Uint32Array(i,0,t),a=new Uint8Array(i,4*t,t),s=0,o=0;o<t;++o){var l=e[o],u=pa(l,!0);0!==u&&(a[s]=u,r[s++]=l)}return[new Uint32Array(r.subarray(0,s)),new Uint8Array(a.subarray(0,s))]}(e),s=a[0],o=a[1];s.length>5&&(s=t.expandsFaces(s,3),(o=new Uint8Array(s.length)).set(a[1])),ua._states.pushVertices(t.getVerticesFromFaces(s)),ua._states.pushFaces(s),t.reAllocateArrays(o.length),function(e,t){for(var i=ua._mesh.getFaces(),r=e.length,n=0;n<r;++n){var a=e[n],s=t[n];0===s&&(s=pa(a));var o=4*a;1===s?da(a,i[o],i[o+1],i[o+2]):2===s?da(a,i[o+1],i[o+2],i[o]):3===s&&da(a,i[o+2],i[o],i[o+1])}}(s,o);var l=0,u=t.getNbTriangles()-r,c=new Uint32Array(u);for(l=0;l<u;++l)c[l]=r+l;s=(c=t.expandsFaces(c,1)).subarray(u),ua._states.pushVertices(t.getVerticesFromFaces(s)),ua._states.pushFaces(s);var h=e,d=e.length;(e=new Uint32Array(d+c.length)).set(h),e.set(c,d);var p=t.getFacesTagFlags(),_=e.length,f=new Uint32Array(n.A.getMemory(4*_),0,_),g=0,m=++n.A.TAG_FLAG;for(l=0;l<_;++l){var v=e[l];p[v]!==m&&(p[v]=m,f[g++]=v)}f=new Uint32Array(f.subarray(0,g));for(var y=t.getNbTriangles();c.length>0;)t.reAllocateArrays(c.length),c=ha(c);for(u=t.getNbTriangles()-y,h=f,(f=new Uint32Array(g+u)).set(h),l=0;l<u;++l)f[g+l]=y+l;var b=t.getNbVertices()-i,A=new Uint32Array(b);for(l=0;l<b;++l)A[l]=i+l;if(A=t.expandsVertices(A,1),!ua._linear){var T=A.subarray(b),M=new at;M.setToolMesh(t),M.smoothTangent(T,1)}var S=t.getVertices(),E=t.getVerticesSculptFlags(),R=ua._center,k=R[0],x=R[1],w=R[2],C=n.A.SCULPT_FLAG;for(b=A.length,l=0;l<b;++l){var P=A[l],D=3*P,I=S[D]-k,F=S[D+1]-x,L=S[D+2]-w;E[P]=I*I+F*F+L*L<ua._radius2?C:C-1}return f};const fa={subdivision:function(t,i,r,n,a,s,o){ua._mesh=t,ua._linear=o,e.C(ua._center,r),ua._radius2=n,ua._edgeMax2=a,ua._states=s;for(var l=0;l!==t.getNbTriangles();)l=t.getNbTriangles(),i=_a(i);return i}};var ga={_mesh:null,_states:null,_iTrisToDelete:[],_iVertsToDelete:[],_iVertsDecimated:[]},ma=function(e,t){return e-t},va=function(e){var t=ga._mesh,i=t.getVerticesRingFace(),r=t.getFacesTagFlags(),a=t.getFaces(),s=t.getFacePosInLeaf(),o=t.getFaceLeaf(),l=t.getFacesStateFlags(),u=s[e],c=o[e]._iFaces,h=c[c.length-1];e!==h&&(c[u]=h,s[h]=u),c.pop();var d=t.getNbTriangles()-1;if(d!==e){var p=4*d,_=a[p],f=a[p+1],g=a[p+2];ga._states.pushVertices([_,f,g]),ga._states.pushFaces([d]),n.A.replaceElement(i[_],d,e),n.A.replaceElement(i[f],d,e),n.A.replaceElement(i[g],d,e);var m=o[d],v=s[d];m._iFaces[v]=e,o[e]=m,s[e]=v,r[e]=r[d],l[e]=l[d],a[e*=4]=_,a[e+1]=f,a[e+2]=g,a[e+3]=n.A.TRI_INDEX,ga._iVertsDecimated.push(_,f,g),t.addNbFace(-1)}else t.addNbFace(-1)},ya=function(e){var t=ga._mesh,i=t.getVerticesRingVert(),r=t.getVerticesRingFace(),a=t.getVertices(),s=t.getNormals(),o=t.getColors(),l=t.getMaterials(),u=t.getFaces(),c=t.getVerticesTagFlags(),h=t.getVerticesStateFlags(),d=t.getVerticesSculptFlags(),p=t.getNbVertices()-1;if(e!==p){var _=0,f=ga._states;f.pushVertices([p]);var g=r[p],m=i[p],v=g.length,y=m.length,b=0;for(b=0;b<v;++b)_=g[b],f.pushFaces([_]),u[_*=4]===p?u[_]=e:u[_+1]===p?u[_+1]=e:u[_+2]=e;for(b=0;b<y;++b)_=m[b],f.pushVertices([_]),n.A.replaceElement(i[_],p,e);i[e]=i[p].slice(),r[e]=r[p].slice(),c[e]=c[p],h[e]=h[p],d[e]=d[p];var A=3*p;a[_=3*e]=a[A],a[_+1]=a[A+1],a[_+2]=a[A+2],s[_]=s[A],s[_+1]=s[A+1],s[_+2]=s[A+2],o[_]=o[A],o[_+1]=o[A+1],o[_+2]=o[A+2],l[_]=l[A],l[_+1]=l[A+1],l[_+2]=l[A+2],t.addNbVertice(-1)}else t.addNbVertice(-1)},ba=function(e,t,i,r,a,s,o){var l=ga._mesh,u=l.getVertices(),c=l.getNormals(),h=l.getColors(),d=l.getMaterials(),p=l.getFaces(),_=l.getVerticesTagFlags(),f=l.getFacesTagFlags(),g=l.getVerticesRingVert(),m=l.getVerticesRingFace(),v=g[i],y=g[r],b=m[i],A=m[r];if(v.length===b.length&&y.length===A.length){var T=g[a],M=g[s],S=m[a],E=m[s];if(T.length===S.length&&M.length===E.length){ga._iVertsDecimated.push(i,r),ga._states.pushVertices(v),ga._states.pushVertices(y),ga._states.pushFaces(b),ga._states.pushFaces(A),v.sort(ma),y.sort(ma);var R=0;if(n.A.intersectionArrays(v,y).length>=3)return n.A.removeElement(b,t),n.A.removeElement(A,e),S.push(t),E.push(e),p[R=4*e]===r?p[R]=s:p[R+1]===r?p[R+1]=s:p[R+2]=s,p[R=4*t]===i?p[R]=a:p[R+1]===i?p[R+1]=a:p[R+2]=a,l.computeRingVertices(i),l.computeRingVertices(r),l.computeRingVertices(a),void l.computeRingVertices(s);var k=3*r,x=c[R=3*i]+c[k],w=c[R+1]+c[k+1],C=c[R+2]+c[k+2],P=x*x+w*w+C*C;0===P?x=1:(x*=P=1/Math.sqrt(P),w*=P,C*=P),c[R]=x,c[R+1]=w,c[R+2]=C,h[R]=.5*(h[R]+h[k]),h[R+1]=.5*(h[R+1]+h[k+1]),h[R+2]=.5*(h[R+2]+h[k+2]),d[R]=.5*(d[R]+d[k]),d[R+1]=.5*(d[R+1]+d[k+1]),d[R+2]=.5*(d[R+2]+d[k+2]),n.A.removeElement(b,e),n.A.removeElement(b,t),n.A.removeElement(A,e),n.A.removeElement(A,t),n.A.removeElement(S,e),n.A.removeElement(E,t);var D=A.length,I=0;for(I=0;I<D;++I){var F=A[I];b.push(F);var L=4*F;p[L]===r?p[L]=i:p[L+1]===r?p[L+1]=i:p[L+2]=i}for(D=y.length,I=0;I<D;++I)v.push(y[I]);l.computeRingVertices(i);var O=0,V=0,N=0,B=v.length;for(I=0;I<B;++I){var U=v[I];l.computeRingVertices(U),O+=u[U*=3],V+=u[U+1],N+=u[U+2]}V/=B,N/=B;var G=x*((O/=B)-u[R])+w*(V-u[R+1])+C*(N-u[R+2]);for(u[R]=O-x*G,u[R+1]=V-w*G,u[R+2]=N-C*G,_[r]=f[e]=f[t]=-1,ga._iVertsToDelete.push(r),ga._iTrisToDelete.push(e,t),D=b.length,I=0;I<D;++I)o.push(b[I])}}},Aa=function(e,t,i){if(-1!==t){var r=ga._mesh.getFaces(),n=4*e,a=r[n],s=r[n+1],o=r[n+2],l=r[n=4*t],u=r[n+1],c=r[n+2];a===l?s===c?ba(e,t,a,s,o,u,i):ba(e,t,a,o,s,c,i):a===u?s===l?ba(e,t,a,s,o,c,i):ba(e,t,a,o,s,l,i):a===c?s===u?ba(e,t,a,s,o,l,i):ba(e,t,a,o,s,u,i):ba(e,t,o,s,a,s===l?u:s===u?c:l,i)}},Ta=function(e,t,i){var r=ga._mesh.getVerticesRingFace(),a=r[t],s=r[i];a.sort(ma),s.sort(ma);var o=n.A.intersectionArrays(a,s);return 2!==o.length?-1:o[0]===e?o[1]:o[0]},Ma={decimation:function(e,t,i,r,a,s){ga._mesh=e,ga._states=s,ga._iVertsDecimated.length=0,ga._iTrisToDelete.length=0,ga._iVertsToDelete.length=0;var o=Math.sqrt(r),l=e.getFacesTagFlags(),u=e.getVertices(),c=e.getMaterials(),h=e.getFaces(),d=i[0],p=i[1],_=i[2],f=0,g=t.length,m=new Array(g);for(f=0;f<g;++f)m[f]=t[f];for(f=0;f<m.length;++f){var v=m[f];if(!(l[v]<0)){var y=4*v,b=h[y],A=h[y+1],T=h[y+2],M=3*b,S=3*A,E=3*T,R=u[M],k=u[M+1],x=u[M+2],w=u[S],C=u[S+1],P=u[S+2],D=u[E],I=u[E+1],F=u[E+2],L=(R+w+D)/3-d,O=(k+C+I)/3-p,V=(x+P+F)/3-_,N=L*L+O*O+V*V;if(N<r)N=1;else{if(!(N<2*r))continue;var B=(N=(Math.sqrt(N)-o)/(o*Math.SQRT2-o))*N;N=3*B*B-4*B*N+1}var U=(L=w-R)*L+(O=C-k)*O+(V=P-x)*V,G=(L=w-D)*L+(O=C-I)*O+(V=P-F)*V,j=(L=R-D)*L+(O=k-I)*O+(V=x-F)*V,W=c[M+2],z=c[S+2],X=c[E+2];U<G&&U<j?U<a*N*(W+z)*.5&&Aa(v,Ta(v,b,A),m):G<j?G<a*N*(z+X)*.5&&Aa(v,Ta(v,A,T),m):j<a*N*(W+X)*.5&&Aa(v,Ta(v,b,T),m)}}return function(){var e=ga._iTrisToDelete;n.A.tidy(e);var t=0;for(t=e.length-1;t>=0;--t)va(e[t]);var i=ga._iVertsToDelete;for(n.A.tidy(i),t=i.length-1;t>=0;--t)ya(i[t])}(),t=function(e,t){var i=ga._mesh,r=i.getFacesTagFlags(),a=i.getNbTriangles(),s=i.getFacesFromVertices(e),o=t,l=t.length;(t=new Uint32Array(l+s.length)).set(o),t.set(s,l);var u=++n.A.TAG_FLAG;l=t.length;for(var c=new Uint32Array(n.A.getMemory(4*l),0,l),h=0,d=0;d<l;++d){var p=t[d];p>=a||r[p]!==u&&(r[p]=u,c[h++]=p)}return new Uint32Array(c.subarray(0,h))}(function(){for(var e=ga._mesh,t=e.getVerticesTagFlags(),i=e.getNbVertices(),r=++n.A.TAG_FLAG,a=ga._iVertsDecimated,s=a.length,o=new Uint32Array(n.A.getMemory(4*s),0,s),l=0,u=0;u<s;++u){var c=a[u];c>=i||t[c]!==r&&(t[c]=r,o[l++]=c)}return new Uint32Array(o.subarray(0,l))}(),m),t}};const Sa=Ma;function Ea(e){return Ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ea(e)}function Ra(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ka(e,t,i){return ka="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wa(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}},ka(e,t,i||e)}function xa(e,t){return xa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xa(e,t)}function wa(e){return wa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wa(e)}var Ca=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xa(e,t)}(l,e);var t,i,a,s,o=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=wa(a);if(s){var i=wa(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==Ea(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this)).setID(e.getID()),t._meshData={_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]},t.setRenderData(e.getRenderData()),t.setTransformData(e.getTransformData()),t._facesStateFlags=null,t._wireframe=null,t.initFromMesh(e),t.initRender(),t.isDynamic=!0,t}return t=l,i=[{key:"subdivide",value:function(e,t,i,r,n){return fa.subdivision(this,e,t,i,r,n,l.LINEAR)}},{key:"decimate",value:function(e,t,i,r,n){return Sa.decimation(this,e,t,i,r,n)}},{key:"getSubdivisionFactor",value:function(){return.01*l.SUBDIVISION_FACTOR}},{key:"getDecimationFactor",value:function(){return.01*l.DECIMATION_FACTOR}},{key:"getVerticesProxy",value:function(){return this.getVertices()}},{key:"addNbVertice",value:function(e){this._meshData._nbVertices+=e}},{key:"getNbTriangles",value:function(){return this.getNbFaces()}},{key:"addNbFace",value:function(e){this._meshData._nbFaces+=e}},{key:"getNbEdges",value:function(){return 3*this.getNbTriangles()}},{key:"getFacesStateFlags",value:function(){return this._facesStateFlags}},{key:"allocateArrays",value:function(){ka(wa(l.prototype),"allocateArrays",this).call(this),this._meshData._vertRingVert=[],this._meshData._vertRingFace=[],this._facesStateFlags=new Int32Array(this.getNbFaces())}},{key:"initFromMesh",value:function(e){var t=e.getNbVertices();this.setVertices(new Float32Array(e.getVertices().subarray(0,3*t))),this.setColors(new Float32Array(e.getColors().subarray(0,3*t))),this.setMaterials(new Float32Array(e.getMaterials().subarray(0,3*t))),this.setNbVertices(t),this.setFacesFromMesh(e),this.init(),e.isUsingTexCoords()&&this.setShaderType(r.A.Shader.MATCAP)}},{key:"setFacesFromMesh",value:function(e){this.setFaces(new Uint32Array(4*e.getNbTriangles())),this.setNbFaces(e.getNbTriangles());var t=e.getTriangles(),i=this.getNbTriangles(),r=this.getFaces();this._meshData._trianglesABC=new Uint32Array(t.subarray(0,3*i));for(var a=0;a<i;++a){var s=3*a,o=4*a;r[o]=t[s],r[o+1]=t[s+1],r[o+2]=t[s+2],r[o+3]=n.A.TRI_INDEX}}},{key:"updateTopology",value:function(e,t){this.updateRenderTriangles(e),this.updateVerticesOnEdge(t),this.getShowWireframe()&&this.updateWireframe(e),this.isUsingDrawArrays()&&this.updateDrawArrays(e)}},{key:"getWireframe",value:function(){return this._wireframe||(this._wireframe=new Uint32Array(2*this.getTriangles().length),this.updateWireframe()),this._wireframe}},{key:"setShowWireframe",value:function(e){this._wireframe=null,ka(wa(l.prototype),"setShowWireframe",this).call(this,e)}},{key:"updateWireframe",value:function(e){for(var t=this._wireframe,i=this.getTriangles(),r=void 0===e,n=this.isUsingDrawArrays(),a=r?this.getNbTriangles():e.length,s=0;s<a;++s){var o=r?s:e[s],l=6*o,u=3*o;n?(t[l]=t[l+5]=u,t[l+1]=t[l+2]=u+2,t[l+3]=t[l+4]=u+1):(t[l]=t[l+5]=i[u],t[l+1]=t[l+2]=i[u+1],t[l+3]=t[l+4]=i[u+2])}}},{key:"updateRenderTriangles",value:function(e){for(var t=this.getTriangles(),i=this.getFaces(),r=void 0===e,n=r?this.getNbFaces():e.length,a=0;a<n;++a){var s=r?a:e[a],o=3*s,l=4*s;t[o]=i[l],t[o+1]=i[l+1],t[o+2]=i[l+2]}}},{key:"updateVerticesOnEdge",value:function(e){for(var t=this.getVerticesOnEdge(),i=this.getVerticesRingVert(),r=this.getVerticesRingFace(),n=void 0===e,a=n?this.getNbVertices():e.length,s=0;s<a;++s){var o=n?s:e[s];t[o]=i[o].length!==r[o].length?1:0}}},{key:"resizeArray",value:function(e,t){if(!e)return null;if(e.length>=t)return e.subarray(0,2*t);var i=new e.constructor(2*t);return i.set(e),i}},{key:"reAllocateArrays",value:function(e){var t=this._meshData,i=this._facesStateFlags.length,r=this.getNbTriangles(),n=r+e;(i<n||i>4*n)&&(this._facesStateFlags=this.resizeArray(this._facesStateFlags,n),this.getShowWireframe()&&(this._wireframe=this.resizeArray(this._wireframe,6*n)),t._facesABCD=this.resizeArray(t._facesABCD,4*n),t._trianglesABC=this.resizeArray(t._trianglesABC,3*n),t._faceBoxes=this.resizeArray(t._faceBoxes,6*n),t._faceNormalsXYZ=this.resizeArray(t._faceNormalsXYZ,3*n),t._faceCentersXYZ=this.resizeArray(t._faceCentersXYZ,3*n),t._facesTagFlags=this.resizeArray(t._facesTagFlags,n),t._facePosInLeaf=this.resizeArray(t._facePosInLeaf,n)),((i=t._verticesXYZ.length/3)<(n=this.getNbVertices()+e)||i>4*n)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,3*n),t._normalsXYZ=this.resizeArray(t._normalsXYZ,3*n),t._colorsRGB=this.resizeArray(t._colorsRGB,3*n),t._materialsPBR=this.resizeArray(t._materialsPBR,3*n),t._vertOnEdge=this.resizeArray(t._vertOnEdge,n),t._vertTagFlags=this.resizeArray(t._vertTagFlags,n),t._vertSculptFlags=this.resizeArray(t._vertSculptFlags,n),t._vertStateFlags=this.resizeArray(t._vertStateFlags,n)),this.isUsingDrawArrays()&&((i=t._verticesXYZ.length/9)<(n=r+10*e)||i>4*n)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,9*n),t._normalsXYZ=this.resizeArray(t._normalsXYZ,9*n),t._colorsRGB=this.resizeArray(t._colorsRGB,9*n),t._materialsPBR=this.resizeArray(t._materialsPBR,9*n))}},{key:"initTopology",value:function(){var e=this.getVerticesRingVert(),t=this.getVerticesRingFace(),i=0,r=this.getNbVertices();for(e.length=t.length=r,i=0;i<r;++i)e[i]=[],t[i]=[];var n=this.getNbTriangles(),a=this.getTriangles();for(i=0;i<n;++i){var s=3*i;t[a[s]].push(i),t[a[s+1]].push(i),t[a[s+2]].push(i)}var o=this.getVerticesOnEdge();for(i=0;i<r;++i)this.computeRingVertices(i),o[i]=t[i].length!==e[i].length?1:0}},{key:"computeRingVertices",value:function(e){var t=++n.A.TAG_FLAG,i=this.getFaces(),r=this.getVerticesTagFlags(),a=this._meshData._vertRingVert[e],s=this._meshData._vertRingFace[e];a.length=0;for(var o=s.length,l=0;l<o;++l){var u=4*s[l],c=i[u],h=i[u+1];c===e?c=i[u+2]:h===e&&(h=i[u+2]),r[c]!==t&&(r[c]=t,a.push(c)),r[h]!==t&&(r[h]=t,a.push(h))}}}],i&&Ra(t.prototype,i),l}(zt);Ca.SUBDIVISION_FACTOR=75,Ca.DECIMATION_FACTOR=0,Ca.LINEAR=!1;const Pa=Ca;function Da(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ia=function(){function e(t,i,r,n){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._multimesh=i,this._mesh=i.getCurrentMesh(),this._type=r,r){case e.DELETE_LOWER:this._deletedMeshes=i._meshes.slice(0,i._sel);break;case e.DELETE_HIGHER:this._deletedMeshes=i._meshes.slice(i._sel+1),n||(this._vMappingState=this._mesh.getVerticesMapping());break;case e.SUBDIVISION:case e.REVERSION:n||(this._vArState=new Float32Array(this._mesh.getVertices()),this._cArState=new Float32Array(this._mesh.getColors()),this._mArState=new Float32Array(this._mesh.getMaterials()))}}var t,i,r;return t=e,r=[{key:"SUBDIVISION",get:function(){return 0}},{key:"REVERSION",get:function(){return 1}},{key:"SELECTION",get:function(){return 2}},{key:"DELETE_LOWER",get:function(){return 3}},{key:"DELETE_HIGHER",get:function(){return 4}}],(i=[{key:"isNoop",value:function(){return!1}},{key:"undo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:Array.prototype.unshift.apply(t._meshes,this._deletedMeshes);break;case e.DELETE_HIGHER:Array.prototype.push.apply(t._meshes,this._deletedMeshes),this._mesh.setVerticesMapping(this._vMappingState);break;case e.SUBDIVISION:case e.REVERSION:var i=this._mesh.getNbVertices();this._mesh.setVertices(new Float32Array(this._vArState)),this._mesh.setColors(new Float32Array(this._cArState)),this._mesh.setMaterials(new Float32Array(this._mArState)),this._mesh.setNbVertices(i),this._type===e.SUBDIVISION?t.popMesh():t.shiftMesh()}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"redo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:t.deleteLower();break;case e.DELETE_HIGHER:t.deleteHigher();break;case e.SUBDIVISION:t.pushMesh(this._mesh);break;case e.REVERSION:t.unshiftMesh(this._mesh)}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"createRedo",value:function(){return new e(this._main,this._multimesh,this._type,!0)}}])&&Da(t.prototype,i),r&&Da(t,r),e}();const Fa=Ia;function La(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oa=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=i,this._main=i._main,this._menu=null,this._ctrlResolution=null,this._ctrlDynamic=null,this.init(t)}var t,i;return t=e,i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("topologyTitle"));t.close(),t.addTitle((0,k.A)("multiresTitle")),this._ctrlResolution=t.addSlider((0,k.A)("multiresResolution"),1,this.onResolutionChanged.bind(this),1,1,1);var i=t.addDualButton((0,k.A)("multiresReverse"),(0,k.A)("multiresSubdivide"),this,this,"reverse","subdivide");this._ctrlReverse=i[0],this._ctrlSubdivide=i[1],i=this._dualButtonDel=t.addDualButton((0,k.A)("multiresDelLower"),(0,k.A)("multiresDelHigher"),this,this,"deleteLower","deleteHigher"),this._ctrlDelLower=i[0],this._ctrlDelHigher=i[1],this._ctrlDelLower.domButton.style.background=this._ctrlDelHigher.domButton.style.background="rgba(230,53,59,0.35)";var r=this.remeshResolution.bind(this);t.addTitle((0,k.A)("remeshTitle")),this._ctrlRes1=t.addSlider((0,k.A)("remeshResolution"),Fi.RESOLUTION,r,8,400,1),t.addCheckbox((0,k.A)("remeshBlock"),Fi,"BLOCK"),t.addButton((0,k.A)("remeshRemesh"),this,"remesh"),t.addTitle((0,k.A)("remeshTitleMC")),this._ctrlRes2=t.addSlider((0,k.A)("remeshResolution"),Fi.RESOLUTION,r,8,400,1),t.addCheckbox((0,k.A)("remeshSmoothingMC"),Fi,"SMOOTHING"),t.addButton((0,k.A)("remeshRemeshMC"),this,"remeshMC"),t.addTitle((0,k.A)("retopoQuadTitle")),this._ctrlQuadRes=t.addSlider((0,k.A)("retopoQuadResolution"),Gn.RESOLUTION,this.retopoQuadResolution.bind(this),8,400,1),this._ctrlQuadRelax=t.addSlider((0,k.A)("retopoQuadRelax"),Gn.RELAX_ITERATIONS,this.retopoQuadRelax.bind(this),0,20,1),this._ctrlQuadIntensity=t.addSlider((0,k.A)("retopoQuadIntensity"),100*Gn.RELAX_INTENSITY,this.retopoQuadIntensity.bind(this),0,100,1),t.addCheckbox((0,k.A)("retopoQuadTangent"),Gn,"TANGENT"),t.addButton((0,k.A)("retopoQuadAction"),this,"retopoQuad"),t.addTitle((0,k.A)("dynamicTitle")),this._ctrlDynamic=t.addCheckbox((0,k.A)("dynamicActivated"),!1,this.dynamicToggleActivate.bind(this)),this._ctrlDynSubd=t.addSlider((0,k.A)("dynamicSubdivision"),Pa,"SUBDIVISION_FACTOR",0,100,1),this._ctrlDynDec=t.addSlider((0,k.A)("dynamicDecimation"),Pa,"DECIMATION_FACTOR",0,100,1),this._ctrlDynLin=t.addCheckbox((0,k.A)("dynamicLinear"),Pa,"LINEAR"),this.updateDynamicVisibility(!1)}},{key:"onKeyUp",value:function(e){if(!0!==e.handled){var t=s.A.getShortKey(e.which);e.stopPropagation(),t===r.A.KeyAction.REMESH&&this.remesh()}}},{key:"updateDynamicVisibility",value:function(e){this._ctrlDynSubd.setVisibility(e),this._ctrlDynDec.setVisibility(e),this._ctrlDynLin.setVisibility(e)}},{key:"dynamicToggleActivate",value:function(){var e=this._main,t=e.getMesh();if(t){var i=t.isDynamic?this.convertToStaticMesh(t):new Pa(t);this.updateDynamicVisibility(!t.isDynamic),e.getStateManager().pushStateAddRemove(i,t),e.replaceMesh(t,i)}}},{key:"remeshResolution",value:function(e){Fi.RESOLUTION=e,this._ctrlRes1.setValue(e,!0),this._ctrlRes2.setValue(e,!0)}},{key:"retopoQuadResolution",value:function(e){Gn.RESOLUTION=e,this._ctrlQuadRes.setValue(e,!0)}},{key:"retopoQuadRelax",value:function(e){Gn.RELAX_ITERATIONS=e,this._ctrlQuadRelax.setValue(e,!0)}},{key:"retopoQuadIntensity",value:function(e){Gn.RELAX_INTENSITY=e/100,this._ctrlQuadIntensity.setValue(e,!0)}},{key:"remesh",value:function(e){var t=this._main,i=t.getMesh();if(i){for(var r=i.isDynamic,n=t.getMeshes(),a=t.getSelectedMeshes().slice(),s=0,o=a.length;s<o;++s){var l=a[s];n.splice(t.getIndexMesh(l),1),a[s]=this.convertToStaticMesh(l),l===i&&(i=a[s])}var u=Fi.remesh(a,i,e);r&&(u=new Pa(u)),t.getStateManager().pushStateAddRemove(u,t.getSelectedMeshes().slice()),t.getMeshes().push(u),t.setMesh(u)}}},{key:"retopoQuad",value:function(){var e=this._main,t=e.getMesh();if(t){for(var i=t.isDynamic,r=e.getMeshes(),n=e.getSelectedMeshes().slice(),a=0,s=n.length;a<s;++a){var o=n[a];r.splice(e.getIndexMesh(o),1),n[a]=this.convertToStaticMesh(o),o===t&&(t=n[a])}var l=Gn.remesh(n,t);i&&(l=new Pa(l)),e.getStateManager().pushStateAddRemove(l,e.getSelectedMeshes().slice()),e.getMeshes().push(l),e.setMesh(l)}}},{key:"remeshMC",value:function(){this.remesh(!0)}},{key:"isMultimesh",value:function(e){return!(!e||!e._meshes)}},{key:"convertToStaticMesh",value:function(e){if(!e.isDynamic)return e;var t=new Qt(e.getGL());return t.setID(e.getID()),t.setTransformData(e.getTransformData()),t.setVertices(e.getVertices().subarray(0,3*e.getNbVertices())),t.setColors(e.getColors().subarray(0,3*e.getNbVertices())),t.setMaterials(e.getMaterials().subarray(0,3*e.getNbVertices())),t.setFaces(e.getFaces().subarray(0,4*e.getNbFaces())),zt.OPTIMIZE=!1,t.init(),zt.OPTIMIZE=!0,t.setRenderData(e.getRenderData()),t.initRender(),t}},{key:"convertToMultimesh",value:function(e){return this.isMultimesh(e)?e:new ra(this.convertToStaticMesh(e))}},{key:"subdivide",value:function(){var e=this._main,t=e.getMesh();if(t){var i=this.convertToMultimesh(t);i._sel===i._meshes.length-1?i.getNbTriangles()>4e5&&!window.confirm((0,k.A)("multiresWarnBigMesh",4*i.getNbFaces()))||(t!==i&&(e.replaceMesh(t,i),e.getStateManager().pushStateAddRemove(i,t,!0)),e.getStateManager().pushState(new Fa(e,i,Fa.SUBDIVISION)),i.addLevel(),e.setMesh(i),e.render()):window.alert((0,k.A)("multiresSelectHighest"))}}},{key:"reverse",value:function(){var e=this._main,t=e.getMesh();if(t){var i=this.convertToMultimesh(t);if(0===i._sel){var r=new Fa(e,i,Fa.REVERSION);i.computeReverse()?(t!==i&&(e.replaceMesh(t,i),e.getStateManager().pushStateAddRemove(i,t,!0)),e.getStateManager().pushState(r),e.setMesh(i),e.render()):window.alert((0,k.A)("multiresNotReversible"))}else window.alert((0,k.A)("multiresSelectLowest"))}}},{key:"deleteLower",value:function(){var e=this._main,t=e._mesh;this.isMultimesh(t)&&0!==t._sel?(e.getStateManager().pushState(new Fa(e,t,Fa.DELETE_LOWER)),t.deleteLower(),this.updateMeshResolution()):window.alert((0,k.A)("multiresNoLower"))}},{key:"deleteHigher",value:function(){var e=this._main,t=e.getMesh();this.isMultimesh(t)&&t._sel!==t._meshes.length-1?(e.getStateManager().pushState(new Fa(e,t,Fa.DELETE_HIGHER)),t.deleteHigher(),this.updateMeshResolution()):window.alert((0,k.A)("multiresNoHigher"))}},{key:"onResolutionChanged",value:function(e){var t=e-1,i=this._main,r=i.getMesh();if(r){var n=this.isMultimesh(r),a=n&&r._meshes.length-1===t;this._ctrlReverse.setEnable(!n||0===t),this._ctrlSubdivide.setEnable(!n||a),this._ctrlDelLower.setEnable(n&&0!==t),this._ctrlDelHigher.setEnable(n&&!a),n&&r._sel!==t&&(i.getStateManager().pushState(new Fa(i,r,Fa.SELECTION)),r.selectResolution(t),this._ctrlGui.updateMeshInfo(),i.render())}}},{key:"updateMeshResolution",value:function(){var e=this._main.getMesh();if(!e||!this.isMultimesh(e))return this._ctrlResolution.setMax(1),void this._ctrlResolution.setValue(0);this._ctrlResolution.setMax(e._meshes.length),this._ctrlResolution.setValue(e._sel+1)}},{key:"updateMesh",value:function(){if(this._main.getMesh()){this._menu.setVisibility(!0),this.updateMeshResolution();var e=this._main.getMesh().isDynamic;this.updateDynamicVisibility(e),this._ctrlDynamic.setValue(e,!0)}else this._menu.setVisibility(!1)}}],i&&La(t.prototype,i),e}();const Va=Oa;function Na(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ba=te[r.A.Shader.MERGE],Ua=te[r.A.Shader.UV],Ga=te[r.A.Shader.PBR],ja=te[r.A.Shader.MATCAP],Wa=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._menu=null,this._ctrlFlatShadizfng=null,this._ctrlShowWireframe=null,this._ctrlShaders=null,this._ctrlMatcap=null,this._ctrlUV=null,this.init(t)}var t,i;return t=e,i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("renderingTitle"));t.close();var i=[];i[r.A.Shader.MATCAP]=(0,k.A)("renderingMatcap"),i[r.A.Shader.PBR]=(0,k.A)("renderingPBR"),i[r.A.Shader.NORMAL]=(0,k.A)("renderingNormal"),i[r.A.Shader.UV]=(0,k.A)("renderingUV"),t.addTitle((0,k.A)("renderingShader")),this._ctrlShaders=t.addCombobox("",r.A.Shader.MATCAP,this.onShaderChanged.bind(this),i),this._ctrlCurvature=t.addSlider((0,k.A)("renderingCurvature"),20,this.onCurvatureChanged.bind(this),0,100,1),this._ctrlFilmic=t.addCheckbox((0,k.A)("renderingFilmic"),Ba.FILMIC,this.onFilmic.bind(this));for(var n={},a=0,s=Ga.environments,o=s.length;a<o;++a)n[a]=s[a].name;this._ctrlEnvTitle=t.addTitle((0,k.A)("renderingEnvironment")),this._ctrlEnv=t.addCombobox("",Ga.idEnv,this.onEnvironmentChanged.bind(this),n);for(var l={},u=0,c=ja.matcaps,h=c.length;u<h;++u)l[u]=c[u].name;this._ctrlMatcapTitle=t.addTitle((0,k.A)("renderingMaterial")),this._ctrlMatcap=t.addCombobox((0,k.A)("renderingMatcap"),0,this.onMatcapChanged.bind(this),l),this._ctrlImportMatcap=t.addButton((0,k.A)("renderingImportMatcap"),this,"importMatcap"),this._ctrlUV=t.addButton((0,k.A)("renderingImportUV"),this,"importTexture"),this._ctrlExposure=t.addSlider((0,k.A)("renderingExposure"),1,this.onExposureChanged.bind(this),0,5,.001),this.onUpdateCtrlExposure(),t.addTitle((0,k.A)("renderingExtra")),this._ctrlTransparency=t.addSlider((0,k.A)("renderingTransparency"),0,this.onTransparencyChanged.bind(this),0,100,1),this._ctrlFlatShading=t.addCheckbox((0,k.A)("renderingFlat"),!1,this.onFlatShading.bind(this)),this._ctrlShowWireframe=t.addCheckbox((0,k.A)("renderingWireframe"),!1,this.onShowWireframe.bind(this)),Gt.ONLY_DRAW_ARRAYS&&this._ctrlShowWireframe.setVisibility(!1),this.addEvents()}},{key:"onFilmic",value:function(e){Ba.FILMIC=e,this._main.render()}},{key:"onCurvatureChanged",value:function(e){this._main.getMesh()&&(this._main.getMesh().setCurvature(e/20),this._main.render())}},{key:"onEnvironmentChanged",value:function(e){Ga.idEnv=e,this.onUpdateCtrlExposure(),this._main.render()}},{key:"onUpdateCtrlExposure",value:function(){this._ctrlExposure.setValue(Ga.environments[Ga.idEnv].exposure)}},{key:"onExposureChanged",value:function(e){Ga.exposure=e,this._main.render()}},{key:"onTransparencyChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),i=0,r=t.length;i<r;++i)t[i].setOpacity(1-e/100);this._main.render()}},{key:"onShaderChanged",value:function(e){for(var t=this._main,i=!1,n=this._main.getSelectedMeshes(),a=0,s=n.length;a<s;++a){var o=n[a];o&&(e!==r.A.Shader.UV||o.hasUV()?(o.setShaderType(e),t.render()):(i||window.alert("No UV on the mesh."),i=!0),i&&this.updateMesh())}this.updateVisibility()}},{key:"onMatcapChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),i=0,n=t.length;i<n;++i){var a=t[i];a.getShaderType()!==r.A.Shader.MATCAP&&a.setShaderType(r.A.Shader.MATCAP),a.setMatcap(e)}this._main.render()}},{key:"onFlatShading",value:function(e){for(var t=this._main.getSelectedMeshes(),i=0,r=t.length;i<r;++i)t[i].setFlatShading(e);this._main.render()}},{key:"onShowWireframe",value:function(e){for(var t=this._main.getSelectedMeshes(),i=0,r=t.length;i<r;++i)t[i].setShowWireframe(e);this._main.render()}},{key:"addEvents",value:function(){var e=this.loadTextureUV.bind(this),t=this.loadMatcap.bind(this);document.getElementById("textureopen").addEventListener("change",e,!1),document.getElementById("matcapopen").addEventListener("change",t,!1),this.removeCallback=function(){document.getElementById("textureopen").removeEventListener("change",e,!1),document.getElementById("matcapopen").removeEventListener("change",t,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"updateMesh",value:function(){var e=this._main.getMesh();e?(this._menu.setVisibility(!0),this._ctrlShaders.setValue(e.getShaderType(),!0),this._ctrlFlatShading.setValue(e.getFlatShading(),!0),this._ctrlShowWireframe.setValue(e.getShowWireframe(),!0),this._ctrlMatcap.setValue(e.getMatcap(),!0),this._ctrlTransparency.setValue(100-100*e.getOpacity(),!0),this._ctrlCurvature.setValue(20*e.getCurvature(),!0),this.updateVisibility()):this._menu.setVisibility(!1)}},{key:"updateVisibility",value:function(){var e=this._main.getMesh();if(e){var t=e.getShaderType();this._ctrlMatcapTitle.setVisibility(t===r.A.Shader.MATCAP),this._ctrlMatcap.setVisibility(t===r.A.Shader.MATCAP),this._ctrlImportMatcap.setVisibility(t===r.A.Shader.MATCAP),this._ctrlExposure.setVisibility(t===r.A.Shader.PBR),this._ctrlEnvTitle.setVisibility(t===r.A.Shader.PBR),this._ctrlEnv.setVisibility(t===r.A.Shader.PBR),this._ctrlUV.setVisibility(t===r.A.Shader.UV)}}},{key:"getFlatShading",value:function(){return this._ctrlFlatShading.getValue()}},{key:"getWireframe",value:function(){return this._ctrlShowWireframe.getValue()}},{key:"getShaderName",value:function(){return this._ctrlShaders.getValue()}},{key:"importTexture",value:function(){document.getElementById("textureopen").click()}},{key:"loadTextureUV",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var i=new FileReader,r=this._main;i.onload=function(e){Ua.texture0=void 0,Ua.texPath=e.target.result,r.render()},document.getElementById("textureopen").value="",i.readAsDataURL(t)}}}},{key:"loadMatcap",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var i=new FileReader,r=this._main,n=this._ctrlMatcap;i.onload=function(e){var i=new Image;i.src=e.target.result,i.onload=function(){var e=ja.matcaps.length;ja.matcaps.push({name:t.name}),ja.createTexture(r._gl,i,e);var a={};a[e]=t.name,n.addOptions(a),n.setValue(e),r.render()}},document.getElementById("matcapopen").value="",i.readAsDataURL(t)}}}},{key:"importMatcap",value:function(){document.getElementById("matcapopen").click()}},{key:"onKeyUp",value:function(e){s.A.getShortKey(e.which)!==r.A.KeyAction.WIREFRAME||e.ctrlKey||this._ctrlShowWireframe.setValue(!this._ctrlShowWireframe.getValue())}}],i&&Na(t.prototype,i),e}();const za=Wa;function Xa(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ka=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._menu=null,this.init(t)}var t,i;return t=e,i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("sceneTitle"));t.addButton((0,k.A)("sceneReset"),this,"clearScene"),t.addButton((0,k.A)("sceneAddSphere"),this._main,"addSphere"),t.addButton((0,k.A)("sceneAddCube"),this._main,"addCube"),t.addButton((0,k.A)("sceneAddPlane"),this._main,"addPlane"),t.addButton((0,k.A)("sceneAddCylinder"),this._main,"addCylinder"),t.addButton((0,k.A)("sceneAddTorus"),this._main,"addTorus"),t.addTitle((0,k.A)("sceneSelection")),this._ctrlIsolate=t.addCheckbox((0,k.A)("renderingIsolate"),!1,this.showHide.bind(this)),this._ctrlIsolate.setVisibility(!1),this._ctrlMerge=t.addButton((0,k.A)("sceneMerge"),this,"merge"),this._ctrlMerge.setVisibility(!1),t.addButton((0,k.A)("sceneDuplicate"),this,"duplicateSelection"),t.addButton((0,k.A)("sceneDelete"),this,"deleteSelection"),t.addTitle((0,k.A)("renderingExtra")),t.addCheckbox((0,k.A)("darkenUnselected"),b.darkenUnselected,this.onDarkenUnselected.bind(this)),t.addCheckbox((0,k.A)("contourShow"),this._main._showContour,this.onShowContour.bind(this)),t.addCheckbox((0,k.A)("renderingGrid"),this._main._showGrid,this.onShowGrid.bind(this)),t.addCheckbox((0,k.A)("renderingSymmetryLine"),b.showSymmetryLine,this.onShowSymmetryLine.bind(this)),this._ctrlOffSym=t.addSlider("SymOffset",0,this.onOffsetSymmetry.bind(this),-1,1,.001)}},{key:"clearScene",value:function(){window.confirm((0,k.A)("sceneResetConfirm"))&&this._main.clearScene()}},{key:"onOffsetSymmetry",value:function(e){var t=this._main.getMesh();t&&(t.setSymmetryOffset(e),this._main.render())}},{key:"duplicateSelection",value:function(){this._main.duplicateSelection()}},{key:"deleteSelection",value:function(){this._main.deleteCurrentSelection()}},{key:"validatePreview",value:function(){this._main._meshPreview||this._main.addTorus(!0),this._main._meshPreview.setShowWireframe(!1),this._main.addNewMesh(this._main._meshPreview),this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"discardPreview",value:function(){this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"updateTorusRadius",value:function(e){this._main._torusRadius=e,this.updateTorus()}},{key:"updateTorusRadial",value:function(e){this._main._torusRadial=e,this.updateTorus()}},{key:"updateTorusTubular",value:function(e){this._main._torusTubular=e,this.updateTorus()}},{key:"updateTorusWidth",value:function(e){this._main._torusWidth=e,this._main._torusLength<this._main._torusWidth?this.ctrlLE.setValue(e):this.updateTorus()}},{key:"updateTorusLength",value:function(e){this._main._torusLength=e,this._main._torusLength<this._main._torusWidth?this.ctrlWI.setValue(e):this.updateTorus()}},{key:"updateTorus",value:function(){this._main.addTorus(!0),this.ctrlDiscard.setVisibility(!0),this.ctrlValidate.setVisibility(!0),this._main.render()}},{key:"hasHiddenMeshes",value:function(){for(var e=this._main.getMeshes(),t=0;t<e.length;++t)if(!e[t].isVisible())return!0;return!1}},{key:"updateMesh",value:function(){var e=this._main.getMeshes().length,t=this._main.getSelectedMeshes().length;this._ctrlIsolate.setVisibility(this.hasHiddenMeshes()||e!==t&&t>=1),this._ctrlMerge.setVisibility(t>1);var i=this._main.getMesh();this._ctrlOffSym.setValue(i?i.getSymmetryOffset():0)}},{key:"merge",value:function(){var e=this._main,t=e.getSelectedMeshes();if(!(t.length<2)){var i=Fi.mergeMeshes(t,e.getMesh()||t[0]);e.removeMeshes(t),e.getStateManager().pushStateAddRemove(i,t.slice()),e.getMeshes().push(i),e.setMesh(i)}}},{key:"toggleShowHide",value:function(e){this._ctrlIsolate.setValue(!this._ctrlIsolate.getValue(),!!e)}},{key:"showHide",value:function(e){e?this.isolate():this.showAll(),this.updateMesh()}},{key:"setMeshesVisible",value:function(e,t){for(var i=0;i<e.length;++i)e[i].setVisible(t);this._ctrlIsolate.setValue(!t,!0)}},{key:"pushSetMeshesVisible",value:function(e,t){this.setMeshesVisible(e,t);var i=this.setMeshesVisible.bind(this,e,!t),r=this.setMeshesVisible.bind(this,e,t);this._main.getStateManager().pushStateCustom(i,r)}},{key:"isolate",value:function(){var e=this._main,t=e.getSelectedMeshes(),i=e.getMeshes();if(i.length===t.length||i.length<2)this._ctrlIsolate.setValue(!1,!0);else{for(var r=[],n=0;n<i.length;++n)e.getIndexSelectMesh(i[n])<0&&r.push(i[n]);this.pushSetMeshesVisible(r,!1),e.render()}}},{key:"showAll",value:function(){for(var e=this._main,t=e.getMeshes(),i=[],r=0;r<t.length;++r)t[r].isVisible()||i.push(t[r]);this.pushSetMeshesVisible(i,!0),e.render()}},{key:"onDarkenUnselected",value:function(e){b.darkenUnselected=e,this._main.render()}},{key:"onShowSymmetryLine",value:function(e){b.showSymmetryLine=e,this._main.render()}},{key:"onShowGrid",value:function(e){var t=this._main;t._showGrid=e,t.render()}},{key:"onShowContour",value:function(e){var t=this._main;t._showContour=e,t.render()}},{key:"onKeyDown",value:function(e){!0!==e.handled&&(e.stopPropagation(),this._main._focusGui||e.preventDefault(),73===e.which?(this.toggleShowHide(),e.handled=!0):68===e.which&&e.ctrlKey&&(this._main.duplicateSelection(),e.handled=!0))}}],i&&Xa(t.prototype,i),e}();const Ya=Ka;var Ha=__webpack_require__(2),qa={tools:[]},Za=qa.tools;qa.initGuiTools=function(e,t,i){for(var r=0,n=br.length;r<n;++r)if(br[r]){var a=Za[r];a||(console.error("No gui for tool index : "+r),qa[r]={_ctrls:[],init:function(){}}),a.init(e.getTool(r),t,i),qa.hide(r)}},qa.hide=function(e){for(var t=0,i=Za[e]._ctrls,r=i.length;t<r;++t)i[t].setVisibility(!1)},qa.show=function(e){for(var t=0,i=Za[e]._ctrls,r=i.length;t<r;++t)i[t].setVisibility(!0);Za[e].onShow&&Za[e].onShow()};var Qa=function(e,t,i){this[e]=t?i/t:i},Ja=function(e,t,i,r){var n=t.addSlider((0,k.A)("sculptRadius"),e._radius,function(t){Qa.call(e,"_radius",1,t),r.getSculptManager().getSelection().setIsEditMode(!0),r.renderSelectOverRtt()},5,500,1);return i._ctrlRadius=n,n},$a=function(e,t,i){var r=t.addSlider((0,k.A)("sculptIntensity"),100*e._intensity,Qa.bind(e,"_intensity",100),0,100,1);return i._ctrlIntensity=r,r},es=function(e,t){return t.addSlider((0,k.A)("sculptHardness"),100*e._hardness,Qa.bind(e,"_hardness",100),0,100,1)},ts=function(e,t){return t.addCheckbox((0,k.A)("sculptCulling"),e,"_culling")},is=function(e,t,i,r){var n=t.addCheckbox(r||(0,k.A)("sculptNegative"),e,"_negative");return i.toggleNegative=function(){n.setValue(!n.getValue())},n},rs=function(){document.getElementById("alphaopen").click()},ns=function(e,t,i,r){e.push(t.addTitle((0,k.A)("sculptAlphaTitle"))),void 0!==i._lockPosition&&e.push(t.addCheckbox((0,k.A)("sculptLockPositon"),i,"_lockPosition")),r._ctrlAlpha=t.addCombobox((0,k.A)("sculptAlphaTex"),i,"_idAlpha",Ha.A.ALPHAS_NAMES),e.push(r._ctrlAlpha),e.push(t.addButton((0,k.A)("sculptImportAlpha"),rs))};Za[r.A.Tools.BRUSH]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(is(e,t,this)),this._ctrls.push(t.addCheckbox((0,k.A)("sculptClay"),e,"_clay")),this._ctrls.push(t.addCheckbox((0,k.A)("sculptAccumulate"),e,"_accumulate")),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.CREASE]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(is(e,t,this)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.DRAG]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.FLATTEN]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(is(e,t,this)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.INFLATE]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(is(e,t,this)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.PAINT]={_ctrls:[],onMaterialChanged:function(t,i,r){e.C(i._color,r[0].getValue()),i._material[0]=r[1].getValue()/100,i._material[1]=r[2].getValue()/100;var n=t.getMesh();n&&(i._writeAlbedo&&n.setAlbedo(i._color),i._writeRoughness&&n.setRoughness(i._material[0]),i._writeMetalness&&n.setMetallic(i._material[1]),t.render())},resetMaterialOverride:function(e,t){this._ctrlPicker.getValue()!==t._pickColor&&this._ctrlPicker.setValue(t._pickColor);var i=e.getMesh();i&&i.getAlbedo&&(i.getAlbedo()[0]=-1,i.setRoughness(-1),i.setMetallic(-1),e.render())},onPickedMaterial:function(t,i,r,a,s,o){r.setCanvasCursor(n.A.cursors.dropper),t[0].setValue(a,!0),t[1].setValue(100*s,!0),t[2].setValue(100*o,!0),e.C(i._color,a),i._material[0]=s,i._material[1]=o},onColorPick:function(e,t,i){e._pickColor=i,t.setCanvasCursor(i?n.A.cursors.dropper:"default"),t._action=i?r.A.Action.SCULPT_EDIT:r.A.Action.NOTHING,t.renderSelectOverRtt()},init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(es(e,t)),this._ctrls.push(ts(e,t)),this._ctrls.push(t.addTitle((0,k.A)("sculptPBRTitle"))),this._ctrls.push(t.addButton((0,k.A)("sculptPaintAll"),e,"paintAll")),this._ctrlPicker=t.addCheckbox((0,k.A)("sculptPickColor"),e._pickColor,this.onColorPick.bind(this,e,i)),this._ctrls.push(this._ctrlPicker);var r=[],n=this.onMaterialChanged.bind(this,i,e,r),a=t.addColor((0,k.A)("sculptColor"),e._color,n),s=t.addSlider((0,k.A)("sculptRoughness"),100*e._material[0],n,0,100,1),o=t.addSlider((0,k.A)("sculptMetallic"),100*e._material[1],n,0,100,1);r.push(a,s,o),this._ctrls.push(a,s,o),e.setPickCallback(this.onPickedMaterial.bind(this,r,e,i)),this._ctrls.push(t.addTitle("Write channel")),this._ctrls.push(t.addCheckbox((0,k.A)("sculptColor"),e,"_writeAlbedo")),this._ctrls.push(t.addCheckbox((0,k.A)("sculptRoughness"),e,"_writeRoughness")),this._ctrls.push(t.addCheckbox((0,k.A)("sculptMetallic"),e,"_writeMetalness")),window.addEventListener("keyup",this.resetMaterialOverride.bind(this,i,e)),window.addEventListener("mouseup",this.resetMaterialOverride.bind(this,i,e)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.PINCH]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(is(e,t,this)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.TWIST]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.LOCALSCALE]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.MOVE]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(t.addCheckbox((0,k.A)("sculptTopologicalCheck"),e,"_topoCheck")),this._ctrls.push(is(e,t,this,(0,k.A)("sculptMoveAlongNormal"))),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.SMOOTH]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(t.addCheckbox((0,k.A)("sculptTangentialSmoothing"),e,"_tangent")),this._ctrls.push(ts(e,t)),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.MASKING]={_ctrls:[],init:function(e,t,i){this._ctrls.push(Ja(e,t,this,i)),this._ctrls.push($a(e,t,this)),this._ctrls.push(es(e,t)),this._ctrls.push(is(e,t,this)),this._ctrls.push(ts(e,t)),this._main=i,this._tool=e;var r=t.addDualButton((0,k.A)("sculptMaskingClear"),(0,k.A)("sculptMaskingInvert"),e,e,"clear","invert"),n=t.addDualButton((0,k.A)("sculptMaskingBlur"),(0,k.A)("sculptMaskingSharpen"),e,e,"blur","sharpen");this._ctrls.push(r[0],r[1],n[0],n[1]),this._ctrls.push(t.addTitle((0,k.A)("sculptExtractTitle"))),this._ctrls.push(t.addSlider((0,k.A)("sculptExtractThickness"),e,"_thickness",-5,5,.001)),this._ctrls.push(t.addButton((0,k.A)("sculptExtractAction"),e,"extract")),ns(this._ctrls,t,e,this)}},Za[r.A.Tools.TRANSFORM]={_ctrls:[],_ctrlCoordSpace:null,_ctrlOpFilter:null,_ctrlAxisFilter:null,_main:null,_tool:null,_opFilter:0,_axisFilter:0,_getOperationMask:function(){switch(this._opFilter){case 1:return ar.TRANS_XYZ|ar.PLANE_XYZ;case 2:return ar.ROT_XYZ|ar.ROT_W;case 3:return ar.SCALE_XYZW;default:return ar.TRANS_XYZ|ar.PLANE_XYZ|ar.ROT_XYZ|ar.ROT_W|ar.SCALE_XYZW}},_getAxisMask:function(){switch(this._axisFilter){case 1:return{trans:ar.TRANS_X,rot:ar.ROT_X,scale:ar.SCALE_X};case 2:return{trans:ar.TRANS_Y,rot:ar.ROT_Y,scale:ar.SCALE_Y};case 3:return{trans:ar.TRANS_Z,rot:ar.ROT_Z,scale:ar.SCALE_Z};default:return null}},_applyGizmoFilters:function(){var e=this._getOperationMask(),t=this._getAxisMask();if(t){var i=0;e&ar.TRANS_XYZ&&(i|=t.trans),e&ar.PLANE_XYZ&&(i|=t.trans),e&ar.ROT_XYZ&&(i|=t.rot),e&ar.ROT_W&&(i|=t.rot),e&ar.SCALE_XYZW&&(i|=t.scale),e=i}this._tool._gizmo.setActivatedType(e),this._main.render()},_onCoordSpaceChanged:function(e){this._tool._gizmo.setCoordSpace(e),this._main.render()},_onOpFilterChanged:function(e){this._opFilter=e,this._applyGizmoFilters()},_onAxisFilterChanged:function(e){this._axisFilter=e,this._applyGizmoFilters()},init:function(e,t,i){this._main=i,this._tool=e,this._ctrls.push(t.addTitle((0,k.A)("sculptGizmoTransform"))),this._ctrlCoordSpace=t.addCombobox((0,k.A)("sculptCoordSpace"),e._gizmo.getCoordSpace(),this._onCoordSpaceChanged.bind(this),[(0,k.A)("sculptGlobal"),(0,k.A)("sculptLocal")]),this._ctrls.push(this._ctrlCoordSpace),this._ctrls.push(t.addTitle((0,k.A)("sculptGizmoFilters"))),this._ctrlOpFilter=t.addCombobox((0,k.A)("sculptGizmoOperation"),this._opFilter,this._onOpFilterChanged.bind(this),[(0,k.A)("sculptGizmoAll"),(0,k.A)("sculptGizmoMove"),(0,k.A)("sculptGizmoRotate"),(0,k.A)("sculptGizmoScale")]),this._ctrlAxisFilter=t.addCombobox((0,k.A)("sculptGizmoAxis"),this._axisFilter,this._onAxisFilterChanged.bind(this),[(0,k.A)("sculptGizmoAll"),(0,k.A)("sculptGizmoAxisX"),(0,k.A)("sculptGizmoAxisY"),(0,k.A)("sculptGizmoAxisZ")]),this._ctrls.push(this._ctrlOpFilter,this._ctrlAxisFilter),this._applyGizmoFilters()}},Za[r.A.Tools.ELEMENTSELECT]={_ctrls:[],init:function(e,t){var i=[];i[e.constructor.Mode.VERTEX]=(0,k.A)("sculptElementSelectVertex"),i[e.constructor.Mode.EDGE]=(0,k.A)("sculptElementSelectEdge"),i[e.constructor.Mode.FACE]=(0,k.A)("sculptElementSelectFace");var r=[];r[e.constructor.Action.REPLACE]=(0,k.A)("sculptElementSelectReplace"),r[e.constructor.Action.ADD]=(0,k.A)("sculptElementSelectAdd"),r[e.constructor.Action.REMOVE]=(0,k.A)("sculptElementSelectRemove"),this._ctrls.push(t.addTitle((0,k.A)("sculptElementSelect"))),this._ctrls.push(t.addCombobox((0,k.A)("sculptElementSelectMode"),e._selectionMode,function(t){e._selectionMode=t},i)),this._ctrls.push(t.addCombobox((0,k.A)("sculptElementSelectAction"),e._selectionAction,function(t){e._selectionAction=t},r)),this._ctrls.push(t.addButton((0,k.A)("sculptElementSelectAll"),e,"selectAll")),this._ctrls.push(t.addButton((0,k.A)("sculptElementSelectClear"),e,"clearSelection")),this._ctrls.push(t.addButton((0,k.A)("sculptElementSelectInvert"),e,"invertSelection"))}};const as=qa;function ss(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var os=as.tools,ls=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i._main,this._ctrlGui=i,this._sculptManager=i._main.getSculptManager(),this._toolOnRelease=-1,this._invertSign=!1,this._modalBrushRadius=!1,this._modalBrushIntensity=!1,this._lastPageX=0,this._lastPageY=0,this._refX=0,this._refY=0,this._menu=null,this._ctrlSculpt=null,this._ctrlSymmetry=null,this._ctrlContinuous=null,this._ctrlTitleCommon=null,this._ctrlRotomold=null,this._ctrlRotomoldSpeed=null,this._ctrlRotomoldAxis=null,this._ctrlRotomoldPivot=null,this.init(t)}var t,i;return t=e,i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("sculptTitle"));t.open(),t.addTitle((0,k.A)("sculptTool"));for(var i=[],r=0,n=br.length;r<n;++r)br[r]&&(i[r]=(0,k.A)(br[r].uiName));this._ctrlSculpt=t.addCombobox((0,k.A)("sculptTool"),this._sculptManager.getToolIndex(),this.onChangeTool.bind(this),i),as.initGuiTools(this._sculptManager,this._menu,this._main),this._ctrlTitleCommon=t.addTitle((0,k.A)("sculptCommon")),this._ctrlSymmetry=t.addCheckbox((0,k.A)("sculptSymmetry"),this._sculptManager._symmetry,this.onSymmetryChange.bind(this)),this._ctrlContinuous=t.addCheckbox((0,k.A)("sculptContinuous"),this._sculptManager,"_continuous"),t.addTitle((0,k.A)("sculptRotomoldTitle")),this._ctrlRotomold=t.addCheckbox((0,k.A)("sculptRotomoldEnable"),this._main._autoRotateEnabled,function(e){this._main.setAutoRotateEnabled(e)}.bind(this)),this._ctrlRotomoldSpeed=t.addSlider((0,k.A)("sculptRotomoldSpeed"),180*this._main._autoRotateSpeed/Math.PI,function(e){this._main.setAutoRotateSpeed(e*Math.PI/180)}.bind(this),0,180,1),this._ctrlRotomoldAxis=t.addCombobox((0,k.A)("sculptRotomoldAxis"),this._main._autoRotateAxis,function(e){this._main.setAutoRotateAxis(e)}.bind(this),[(0,k.A)("sculptRotomoldAxisX"),(0,k.A)("sculptRotomoldAxisY"),(0,k.A)("sculptRotomoldAxisZ")]),this._ctrlRotomoldPivot=t.addCombobox((0,k.A)("sculptRotomoldPivot"),this._main._autoRotatePivot,function(e){this._main.setAutoRotatePivot(e)}.bind(this),[(0,k.A)("sculptRotomoldPivotMesh"),(0,k.A)("sculptRotomoldPivotWorld")]),as.show(this._sculptManager.getToolIndex()),this.addEvents(),this.onChangeTool(this._sculptManager.getToolIndex())}},{key:"onSymmetryChange",value:function(e){this._sculptManager._symmetry=e,this._main.render()}},{key:"addEvents",value:function(){var e=this.loadAlpha.bind(this);document.getElementById("alphaopen").addEventListener("change",e,!1),this.removeCallback=function(){document.getElementById("alphaopen").removeEventListener("change",e,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"getSelectedTool",value:function(){return this._ctrlSculpt.getValue()}},{key:"releaseInvertSign",value:function(){if(this._invertSign){this._invertSign=!1;var e=os[this.getSelectedTool()];e.toggleNegative&&e.toggleNegative()}}},{key:"onChangeTool",value:function(e){as.hide(this._sculptManager.getToolIndex()),this._sculptManager.setToolIndex(e),as.show(e);var t=!0===this._sculptManager.canBeContinuous();this._ctrlContinuous.setVisibility(t);var i=e!==r.A.Tools.TRANSFORM&&e!==r.A.Tools.ELEMENTSELECT;this._ctrlSymmetry.setVisibility(i),this._ctrlTitleCommon.setVisibility(t||i),this._main.getPicking().updateLocalAndWorldRadius2()}},{key:"loadAlpha",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var i=new FileReader,r=this._main,n=os[this._sculptManager.getToolIndex()];i.onload=function(e){var i=new Image;i.src=e.target.result,i.onload=r.onLoadAlphaImage.bind(r,i,t.name||"new alpha",n)},document.getElementById("alphaopen").value="",i.readAsDataURL(t)}}}},{key:"addAlphaOptions",value:function(e){for(var t=0,i=os.length;t<i;++t){var r=os[t];r&&r._ctrlAlpha&&r._ctrlAlpha.addOptions(e)}}},{key:"updateMesh",value:function(e){this._menu.setVisibility(!e&&!!this._main.getMesh())}},{key:"_startModalBrushRadius",value:function(e,t){this._refX=e,this._refY=t;var i=os[this.getSelectedTool()];if(i._ctrlRadius){var r=i._ctrlRadius.getValue();this._refX-=r,this._main.getSculptManager().getSelection().setOffsetX(-r*this._main.getPixelRatio()),this._main.renderSelectOverRtt()}}},{key:"_checkModifierKey",value:function(e){var t=this.getSelectedTool();if(this._main._action===r.A.Action.NOTHING&&(!e.shiftKey||e.altKey||e.ctrlKey||t!==r.A.Tools.SMOOTH&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(r.A.Tools.SMOOTH)),!e.ctrlKey||e.shiftKey||e.altKey||t!==r.A.Tools.MASKING&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(r.A.Tools.MASKING))),e.altKey){if(this._invertSign||e.shiftKey)return!0;this._invertSign=!0;var i=os[t];return i.toggleNegative&&i.toggleNegative(),!0}return!1}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){var t=this._main,i=s.A.getShortKey(e.which);if(e.stopPropagation(),t._focusGui&&i!==r.A.KeyAction.RADIUS&&i!==r.A.KeyAction.INTENSITY||e.preventDefault(),e.handled=!0,!this._checkModifierKey(e)&&t._action===r.A.Action.NOTHING){if(void 0!==i&&br[i])return this._ctrlSculpt.setValue(i);var n=os[this.getSelectedTool()];switch(i){case r.A.KeyAction.DELETE:t.deleteCurrentSelection();break;case r.A.KeyAction.INTENSITY:this._modalBrushIntensity=t._focusGui=!0;break;case r.A.KeyAction.RADIUS:this._modalBrushRadius||this._startModalBrushRadius(this._lastPageX,this._lastPageY),this._modalBrushRadius=t._focusGui=!0;break;case r.A.KeyAction.NEGATIVE:n.toggleNegative&&n.toggleNegative();break;case r.A.KeyAction.PICKER:var a=n._ctrlPicker;a&&!a.getValue()&&a.setValue(!0);break;default:e.handled=!1}}}}},{key:"onKeyUp",value:function(e){var t=this._main._action===r.A.Action.NOTHING&&-1!==this._toolOnRelease&&!e.ctrlKey&&!e.shiftKey;e.altKey&&!t||this.releaseInvertSign(),t&&(this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1);var i=this._main;switch(s.A.getShortKey(e.which)){case r.A.KeyAction.RADIUS:this._modalBrushRadius=i._focusGui=!1,this._main.getSculptManager().getSelection().setOffsetX(0),e.pageX=this._lastPageX,e.pageY=this._lastPageY,i.setMousePosition(e),i.getPicking().intersectionMouseMeshes(),i.renderSelectOverRtt();break;case r.A.KeyAction.PICKER:var n=os[this.getSelectedTool()]._ctrlPicker;n&&n.getValue()&&n.setValue(!1);break;case r.A.KeyAction.INTENSITY:this._modalBrushIntensity=i._focusGui=!1}}},{key:"onMouseUp",value:function(e){-1===this._toolOnRelease||e.ctrlKey||e.shiftKey||(this.releaseInvertSign(),this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1)}},{key:"onMouseMove",value:function(e){var t=os[this.getSelectedTool()];if(this._modalBrushRadius&&t._ctrlRadius){var i=e.pageX-this._refX,r=e.pageY-this._refY;t._ctrlRadius.setValue(Math.sqrt(i*i+r*r)),this._main.renderSelectOverRtt()}this._modalBrushIntensity&&t._ctrlIntensity&&t._ctrlIntensity.setValue(t._ctrlIntensity.getValue()+e.pageX-this._lastPageX),this._lastPageX=e.pageX,this._lastPageY=e.pageY}},{key:"onMouseOver",value:function(e){this._modalBrushRadius&&this._startModalBrushRadius(e.pageX,e.pageY)}}],i&&ss(t.prototype,i),e}();const us=ls;function cs(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var hs=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._addedMeshes=void 0!==i.length?i:[i],this._removedMeshes=void 0!==r.length?r:[r],this._selectMeshes=t.getSelectedMeshes().slice()}var t,i;return t=e,i=[{key:"isNoop",value:function(){return 0===this._addedMeshes.length&&0===this._removedMeshes.length}},{key:"undo",value:function(){var e,t,i=this._main,r=i.getMeshes(),n=this._addedMeshes;for(e=0,t=n.length;e<t;++e)r.splice(i.getIndexMesh(n[e]),1);var a=this._removedMeshes;for(e=0,t=a.length;e<t;++e)r.push(a[e]);for(e=0,t=r.length;e<t;++e)r[e].initRender();var s=this._selectMeshes;i.setMesh(s[0]?s[0]:null);var o=i.getSelectedMeshes();for(o.length=0,e=0,t=s.length;e<t;++e)o.push(s[e])}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){return new e(this._main,this._removedMeshes,this._addedMeshes)}}],i&&cs(t.prototype,i),e}();const ds=hs;function ps(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _s=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=i,this._idVertState=[],this._cArState=[],this._mArState=[]}var t,i;return t=e,(i=[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var e=this._mesh;e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,i=this._cArState,r=this._mArState,a=this._mesh,s=a.getColors(),o=a.getMaterials(),l=a.getVerticesStateFlags(),u=n.A.STATE_FLAG,c=e.length,h=0;h<c;++h){var d=e[h];l[d]!==u&&(l[d]=u,t.push(d),d*=3,i.push(s[d],s[d+1],s[d+2]),r.push(o[d],o[d+1],o[d+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh,i=t.getColors(),r=t.getMaterials(),n=this._idVertState,a=n.length,s=e._cArState=new Float32Array(3*a),o=e._mArState=new Float32Array(3*a),l=e._idVertState=new Uint32Array(a),u=0;u<a;++u){var c=l[u]=n[u];c*=3;var h=3*u;s[h]=i[c],s[h+1]=i[c+1],s[h+2]=i[c+2],o[h]=r[c],o[h+1]=r[c+1],o[h+2]=r[c+2]}}},{key:"pullVertices",value:function(){for(var e=this._cArState,t=this._mArState,i=this._idVertState,r=i.length,n=this._mesh,a=n.getColors(),s=n.getMaterials(),o=0;o<r;++o){var l=3*i[o],u=3*o;a[l]=e[u],a[l+1]=e[u+1],a[l+2]=e[u+2],s[l]=t[u],s[l+1]=t[u+1],s[l+2]=t[u+2]}}}])&&ps(t.prototype,i),e}();const fs=_s;function gs(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ms=function(){function t(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._main=i,this._mesh=r,this._center=e.C([0,0,0],r.getCenter()),this._idVertState=[],this._vArState=[]}var i,r;return i=t,(r=[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var t=this._mesh;t.updateGeometry(t.getFacesFromVertices(this._idVertState),this._idVertState),t.updateGeometryBuffers(),e.C(t.getCenter(),this._center),this._main.setMesh(t)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var e=new t(this._main,this._mesh);return this.pushRedoVertices(e),e}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,i=this._vArState,r=this._mesh,a=r.getVertices(),s=r.getVerticesStateFlags(),o=n.A.STATE_FLAG,l=e.length,u=0;u<l;++u){var c=e[u];s[c]!==o&&(s[c]=o,t.push(c),c*=3,i.push(a[c],a[c+1],a[c+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh.getVertices(),i=this._idVertState,r=i.length,n=e._vArState=new Float32Array(3*r),a=e._idVertState=new Uint32Array(r),s=0;s<r;++s){var o=a[s]=i[s];o*=3;var l=3*s;n[l]=t[o],n[l+1]=t[o+1],n[l+2]=t[o+2]}}},{key:"pullVertices",value:function(){for(var e=this._vArState,t=this._idVertState,i=t.length,r=this._mesh.getVertices(),n=0;n<i;++n){var a=3*t[n],s=3*n;r[a]=e[s],r[a+1]=e[s+1],r[a+2]=e[s+2]}}}])&&gs(i.prototype,r),t}();const vs=ms;function ys(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bs=function(){function t(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._main=i,this._mesh=r,this._center=e.C([0,0,0],r.getCenter()),this._nbFacesState=r.getNbFaces(),this._nbVerticesState=r.getNbVertices(),this._idVertState=[],this._fRingState=[],this._vRingState=[],this._vArState=[],this._cArState=[],this._mArState=[],this._idFaceState=[],this._fArState=[]}var i,r;return i=t,(r=[{key:"isNoop",value:function(){return 0===this._idVertState.length&&0===this._idFaceState.length}},{key:"undo",value:function(){this.pullVertices(),this.pullFaces();var t=this._mesh;t.setNbVertices(this._nbVerticesState),t.setNbFaces(this._nbFacesState),t.updateTopology(),t.updateGeometry(),t.updateDuplicateColorsAndMaterials(),t.updateDrawArrays(),t.updateColorBuffer(),t.updateMaterialBuffer(),t.updateBuffers(),e.C(t.getCenter(),this._center),this._main.setMesh(t)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var e=new t(this._main,this._mesh);return this.pushRedoVertices(e),this.pushRedoFaces(e),e}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,i=this._fRingState,r=this._vRingState,a=this._vArState,s=this._cArState,o=this._mArState,l=this._mesh,u=l.getVerticesRingFace(),c=l.getVerticesRingVert(),h=l.getVertices(),d=l.getColors(),p=l.getMaterials(),_=l.getVerticesStateFlags(),f=n.A.STATE_FLAG,g=e.length,m=0;m<g;++m){var v=e[m];_[v]!==f&&(_[v]=f,i.push(u[v].slice()),r.push(c[v].slice()),t.push(v),v*=3,a.push(h[v],h[v+1],h[v+2]),s.push(d[v],d[v+1],d[v+2]),o.push(p[v],p[v+1],p[v+2]))}}},{key:"pushFaces",value:function(e){for(var t=this._idFaceState,i=this._fArState,r=this._mesh,a=r.getFaces(),s=r.getFacesStateFlags(),o=n.A.STATE_FLAG,l=e.length,u=0;u<l;++u){var c=e[u];s[c]!==o&&(s[c]=o,t.push(c),c*=4,i.push(a[c],a[c+1],a[c+2],a[c+3]))}}},{key:"pushRedoVertices",value:function(e){var t=e._mesh,i=t.getNbVertices(),r=t.getVerticesRingFace(),a=t.getVerticesRingVert(),s=t.getVertices(),o=t.getColors(),l=t.getMaterials(),u=0,c=0,h=0,d=this._idVertState,p=d.length,_=this._nbVerticesState,f=Math.min(_,i),g=new Uint32Array(n.A.getMemory(4*i),0,i);for(u=0;u<p;++u)(c=d[u])<f&&(g[h++]=c);for(u=_;u<i;++u)g[h++]=u;p=h,g=e._idVertState=new Uint32Array(g.subarray(0,p));var m=e._fRingState=new Array(p),v=e._vRingState=new Array(p),y=e._vArState=new Float32Array(3*p),b=e._cArState=new Float32Array(3*p),A=e._mArState=new Float32Array(3*p);for(u=0;u<p;++u){c=g[u],m[u]=r[c].slice(),v[u]=a[c].slice(),c*=3;var T=3*u;y[T]=s[c],y[T+1]=s[c+1],y[T+2]=s[c+2],b[T]=o[c],b[T+1]=o[c+1],b[T+2]=o[c+2],A[T]=l[c],A[T+1]=l[c+1],A[T+2]=l[c+2]}}},{key:"pushRedoFaces",value:function(e){var t=e._mesh,i=t.getNbFaces(),r=t.getFaces(),a=0,s=0,o=0,l=this._idFaceState,u=l.length,c=this._nbFacesState,h=Math.min(c,i),d=new Uint32Array(n.A.getMemory(4*i),0,i);for(a=0;a<u;++a)(s=l[a])<h&&(d[o++]=s);for(a=c;a<i;++a)d[o++]=a;u=o,d=e._idFaceState=new Uint32Array(d.subarray(0,u));var p=e._fArState=new Int32Array(4*u);for(a=0;a<u;++a){s=d[a],s*=4;var _=4*a;p[_]=r[s],p[_+1]=r[s+1],p[_+2]=r[s+2],p[_+3]=r[s+3]}}},{key:"pullVertices",value:function(){for(var e=this._nbVerticesState,t=this._fRingState,i=this._vRingState,r=this._vArState,n=this._cArState,a=this._mArState,s=this._idVertState,o=s.length,l=this._mesh,u=l.getVerticesRingFace(),c=l.getVerticesRingVert(),h=l.getVertices(),d=l.getColors(),p=l.getMaterials(),_=0;_<o;++_){var f=s[_];if(!(f>=e)){u[f]=t[_].slice(),c[f]=i[_].slice();var g=3*_;h[f*=3]=r[g],h[f+1]=r[g+1],h[f+2]=r[g+2],d[f]=n[g],d[f+1]=n[g+1],d[f+2]=n[g+2],p[f]=a[g],p[f+1]=a[g+1],p[f+2]=a[g+2]}}}},{key:"pullFaces",value:function(){for(var e=this._nbFacesState,t=this._fArState,i=this._idFaceState,r=i.length,n=this._mesh.getFaces(),a=0;a<r;++a){var s=i[a];if(!(s>=e)){var o=4*a;n[s*=4]=t[o],n[s+1]=t[o+1],n[s+2]=t[o+2],n[s+3]=t[o+3]}}}}])&&ys(i.prototype,r),t}();const As=bs;function Ts(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Ms=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._undocb=t,this._redocb=i||t}var t,i;return t=e,(i=[{key:"isNoop",value:function(){return!this._undocb}},{key:"undo",value:function(){this._undocb()}},{key:"redo",value:function(){this._redocb()}},{key:"createRedo",value:function(){return new e(this._undocb,this._redocb)}}])&&Ts(t.prototype,i),e}();function Ss(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Es=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._undos=[],this._redos=[],this._curUndoIndex=-1}var t,i;return t=e,(i=[{key:"pushStateCustom",value:function(e,t,i){var r=new Ms(e,t);r.squash=i,this.pushState(r)}},{key:"pushStateAddRemove",value:function(e,t,i){var r=new ds(this._main,e,t);r.squash=i,this.pushState(r)}},{key:"pushStateRemove",value:function(e){this.pushState(new ds(this._main,[],e))}},{key:"pushStateAdd",value:function(e){this.pushState(new ds(this._main,e,[]))}},{key:"pushStateColorAndMaterial",value:function(e){e.isDynamic?this.pushState(new As(this._main,e)):this.pushState(new fs(this._main,e))}},{key:"pushStateGeometry",value:function(e){e.isDynamic?this.pushState(new As(this._main,e)):this.pushState(new vs(this._main,e))}},{key:"pushStateMultiresolution",value:function(e,t){this.pushState(new Fa(this._main,e,t))}},{key:"setNewMaxStack",value:function(t){e.STACK_LENGTH=t;for(var i=this._undos,r=this._redos;this._curUndoIndex>=t;)i.shift(),--this._curUndoIndex;for(;i.length>t;)i.pop(),r.shift()}},{key:"pushState",value:function(t){++n.A.STATE_FLAG;var i=this._undos;-1===this._curUndoIndex?i.length=0:i.length>=e.STACK_LENGTH&&(i.shift(),--this._curUndoIndex),this._redos.length=0,++this._curUndoIndex,i.length>0&&(i.length=this._curUndoIndex),i.push(t)}},{key:"getCurrentState",value:function(){return this._undos[this._curUndoIndex]}},{key:"pushVertices",value:function(e){e&&e.length>0&&this.getCurrentState().pushVertices(e)}},{key:"pushFaces",value:function(e){e&&e.length>0&&this.getCurrentState().pushFaces(e)}},{key:"undo",value:function(){if(this._undos.length&&!(this._curUndoIndex<0)){var e=this.getCurrentState(),t=e.createRedo();t.squash=e.squash,this._redos.push(t),e.undo(),this._curUndoIndex--,!0===e.squash&&this.undo()}}},{key:"redo",value:function(){this._redos.length&&(this._redos[this._redos.length-1].redo(),this._curUndoIndex++,this._redos.pop(),this._redos.length&&!0===this._redos[this._redos.length-1].squash&&this.redo())}},{key:"reset",value:function(){this._undos.length=0,this._redos.length=0,this._curUndoIndex=-1}},{key:"cleanNoop",value:function(){for(;this._curUndoIndex>=0&&this.getCurrentState().isNoop();)this._undos.length--,this._curUndoIndex--,this._redos.length=0}}])&&Ss(t.prototype,i),e}();Es.STACK_LENGTH=15;const Rs=Es;function ks(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const xs=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=i,this._main=i._main,this._menu=null,this.init(t)}var t,i;return t=e,(i=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("stateTitle"));t.addButton((0,k.A)("stateUndo"),this,"onUndo","CTRL+Z"),t.addButton((0,k.A)("stateRedo"),this,"onRedo","CTRL+Y"),t.addTitle((0,k.A)("stateMaxStack"));var i=this._main.getStateManager();t.addSlider("",Rs.STACK_LENGTH,i.setNewMaxStack.bind(i),3,50,1)}},{key:"onUndo",value:function(){this._main._action=r.A.Action.NOTHING,this._main.getSculptManager().end(),this._main.getStateManager().undo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onRedo",value:function(){this._main.getStateManager().redo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&90===t?(this.onUndo(),e.handled=!0):e.ctrlKey&&89===t&&(this.onRedo(),e.handled=!0)}}}])&&ks(t.prototype,i),e}();function ws(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Cs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,k.A)("pressureTitle"));t.addTitle((0,k.A)("pressureRadius")),t.addSlider("",i.A,"radiusFactor",0,1,.01),t.addTitle((0,k.A)("pressureIntensity")),t.addSlider("",i.A,"intensityFactor",0,1,.01)}}])&&ws(t.prototype,r),e}();function Ps(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ds=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._guiMain=null,this._sidebar=null,this._topbar=null,this._ctrlTablet=null,this._ctrlFiles=null,this._ctrlScene=null,this._ctrlStates=null,this._ctrlCamera=null,this._ctrlBackground=null,this._ctrlModeling=null,this._ctrlSculpting=null,this._ctrlTopology=null,this._ctrlRendering=null,this._ctrlNotification=null,this._ctrls=[],this._notifications={},this._xhrs={},this._modelingMode=!1}var t,i;return t=e,i=[{key:"initGui",value:function(){this.deleteGui(),this._guiMain=new(Qr().GuiMain)(this._main.getViewport(),this._main.onCanvasResize.bind(this._main));var e=this._ctrls;e.length=0;var t=0;this._topbar=this._guiMain.addTopbar(),e[t++]=this._ctrlFiles=new Ln(this._topbar,this),e[t++]=this._ctrlScene=new Ya(this._topbar,this),e[t++]=this._ctrlStates=new xs(this._topbar,this),e[t++]=this._ctrlBackground=new $r(this._topbar,this),e[t++]=this._ctrlCamera=new rn(this._topbar,this),e[t++]=this._ctrlTablet=new Cs(this._topbar,this),e[t++]=this._ctrlConfig=new an(this._topbar,this),e[t++]=this._ctrlMesh=new Vn(this._topbar,this),this._sidebar=this._guiMain.addRightSidebar(),e[t++]=this._ctrlModeling=new Bn(this._topbar,this._sidebar,this),e[t++]=this._ctrlRendering=new za(this._sidebar,this),e[t++]=this._ctrlTopology=new Va(this._sidebar,this),e[t++]=this._ctrlSculpting=new us(this._sidebar,this);var i=this._topbar.addExtra();i.addTitle((0,k.A)("contour")),i.addColor((0,k.A)("contourColor"),q.color,this.onContourColor.bind(this)),i.addTitle((0,k.A)("resolution")),i.addSlider("",this._main._pixelRatio,this.onPixelRatio.bind(this),.5,2,.02),this.addAboutButton(),this.updateMesh(),this.setVisibility(!0),window.postprocessGui&&window.postprocessGui()}},{key:"getNotification",value:function(e){var t=this._notifications[e];return t?this._xhrs[e]&&t.isVisible()?void(window.confirm("Abort "+e+" previous upload?")&&(this._xhrs[e].abort(),this._xhrs[e].isAborted=!0,t.setMessage(null))):t:((t=this._topbar.addMenu()).isVisible=function(){return!this.domContainer.hidden},t.setMessage=function(e){this.domContainer.innerHTML=e,this.setVisibility(!!e)},t.domContainer.style.color="red",t.setMessage(""),this._notifications[e]=t,t)}},{key:"initPrint",value:function(e){e.addMenu("Print it!").addButton("Go to Materialise!",this,"exportMaterialise")}},{key:"exportSculpteo",value:function(){this._export("sculpteo")}},{key:"exportMaterialise",value:function(){window.confirm("A new webpage will be opened. Start upload?")&&this._export("materialise")}},{key:"exportSketchfab",value:function(){this._export("sketchfab")}},{key:"_export",value:function(e){if(this._main.getMesh()){var t=this.getNotification(e);if(t){var i="export"+e.charAt(0).toUpperCase()+e.slice(1);this._xhrs[e]=kn[i](this._main,t)}}}},{key:"onPixelRatio",value:function(e){this._main._pixelRatio=e,this._main.onCanvasResize()}},{key:"onContourColor",value:function(e){q.color[0]=e[0],q.color[1]=e[1],q.color[2]=e[2],q.color[3]=e[3],this._main.render()}},{key:"addAboutButton",value:function(){var e=this._topbar.addMenu();e.domContainer.innerHTML=(0,k.A)("about"),e.domContainer.addEventListener("mousedown",function(){window.open("http://stephaneginier.com","_blank")})}},{key:"updateMesh",value:function(){this._ctrlRendering.updateMesh(),this._ctrlTopology.updateMesh(),this._ctrlSculpting.updateMesh(this._modelingMode),this._ctrlModeling.updateMesh(this._modelingMode),this._ctrlScene.updateMesh(),this.updateMeshInfo()}},{key:"updateMeshInfo",value:function(){this._ctrlMesh.updateMeshInfo()}},{key:"setModelingMode",value:function(e){this._modelingMode=e,this.updateMesh()}},{key:"getFlatShading",value:function(){return this._ctrlRendering.getFlatShading()}},{key:"getWireframe",value:function(){return this._ctrlRendering.getWireframe()}},{key:"getShaderType",value:function(){return this._ctrlRendering.getShaderType()}},{key:"addAlphaOptions",value:function(e){this._ctrlSculpting.addAlphaOptions(e)}},{key:"deleteGui",value:function(){this._guiMain&&this._guiMain.domMain.parentNode&&(this.callFunc("removeEvents"),this.setVisibility(!1),this._guiMain.domMain.parentNode.removeChild(this._guiMain.domMain))}},{key:"setVisibility",value:function(e){this._guiMain.setVisibility(e)}},{key:"callFunc",value:function(e,t){for(var i=0,r=this._ctrls,n=r.length;i<n;++i){var a=r[i];a&&a[e]&&a[e](t)}}}],i&&Ps(t.prototype,i),e}();const Is=Ds;function Fs(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ls=200,Os=200,Vs=[0,0],Ns=[0,0,0],Bs=[0,0,0],Us=[0,1,0],Gs=[0,0,0,1],js=a.vt(),Ws=Math.SQRT1_2,zs=.5,Xs=[We(1,0,0,0),We(0,1,0,0),We(0,0,1,0),We(0,0,0,1),We(Ws,Ws,0,0),We(Ws,-Ws,0,0),We(Ws,0,Ws,0),We(Ws,0,-Ws,0),We(Ws,0,0,Ws),We(Ws,0,0,-Ws),We(0,Ws,Ws,0),We(0,Ws,-Ws,0),We(0,Ws,0,Ws),We(0,Ws,0,-Ws),We(0,0,Ws,Ws),We(0,0,Ws,-Ws),We(zs,zs,zs,zs),We(zs,zs,zs,-zs),We(zs,zs,-zs,zs),We(zs,zs,-zs,-zs),We(zs,-zs,zs,zs),We(zs,-zs,zs,-zs),We(zs,-zs,-zs,zs),We(-zs,zs,zs,zs)],Ks=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._main=e;var i=(0,s.A)();this._mode=i.cameramode||r.A.CameraMode.ORBIT,this._projectionType=i.projection||r.A.Projection.PERSPECTIVE,this._quatRot=[0,0,0,1],this._view=a.vt(),this._proj=a.vt(),this._viewport=a.vt(),this._lastNormalizedMouseXY=[0,0],this._width=0,this._height=0,this._speed=0,this._fov=Math.min(i.fov,150),this._trans=[0,0,30],this._moveX=0,this._moveZ=0,this._usePivot=i.pivot,this._center=[0,0,0],this._offset=[0,0,0],this._rotX=0,this._rotY=0,this._near=.05,this._far=5e3,this._timers={},this.resetView()}var i,l;return i=t,l=[{key:"setProjectionType",value:function(e){this._projectionType=e,this.updateProjection(),this.updateView()}},{key:"setMode",value:function(e){this._mode=e,e===r.A.CameraMode.ORBIT&&this.resetViewFront()}},{key:"setFov",value:function(e){this._fov=e,this.updateView(),this.optimizeNearFar()}},{key:"setUsePivot",value:function(e){this._usePivot=e}},{key:"toggleUsePivot",value:function(){this._usePivot=!this._usePivot}},{key:"getView",value:function(){return this._view}},{key:"getProjection",value:function(){return this._proj}},{key:"getProjectionType",value:function(){return this._projectionType}},{key:"isOrthographic",value:function(){return this._projectionType===r.A.Projection.ORTHOGRAPHIC}},{key:"getMode",value:function(){return this._mode}},{key:"getFov",value:function(){return this._fov}},{key:"getUsePivot",value:function(){return this._usePivot}},{key:"getConstantScreen",value:function(){var e=this._main.getCanvas().clientWidth;return this._projectionType===r.A.Projection.ORTHOGRAPHIC?e/this.getOrthoZoom():e*this._proj[0]}},{key:"start",value:function(t,i){if(this._lastNormalizedMouseXY=Ye.A.normalizedMouse(t,i,this._width,this._height),this._usePivot){var r=this._main,n=r.getPicking();n.intersectionMouseMeshes(r.getMeshes(),t,i),n.getMesh()&&(e.Z0(Ns,n.getIntersectionPoint(),n.getMesh().getMatrix()),this.setPivot(Ns))}}},{key:"setPivot",value:function(t){if(e.gL(this._offset,this._offset,function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}(Gs,this._quatRot)),e.jb(this._offset,this._offset,this._center),e.C(this._center,t),e.WQ(this._offset,this._offset,this._center),e.gL(this._offset,this._offset,this._quatRot),this._projectionType===r.A.Projection.PERSPECTIVE){var i=this.getTransZ();this._trans[2]=e.xg(this.computePosition(),this._center)*this._fov/45,this._offset[2]+=this.getTransZ()-i}else this._offset[2]=0}},{key:"rotate",value:function(t,i){var n=Ns,a=Vs,s=Ye.A.normalizedMouse(t,i,this._width,this._height);if(this._mode===r.A.CameraMode.ORBIT)Oe(a,s,this._lastNormalizedMouseXY),this.setOrbit(this._rotX-2*a[1],this._rotY+2*a[0]),this.rotateDelay([6*-a[1],6*a[0]],-1);else if(this._mode===r.A.CameraMode.PLANE){var o=Ve(this._lastNormalizedMouseXY,s);Oe(a,s,this._lastNormalizedMouseXY),e.S8(n,e.hZ(n,-a[1],a[0],0)),ze(this._quatRot,Ue(Gs,n,2*o),this._quatRot),this.rotateDelay([n[0],n[1],n[2],6*o],-1)}else if(this._mode===r.A.CameraMode.SPHERICAL){var l=Ye.A.mouseOnUnitSphere(this._lastNormalizedMouseXY),u=Ye.A.mouseOnUnitSphere(s),c=Math.acos(Math.min(1,e.Om(l,u)));e.S8(n,e.$A(n,l,u)),ze(this._quatRot,Ue(Gs,n,2*c),this._quatRot),this.rotateDelay([n[0],n[1],n[2],6*c],-1)}this._lastNormalizedMouseXY=s,this.updateView()}},{key:"setOrbit",value:function(e,t){var i=.49*Math.PI;this._rotX=Math.max(Math.min(e,i),-i),this._rotY=t;var r=this._quatRot;Be(r),Ge(r,r,this._rotX),je(r,r,this._rotY)}},{key:"getTransZ",value:function(){return this._projectionType===r.A.Projection.PERSPECTIVE?45*this._trans[2]/this._fov:1e3}},{key:"updateView",value:function(){var t=Ns,i=this._view,r=this._trans[0],n=this._trans[1],s=this._offset;e.hZ(Bs,r-s[0],n-s[1],this.getTransZ()-s[2]),e.hZ(t,r-s[0],n-s[1],-s[2]),a.t5(i,Bs,t,Us),a.lK(i,i,a.I0(js,this._quatRot)),a.Tl(i,i,e.ze(Ns,this._center))}},{key:"optimizeNearFar",value:function(t){if(t||(t=this._lastBBox),t){this._lastBBox=t;var i=this.computePosition(Bs),r=e.hZ(Ns,.5*(t[0]+t[3]),.5*(t[1]+t[4]),.5*(t[2]+t[5])),n=e.xg(i,r),a=.5*e.xg(t,e.hZ(Ns,t[3],t[4],t[5]));this._near=Math.max(.01,n-a),this._far=a+n,this.updateProjection()}}},{key:"updateProjection",value:function(){this._projectionType===r.A.Projection.PERSPECTIVE?(a.fN(this._proj,this._fov*Math.PI/180,this._width/this._height,this._near,this._far),this._proj[10]=-1,this._proj[14]=-2*this._near):this.updateOrtho()}},{key:"updateTranslation",value:function(){var e=this._trans;e[0]+=this._moveX*this._speed*e[2]/50/400,e[2]=Math.max(1e-5,e[2]+this._moveZ*this._speed/400),this._projectionType===r.A.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"translate",value:function(t,i){var r=this._speed*this._trans[2]/54,n=[-t*r,i*r,0];this.setTrans(e.WQ(this._trans,this._trans,n)),e.hs(n,n,5),this.translateDelay(n,-1)}},{key:"zoom",value:function(t){var i=[0,0,0];e.jb(i,this._offset,this._trans),e.hs(i,i,t*this._speed/54),t<0&&(i[0]=i[1]=0),this.setTrans(e.WQ(this._trans,this._trans,i)),e.hs(i,i,5),this.translateDelay(i,-1)}},{key:"setAndFocusOnPivot",value:function(e,t){this.setPivot(e),this.moveToDelay(this._offset[0],this._offset[1],this._offset[2]+t)}},{key:"moveToDelay",value:function(t,i,r){var n=[t,i,r];this.translateDelay(e.jb(n,n,this._trans),Os)}},{key:"setTrans",value:function(t){e.C(this._trans,t),this._projectionType===r.A.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"getOrthoZoom",value:function(){return 55e-5*Math.abs(this._trans[2])}},{key:"updateOrtho",value:function(){var e=this.getOrthoZoom(),t=this._width*e,i=this._height*e;a.v3(this._proj,-t,t,-i,i,-this._near,this._far)}},{key:"computePosition",value:function(t){t=t||[0,0,0];var i=this._view;return e.hZ(t,-i[12],-i[13],-i[14]),u(js,i),c(js,js),e.ei(t,t,js)}},{key:"resetView",value:function(){this._speed=1.5*n.A.SCALE,this.centerDelay([0,0,0],Os),this.offsetDelay([0,0,0],Os);var t=[0,0,30+this._speed/3];e.jb(t,t,this._trans),this.translateDelay(t,Os),this.quatDelay([0,0,0,1],Os)}},{key:"resetViewFront",value:function(){this.quatDelay([0,0,0,1],Ls)}},{key:"resetViewBack",value:function(){this.quatDelay([0,1,0,0],Ls)}},{key:"resetViewTop",value:function(){this.quatDelay([Math.SQRT1_2,0,0,Math.SQRT1_2],Ls)}},{key:"resetViewBottom",value:function(){this.quatDelay([-Math.SQRT1_2,0,0,Math.SQRT1_2],Ls)}},{key:"resetViewLeft",value:function(){this.quatDelay([0,-Math.SQRT1_2,0,Math.SQRT1_2],Ls)}},{key:"resetViewRight",value:function(){this.quatDelay([0,Math.SQRT1_2,0,Math.SQRT1_2],Ls)}},{key:"toggleViewFront",value:function(){Math.abs(this._quatRot[3])>.99?this.resetViewBack():this.resetViewFront()}},{key:"toggleViewTop",value:function(){var e=this._quatRot[0]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewBottom():this.resetViewTop()}},{key:"toggleViewLeft",value:function(){var e=-this._quatRot[1]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewRight():this.resetViewLeft()}},{key:"computeWorldToScreenMatrix",value:function(e){return e=e||a.vt(),a.lK(e,a.lK(e,this._viewport,this._proj),this._view)}},{key:"unproject",value:function(t,i,r){var n=[0,0,0];return a.B8(js,this.computeWorldToScreenMatrix(js)),e.Z0(n,e.hZ(n,t,this._height-i,r),js)}},{key:"project",value:function(t){var i=[0,0,0];return e.Z0(i,t,this.computeWorldToScreenMatrix(js)),i[1]=this._height-i[1],i}},{key:"onResize",value:function(t,i){this._width=t,this._height=i;var r=this._viewport;a.D_(r),a.hs(r,r,e.hZ(Ns,.5*t,.5*i,.5)),a.Tl(r,r,e.hZ(Ns,1,1,1)),this.updateProjection()}},{key:"snapClosestRotation",value:function(){for(var e=this._quatRot,t=1/0,i=0,r=Xs.length,n=0;n<r;++n){var a=Xe(e,Xs[n]);t<(a=1-a*a)||(t=a,i=n)}this.quatDelay(Xs[i],Ls)}},{key:"clearTimerN",value:function(e){window.clearInterval(this._timers[e]),this._timers[e]=0}},{key:"delay",value:function(e,t,i){var r=i||"default";if(this._timers[r]&&this.clearTimerN(r),0===t)return e(1);if(!(t<0)){var n=0,a=(new Date).getTime();this._timers[r]=window.setInterval(function(){var i=((new Date).getTime()-a)/t;i=function(e){return-((e=Math.min(1,e)-1)*e*e*e-1)}(i),e(i-n,i),n=i,i>=1&&this.clearTimerN(r)}.bind(this),16.6)}}},{key:"_translateDelta",value:function(t,i){var r=this._trans;e.Ln(r,r,t,i),this.setTrans(r),this._main.render()}},{key:"translateDelay",value:function(e,t){var i=this._translateDelta.bind(this,e);this.delay(i,t,"translate")}},{key:"_rotDelta",value:function(e,t){if(this._mode===r.A.CameraMode.ORBIT){var i=this._rotX+e[0]*t,n=this._rotY+e[1]*t;this.setOrbit(i,n)}else ze(this._quatRot,Ue(Gs,e,e[3]*t),this._quatRot);this.updateView(),this._main.render()}},{key:"rotateDelay",value:function(e,t){var i=this._rotDelta.bind(this,e);this.delay(i,t,"rotate")}},{key:"_quatDelta",value:function(e,t){Be(Gs),function(e,t,i,r){var n,a,s,l,u,c=t[0],h=t[1],d=t[2],p=t[3],_=i[0],f=i[1],g=i[2],m=i[3];(a=c*_+h*f+d*g+p*m)<0&&(a=-a,_=-_,f=-f,g=-g,m=-m),1-a>o.p8?(n=Math.acos(a),s=Math.sin(n),l=Math.sin((1-r)*n)/s,u=Math.sin(r*n)/s):(l=1-r,u=r),e[0]=l*c+u*_,e[1]=l*h+u*f,e[2]=l*d+u*g,e[3]=l*p+u*m}(Gs,Gs,e,t);var i=this._quatRot;if(ze(this._quatRot,this._quatRot,Gs),this._mode===r.A.CameraMode.ORBIT){var n=i[0],a=i[1],s=i[2],l=i[3];this._rotY=Math.atan2(2*(l*a+s*n),1-2*(a*a+s*s)),this._rotX=Math.atan2(2*(l*n+a*s),1-2*(s*s+n*n))}this.updateView(),this._main.render()}},{key:"quatDelay",value:function(e,t){var i=[0,0,0,0];!function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(i,this._quatRot),ze(i,i,e),Ke(i,i);var r=this._quatDelta.bind(this,i);this.delay(r,t,"quat")}},{key:"_centerDelta",value:function(t,i){e.Ln(this._center,this._center,t,i),this.updateView(),this._main.render()}},{key:"centerDelay",value:function(t,i){var r=[0,0,0];e.jb(r,t,this._center);var n=this._centerDelta.bind(this,r);this.delay(n,i,"center")}},{key:"_offsetDelta",value:function(t,i){e.Ln(this._offset,this._offset,t,i),this.updateView(),this._main.render()}},{key:"offsetDelay",value:function(t,i){var r=[0,0,0];e.jb(r,t,this._offset);var n=this._offsetDelta.bind(this,r);this.delay(n,i,"offset")}},{key:"computeFrustumFit",value:function(){var e,t=this._near;if(this._projectionType===r.A.Projection.ORTHOGRAPHIC)return e=Math.min(this._width,this._height)/t*.5,Math.sqrt(1+e*e)/e;var i=this._proj,n=t*(i[8]-1)/i[0],a=t*(1+i[8])/i[0],s=t*(1+i[9])/i[5],o=t*(i[9]-1)/i[5],l=Math.abs(a-n),u=Math.abs(s-o);return e=Math.min(u,l)/t*.5,this._fov/45*Math.sqrt(1+e*e)/e}}],l&&Fs(i.prototype,l),t}();const Ys=Ks;function Hs(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var qs=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=i,this._gl=t,this._vertexBuffer=new p(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._texCoordBuffer=new p(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._fill=!0,this._monoTex=null,this._texture=null,this._texWidth=1,this._texHeight=1,this._type=0,this._blur=0,this.init()}var t,i;return t=e,(i=[{key:"init",value:function(){this.getTexCoordBuffer().update(new Float32Array([0,0,1,0,0,1,1,1])),this._monoTex=this.createOnePixelTexture(50,50,50,255),document.getElementById("backgroundopen").addEventListener("change",this.loadBackground.bind(this),!1)}},{key:"loadBackground",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var i=this,r=new FileReader;r.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){var e=i._main.getCanvas();i.loadBackgroundTexture(t),i.onResize(e.width,e.height),i._main.render()}},document.getElementById("backgroundopen").value="",r.readAsDataURL(t)}}}},{key:"getGL",value:function(){return this._gl}},{key:"getBlur",value:function(){return this._blur}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getTexCoordBuffer",value:function(){return this._texCoordBuffer}},{key:"release",value:function(){this.deleteTexture(),this.getVertexBuffer().release(),this.getTexCoordBuffer().release()}},{key:"getType",value:function(){return this._type}},{key:"setType",value:function(e){this._type=e}},{key:"onResize",value:function(e,t){var i=e/t/(this._texWidth/this._texHeight),r=this._fill||0!==this._type?1/i:i,n=r<1?1:1/i,a=r<1?i:1;this.getVertexBuffer().update(new Float32Array([-n,-a,n,-a,-n,a,n,a]))}},{key:"getTexture",value:function(){return this._texture?this._texture:this._monoTex}},{key:"createOnePixelTexture",value:function(e,t,i,r){var n=this._gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([e,t,i,r])),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,null),a}},{key:"loadBackgroundTexture",value:function(e){var t=this._gl;this.deleteTexture(),this._texWidth=e.width,this._texHeight=e.height,this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}},{key:"deleteTexture",value:function(){this._texture&&(this._texWidth=this._texHeight=1,this._gl.deleteTexture(this._texture),this._texture=null)}},{key:"render",value:function(){te[r.A.Shader.BACKGROUND].getOrCreate(this._gl).draw(this)}}])&&Hs(t.prototype,i),e}();const Zs=qs;function Qs(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Js=e.vt(),$s=e.vt(),eo=a.vt(),to=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=null,this._cameraSpeed=.25,this._pixelRatio=1,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("canvas"),this._canvasWidth=0,this._canvasHeight=0,this._canvasOffsetLeft=0,this._canvasOffsetTop=0,this._stateManager=new Rs(this),this._sculptManager=null,this._camera=new Ys(this),this._picking=new Ha.A(this),this._pickingSym=new Ha.A(this,!0),this._meshPreview=null,this._torusLength=.5,this._torusWidth=.1,this._torusRadius=2*Math.PI,this._torusRadial=32,this._torusTubular=128;var e=(0,s.A)();this._showContour=e.outline,this._showGrid=e.grid,this._grid=null,this._background=null,this._meshes=[],this._selectMeshes=[],this._mesh=null,this._rttContour=null,this._rttMerge=null,this._rttOpaque=null,this._rttTransparent=null,this._focusGui=!1,this._gui=new Is(this),this._preventRender=!1,this._drawFullScene=!1,this._autoMatrix=e.scalecenter,this._vertexSRGB=!0,this._autoRotateEnabled=!1,this._autoRotateSpeed=Math.PI/6,this._autoRotateAxis=1,this._autoRotatePivot=0,this._autoRotateLastTime=null}var i,o;return i=t,o=[{key:"start",value:function(){if(this.initWebGL(),this._gl){this._sculptManager=new Mr(this),this._background=new Zs(this._gl,this),this._rttContour=new In(this._gl,r.A.Shader.CONTOUR,null),this._rttMerge=new In(this._gl,r.A.Shader.MERGE,null),this._rttOpaque=new In(this._gl,r.A.Shader.FXAA),this._rttTransparent=new In(this._gl,null,this._rttOpaque.getDepth(),!0),this._grid=Wi.createGrid(this._gl),this.initGrid(),this.loadTextures(),this._gui.initGui(),this.onCanvasResize();var e=(0,s.A)().modelurl;e?this.addModelURL(e):this.addSphere()}}},{key:"addModelURL",value:function(e){var t=this.getFileType(e);if(t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="obj"===t?"text":"arraybuffer",i.onload=function(){200===i.status&&this.loadScene(i.response,t)}.bind(this),i.send(null)}}},{key:"getBackground",value:function(){return this._background}},{key:"getViewport",value:function(){return this._viewport}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getPixelRatio",value:function(){return this._pixelRatio}},{key:"getCanvasWidth",value:function(){return this._canvasWidth}},{key:"getCanvasHeight",value:function(){return this._canvasHeight}},{key:"getCamera",value:function(){return this._camera}},{key:"getGui",value:function(){return this._gui}},{key:"getMeshes",value:function(){return this._meshes}},{key:"getMesh",value:function(){return this._mesh}},{key:"getSelectedMeshes",value:function(){return this._selectMeshes}},{key:"getPicking",value:function(){return this._picking}},{key:"getPickingSymmetry",value:function(){return this._pickingSym}},{key:"getSculptManager",value:function(){return this._sculptManager}},{key:"getStateManager",value:function(){return this._stateManager}},{key:"setMesh",value:function(e){return this.setOrUnsetMesh(e)}},{key:"setCanvasCursor",value:function(e){this._canvas.style.cursor=e}},{key:"setAutoRotateEnabled",value:function(e){this._autoRotateEnabled=e,this._autoRotateLastTime=null,e&&this.render()}},{key:"setAutoRotateSpeed",value:function(e){this._autoRotateSpeed=e}},{key:"setAutoRotateAxis",value:function(e){this._autoRotateAxis=e}},{key:"setAutoRotatePivot",value:function(e){this._autoRotatePivot=e}},{key:"_updateAutoRotate",value:function(){if(this._autoRotateEnabled&&this._mesh){var t=performance.now();if(null!==this._autoRotateLastTime){var i=(t-this._autoRotateLastTime)/1e3;this._autoRotateLastTime=t;var r=this._autoRotateSpeed;if(r){var n=r*i,s=this._mesh,o=s.getMatrix();e.hZ($s,0,0,0),$s[this._autoRotateAxis]=1,a.D_(eo),0===this._autoRotatePivot?(e.Z0(Js,s.getCenter(),o),a.Tl(eo,eo,Js),a.e$(eo,eo,n,$s),a.Tl(eo,eo,[-Js[0],-Js[1],-Js[2]])):a.e$(eo,eo,n,$s),a.lK(o,eo,o),s.updateYawPitchRollFromMatrix()}}else this._autoRotateLastTime=t}}},{key:"initGrid",value:function(){var e=this._grid;e.normalizeSize();var t=e.getMatrix();a.Tl(t,t,[0,-.45,0]),a.hs(t,t,[2.5,2.5,2.5]),this._grid.setShaderType(r.A.Shader.FLAT),e.setFlatColor([.04,.04,.04])}},{key:"setOrUnsetMesh",value:function(e,t){if(e)if(t){var i=this.getIndexSelectMesh(e);i>=0?this._selectMeshes.length>1&&(this._selectMeshes.splice(i,1),e=this._selectMeshes[0]):this._selectMeshes.push(e)}else this._selectMeshes.length=0,this._selectMeshes.push(e);else this._selectMeshes.length=0;return this._mesh=e,this.getGui().updateMesh(),this.render(),e}},{key:"renderSelectOverRtt",value:function(){this._requestRender()&&(this._drawFullScene=!1)}},{key:"_requestRender",value:function(){return!0!==this._preventRender&&(window.requestAnimationFrame(this.applyRender.bind(this)),this._preventRender=!0,!0)}},{key:"render",value:function(){this._drawFullScene=!0,this._requestRender()}},{key:"applyRender",value:function(){this._preventRender=!1,this._updateAutoRotate(),this.updateMatricesAndSort();var e=this._gl;e&&(this._drawFullScene&&this._drawScene(),e.disable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttMerge.getFramebuffer()),this._rttMerge.render(this),e.bindFramebuffer(e.FRAMEBUFFER,null),this._rttOpaque.render(this),e.enable(e.DEPTH_TEST),this._sculptManager.postRender(),this._autoRotateEnabled&&this._mesh&&this.render())}},{key:"_drawScene",value:function(){var e=this._gl,t=0,i=this._meshes,n=i.length;e.disable(e.DEPTH_TEST);var a=this._selectMeshes.length>0&&this._showContour&&te[r.A.Shader.CONTOUR].color[3]>0;if(a){e.bindFramebuffer(e.FRAMEBUFFER,this._rttContour.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT);for(var s=0,o=this._selectMeshes,l=o.length;s<l;++s)o[s].renderFlatColor(this)}for(e.enable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._showGrid&&this._grid.render(this),t=0;t<n&&!i[t].isTransparent();++t)i[t].render(this);var u=t;for(this._meshPreview&&this._meshPreview.render(this),this._background.render(),e.bindFramebuffer(e.FRAMEBUFFER,this._rttTransparent.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.depthFunc(e.LESS),t=0;t<n;++t)i[t].getShowWireframe()&&i[t].renderWireframe(this);for(e.depthFunc(e.LEQUAL),e.depthMask(!1),e.enable(e.CULL_FACE),t=u;t<n;++t)e.cullFace(e.FRONT),i[t].render(this),e.cullFace(e.BACK),i[t].render(this);e.disable(e.CULL_FACE),a&&this._rttContour.render(this),e.depthMask(!0),e.disable(e.BLEND)}},{key:"updateMatricesAndSort",value:function(){var e=this._meshes,t=this._camera;e.length>0&&t.optimizeNearFar(this.computeBoundingBoxScene());for(var i=0,r=e.length;i<r;++i)e[i].updateMatrices(t);e.sort(zt.sortFunction),this._meshPreview&&this._meshPreview.updateMatrices(t),this._grid&&this._grid.updateMatrices(t)}},{key:"initWebGL",value:function(){var e={antialias:!1,stencil:!0},t=document.getElementById("canvas"),i=this._gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);i?(wn.initWebGLExtensions(i),wn.getWebGLExtension("OES_element_index_uint")||(Gt.ONLY_DRAW_ARRAYS=!0),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.disable(i.CULL_FACE),i.frontFace(i.CCW),i.cullFace(i.BACK),i.disable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.depthMask(!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):window.alert("Could not initialise WebGL. No WebGL, no SculptGL. Sorry.")}},{key:"loadTextures",value:function(){for(var e=this,t=this._gl,i=te[r.A.Shader.MATCAP],n=function(r,n){var a=new Image;a.src=r,a.onload=function(){i.createTexture(t,a,n),e.render()}},a=0,s=i.matcaps,o=s.length;a<o;++a)n(s[a].path,a);this.initAlphaTextures()}},{key:"initAlphaTextures",value:function(){for(var e=Ha.A.INIT_ALPHAS_PATHS,t=Ha.A.INIT_ALPHAS_NAMES,i=0,r=e.length;i<r;++i){var n=new Image;n.src="resources/alpha/"+e[i],n.onload=this.onLoadAlphaImage.bind(this,n,t[i])}}},{key:"onCanvasResize",value:function(){var e=this._viewport,t=e.clientWidth*this._pixelRatio,i=e.clientHeight*this._pixelRatio;this._canvasOffsetLeft=e.offsetLeft,this._canvasOffsetTop=e.offsetTop,this._canvasWidth=t,this._canvasHeight=i,this._canvas.width=t,this._canvas.height=i,this._gl.viewport(0,0,t,i),this._camera.onResize(t,i),this._background.onResize(t,i),this._rttContour.onResize(t,i),this._rttMerge.onResize(t,i),this._rttOpaque.onResize(t,i),this._rttTransparent.onResize(t,i),this.render()}},{key:"computeRadiusFromBoundingBox",value:function(e){var t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return.5*Math.sqrt(t*t+i*i+r*r)}},{key:"computeBoundingBoxMeshes",value:function(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],i=0,r=e.length;i<r;++i)if(e[i].isVisible()){var n=e[i].computeWorldBound();n[0]<t[0]&&(t[0]=n[0]),n[1]<t[1]&&(t[1]=n[1]),n[2]<t[2]&&(t[2]=n[2]),n[3]>t[3]&&(t[3]=n[3]),n[4]>t[4]&&(t[4]=n[4]),n[5]>t[5]&&(t[5]=n[5])}return t}},{key:"computeBoundingBoxScene",value:function(){var e=this._meshes.slice();return e.push(this._grid),this._sculptManager.addSculptToScene(e),this.computeBoundingBoxMeshes(e)}},{key:"normalizeAndCenterMeshes",value:function(t){var i=this.computeBoundingBoxMeshes(t),r=n.A.SCALE/e.xg([i[0],i[1],i[2]],[i[3],i[4],i[5]]),s=a.vt();a.hs(s,s,[r,r,r]),a.Tl(s,s,[.5*-(i[0]+i[3]),.5*-(i[1]+i[4]),.5*-(i[2]+i[5])]);for(var o=0,l=t.length;o<l;++o){var u=t[o].getMatrix();a.lK(u,s,u)}}},{key:"addSphere",value:function(){var e=new ra(Wi.createCube(this._gl));return e.normalizeSize(),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addCube",value:function(){var e=new ra(Wi.createCube(this._gl));return e.normalizeSize(),a.hs(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e,!0),this.addNewMesh(e)}},{key:"addPlane",value:function(){var e=new ra(Wi.createPlane(this._gl));return e.normalizeSize(),this.subdivideClamp(e,!0),this.addNewMesh(e)}},{key:"addCylinder",value:function(){var e=new ra(Wi.createCylinder(this._gl));return e.normalizeSize(),a.hs(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addTorus",value:function(e){var t=new ra(Wi.createTorus(this._gl,this._torusLength,this._torusWidth,this._torusRadius,this._torusRadial,this._torusTubular));if(e){t.setShowWireframe(!0);var i=.3*n.A.SCALE;return a.hs(t.getMatrix(),t.getMatrix(),[i,i,i]),void(this._meshPreview=t)}t.normalizeSize(),this.subdivideClamp(t),this.addNewMesh(t)}},{key:"subdivideClamp",value:function(e,t){for(wr.LINEAR=!!t;e.getNbFaces()<5e4;)e.addLevel();e._meshes.splice(0,Math.min(e._meshes.length-4,4)),e._sel=e._meshes.length-1,wr.LINEAR=!1}},{key:"addNewMesh",value:function(e){return this._meshes.push(e),this._stateManager.pushStateAdd(e),this.setMesh(e),e}},{key:"loadScene",value:function(e,t){var i;"obj"===t?i=qr.importOBJ(e,this._gl):"sgl"===t?i=qr.importSGL(e,this._gl,this):"stl"===t?i=qr.importSTL(e,this._gl):"ply"===t&&(i=qr.importPLY(e,this._gl));var r=i.length;if(0!==r){for(var a=this._meshes,s=0;s<r;++s){var o=i[s]=new ra(i[s]);!this._vertexSRGB&&o.getColors()&&n.A.convertArrayVec3toSRGB(o.getColors()),o.init(),o.initRender(),a.push(o)}return this._autoMatrix&&this.normalizeAndCenterMeshes(i),this._stateManager.pushStateAdd(i),this.setMesh(a[a.length-1]),this.resetCameraMeshes(i),i}}},{key:"clearScene",value:function(){this.getStateManager().reset(),this.getMeshes().length=0,this.getCamera().resetView(),this.setMesh(null),this._action=r.A.Action.NOTHING}},{key:"deleteCurrentSelection",value:function(){this._mesh&&(this.removeMeshes(this._selectMeshes),this._stateManager.pushStateRemove(this._selectMeshes.slice()),this._selectMeshes.length=0,this.setMesh(null))}},{key:"removeMeshes",value:function(e){for(var t=this._meshes,i=0;i<e.length;++i)t.splice(this.getIndexMesh(e[i]),1)}},{key:"getIndexMesh",value:function(e,t){for(var i=t?this._selectMeshes:this._meshes,r=e.getID(),n=0,a=i.length;n<a;++n){var s=i[n];if(s===e||s.getID()===r)return n}return-1}},{key:"getIndexSelectMesh",value:function(e){return this.getIndexMesh(e,!0)}},{key:"replaceMesh",value:function(e,t){var i=this.getIndexMesh(e);i>=0&&(this._meshes[i]=t),this._mesh===e&&this.setMesh(t)}},{key:"duplicateSelection",value:function(){for(var e=this._selectMeshes.slice(),t=null,i=0;i<e.length;++i){t=e[i];var r=new Qt(t.getGL());r.copyData(t),this.addNewMesh(r)}this.setMesh(t)}},{key:"onLoadAlphaImage",value:function(e,t,i){var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var n=r.getContext("2d");n.drawImage(e,0,0);for(var a=n.getImageData(0,0,e.width,e.height).data,s=a.subarray(0,a.length/4),o=0,l=0,u=s.length;o<u;++o,l+=4)s[o]=Math.round((a[l]+a[l+1]+a[l+2])/3);var c={};c[t=Ha.A.addAlpha(s,e.width,e.height,t)._name]=t,this.getGui().addAlphaOptions(c),i&&i._ctrlAlpha&&i._ctrlAlpha.setValue(t)}}],o&&Qs(i.prototype,o),t}();function io(e){return io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},io(e)}function ro(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function no(e,t){return no=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},no(e,t)}function ao(e){return ao=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ao(e)}const so=function(a){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&no(e,t)}(h,a);var s,o,l,u,c=(l=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=ao(l);if(u){var i=ao(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=c.call(this))._mouseX=0,e._mouseY=0,e._lastMouseX=0,e._lastMouseY=0,e._lastScale=0,e._action=r.A.Action.NOTHING,e._lastNbPointers=0,e._isWheelingIn=!1,e._maskX=0,e._maskY=0,e._hammer=new t.Manager(e._canvas),e._eventProxy={},e.initHammer(),e.addEvents(),e}return s=h,(o=[{key:"addEvents",value:function(){var e=this._canvas,t=this.onMouseWheel.bind(this),i=this.onPointer.bind(this);e.addEventListener("pointerdown",i,!1),e.addEventListener("pointermove",i,!1),e.addEventListener("mousedown",this.onMouseDown.bind(this),!1),e.addEventListener("mouseup",this.onMouseUp.bind(this),!1),e.addEventListener("mouseout",this.onMouseOut.bind(this),!1),e.addEventListener("mouseover",this.onMouseOver.bind(this),!1),e.addEventListener("mousemove",n.A.throttle(this.onMouseMove.bind(this),16.66),!1),e.addEventListener("mousewheel",t,!1),e.addEventListener("DOMMouseScroll",t,!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1);var r=this.loadFiles.bind(this),a=this.stopAndPrevent.bind(this);e.addEventListener("webglcontextlost",this.onContextLost.bind(this),!1),e.addEventListener("webglcontextrestored",this.onContextRestored.bind(this),!1),window.addEventListener("dragenter",a,!1),window.addEventListener("dragover",a,!1),window.addEventListener("drop",r,!1),document.getElementById("fileopen").addEventListener("change",r,!1)}},{key:"onPointer",value:function(e){i.A.pressure=e.pressure}},{key:"initHammer",value:function(){this._hammer.options.enable=!0,this._initHammerRecognizers(),this._initHammerEvents()}},{key:"_initHammerRecognizers",value:function(){var e=this._hammer;e.add(new t.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new t.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new t.Pan({event:"pan",pointers:0,threshold:0})),e.add(new t.Pinch({event:"pinch",pointers:2,threshold:.1})),e.get("pinch").recognizeWith(e.get("pan"))}},{key:"_initHammerEvents",value:function(){var e=this._hammer;e.on("panstart",this.onPanStart.bind(this)),e.on("panmove",this.onPanMove.bind(this)),e.on("panend pancancel",this.onPanEnd.bind(this)),e.on("doubletap",this.onDoubleTap.bind(this)),e.on("doubletap2fingers",this.onDoubleTap2Fingers.bind(this)),e.on("pinchstart",this.onPinchStart.bind(this)),e.on("pinchin pinchout",this.onPinchInOut.bind(this))}},{key:"stopAndPrevent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onContextLost",value:function(){window.alert("Oops... WebGL context lost.")}},{key:"onContextRestored",value:function(){window.alert("Wow... Context is restored.")}},{key:"onKeyDown",value:function(e){this._gui.callFunc("onKeyDown",e)}},{key:"onKeyUp",value:function(e){this._gui.callFunc("onKeyUp",e)}},{key:"onPanStart",value:function(e){if("mouse"!==e.pointerType){this._focusGui=!1;var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this.onPanUpdateNbPointers(Math.min(3,e.pointers.length))}}},{key:"onPanMove",value:function(e){if("mouse"!==e.pointerType){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y;var i=Math.min(3,e.pointers.length);i!==this._lastNbPointers&&(this.onDeviceUp(),this.onPanUpdateNbPointers(i)),this.onDeviceMove(t),this._isIOS()&&(window.clearTimeout(this._timerResetPointer),this._timerResetPointer=window.setTimeout(function(){this._lastNbPointers=0}.bind(this),60))}}},{key:"_isIOS",value:function(){return void 0!==this._isIOS||(this._isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)),this._isIOS}},{key:"onPanUpdateNbPointers",value:function(e){var t=this._eventProxy;t.which=1===e&&this._lastNbPointers>=1?3:e,this._lastNbPointers=e,this.onDeviceDown(t)}},{key:"onPanEnd",value:function(e){"mouse"!==e.pointerType&&(this.onDeviceUp(),window.setTimeout(function(){e.pointers.length||(this._lastNbPointers=0)}.bind(this),60))}},{key:"onDoubleTap",value:function(t){if(!this._focusGui){var i=this._eventProxy;i.pageX=t.center.x,i.pageY=t.center.y,this.setMousePosition(i);var r=this._picking,n=r.intersectionMouseMeshes(),a=this._camera,s=[0,0,0];if(!n)return this.resetCameraMeshes();e.Z0(s,r.getIntersectionPoint(),r.getMesh().getMatrix());var o=a._trans[2];a.isOrthographic()||(o=Math.min(o,e.xg(s,a.computePosition()))),a.setAndFocusOnPivot(s,o),this.render()}}},{key:"onDoubleTap2Fingers",value:function(){this._focusGui||this.resetCameraMeshes()}},{key:"onPinchStart",value:function(e){this._focusGui=!1,this._lastScale=e.scale}},{key:"onPinchInOut",value:function(e){var t=25*(e.scale-this._lastScale);this._lastScale=e.scale,this.onDeviceWheel(t)}},{key:"resetCameraMeshes",value:function(t){if(t||(t=this._meshes),t.length>0){var i=[0,0,0],r=this.computeBoundingBoxMeshes(t),n=.8*this.computeRadiusFromBoundingBox(r);n*=this._camera.computeFrustumFit(),e.hZ(i,.5*(r[0]+r[3]),.5*(r[1]+r[4]),.5*(r[2]+r[5])),this._camera.setAndFocusOnPivot(i,n)}else this._camera.resetView();this.render()}},{key:"getFileType",value:function(e){var t=e.toLowerCase();return t.endsWith(".obj")?"obj":t.endsWith(".sgl")?"sgl":t.endsWith(".stl")?"stl":t.endsWith(".ply")?"ply":void 0}},{key:"loadFiles",value:function(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer?e.dataTransfer.files:e.target.files,i=0,r=t.length;i<r;++i){var n=t[i],a=this.getFileType(n.name);this.readFile(n,a)}}},{key:"readFile",value:function(e,t){var i=t||this.getFileType(e.name);if(i){var r=new FileReader,n=this;r.onload=function(e){n.loadScene(e.target.result,i),document.getElementById("fileopen").value=""},"obj"===i?r.readAsText(e):r.readAsArrayBuffer(e)}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseDown",e),this.onDeviceDown(e)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseMove",e),this.onDeviceMove(e)}},{key:"onMouseOver",value:function(e){this._focusGui=!1,this._gui.callFunc("onMouseOver",e)}},{key:"onMouseOut",value:function(e){this._focusGui=!0,this._gui.callFunc("onMouseOut",e),this.onMouseUp(e)}},{key:"onMouseUp",value:function(e){e.preventDefault(),this._gui.callFunc("onMouseUp",e),this.onDeviceUp()}},{key:"onMouseWheel",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseWheel",e);var t=void 0===e.wheelDelta?-e.detail:e.wheelDelta;this.onDeviceWheel(t>0?1:-1)}},{key:"onDeviceUp",value:function(){this.setCanvasCursor("default"),ra.RENDER_HINT=ra.NONE,this._sculptManager.end(),this._action===r.A.Action.MASK_EDIT&&this._mesh&&(this._lastMouseX===this._maskX&&this._lastMouseY===this._maskY?this.getSculptManager().getTool(r.A.Tools.MASKING).invert():this.getSculptManager().getTool(r.A.Tools.MASKING).clear()),this._action=r.A.Action.NOTHING,this.render(),this._stateManager.cleanNoop()}},{key:"onDeviceWheel",value:function(e){e>0&&!this._isWheelingIn&&(this._isWheelingIn=!0,this._camera.start(this._mouseX,this._mouseY)),this._camera.zoom(.02*e),ra.RENDER_HINT=ra.CAMERA,this.render(),this._timerEndWheel&&window.clearTimeout(this._timerEndWheel),this._timerEndWheel=window.setTimeout(this._endWheel.bind(this),300)}},{key:"_endWheel",value:function(){ra.RENDER_HINT=ra.NONE,this._isWheelingIn=!1,this.render()}},{key:"setMousePosition",value:function(e){this._mouseX=this._pixelRatio*(e.pageX-this._canvasOffsetLeft),this._mouseY=this._pixelRatio*(e.pageY-this._canvasOffsetTop)}},{key:"onDeviceDown",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,i=this._mouseY,n=e.which,a=!1;1===n&&(a=this._sculptManager.start(e.shiftKey)),1===n&&a&&this.setCanvasCursor("none"),3===n&&e.ctrlKey?this._action=r.A.Action.CAMERA_ZOOM:2===n?this._action=r.A.Action.CAMERA_PAN:!a&&e.ctrlKey?(this._maskX=t,this._maskY=i,this._action=r.A.Action.MASK_EDIT):a&&3!==n||!e.altKey?this._action=3===n||1===n&&!a?r.A.Action.CAMERA_ROTATE:r.A.Action.SCULPT_EDIT:this._action=r.A.Action.CAMERA_PAN_ZOOM_ALT,this._action!==r.A.Action.CAMERA_ROTATE&&this._action!==r.A.Action.CAMERA_ZOOM||this._camera.start(t,i),this._lastMouseX=t,this._lastMouseY=i}}},{key:"getSpeedFactor",value:function(){return this._cameraSpeed/(this._canvasHeight*this.getPixelRatio())}},{key:"onDeviceMove",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,i=this._mouseY,n=this._action,a=this.getSpeedFactor();n===r.A.Action.CAMERA_ZOOM||n===r.A.Action.CAMERA_PAN_ZOOM_ALT&&!e.altKey?(ra.RENDER_HINT=ra.CAMERA,this._camera.zoom((t-this._lastMouseX+i-this._lastMouseY)*a),this.render()):n===r.A.Action.CAMERA_PAN_ZOOM_ALT||n===r.A.Action.CAMERA_PAN?(ra.RENDER_HINT=ra.CAMERA,this._camera.translate((t-this._lastMouseX)*a,(i-this._lastMouseY)*a),this.render()):n===r.A.Action.CAMERA_ROTATE?(ra.RENDER_HINT=ra.CAMERA,e.shiftKey||this._camera.rotate(t,i),this.render()):(ra.RENDER_HINT=ra.PICKING,this._sculptManager.preUpdate(),n===r.A.Action.SCULPT_EDIT&&(ra.RENDER_HINT=ra.SCULPT,this._sculptManager.update(this),this.getMesh().isDynamic&&this._gui.updateMeshInfo())),this._lastMouseX=t,this._lastMouseY=i,this.renderSelectOverRtt()}}}])&&ro(s.prototype,o),h}(to);window.SculptGL=so;const oo=so})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})());